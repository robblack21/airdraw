<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AirDraw</title>


    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: #000;
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }
      #app {
        width: 100vw;
        height: 100vh;
      }
      #ui {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        pointer-events: none;
        padding: 20px;
        box-sizing: border-box;
      }
      #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 24px;
        pointer-events: auto;
        background: rgba(0, 0, 0, 0.85);
        padding: 30px 40px;
        border-radius: 16px;
        z-index: 1000;
        text-align: center;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      #loading-details {
        font-size: 14px;
        color: #aaa;
        margin-top: 10px;
      }
      .hidden {
        display: none !important;
      }

      /* Drawing indicator */
      #draw-indicator {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 8px 20px;
        background: rgba(0, 0, 0, 0.6);
        border-radius: 20px;
        font-size: 14px;
        pointer-events: none;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        opacity: 0;
        transition: opacity 0.3s;
      }
      #draw-indicator.active {
        opacity: 1;
      }

      /* Color swatch */
      #color-preview {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.5);
        display: inline-block;
        vertical-align: middle;
        cursor: pointer;
      }

      /* Call controls bar */
      #call-controls {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 6px;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 24px;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        pointer-events: auto;
        z-index: 2000;
      }
      #call-controls button {
        background: transparent;
        border: none;
        font-size: 20px;
        cursor: pointer;
        padding: 10px;
        border-radius: 50%;
        transition: background 0.2s;
        min-width: 44px;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #call-controls button:hover {
        background: rgba(255, 255, 255, 0.1);
      }
      .ctrl-divider {
        width: 1px;
        background: rgba(255, 255, 255, 0.15);
        margin: 4px 2px;
      }

      /* Settings menu */
      #settings-menu {
        position: absolute;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.85);
        padding: 15px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        z-index: 2000;
        display: flex;
        flex-direction: column;
        gap: 10px;
        min-width: 220px;
      }
      #settings-menu label {
        display: block;
        font-size: 12px;
        color: #aaa;
        margin-bottom: 4px;
      }
      #settings-menu select,
      #settings-menu input[type="range"] {
        width: 100%;
        background: #222;
        color: white;
        border: 1px solid #444;
        padding: 4px;
        border-radius: 4px;
      }

      /* Color palette */
      #color-palette {
        position: absolute;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.85);
        padding: 12px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        z-index: 2000;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        max-width: 240px;
        justify-content: center;
      }
      .color-swatch {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid transparent;
        transition:
          border-color 0.2s,
          transform 0.15s;
      }
      .color-swatch:hover {
        transform: scale(1.15);
      }
      .color-swatch.selected {
        border-color: white;
      }

      /* Scene tree panel */
      #scene-tree-panel {
        position: absolute;
        top: 80px;
        right: 16px;
        width: 220px;
        background: rgba(0,0,0,0.82);
        padding: 12px;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.12);
        backdrop-filter: blur(20px);
        z-index: 2000;
        pointer-events: auto;
      }
      .scene-tree-item {
        padding: 6px 8px;
        margin: 2px 0;
        font-size: 12px;
        color: #bbb;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.15s, color 0.15s;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .scene-tree-item:hover {
        background: rgba(255,255,255,0.08);
        color: #fff;
      }
      .scene-tree-item.selected {
        background: rgba(100,160,255,0.18);
        color: #6af;
      }
      .scene-tree-icon {
        font-size: 14px;
      }

      /* Help panel */
      #help-panel {
        position: absolute;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.88);
        padding: 16px 20px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        z-index: 2000;
        pointer-events: auto;
        max-width: 420px;
        width: 90vw;
      }
      .help-section {
        margin-bottom: 10px;
      }
      .help-section:last-child {
        margin-bottom: 0;
      }
      .help-heading {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #888;
        margin-bottom: 4px;
        border-bottom: 1px solid rgba(255,255,255,0.08);
        padding-bottom: 3px;
      }
      .help-row {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 12px;
        color: #bbb;
        padding: 2px 0;
      }
      .help-row span:last-child {
        margin-left: auto;
        color: #999;
      }
      .help-row kbd {
        display: inline-block;
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.2);
        border-radius: 4px;
        padding: 1px 6px;
        font-family: monospace;
        font-size: 11px;
        min-width: 18px;
        text-align: center;
        color: #ddd;
      }
      .help-icon {
        font-size: 14px;
        margin-right: 2px;
      }
    </style>
    <script type="importmap">
      {
        "imports": {
          "@mediapipe/tasks-vision": "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.32/vision_bundle.mjs",
          "three": "/airdraw/three-polyfill.js",
          "three/addons/": "https://unpkg.com/three@0.178.0/examples/jsm/"
        }
      }
    </script>
    <script type="module" crossorigin src="/airdraw/assets/index-CtFD-6IK.js"></script>
  </head>
  <body>
    <div id="loading">
      <div>AirDraw</div>
      <div id="loading-details"></div>
      <button
        id="start-btn"
        class="hidden"
        style="
          background: #333;
          color: white;
          border: 1px solid #555;
          padding: 8px 16px;
          cursor: pointer;
          border-radius: 4px;
          margin-top: 10px;
        "
      >
        Enter Room
      </button>
    </div>
    <div id="app"></div>
    <div id="ui"></div>

    <!-- Drawing state indicator -->
    <div id="draw-indicator">Pinch to draw</div>

    <!-- Hidden webcam video element (used by hand tracking + video call) -->
    <video id="video" style="display:none" autoplay muted playsinline></video>

    <!-- Call Controls -->
    <div id="call-controls">
      <button id="btn-mic" title="Toggle Microphone">üé§</button>
      <button id="btn-cam" title="Toggle Camera">üì∑</button>
      <button id="btn-head" title="Toggle Head Tracking">üòé</button>
      <button id="btn-hand" title="Toggle Hand Tracking">‚úã</button>
      <div class="ctrl-divider"></div>
      <button id="btn-color" title="Color Palette">
        <span id="color-preview" style="background: #c0c0c0"></span>
      </button>
      <button id="btn-undo" title="Undo Last Stroke">‚Ü©</button>
      <button id="btn-clear" title="Clear All">üóë</button>
      <button id="btn-physics" title="Toggle Physics">‚ö°</button>
      <button id="btn-gravity" title="Toggle Gravity">üåç</button>
      <div class="ctrl-divider"></div>
      <button id="btn-cube" title="Add Cube">üî≤</button>
      <button id="btn-sphere" title="Add Sphere">üîµ</button>
      <button id="btn-cylinder" title="Add Cylinder">üî∑</button>
      <button id="btn-torus" title="Add Torus">üç©</button>
      <div class="ctrl-divider"></div>
      <button id="btn-scene-tree" title="Scene Tree">üå≥</button>
      <button id="btn-quat-ball" title="Precision Rotation">üé±</button>
      <div class="ctrl-divider"></div>
      <button id="btn-reflection" title="Toggle Webcam Reflections">ü™û</button>
      <button id="btn-settings" title="Settings">‚öôÔ∏è</button>
      <button id="btn-help" title="Keyboard Shortcuts">?</button>
    </div>

    <!-- Color Palette -->
    <div id="color-palette" class="hidden"></div>

    <!-- Scene Tree Panel -->
    <div id="scene-tree-panel" class="hidden">
      <div
        style="
          font-size: 13px;
          font-weight: 600;
          margin-bottom: 8px;
          color: #ccc;
        "
      >
        Scene Objects
      </div>
      <div
        id="scene-tree-list"
        style="max-height: 300px; overflow-y: auto"
      ></div>
    </div>

    <!-- Settings Menu -->
    <div id="settings-menu" class="hidden">
      <div>
        <label>Microphone</label>
        <select id="audio-select"></select>
      </div>
      <div>
        <label>Camera</label>
        <select id="video-select"></select>
      </div>
      <div>
        <label>Thickness</label>
        <input
          id="brush-size"
          type="range"
          min="5"
          max="60"
          step="1"
          value="24"
        />
        <span id="brush-size-val" style="font-size: 12px; color: #aaa">24</span>
      </div>
      <div>
        <label>Draw Depth</label>
        <input
          id="draw-depth"
          type="range"
          min="0.5"
          max="4.0"
          step="0.1"
          value="1.5"
        />
        <span id="draw-depth-val" style="font-size: 12px; color: #aaa"
          >1.5m</span
        >
      </div>
      <div>
        <label>Hand Tracking Rate</label>
        <input
          id="hand-fps"
          type="range"
          min="1"
          max="30"
          step="1"
          value="30"
        />
        <span id="hand-fps-val" style="font-size: 12px; color: #aaa">30 fps</span>
        <span id="hand-fps-stats" style="font-size: 10px; color: #666; display: block; margin-top: 2px;"></span>
      </div>
    </div>

    <!-- Help / Keyboard Map -->
    <div id="help-panel" class="hidden">
      <div style="font-size:14px;font-weight:600;margin-bottom:10px;color:#eee;">Keyboard & Mouse Controls</div>
      <div class="help-section">
        <div class="help-heading">Camera</div>
        <div class="help-row"><kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd><span>Move</span></div>
        <div class="help-row"><kbd>Q</kbd><kbd>E</kbd><span>Down / Up</span></div>
        <div class="help-row"><kbd>I</kbd><kbd>J</kbd><kbd>K</kbd><kbd>L</kbd><span>Look</span></div>
        <div class="help-row"><kbd>[</kbd><kbd>]</kbd><span>Zoom out / in</span></div>
        <div class="help-row"><span class="help-icon">üñ±</span> Scroll<span>Zoom</span></div>
      </div>
      <div class="help-section">
        <div class="help-heading">Selected Object</div>
        <div class="help-row"><span>Click object to select</span></div>
        <div class="help-row"><kbd>T</kbd><kbd>B</kbd><span>Move up / down</span></div>
        <div class="help-row"><kbd>G</kbd><kbd>H</kbd><span>Move left / right</span></div>
        <div class="help-row"><kbd>F</kbd><kbd>V</kbd><span>Move fwd / back</span></div>
        <div class="help-row"><kbd>R</kbd><kbd>Y</kbd><span>Pitch</span></div>
        <div class="help-row"><kbd>O</kbd><kbd>P</kbd><span>Yaw</span></div>
        <div class="help-row"><kbd>,</kbd><kbd>.</kbd><span>Scale down / up</span></div>
        <div class="help-row"><kbd>Esc</kbd><span>Deselect</span></div>
      </div>
      <div class="help-section">
        <div class="help-heading">Drawing</div>
        <div class="help-row"><span>Pinch thumb + index to draw</span></div>
        <div class="help-row"><span>Open hand pushes physics objects</span></div>
      </div>
    </div>

  </body>
</html>
