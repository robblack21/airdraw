
> chess@1.0.0 build
> vite build

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
vite v5.4.21 building for production...
transforming...

new URL("data:application/wasm;base64,AGFzbQEAAAABzAEeYAJ/fwF/YAJ/fwBgA39/fwF/YAF/AX9gA39/fwBgAX8AYAV/f39/fwBgA29/fwFvYAV/f39/fwF/YAFvAW9gA29vfwBgAW8Bf2AAAX9gBH9/f38AYAAAYAR/f39/AX9gA39vbwF/YAF/AW9gAAFvYAF9AX1gBn9/f39/fwBgDX19fX19fX19f29/fX0Bb2AGf39/f39/AX9gBX9/fH9/AGAEf3x/fwBgBX9/fX9/AGAEf31/fwBgBX9/fn9/AGAEf35/fwBgAn19AX0C8gQRA3diZx1fX3diZ19idWZmZXJfNjA5Y2MzZWVlNTFlZDE1OAAJA3diZxpfX3diZ19uZXdfOWZlZTk3YTQwOWIzMmI2OAAJA3diZxpfX3diZ19zZXRfZjRmMWYwZGFhMzA2OTZmYwAKA3diZx1fX3diZ19sZW5ndGhfOGNmZDJjNjQwOWFmODhhZAALA3diZzFfX3diZ19uZXd3aXRoYnl0ZW9mZnNldGFuZGxlbmd0aF9mMWRlYWQ0NGQxZmM3MjEyAAcDd2JnGl9fd2JnX25ld19lM2IzMjFkY2ZlZjg5ZmM3AAkDd2JnGl9fd2JnX3NldF9kMjM2NjFkMTkxNDhiMjI5AAoDd2JnHV9fd2JnX2xlbmd0aF82Y2E1Mjc2NjVkODk2OTRkAAsDd2JnMV9fd2JnX25ld3dpdGhieXRlb2Zmc2V0YW5kbGVuZ3RoX2U2YjdlNjlhY2Q0YzczNTQABwN3YmcaX193Ymdfc2V0XzEwYmFkOWJlZTBlOWM1OGIACgN3YmcdX193YmdfbGVuZ3RoXzNiNGYwMjIxODhhZThkYjYACwN3YmcfX193Ymdfc3ViYXJyYXlfNzY5ZTFlMGY4MWJiMjU5YgAHA3diZx9fX3diZ19zdWJhcnJheV8zYWFlZWM4OWJiMjU0NGYwAAcDd2JnJF9fd2JnX25ld3dpdGhsZW5ndGhfNWE1ZWZlMzEzY2ZkNTlmMQARA3diZxBfX3diaW5kZ2VuX3Rocm93AAEDd2JnEV9fd2JpbmRnZW5fbWVtb3J5ABIDd2JnH19fd2JpbmRnZW5faW5pdF9leHRlcm5yZWZfdGFibGUADgNhYAMAAQIIBQQCEwEMAAEBAgAAAQwBBAYFBQQAAQYFFAENBAAGBQQEAQQOAgECAQAIBAAVARYG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ACIDKAIEQXhxRgRAIAMhAgwBCyABQRkgAkEBdmtBACACQR9HG3QhBQNAIAMgBUEddkEEcWpBEGoiBCgCACICRQ0CIAVBAXQhBSACIQMgAigCBEF4cSABRw0ACwsgAigCCCIBIAA2AgwgAiAANgIIIABBADYCGCAAIAI2AgwgACABNgIIDwsgBCAANgIAIAAgAzYCGCAAIAA2AgwgACAANgIIC/MCAQR/IwBBMGsiACQAAkACQEGQksAAKAIARQRAQaiSwAAoAgAhAUGoksAAQQA2AgAgAUUNASAAQRhqIAERBQAgAEEQaiICIABBJGopAgA3AwAgACAAKQIcNwMIIAAoAhghAUGQksAAKAIAIgMNAgJAIANFDQBBlJLAACgCACICRQ0AQZiSwAAoAgAgAkECdBBlC0GUksAAIAE2AgBBkJLAAEEBNgIAQZiSwAAgACkDCDcCAEGgksAAIABBEGopAwA3AgALIABBMGokAEGUksAADwsgAEEANgIoIABBATYCHCAAQaCHwAA2AhggAEIENwIgIABBGGpBiIjAABBDAAsgAEEoaiACKQMANwIAIAAgACkDCDcCICAAIAE2AhwgAEEBNgIYAkAgAEEYaiIBKAIARQ0AIAEoAgQiAkUNACABKAIIIAJBAnQQZQsgAEEANgIoIABBATYCHCAAQaiIwAA2AhggAEIENwIgIAFBsIjAABBDAAuoAgIDfwF+IwBBQGoiAiQAIAEoAgBBgICAgHhGBEAgASgCDCEDIAJBJGoiBEEANgIAIAJCgICAgBA3AhwgAkEwaiADKAIAIgNBCGopAgA3AwAgAkE4aiADQRBqKQIANwMAIAIgAykCADcDKCACQRxqQcCIwAAgAkEoahAYGiACQRhqIAQoAgAiAzYCACACIAIpAhwiBTcDECABQQhqIAM2AgAgASAFNwIACyABKQIAIQUgAUKAgICAEDcCACACQQhqIgMgAUEIaiIBKAIANgIAIAFBADYCAEGxk8AALQAAGiACIAU3AwBBDEEEEF0iAUUEQEEEQQwQbQALIAEgAikDADcCACABQQhqIAMoAgA2AgAgAEHgisAANgIEIAAgATYCACACQUBrJAAL0gECBH8BfiMAQSBrIgMkACABIAEgAmoiAksEQEEAQQAQUgALQQggACgCACIEQQF0IgEgAiABIAJLGyICIAJBCEkb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QQRqrUKAgICA4ACENwMoIAEgAa1CgICAgOAAhDcDICABIAFBIGo2AhAgAUEIakHIj8AAEEMAC2kCAX8BfiMAQTBrIgMkACADIAE2AgQgAyAANgIAIANBAjYCDCADQfyNwAA2AgggA0ICNwIUIANCgICAgOAAIgQgA62ENwMoIAMgBCADQQRqrYQ3AyAgAyADQSBqNgIQIANBCGogAhBDAAtpAgF/AX4jAEEwayIDJAAgAyAANgIAIAMgATYCBCADQQI2AgwgA0H4kcAANgIIIANCAjcCFCADQoCAgIDgACIEIANBBGqthDcDKCADIAQgA62ENwMgIAMgA0EgajYCECADQQhqIAIQQwALZgAjAEEwayIAJABBsJPAAC0AAARAIABBAjYCDCAAQbCKwAA2AgggAEIBNwIUIAAgATYCLCAAIABBLGqtQoCAgIDgAIQ3AyAgACAAQSBqNgIQIABBCGpB0IrAABBDAAsgAEEwaiQAC5QBAgN/AW8jAEEgayIDJAAgAyAAKAIAEHAiBDYCACADIAI2AgQgAiAERwRAIANBADYCCCADIANBBGogA0EIahBAAAsQWyIEEFMiBSUBEAUhBhAbIgIgBiYBIAVBhAFPBEAgBRAtCyACIAAoAgAgAUECdhBkIAJBhAFPBEAgAhAtCyAEQYQBTwRAIAQQLQsgA0EgaiQAC08BAX8jAEEwayIAJAAgAEEBNgIMIABBwI3AADYCCCAAQgE3AhQgACAAQS9qrUKAgICAoAWENwMgIAAgAEEgajYCECAAQQhqQcSBwAAQQwALQQEBfyACIAAoAgAgACgCCCIDa0sEQCAAIAMgAhAlIAAoAgghAwsgACgCBCADaiABIAIQHxogACACIANqNgIIQQALTQECf0Gxk8AALQAAGiABKAIEIQIgASgCACEDQQhBBBBdIgFFBEBBBEEIEG0ACyABIAI2AgQgASADNgIAIABB8IrAADYCBCAAIAE2AgALQQEBfyACIAAoAgAgACgCCCIDa0sEQCAAIAMgAhApIAAoAgghAwsgACgCBCADaiABIAIQHxogACACIANqNgIIQQALQQEBfyMAQSBrIgIkACACQQA2AhAgAkEBNgIEIAJCBDcCCCACQS42AhwgAiAANgIYIAIgAkEYajYCACACIAEQQwALswIBA38gACgCACECIAEoAhwiAEEQcUUE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ZCByZWN1cnNpdmVseSBvciBhZnRlciBiZWluZyBkcm9wcGVkTGF6eSBpbnN0YW5jZSBoYXMgcHJldmlvdXNseSBiZWVuIHBvaXNvbmVkdgMQACoAAAAvVXNlcnMvZG1hcmNvcy8uY2FyZ28vcmVnaXN0cnkvc3JjL2luZGV4LmNyYXRlcy5pby02ZjE3ZDIyYmJhMTUwMDFmL29uY2VfY2VsbC0xLjIxLjMvc3JjL2xpYi5ycwCoAxAAXwAAAAgDAAAZAAAAcmVlbnRyYW50IGluaXQAABgEEAAOAAAAqAMQAF8AAAB6AgAADQAAABYAAAAMAAAABAAAABcAAAAYAAAAGQAAAC9ydXN0L2RlcHMvZGxtYWxsb2MtMC4yLjYvc3JjL2RsbWFsbG9jLnJzYXNzZXJ0aW9uIGZhaWxlZDogcHNpemUgPj0gc2l6ZSArIG1pbl9vdmVyaGVhZABYBBAAKQAAAKgEAAAJAAAAYXNzZXJ0aW9uIGZhaWxlZDogcHNpemUgPD0gc2l6ZSArIG1heF9vdmVyaGVhZAAAWAQQACkAAACuBAAADQAAAEFjY2Vzc0Vycm9ybWVtb3J5IGFsbG9jYXRpb24gb2YgIGJ5dGVzIGZhaWxlZAAAAAsFEAAVAAAAIAUQAA0AAABzdGQvc3JjL2FsbG9jLnJzQAUQABAAAABjAQAACQAAABYAAAAMAAAABAAAABoAAAAAAAAACAAAAAQAAAAbAAAAAAAAAAgAAAAEAAAAHAAAAB0AAAAeAAAAHwAAACAAAAAQAAAABAAAACEAAAAiAAAAIwAAACQAAABFcnJvcgAAACUAAAAMAAAABAAAACYAAAAnAAAAKAAAAGNhcGFjaXR5IG92ZXJmbG93AAAA2AUQABEAAABhbGxvYy9zcmMvcmF3X3ZlYy5yc/QFEAAUAAAAGAAAAAUAQaCMwAAL8AUBAAAAKQAAAGEgZm9ybWF0dGluZyB0cmFpdCBpbXBsZW1lbnRhdGlvbiByZXR1cm5lZCBhbiBlcnJvciB3aGVuIHRoZSB1bmRlcmx5aW5nIHN0cmVhbSBkaWQgbm90YWxsb2Mvc3JjL2ZtdC5ycwAAfgYQABAAAAB+AgAADgAAAEJvcnJvd011dEVycm9yYWxyZWFkeSBib3Jyb3dlZDogrgYQABIAAABpbmRleCBvdXQgb2YgYm91bmRzOiB0aGUgbGVuIGlzICBidXQgdGhlIGluZGV4IGlzIAAAyAYQACAAAADoBhAAEgAAAD09IT1tYXRjaGVzYXNzZXJ0aW9uIGBsZWZ0ICByaWdodGAgZmFpbGVkCiAgbGVmdDogCiByaWdodDogABcHEAAQAAAAJwcQABcAAAA+BxAACQAAACByaWdodGAgZmFpbGVkOiAKICBsZWZ0OiAAAAAXBxAAEAAAAGAHEAAQAAAAcAcQAAkAAAA+BxAACQAAADogAAABAAAAAAAAAJwHEAACAAAAfSB9Y29yZS9zcmMvZm10L251bS5ycwAAswcQABMAAABmAAAAFwAAADB4MDAwMTAyMDMwNDA1MDYwNzA4MDkxMDExMTIxMzE0MTUxNjE3MTgxOTIwMjEyMjIzMjQyNTI2MjcyODI5MzAzMTMyMzMzNDM1MzYzNzM4Mzk0MDQxNDI0MzQ0NDU0NjQ3NDg0OTUwNTE1MjUzNTQ1NTU2NTc1ODU5NjA2MTYyNjM2NDY1NjY2NzY4Njk3MDcxNzI3Mzc0NzU3Njc3Nzg3OTgwODE4MjgzODQ4NTg2ODc4ODg5OTA5MTkyOTM5NDk1OTY5Nzk4OTlyYW5nZSBzdGFydCBpbmRleCAgb3V0IG9mIHJhbmdlIGZvciBzbGljZSBvZiBsZW5ndGggAACiCBAAEgAAALQIEAAiAAAAcmFuZ2UgZW5kIGluZGV4IOgIEAAQAAAAtAgQACIAAAAAAAA/AAAAvwBBqJLAAAsBFABwCXByb2R1Y2VycwIIbGFuZ3VhZ2UBBFJ1c3QADHByb2Nlc3NlZC1ieQMFcnVzdGMdMS44My4wICg5MGIzNWE2MjMgMjAyNC0xMS0yNikGd2FscnVzBjAuMjMuMwx3YXNtLWJpbmRnZW4HMC4yLjEwMABJD3RhcmdldF9mZWF0dXJlcwQrD211dGFibGUtZ2xvYmFscysIc2lnbi1leHQrD3JlZmVyZW5jZS10eXBlcysKbXVsdGl2YWx1ZQ==", import.meta.url) doesn't exist at build time, it will remain unchanged to be resolved at runtime. If this is intended, you can use the /* @vite-ignore */ comment to suppress this warning.
âœ“ 21 modules transformed.
x Build failed in 4.39s
error during build:
[vite:esbuild-transpile] Transform failed with 3 errors:
assets/index-!~{001}~.js:2391:131095: ERROR: Top-level await is not available in the configured target environment ("chrome87", "edge88", "es2020", "firefox78", "safari14" + 2 overrides)
assets/index-!~{001}~.js:2391:131146: ERROR: Top-level await is not available in the configured target environment ("chrome87", "edge88", "es2020", "firefox78", "safari14" + 2 overrides)
assets/index-!~{001}~.js:2391:131246: ERROR: Top-level await is not available in the configured target environment ("chrome87", "edge88", "es2020", "firefox78", "safari14" + 2 overrides)

Top-level await is not available in the configured target environment ("chrome87", "edge88", "es2020", "firefox78", "safari14" + 2 overrides)
2389|   * limitations under the License.
2390|   * =============================================================================
2391|   */const z_=Object.freeze(Object.defineProperty({__proto__:null,get InferenceSession(){return ao$2},get TRACE(){return jn$2},get TRACE_FUNC_BEGIN(){return Ht$2},get TRACE_FUNC_END(){return Mt$2},get Tensor(){return ft$2},get TrainingSession(){return io$2},default:O_,get env(){return Fe$2},get registerBackend(){return Or$2}},Symbol.toStringTag,{value:"Module"})),R_=(t,e)=>{const r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=t.dims[3],r.height=t.dims[2];const n=r.getContext("2d");if(n!=null){let i,a;e?.tensorLayout!==void 0&&e.tensorLayout==="NHWC"?(i=t.dims[2],a=t.dims[3]):(i=t.dims[3],a=t.dims[2]);const s=e?.format!==void 0?e.format:"RGB",o=e?.norm;let u,l;o===void 0||o.mean===void 0?u=[255,255,255,255]:typeof o.mean=="number"?u=[o.mean,o.mean,o.mean,o.mean]:(u=[o.mean[0],o.mean[1],o.mean[2],0],o.mean[3]!==void 0&&(u[3]=o.mean[3])),o===void 0||o.bias===void 0?l=[0,0,0,0]:typeof o.bias=="number"?l=[o.bias,o.bias,o.bias,o.bias]:(l=[o.bias[0],o.bias[1],o.bias[2],0],o.bias[3]!==void 0&&(l[3]=o.bias[3]));const h=a*i;let f=0,m=h,c=h*2,y=-1;s==="RGBA"?(f=0,m=h,c=h*2,y=h*3):s==="RGB"?(f=0,m=h,c=h*2):s==="RBG"&&(f=0,c=h,m=h*2);for(let b=0;b<a;b++)for(let v=0;v<i;v++){const C=(t.data[f++]-l[0])*u[0],x=(t.data[m++]-l[1])*u[1],T=(t.data[c++]-l[2])*u[2],I=y===-1?255:(t.data[y++]-l[3])*u[3];n.fillStyle="rgba("+C+","+x+","+T+","+I+")",n.fillRect(v,b,1,1);}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},P_=(t,e)=>{const r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");let n;if(r!=null){let i,a,s;e?.tensorLayout!==void 0&&e.tensorLayout==="NHWC"?(i=t.dims[2],a=t.dims[1],s=t.dims[3]):(i=t.dims[3],a=t.dims[2],s=t.dims[1]);const o=e!==void 0&&e.format!==void 0?e.format:"RGB",u=e?.norm;let l,h;u===void 0||u.mean===void 0?l=[255,255,255,255]:typeof u.mean=="number"?l=[u.mean,u.mean,u.mean,u.mean]:(l=[u.mean[0],u.mean[1],u.mean[2],255],u.mean[3]!==void 0&&(l[3]=u.mean[3])),u===void 0||u.bias===void 0?h=[0,0,0,0]:typeof u.bias=="number"?h=[u.bias,u.bias,u.bias,u.bias]:(h=[u.bias[0],u.bias[1],u.bias[2],0],u.bias[3]!==void 0&&(h[3]=u.bias[3]));const f=a*i;if(e!==void 0&&(e.format!==void 0&&s===4&&e.format!=="RGBA"||s===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");const m=4;let c=0,y=1,b=2,v=3,C=0,x=f,T=f*2,I=-1;o==="RGBA"?(C=0,x=f,T=f*2,I=f*3):o==="RGB"?(C=0,x=f,T=f*2):o==="RBG"&&(C=0,T=f,x=f*2),n=r.createImageData(i,a);for(let A=0;A<a*i;c+=m,y+=m,b+=m,v+=m,A++)n.data[c]=(t.data[C++]-h[0])*l[0],n.data[y]=(t.data[x++]-h[1])*l[1],n.data[b]=(t.data[T++]-h[2])*l[2],n.data[v]=I===-1?255:(t.data[I++]-h[3])*l[3];}else throw new Error("Can not access image data");return n},Ts$2=(t,e)=>{if(t===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");const{height:r,width:n}=e,i=e.norm??{mean:255,bias:0};let a,s;typeof i.mean=="number"?a=[i.mean,i.mean,i.mean,i.mean]:a=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?s=[i.bias,i.bias,i.bias,i.bias]:s=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];const o=e.format!==void 0?e.format:"RGBA",u=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",l=r*n,h=u==="RGBA"?new Float32Array(l*4):new Float32Array(l*3);let f=4,m=0,c=1,y=2,b=3,v=0,C=l,x=l*2,T=-1;o==="RGB"&&(f=3,m=0,c=1,y=2,b=-1),u==="RGBA"?T=l*3:u==="RBG"?(v=0,x=l,C=l*2):u==="BGR"&&(x=0,C=l,v=l*2);for(let A=0;A<l;A++,m+=f,y+=f,c+=f,b+=f)h[v++]=(t[m]+s[0])/a[0],h[C++]=(t[c]+s[1])/a[1],h[x++]=(t[y]+s[2])/a[2],T!==-1&&b!==-1&&(h[T++]=(t[b]+s[3])/a[3]);return u==="RGBA"?new Qt$2("float32",h,[1,4,r,n]):new Qt$2("float32",h,[1,3,r,n])},B_=async(t,e)=>{const r=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,n=typeof ImageData<"u"&&t instanceof ImageData,i=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,a=typeof t=="string";let s,o=e??{};const u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},l=h=>h instanceof HTMLCanvasElement||h instanceof OffscreenCanvas?h.getContext("2d"):null;if(r){const h=u();h.width=t.width,h.height=t.height;const f=l(h);if(f!=null){let m=t.height,c=t.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(m=e.resizedHeight,c=e.resizedWidth),e!==void 0){if(o=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");o.tensorFormat="RGBA",o.height=m,o.width=c;}else o.tensorFormat="RGBA",o.height=m,o.width=c;f.drawImage(t,0,0),s=f.getImageData(0,0,c,m).data;}else throw new Error("Can not access image data")}else if(n){let h,f;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(h=e.resizedHeight,f=e.resizedWidth):(h=t.height,f=t.width),e!==void 0&&(o=e),o.format="RGBA",o.height=h,o.width=f,e!==void 0){const m=u();m.width=f,m.height=h;const c=l(m);if(c!=null)c.putImageData(t,0,0),s=c.getImageData(0,0,f,h).data;else throw new Error("Can not access image data")}else s=t.data;}else if(i){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");const h=u();h.width=t.width,h.height=t.height;const f=l(h);if(f!=null){const m=t.height,c=t.width;return f.drawImage(t,0,0,c,m),s=f.getImageData(0,0,c,m).data,o.height=m,o.width=c,Ts$2(s,o)}else throw new Error("Can not access image data")}else {if(a)return new Promise((h,f)=>{const m=u(),c=l(m);if(!t||!c)return f();const y=new Image;y.crossOrigin="Anonymous",y.src=t,y.onload=()=>{m.width=y.width,m.height=y.height,c.drawImage(y,0,0,m.width,m.height);const b=c.getImageData(0,0,m.width,m.height);o.height=m.height,o.width=m.width,h(Ts$2(b.data,o));};});throw new Error("Input data provided is not supported - aborted tensor creation")}if(s!==void 0)return Ts$2(s,o);throw new Error("Input data provided is not supported - aborted tensor creation")},D_=(t,e)=>{const{width:r,height:n,download:i,dispose:a}=e,s=[1,n,r,4];return new Qt$2({location:"texture",type:"float32",texture:t,dims:s,download:i,dispose:a})},N_=(t,e)=>{const{dataType:r,dims:n,download:i,dispose:a}=e;return new Qt$2({location:"gpu-buffer",type:r??"float32",gpuBuffer:t,dims:n,download:i,dispose:a})},F_=(t,e,r)=>new Qt$2({location:"cpu-pinned",type:t,data:e,dims:r??[e.length]}),ln$1=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),ii$2=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);let wc$2=false;const L_=()=>{if(!wc$2){wc$2=true;const t=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,r=typeof Float16Array<"u"&&Float16Array.from;t&&(ln$1.set("int64",BigInt64Array),ii$2.set(BigInt64Array,"int64")),e&&(ln$1.set("uint64",BigUint64Array),ii$2.set(BigUint64Array,"uint64")),r?(ln$1.set("float16",Float16Array),ii$2.set(Float16Array,"float16")):ln$1.set("float16",Uint16Array);}},W_=t=>{let e=1;for(let r=0;r<t.length;r++){const n=t[r];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);e*=n;}return e},U_=(t,e)=>{switch(t.location){case "cpu":return new Qt$2(t.type,t.data,e);case "cpu-pinned":return new Qt$2({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case "texture":return new Qt$2({location:"texture",texture:t.texture,type:t.type,dims:e});case "gpu-buffer":return new Qt$2({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}};let Qt$2=class Qt{constructor(e,r,n){L_();let i,a;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,i=e.type,a=e.dims,e.location){case "cpu-pinned":{const o=ln$1.get(i);if(!o)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(e.data instanceof o))throw new TypeError(`buffer should be of type ${o.name}`);this.cpuData=e.data;break}case "texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case "gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else {let o,u;if(typeof e=="string")if(i=e,u=n,e==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor's data must be a string array.");o=r;}else {const l=ln$1.get(e);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(r)){if(e==="float16"&&l===Uint16Array)throw new TypeError("Creating a float16 tensor from number array is not supported. Please use Uint16Array as data.");e==="uint64"||e==="int64"?o=l.from(r,BigInt):o=l.from(r);}else if(r instanceof l)o=r;else throw new TypeError(`A ${i} tensor's data must be type of ${l}`)}else if(u=r,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const l=typeof e[0];if(l==="string")i="string",o=e;else if(l==="boolean")i="bool",o=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else {const l=ii$2.get(e.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);i=l,o=e;}if(u===void 0)u=[o.length];else if(!Array.isArray(u))throw new TypeError("A tensor's dims must be a number array");a=u,this.cpuData=o,this.dataLocation="cpu";}const s=W_(a);if(this.cpuData&&s!==this.cpuData.length)throw new Error(`Tensor's size(${s}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=a,this.size=s;}static async fromImage(e,r){return B_(e,r)}static fromTexture(e,r){return D_(e,r)}static fromGpuBuffer(e,r){return N_(e,r)}static fromPinnedBuffer(e,r,n){return F_(e,r,n)}toDataURL(e){return R_(this,e)}toImageData(e){return P_(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}async getData(e){switch(this.ensureValid(),this.dataLocation){case "cpu":case "cpu-pinned":return this.data;case "texture":case "gpu-buffer":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;const r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,e&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=false;}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none";}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return U_(this,e)}};const V_=Qt$2,Hn$2=[];let Ks$2,Xn$2;Pr$2.IS_NODE_ENV?(Xn$2=Ye$2??qg,Hn$2.push("cpu"),Ks$2=["cpu"]):(Xn$2=z_,Pr$2.IS_WEBGPU_AVAILABLE&&Hn$2.push("webgpu"),Hn$2.push("wasm"),Ks$2=["wasm"]);const G_=Xn$2.InferenceSession;function H_(t){let e=Ks$2;if(t){if(!Hn$2.includes(t))throw new Error(`Unsupported device: "${t}". Should be one of: ${Hn$2.join(", ")}.`);e=[t];}return e}async function lm(t,e){return await G_.create(t,e)}function dm(t){return t instanceof Xn$2.Tensor}const Mr$2=Xn$2?.env;Mr$2?.wasm&&(Mr$2.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.18.0/dist/",Mr$2.wasm.proxy=!Pr$2.IS_WEBWORKER_ENV,(typeof crossOriginIsolated>"u"||!crossOriginIsolated)&&(Mr$2.wasm.numThreads=1),typeof navigator<"u"&&/iP(hone|od|ad).+16_4.+AppleWebKit/.test(navigator.userAgent)&&(Mr$2.wasm.simd=false));function q_(){return Mr$2?.wasm?.proxy}bt$2.backends.onnx=Mr$2;const an$2=async(t,e,r)=>{const n=await lm(new Uint8Array(t),e);return async i=>{const a=Object.fromEntries(Object.entries(i).map(([o,u])=>[o,u.ort_tensor])),s=await n.run(a);return Array.isArray(r)?r.map(o=>new ce$2(s[o])):new ce$2(s[r])}};let _i$1 = class _i{static session_options={};static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=an$2([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=an$2([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=an$2([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=an$2([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=an$2([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=an$2([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}};const bc$2=Object.freeze({float32:Float32Array,float16:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array});let ce$2 = class ce{get dims(){return this.ort_tensor.dims}set dims(e){this.ort_tensor.dims=e;}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}ort_tensor;constructor(...e){return dm(e[0])?this.ort_tensor=e[0]:this.ort_tensor=new V_(e[0],e[1],e[2]),new Proxy(this,{get:(r,n)=>{if(typeof n=="string"){let i=Number(n);if(Number.isInteger(i))return r._getitem(i)}return r[n]},set:(r,n,i)=>r[n]=i})}dispose(){this.ort_tensor.dispose();}*[Symbol.iterator](){const[e,...r]=this.dims;if(r.length>0){const n=r.reduce((i,a)=>i*a);for(let i=0;i<e;++i)yield this._subarray(i,n,r);}else yield*this.data;}_getitem(e){const[r,...n]=this.dims;if(e=Xt$2(e,r),n.length>0){const i=n.reduce((a,s)=>a*s);return this._subarray(e,i,n)}else return new ce(this.type,[this.data[e]],n)}indexOf(e){const r=this.data;for(let n=0;n<r.length;++n)if(r[n]==e)return n;return  -1}_subarray(e,r,n){const i=e*r,a=(e+1)*r,s="subarray"in this.data?this.data.subarray(i,a):this.data.slice(i,a);return new ce(this.type,s,n)}item(){const e=this.data;if(e.length!==1)throw new Error(`a Tensor with ${e.length} elements cannot be converted to Scalar`);return e[0]}tolist(){return j_(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){const e=this.data;for(let r=0;r<e.length;++r)e[r]=1/(1+Math.exp(-e[r]));return this}mul(e){return this.clone().mul_(e)}mul_(e){const r=this.data;for(let n=0;n<r.length;++n)r[n]*=e;return this}div(e){return this.clone().div_(e)}div_(e){const r=this.data;for(let n=0;n<r.length;++n)r[n]/=e;return this}add(e){return this.clone().add_(e)}add_(e){const r=this.data;for(let n=0;n<r.length;++n)r[n]+=e;return this}clone(){return new ce(this.type,this.data.slice(),this.dims.slice())}slice(...e){let r=[],n=[];for(let l=0;l<this.dims.length;++l){let h=e[l];if(h==null)n.push([0,this.dims[l]]),r.push(this.dims[l]);else if(typeof h=="number")h=Xt$2(h,this.dims[l],l),n.push([h,h+1]);else if(Array.isArray(h)&&h.length===2){let[f,m]=h;if(f=f===null?0:Xt$2(f,this.dims[l],l,false),m=m===null?this.dims[l]:Xt$2(m,this.dims[l],l,false),f>m)throw new Error(`Invalid slice: ${h}`);let c=[Math.max(f,0),Math.min(m,this.dims[l])];n.push(c),r.push(c[1]-c[0]);}else throw new Error(`Invalid slice: ${h}`)}let i=n.map(([l,h])=>h-l),a=i.reduce((l,h)=>l*h);const s=this.data;let o=new s.constructor(a);const u=this.stride();for(let l=0;l<a;++l){let h=0;for(let f=i.length-1,m=l;f>=0;--f){const c=i[f];h+=(m%c+n[f][0])*u[f],m=Math.floor(m/c);}o[l]=s[h];}return new ce(this.type,o,r)}permute(...e){return K_(this,e)}transpose(...e){return this.permute(...e)}sum(e=null,r=false){return this.norm(1,e,r)}norm(e="fro",r=null,n=false){if(e==="fro")e=2;else if(typeof e=="string")throw Error(`Unsupported norm: ${e}`);const i=this.data;if(r===null){let o=i.reduce((u,l)=>u+l**e,0)**(1/e);return new ce(this.type,[o],[])}r=Xt$2(r,this.dims.length);const a=this.dims.slice();a[r]=1;const s=new i.constructor(i.length/this.dims[r]);for(let o=0;o<i.length;++o){let u=0;for(let l=this.dims.length-1,h=o,f=1;l>=0;--l){const m=this.dims[l];if(l!==r){const c=h%m;u+=c*f,f*=a[l];}h=Math.floor(h/m);}s[u]+=i[o]**e;}if(e!==1)for(let o=0;o<s.length;++o)s[o]=s[o]**(1/e);return n||a.splice(r,1),new ce(this.type,s,a)}normalize_(e=2,r=1){r=Xt$2(r,this.dims.length);const n=this.norm(e,r,true),i=this.data;for(let a=0;a<i.length;++a){let s=0;for(let o=this.dims.length-1,u=a,l=1;o>=0;--o){const h=this.dims[o];if(o!==r){const f=u%h;s+=f*l,l*=this.dims[o];}u=Math.floor(u/h);}i[a]/=n.data[s];}return this}normalize(e=2,r=1){return this.clone().normalize_(e,r)}stride(){return J_(this.dims)}squeeze(e=null){return new ce(this.type,this.data,$c$1(this.dims,e))}squeeze_(e=null){return this.dims=$c$1(this.dims,e),this}unsqueeze(e=null){return new ce(this.type,this.data,xc$1(this.dims,e))}unsqueeze_(e=null){return this.dims=xc$1(this.dims,e),this}flatten_(e=0,r=-1){r=(r+this.dims.length)%this.dims.length;let n=this.dims.slice(0,e),i=this.dims.slice(e,r+1),a=this.dims.slice(r+1);return this.dims=[...n,i.reduce((s,o)=>s*o,1),...a],this}flatten(e=0,r=-1){return this.clone().flatten_(e,r)}view(...e){let r=-1;for(let n=0;n<e.length;++n)if(e[n]===-1){if(r!==-1)throw new Error("Only one dimension can be inferred");r=n;}if(r!==-1){const n=e.reduce((i,a,s)=>s!==r?i*a:i,1);e[r]=this.data.length/n;}return new ce(this.type,this.data,e)}neg_(){const e=this.data;for(let r=0;r<e.length;++r)e[r]=-e[r];return this}neg(){return this.clone().neg_()}clamp_(e,r){const n=this.data;for(let i=0;i<n.length;++i)n[i]=Math.min(Math.max(n[i],e),r);return this}clamp(e,r){return this.clone().clamp_(e,r)}round_(){const e=this.data;for(let r=0;r<e.length;++r)e[r]=Math.round(e[r]);return this}round(){return this.clone().round_()}mean(e=null,r=false){return xo$2(this,e,r)}to(e){if(this.type===e)return this;if(!bc$2.hasOwnProperty(e))throw new Error(`Unsupported type: ${e}`);return new ce(e,bc$2[e].from(this.data),this.dims)}};function j_(t,e){const r=t.length,n=e.reduce((a,s)=>a*s);if(r!==n)throw Error(`cannot reshape array of size ${r} into shape (${e})`);let i=t;for(let a=e.length-1;a>=0;a--)i=i.reduce((s,o)=>{let u=s[s.length-1];return u.length<e[a]?u.push(o):s.push([o]),s},[[]]);return i[0]}function K_(t,e){const[r,n]=s0(t.data,t.dims,e);return new ce$2(t.type,r,n)}function cm(t,[e,r],n="bilinear",i=false){const a=t.dims.at(-3)??1,s=t.dims.at(-2),o=t.dims.at(-1);let u=i0(t.data,[a,s,o],[e,r],n,i);return new ce$2(t.type,u,[a,e,r])}async function vc$2(t,{size:e=null,mode:r="bilinear"}={}){if(t.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!e)throw new Error("`interpolate_4d` requires a `size` argument.");let n;if(e.length===2)n=[...t.dims.slice(0,2),...e];else if(e.length===3)n=[t.dims[0],...e];else if(e.length===4)n=e;else throw new Error("`size` must be of length 2, 3, or 4.");let i;if(r==="bilinear")i=await _i$1.bilinear_interpolate_4d;else if(r==="bicubic")i=await _i$1.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${r}`);const a=new ce$2("int64",new BigInt64Array(n.map(BigInt)),[n.length]);return await i({x:t,s:a})}async function Y_(t,e){return await(await _i$1.matmul)({a:t,b:e})}async function pm(t,e){const r=await _i$1.top_k;return e===null?e=t.dims.at(-1):e=Math.min(e,t.dims.at(-1)),await r({x:t,k:new ce$2("int64",[BigInt(e)],[1])})}function $c$1(t,e){return t=t.slice(),e===null?t=t.filter(r=>r!==1):typeof e=="number"?t[e]===1&&t.splice(e,1):Array.isArray(e)&&(t=t.filter((r,n)=>r!==1||!e.includes(n))),t}function xc$1(t,e){return e=Xt$2(e,t.length+1),t=t.slice(),t.splice(e,0,1),t}function Xt$2(t,e,r=null,n=true){if(n&&(t<-e||t>=e))throw new Error(`IndexError: index ${t} is out of bounds for dimension${r===null?"":" "+r} with size ${e}`);return t<0&&(t=(t%e+e)%e),t}function Jt$2(t,e=0){e=Xt$2(e,t[0].dims.length);const r=t[0].dims.slice();r[e]=t.reduce((s,o)=>s+o.dims[e],0);const n=r.reduce((s,o)=>s*o,1),i=new t[0].data.constructor(n),a=t[0].type;if(e===0){let s=0;for(let o of t)i.set(o.data,s),s+=o.data.length;}else {let s=0;for(let o=0;o<t.length;++o){let u=t[o];for(let l=0;l<u.data.length;++l){let h=0;for(let f=u.dims.length-1,m=l,c=1;f>=0;--f){const y=u.dims[f];let b=m%y;f===e&&(b+=s),h+=b*c,c*=r[f],m=Math.floor(m/y);}i[h]=u.data[l];}s+=u.dims[e];}}return new ce$2(a,i,r)}function Qn$2(t,e=0){return Jt$2(t.map(r=>r.unsqueeze(e)),e)}function X_(t,e=null,r=1,n=false){if(e===null){const l=t.data.reduce((c,y)=>c+y,0)/t.data.length,h=Math.sqrt(t.data.reduce((c,y)=>c+(y-l)**2,0)/(t.data.length-r)),f=new ce$2(t.type,[l],[]);return [new ce$2(t.type,[h],[]),f]}e=Xt$2(e,t.dims.length);const i=xo$2(t,e,n),a=t.dims.slice();a[e]=1;const s=new t.data.constructor(t.data.length/t.dims[e]);for(let u=0;u<t.data.length;++u){let l=0;for(let h=t.dims.length-1,f=u,m=1;h>=0;--h){const c=t.dims[h];if(h!==e){const y=f%c;l+=y*m,m*=a[h];}f=Math.floor(f/c);}s[l]+=(t.data[u]-i.data[l])**2;}for(let u=0;u<s.length;++u)s[u]=Math.sqrt(s[u]/(t.dims[e]-r));return n||a.splice(e,1),[new ce$2(t.type,s,a),i]}function xo$2(t,e=null,r=false){if(e===null){let a=t.data.reduce((s,o)=>s+o,0);return new ce$2(t.type,[a/t.data.length],[])}e=Xt$2(e,t.dims.length);const n=t.dims.slice();n[e]=1;const i=new t.data.constructor(t.data.length/t.dims[e]);for(let a=0;a<t.data.length;++a){let s=0;for(let o=t.dims.length-1,u=a,l=1;o>=0;--o){const h=t.dims[o];if(o!==e){const f=u%h;s+=f*l,l*=n[o];}u=Math.floor(u/h);}i[s]+=t.data[a];}if(t.dims[e]!==1)for(let a=0;a<i.length;++a)i[a]=i[a]/t.dims[e];return r||n.splice(e,1),new ce$2(t.type,i,n)}function Q_(t){const[e,r]=t.dims,n=[e+1,r+1],i=new ce$2("float32",new Float32Array(n[0]*n[1]).fill(1/0),n),a=new ce$2("float32",new Float32Array(n[0]*n[1]).fill(-1),n);i[0].data[0]=0;for(let h=1;h<r+1;++h)for(let f=1;f<e+1;++f){const m=i[f-1][h-1].item(),c=i[f-1][h].item(),y=i[f][h-1].item();let b,v;m<c&&m<y?(b=m,v=0):c<m&&c<y?(b=c,v=1):(b=y,v=2),i[f].data[h]=t[f-1][h-1].item()+b,a[f].data[h]=v;}let s=e,o=r;a.data.fill(2,0,n[1]);for(let h=0;h<n[0];++h)a[h].data[0]=1;let u=[],l=[];for(;s>0||o>0;)switch(u.push(s-1),l.push(o-1),a[s][o].item()){case 0:--s,--o;break;case 1:--s;break;case 2:--o;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${s}, ${o}]. Please file a bug report.`)}return u.reverse(),l.reverse(),[u,l]}function J_(t){const e=new Array(t.length);for(let r=t.length-1,n=1;r>=0;--r)e[r]=n,n*=t[r];return e}function So$2(t,e,r,n){const i=t.reduce((a,s)=>a*s,1);return new ce$2(r,new n(i).fill(e),t)}function Z_(t,e){let r,n;return r="float32",n=Float32Array,So$2(t,e,r,n)}function ey(t,e){return Z_(t.dims,e)}function aa$2(t){return So$2(t,1n,"int64",BigInt64Array)}function ty(t){return aa$2(t.dims)}function ry(t){return So$2(t,0n,"int64",BigInt64Array)}function ny(t){return ry(t.dims)}var Ce$2=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator"});Object.freeze({set:Ce$2.Set,for:Ce$2.For,in:Ce$2.In,is:Ce$2.Is,if:Ce$2.If,else:Ce$2.Else,endif:Ce$2.EndIf,elif:Ce$2.ElseIf,endfor:Ce$2.EndFor,and:Ce$2.And,or:Ce$2.Or,not:Ce$2.Not,"not in":Ce$2.NotIn,true:Ce$2.BooleanLiteral,false:Ce$2.BooleanLiteral});Ce$2.OpenStatement,Ce$2.CloseStatement,Ce$2.OpenExpression,Ce$2.CloseExpression,Ce$2.OpenParen,Ce$2.CloseParen,Ce$2.OpenCurlyBracket,Ce$2.CloseCurlyBracket,Ce$2.OpenSquareBracket,Ce$2.CloseSquareBracket,Ce$2.Comma,Ce$2.Dot,Ce$2.Colon,Ce$2.Pipe,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.AdditiveBinaryOperator,Ce$2.AdditiveBinaryOperator,Ce$2.MultiplicativeBinaryOperator,Ce$2.MultiplicativeBinaryOperator,Ce$2.MultiplicativeBinaryOperator,Ce$2.Equals;const hm=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],ks$2=new Map(hm),ay=new Map([...hm.map(([t,e])=>[e,t]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function iy(t){t=t.toLowerCase();let e=ay.get(t);if(e===void 0)if(ks$2.has(t))e=t;else {const n=t.length===2?ks$2.keys():ks$2.values();throw new Error(`Language "${t}" is not supported. Must be one of: ${JSON.stringify(n)}`)}return e}const sy=(()=>{const t=[...Array.from({length:94},(i,a)=>a+33),...Array.from({length:12},(i,a)=>a+161),...Array.from({length:82},(i,a)=>a+174)],e=t.slice();let r=0;for(let i=0;i<256;++i)t.includes(i)||(t.push(i),e.push(256+r),r+=1);const n=e.map(i=>String.fromCharCode(i));return Object.fromEntries(t.map((i,a)=>[i,n[a]]))})();Zg(sy);async function oy(t,e){return await on$2(t,"config.json",true,e)}function sn$2(t){const e={};let r={};switch(t.model_type){case "llava":case "paligemma":r=sn$2(t.text_config);break;case "moondream1":r=sn$2(t.phi_config);break;case "musicgen":r=sn$2(t.decoder);break;case "gpt2":case "gptj":case "codegen":case "gpt_bigcode":e.num_heads="n_head",e.num_layers="n_layer",e.hidden_size="n_embd";break;case "gpt_neox":case "stablelm":case "opt":case "phi":case "phi3":case "falcon":e.num_heads="num_attention_heads",e.num_layers="num_hidden_layers",e.hidden_size="hidden_size";break;case "llama":case "cohere":case "mistral":case "starcoder2":case "qwen2":e.num_heads="num_key_value_heads",e.num_layers="num_hidden_layers",e.hidden_size="hidden_size",e.num_attention_heads="num_attention_heads";break;case "gemma":e.num_heads="num_key_value_heads",e.num_layers="num_hidden_layers",e.dim_kv="head_dim";break;case "openelm":e.num_heads="num_kv_heads",e.num_layers="num_transformer_layers",e.dim_kv="head_dim";break;case "gpt_neo":e.num_heads="num_heads",e.num_layers="num_layers",e.hidden_size="hidden_size";break;case "bloom":e.num_heads="n_head",e.num_layers="n_layer",e.hidden_size="hidden_size";break;case "mpt":e.num_heads="n_heads",e.num_layers="n_layers",e.hidden_size="d_model";break;case "t5":case "mt5":case "longt5":e.num_decoder_layers="num_decoder_layers",e.num_decoder_heads="num_heads",e.decoder_dim_kv="d_kv",e.num_encoder_layers="num_layers",e.num_encoder_heads="num_heads",e.encoder_dim_kv="d_kv";break;case "bart":case "mbart":case "marian":case "whisper":case "m2m_100":case "blenderbot":case "blenderbot-small":e.num_decoder_layers="decoder_layers",e.num_decoder_heads="decoder_attention_heads",e.decoder_hidden_size="d_model",e.num_encoder_layers="encoder_layers",e.num_encoder_heads="encoder_attention_heads",e.encoder_hidden_size="d_model";break;case "speecht5":e.num_decoder_layers="decoder_layers",e.num_decoder_heads="decoder_attention_heads",e.decoder_hidden_size="hidden_size",e.num_encoder_layers="encoder_layers",e.num_encoder_heads="encoder_attention_heads",e.encoder_hidden_size="hidden_size";break;case "trocr":e.num_encoder_layers=e.num_decoder_layers="decoder_layers",e.num_encoder_heads=e.num_decoder_heads="decoder_attention_heads",e.encoder_hidden_size=e.decoder_hidden_size="d_model";break;case "musicgen_decoder":e.num_encoder_layers=e.num_decoder_layers="num_hidden_layers",e.num_encoder_heads=e.num_decoder_heads="num_attention_heads",e.encoder_hidden_size=e.decoder_hidden_size="hidden_size";break;case "vision-encoder-decoder":const i=sn$2(t.encoder),a=sn$2(t.decoder),s="num_decoder_layers"in a,o={};return s?(o.num_decoder_layers=a.num_layers,o.num_decoder_heads=a.num_heads,o.decoder_hidden_size=a.hidden_size,o.num_encoder_layers=i.num_layers,o.num_encoder_heads=i.num_heads,o.encoder_hidden_size=i.hidden_size):(o.num_layers=a.num_layers,o.num_heads=a.num_heads,o.hidden_size=a.hidden_size),o}const n={...r,...zr$2(t,["model_type","multi_query","is_encoder_decoder"])};for(const i in e)n[i]=t[e[i]];return n}function fm(t,{prefix:e="past_key_values",encoder_add_pkv:r=true}={}){const n={},i=t.normalized_config,a=1;if(i.is_encoder_decoder&&r){const s=i.encoder_dim_kv??i.encoder_hidden_size/i.num_encoder_heads,o=i.decoder_dim_kv??i.decoder_hidden_size/i.num_decoder_heads,u=[a,i.num_encoder_heads,0,s],l=[a,i.num_decoder_heads,0,o];for(let h=0;h<i.num_decoder_layers;++h)n[`${e}.${h}.encoder.key`]=u,n[`${e}.${h}.encoder.value`]=u,n[`${e}.${h}.decoder.key`]=l,n[`${e}.${h}.decoder.value`]=l;}else {const s=i.num_heads,o=i.num_layers,u=i.dim_kv??i.hidden_size/(i.num_attention_heads??s);if(i.model_type==="falcon"){const l=[a*s,0,u];for(let h=0;h<o;++h)n[`${e}.${h}.key`]=l,n[`${e}.${h}.value`]=l;}else if(i.multi_query){const l=[a*s,0,2*u];for(let h=0;h<o;++h)n[`${e}.${h}.key_value`]=l;}else if(i.model_type==="bloom"){const l=[a*s,u,0],h=[a*s,0,u];for(let f=0;f<o;++f)n[`${e}.${f}.key`]=l,n[`${e}.${f}.value`]=h;}else if(i.model_type==="openelm")for(let l=0;l<o;++l){const h=[a,s[l],0,u];n[`${e}.${l}.key`]=h,n[`${e}.${l}.value`]=h;}else {const l=[a,s,0,u];for(let h=0;h<o;++h)n[`${e}.${h}.key`]=l,n[`${e}.${h}.value`]=l;}}return n}let yi$2 = class yi{max_position_embeddings;constructor(e){this.model_type=null,this.is_encoder_decoder=false,Object.assign(this,e),this.normalized_config=sn$2(this);}static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main"}={}){n&&!(n instanceof yi)&&(n=new yi(n));const o=n??await oy(e,{progress_callback:r,cache_dir:i,local_files_only:a,revision:s});return new this(o)}};class mm{static async from_pretrained(...e){return yi$2.from_pretrained(...e)}}const Za$1=Object.freeze({cpu:"cpu",gpu:"gpu",wasm:"wasm",webgpu:"webgpu"}),uy=function(){let t;return async function(){if(t===void 0)if(Pr$2.IS_NODE_ENV)t=true;else if(!Pr$2.IS_WEBGPU_AVAILABLE)t=false;else try{t=(await navigator.gpu.requestAdapter()).features.has("shader-f16");}catch{t=false;}return t}}(),$t$2=Object.freeze({fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),ly=Object.freeze({[Za$1.cpu]:$t$2.q8,[Za$1.gpu]:$t$2.fp32,[Za$1.wasm]:$t$2.q8,[Za$1.webgpu]:$t$2.fp32}),Sc$1=Object.freeze({[$t$2.fp32]:"",[$t$2.fp16]:"_fp16",[$t$2.int8]:"_int8",[$t$2.uint8]:"_uint8",[$t$2.q8]:"_quantized",[$t$2.q4]:"_q4",[$t$2.q4f16]:"_q4f16",[$t$2.bnb4]:"_bnb4"});let Zt$2 = class Zt extends or$2{_call(e,r){throw Error("`_call` should be implemented in a subclass")}};let Co$2 = class Co extends or$2{_call(e,r){throw Error("`_call` should be implemented in a subclass")}};let Ys$2 = class Ys extends or$2{constructor(){super(),this.processors=[];}push(e){this.processors.push(e);}extend(e){this.processors.push(...e);}_call(e,r){let n=r;for(const i of this.processors)n=i(e,n);return n}[Symbol.iterator](){return this.processors.values()}};class dy extends Zt$2{constructor(e){super(),this.bos_token_id=e;}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length===1){const i=r[n];i.data.fill(-1/0),i.data[this.bos_token_id]=0;}return r}}class cy extends Zt$2{constructor(e,r){super(),this.max_length=e,this.eos_token_id=Array.isArray(r)?r:[r];}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length===this.max_length-1){const i=r[n];i.data.fill(-1/0);for(const a of this.eos_token_id)i.data[a]=0;}return r}}class py extends Zt$2{constructor(e,r){super(),this.begin_suppress_tokens=e,this.begin_index=r;}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length===this.begin_index){const i=r[n];for(const a of this.begin_suppress_tokens)i.data[a]=-1/0;}return r}}class hy extends Zt$2{constructor(e,r){super(),this.eos_token_id=Array.isArray(e.eos_token_id)?e.eos_token_id[0]:e.eos_token_id,this.no_timestamps_token_id=e.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=r.length,r.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=e.max_initial_timestamp_index;}_call(e,r){for(let n=0;n<e.length;++n){const a=r[n].data;if(a[this.no_timestamps_token_id]=-1/0,e[n].length===this.begin_index-1){a.fill(-1/0),a[this.timestamp_begin]=0;continue}const s=e[n].slice(this.begin_index),o=s.length>=1&&s[s.length-1]>=this.timestamp_begin,u=s.length<2||s[s.length-2]>=this.timestamp_begin;if(o&&(u?a.subarray(this.timestamp_begin).fill(-1/0):a.subarray(0,this.eos_token_id).fill(-1/0)),e[n].length===this.begin_index&&this.max_initial_timestamp_index!==null){const m=this.timestamp_begin+this.max_initial_timestamp_index;a.subarray(m+1).fill(-1/0);}const l=o0(a),h=Math.log(l.subarray(this.timestamp_begin).map(Math.exp).reduce((m,c)=>m+c)),f=_r$2(l.subarray(0,this.timestamp_begin))[0];h>f&&a.subarray(0,this.timestamp_begin).fill(-1/0);}return r}}class fy extends Zt$2{constructor(e){super(),this.no_repeat_ngram_size=e;}getNgrams(e){const r=e.length,n=[];for(let a=0;a<r+1-this.no_repeat_ngram_size;++a){const s=[];for(let o=0;o<this.no_repeat_ngram_size;++o)s.push(e[a+o]);n.push(s);}const i=new Map;for(const a of n){const s=a.slice(0,a.length-1),o=JSON.stringify(s),u=i.get(o)??[];u.push(a[a.length-1]),i.set(o,u);}return i}getGeneratedNgrams(e,r){const n=r.slice(r.length+1-this.no_repeat_ngram_size,r.length);return e.get(JSON.stringify(n))??[]}calcBannedNgramTokens(e){const r=[];if(e.length+1<this.no_repeat_ngram_size)return r;{const n=this.getNgrams(e);return this.getGeneratedNgrams(n,e)}}_call(e,r){for(let n=0;n<e.length;++n){const i=r[n],a=this.calcBannedNgramTokens(e[n]);for(const s of a)i.data[s]=-1/0;}return r}}class my extends Zt$2{constructor(e){super(),this.penalty=e;}_call(e,r){for(let n=0;n<e.length;++n){const i=r[n];for(const a of e[n])i.data[a]<0?i.data[a]*=this.penalty:i.data[a]/=this.penalty;}return r}}class gy extends Zt$2{constructor(e,r){super(),this.min_length=e,this.eos_token_id=Array.isArray(r)?r:[r];}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length<this.min_length){const i=r[n];for(const a of this.eos_token_id)i.data[a]=-1/0;}return r}}let _y$1 = class _y extends Zt$2{constructor(e,r,n){super(),this.prompt_length_to_skip=e,this.min_new_tokens=r,this.eos_token_id=Array.isArray(n)?n:[n];}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length-this.prompt_length_to_skip<this.min_new_tokens){const a=r[n];for(const s of this.eos_token_id)a[s]=-1/0;}return r}};class yy extends Zt$2{constructor(e,r){super(),this.bad_words_ids=e,this.eos_token_id=Array.isArray(r)?r:[r];}_call(e,r){for(let n=0;n<e.length;++n){const i=r[n];for(const a of this.bad_words_ids){let s=true;for(let o=1;o<=a.length-1&&a.length<e[o].length;++o)if(a.at(-o-1)!==e[o].at(-o)){s=false;break}s&&(i[a.at(-1)]=-1/0);}}return r}}class wy extends Zt$2{constructor(e){if(super(),e<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${e}.`);this.guidance_scale=e;}_call(e,r){if(r.dims[0]!==2*e.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${r.dims[0]} for the logits and ${e.length} for the input ids.`);const n=e.length,i=r.slice([0,n],null),a=r.slice([n,r.dims[0]],null);for(let s=0;s<a.data.length;++s)a.data[s]+=(i.data[s]-a.data[s])*this.guidance_scale;return a}}class by extends Co$2{constructor(e){super(),this.temperature=e;}_call(e,r){const n=r.data;for(let i=0;i<n.length;++i)n[i]/=this.temperature;return r}}class vy extends Co$2{constructor(e,{filter_value:r=-1/0,min_tokens_to_keep:n=1}={}){if(super(),e<0||e>1)throw new Error(`\`top_p\` must be a float > 0 and < 1, but is ${e}`);if(!Number.isInteger(n)||n<1)throw new Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${n}`);this.top_p=e,this.filter_value=r,this.min_tokens_to_keep=n;}}class $y extends Co$2{constructor(e,{filter_value:r=-1/0,min_tokens_to_keep:n=1}={}){if(super(),!Number.isInteger(e)||e<0)throw new Error(`\`top_k\` must be a positive integer, but is ${e}`);this.top_k=Math.max(e,n),this.filter_value=r;}}class gm{max_length=20;max_new_tokens=null;min_length=0;min_new_tokens=null;early_stopping=false;max_time=null;do_sample=false;num_beams=1;num_beam_groups=1;penalty_alpha=null;use_cache=true;temperature=1;top_k=50;top_p=1;typical_p=1;epsilon_cutoff=0;eta_cutoff=0;diversity_penalty=0;repetition_penalty=1;encoder_repetition_penalty=1;length_penalty=1;no_repeat_ngram_size=0;bad_words_ids=null;force_words_ids=null;renormalize_logits=false;constraints=null;forced_bos_token_id=null;forced_eos_token_id=null;remove_invalid_values=false;exponential_decay_length_penalty=null;suppress_tokens=null;begin_suppress_tokens=null;forced_decoder_ids=null;guidance_scale=null;num_return_sequences=1;output_attentions=false;output_hidden_states=false;output_scores=false;return_dict_in_generate=false;pad_token_id=null;bos_token_id=null;eos_token_id=null;encoder_no_repeat_ngram_size=0;decoder_start_token_id=null;generation_kwargs={};constructor(e){Object.assign(this,zr$2(e,Object.getOwnPropertyNames(this)));}}let Eo$2 = class Eo extends or$2{_call(e,r){throw Error("StoppingCriteria needs to be subclassed")}};let To$2 = class To extends or$2{constructor(){super(),this.criteria=[];}push(e){this.criteria.push(e);}extend(e){e instanceof To?e=e.criteria:e instanceof Eo$2&&(e=[e]),this.criteria.push(...e);}_call(e,r){const n=new Array(e.length).fill(false);for(const i of this.criteria){const a=i(e,r);for(let s=0;s<n.length;++s)n[s]||=a[s];}return n}[Symbol.iterator](){return this.criteria.values()}};class xy extends Eo$2{constructor(e,r=null){super(),this.max_length=e,this.max_position_embeddings=r;}_call(e){return e.map(r=>r.length>=this.max_length)}}class Sy extends Eo$2{constructor(e){super(),Array.isArray(e)||(e=[e]),this.eos_token_id=e;}_call(e,r){return e.map(n=>{const i=n.at(-1);return this.eos_token_id.some(a=>i==a)})}}let Si$1 = class Si extends or$2{constructor(e){super(),this.generation_config=e;}async _call(e){return this.sample(e)}async sample(e){throw Error("sample should be implemented in subclasses.")}getLogits(e,r){let n=e.dims.at(-1),i=e.data;if(r===-1)i=i.slice(-n);else {let a=r*n;i=i.slice(a,a+n);}return i}randomSelect(e){let r=0;for(let i=0;i<e.length;++i)r+=e[i];let n=Math.random()*r;for(let i=0;i<e.length;++i)if(n-=e[i],n<=0)return i;return 0}static getSampler(e){if(e.do_sample)return new Ey(e);if(e.num_beams>1)return new Ty(e);if(e.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${e.num_return_sequences}.`);return new Cy(e)}};class Cy extends Si$1{async sample(e){const r=_r$2(e.data)[1];return [[BigInt(r),0]]}}class Ey extends Si$1{async sample(e){let r=e.dims.at(-1);this.generation_config.top_k>0&&(r=Math.min(this.generation_config.top_k,r));const[n,i]=await pm(e,r),a=ta$2(n.data);return Array.from({length:this.generation_config.num_beams},()=>{const s=this.randomSelect(a);return [i.data[s],Math.log(a[s])]})}}class Ty extends Si$1{async sample(e){let r=e.dims.at(-1);this.generation_config.top_k>0&&(r=Math.min(this.generation_config.top_k,r));const[n,i]=await pm(e,r),a=ta$2(n.data);return Array.from({length:this.generation_config.num_beams},(s,o)=>[i.data[o],Math.log(a[o])])}}class ky extends gm{return_timestamps=null;return_token_timestamps=null;num_frames=null;alignment_heads=null;task=null;language=null;no_timestamps_token_id=null;prompt_ids=null;is_multilingual=null;lang_to_id=null;task_to_id=null;max_initial_timestamp_index=1}const be$2={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7},wi$1=new Map,_m=new Map,qn$2=new Map;async function Iy(t,e,r){let n=r.device;n&&typeof n!="string"&&(n.hasOwnProperty(e)?n=n[e]:(console.warn(`Device not specified for ${e}. Using the default device.`),n=null));const i=H_(n);let a=r.dtype;if(typeof a!="string"&&(a&&a.hasOwnProperty(e)?a=a[e]:(a=ly[i[0]],console.warn(`Dtype not specified for ${e}. Using the default dtype: ${a}.`))),Sc$1.hasOwnProperty(a)){if(a===$t$2.fp16&&!await uy())throw new Error("The device does not support fp16.")}else throw new Error(`Invalid dtype: ${a}. Should be one of: ${Object.keys($t$2).join(", ")}`);const s=Sc$1[a],o=`${r.subfolder??""}/${e}${s}.onnx`,u={...r.session_options};u.executionProviders??=i;const l=ei$2(t,o,true,r);let h=[];if(r.use_external_data_format){if(Pr$2.IS_NODE_ENV)throw new Error("External data format is not yet supported in Node.js");const m=`${e}${s}.onnx_data`,c=`${r.subfolder??""}/${m}`;h.push(new Promise(async(y,b)=>{const v=await ei$2(t,c,true,r);y({path:m,data:v});}));}else u.externalData!==void 0&&(h=u.externalData.map(async m=>{if(typeof m.data=="string"){const c=await ei$2(t,m.data,true,r);return {...m,data:c}}return m}));if(h.length>0&&(u.externalData=await Promise.all(h)),n==="webgpu"){const m=fm(r.config,{prefix:"present"});if(Object.keys(m).length>0){const c={};for(const y in m)c[y]="gpu-buffer";u.preferredOutputLocation=c;}}return {buffer:await l,session_options:u}}async function Tr$2(t,e,r){const n=Object.keys(e),i=await Promise.all(n.map(async s=>Iy(t,e[s],r))),a={};for(let s=0;s<n.length;++s){const{buffer:o,session_options:u}=i[s],l=await lm(o,u);a[n[s]]=l;}return a}function Ay(t,e){const r=Object.create(null),n=[];for(const s of t.inputNames){const o=e[s];if(!(o instanceof ce$2)){n.push(s);continue}r[s]=q_()?o.clone():o;}if(n.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${n.join(", ")}.`);const i=Object.keys(e).length,a=t.inputNames.length;if(i>a){let s=Object.keys(e).filter(o=>!t.inputNames.includes(o));console.warn(`WARNING: Too many inputs were provided (${i} > ${a}). The following inputs will be ignored: "${s.join(", ")}".`);}return r}async function gr$2(t,e){const r=Ay(t,e);try{const n=Object.fromEntries(Object.entries(r).map(([a,s])=>[a,s.ort_tensor]));let i=await t.run(n);return i=ym(i),i}catch(n){throw console.error(`An error occurred during model execution: "${n}".`),console.error("Inputs given to model:",r),n}}function ym(t){for(let e in t)dm(t[e])?t[e]=new ce$2(t[e]):typeof t[e]=="object"&&ym(t[e]);return t}function wm(t){if(t instanceof ce$2)return t;if(t.length===0)throw Error("items must be non-empty");if(Array.isArray(t[0])){if(t.some(e=>e.length!==t[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new ce$2("int64",BigInt64Array.from(t.flat().map(e=>BigInt(e))),[t.length,t[0].length])}else return new ce$2("int64",BigInt64Array.from(t.map(e=>BigInt(e))),[1,t.length])}function bm(t){return new ce$2("bool",[t],[1])}async function Cc$1(t,e){let{encoder_outputs:r,past_key_values:n}=e;if(!r){const u=zr$2(e,t.sessions.model.inputNames);r=(await Jn$2(t,u)).last_hidden_state;}const{input_ids:i,decoder_input_ids:a,...s}=e;return s.input_ids=a,s.encoder_hidden_states=r,t.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(s.encoder_attention_mask=e.attention_mask),await ko$2(t,s,true)}async function Jn$2(t,e){const r=t.sessions.model,n=Object.create(null);for(const i of r.inputNames)n[i]=e[i];return r.inputNames.includes("token_type_ids")&&!n.token_type_ids&&(n.token_type_ids=new ce$2("int64",new BigInt64Array(n.input_ids.data.length),n.input_ids.dims)),await gr$2(r,n)}async function ko$2(t,e,r=false){const n=t.sessions[r?"decoder_model_merged":"model"],{past_key_values:i,...a}=e;n.inputNames.includes("use_cache_branch")&&(a.use_cache_branch=bm(!!i)),n.inputNames.includes("position_ids")&&a.attention_mask&&!a.position_ids&&(a.position_ids=Oy(a,i)),t.addPastKeyValues(a,i);const s=zr$2(a,n.inputNames);return await gr$2(n,s)}async function My(t,{input_ids:e=null,attention_mask:r=null,pixel_values:n=null,position_ids:i=null,inputs_embeds:a=null,past_key_values:s=null,generation_config:o=null,logits_processor:u=null,...l}){if(!a){if(a=await t.encode_text({input_ids:e}),n&&e.dims[1]!==1){const f=await t.encode_image({pixel_values:n});({inputs_embeds:a,attention_mask:r}=t._merge_input_ids_with_image_features({image_features:f,inputs_embeds:a,input_ids:e,attention_mask:r}));}else if(s&&n&&e.dims[1]===1){const f=e.dims[1],m=Object.values(s)[0].dims.at(-2);r=Jt$2([aa$2([e.dims[0],m]),r.slice(null,[r.dims[1]-f,r.dims[1]])],1);}}return await ko$2(t,{inputs_embeds:a,past_key_values:s,attention_mask:r,position_ids:i,generation_config:o,logits_processor:u},true)}function Oy(t,e=null){const{input_ids:r,inputs_embeds:n,attention_mask:i}=t,[a,s]=i.dims,o=new BigInt64Array(i.data.length);for(let l=0;l<a;++l){const h=l*s;let f=BigInt(0);for(let m=0;m<s;++m){const c=h+m;i.data[c]===0n?o[c]=BigInt(1):(o[c]=f,f+=i.data[c]);}}let u=new ce$2("int64",o,i.dims);if(e){const l=-(r??n).dims.at(1);u=u.slice(null,[l,null]);}return u}function Ec$1(t,e,r,n){if(r.past_key_values){const i=Object.values(r.past_key_values)[0].dims.at(-2),{input_ids:a,attention_mask:s}=r;if(!(s&&s.dims[1]>a.dims[1])){if(i<a.dims[1])r.input_ids=a.slice(null,[i,null]);else if(t.config.image_token_index!=null&&a.data.some(o=>o==t.config.image_token_index)){const o=t.config.num_image_tokens;if(!o)throw new Error("`num_image_tokens` is missing in the model configuration.");const u=a.dims[1]-(i-o);r.input_ids=a.slice(null,[-u,null]),r.attention_mask=aa$2([1,i+u]);}}}return r}function zy(t,e,r,n){const{...i}=r;return r.past_key_values&&(e=e.map(s=>[s.at(-1)])),i.decoder_input_ids=wm(e),i}let X$2 = class X extends or$2{main_input_name="input_ids";forward_params=["input_ids","attention_mask"];constructor(e,r){super(),this.config=e,this.sessions=r;const n=qn$2.get(this.constructor),i=wi$1.get(n);this.can_generate=false,this._forward=null,this._prepare_inputs_for_generation=null,i===be$2.DecoderOnly?(this.can_generate=true,this._forward=ko$2,this._prepare_inputs_for_generation=Ec$1):i===be$2.Seq2Seq||i===be$2.Vision2Seq||i===be$2.Musicgen?(this.can_generate=true,this._forward=Cc$1,this._prepare_inputs_for_generation=zy):i===be$2.EncoderDecoder?this._forward=Cc$1:i===be$2.ImageTextToText?(this.can_generate=true,this._forward=My,this._prepare_inputs_for_generation=Ec$1):this._forward=Jn$2,this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=this.config["transformers.js_config"]??{};}async dispose(){const e=[];for(const r of Object.values(this.sessions))r?.handler?.dispose&&e.push(r.handler.dispose());return await Promise.all(e)}static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main",model_file_name:o=null,subfolder:u="onnx",device:l=null,dtype:h=null,use_external_data_format:f=null,session_options:m={}}={}){let c={progress_callback:r,config:n,cache_dir:i,local_files_only:a,revision:s,model_file_name:o,subfolder:u,device:l,dtype:h,use_external_data_format:f,session_options:m};const y=qn$2.get(this),b=wi$1.get(y);c.config=await mm.from_pretrained(e,c);let v;return b===be$2.DecoderOnly?v=await Promise.all([Tr$2(e,{model:c.model_file_name??"model"},c),on$2(e,"generation_config.json",false,c)]):b===be$2.Seq2Seq||b===be$2.Vision2Seq?v=await Promise.all([Tr$2(e,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},c),on$2(e,"generation_config.json",false,c)]):b===be$2.MaskGeneration?v=await Promise.all([Tr$2(e,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},c)]):b===be$2.EncoderDecoder?v=await Promise.all([Tr$2(e,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},c)]):b===be$2.ImageTextToText?v=await Promise.all([Tr$2(e,{embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"},c),on$2(e,"generation_config.json",false,c)]):b===be$2.Musicgen?v=await Promise.all([Tr$2(e,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},c),on$2(e,"generation_config.json",false,c)]):(b!==be$2.EncoderOnly&&console.warn(`Model type for '${y??n?.model_type}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`),v=await Promise.all([Tr$2(e,{model:c.model_file_name??"model"},c)])),new this(c.config,...v)}async _call(e){return await this.forward(e)}async forward(e){return await this._forward(this,e)}_get_logits_warper(e){const r=new Ys$2;return e.temperature!==null&&e.temperature!==1&&r.push(new by(e.temperature)),e.top_k!==null&&e.top_k!==0&&r.push(new $y(e.top_k)),e.top_p!==null&&e.top_p<1&&r.push(new vy(e.top_p)),r}_get_logits_processor(e,r,n=null){const i=new Ys$2;if(e.repetition_penalty!==null&&e.repetition_penalty!==1&&i.push(new my(e.repetition_penalty)),e.no_repeat_ngram_size!==null&&e.no_repeat_ngram_size>0&&i.push(new fy(e.no_repeat_ngram_size)),e.bad_words_ids!==null&&i.push(new yy(e.bad_words_ids,e.eos_token_id)),e.min_length!==null&&e.eos_token_id!==null&&e.min_length>0&&i.push(new gy(e.min_length,e.eos_token_id)),e.min_new_tokens!==null&&e.eos_token_id!==null&&e.min_new_tokens>0&&i.push(new _y$1(r,e.min_new_tokens,e.eos_token_id)),e.forced_bos_token_id!==null&&i.push(new dy(e.forced_bos_token_id)),e.forced_eos_token_id!==null&&i.push(new cy(e.max_length,e.forced_eos_token_id)),e.begin_suppress_tokens!==null){const a=r>1||e.forced_bos_token_id===null?r:r+1;i.push(new py(e.begin_suppress_tokens,a));}return e.guidance_scale!==null&&e.guidance_scale>1&&i.push(new wy(e.guidance_scale)),n!==null&&i.extend(n),i}_prepare_generation_config(e,r,n=gm){const i={...this.config};for(const s of ["decoder","generator","text_config"])s in i&&Object.assign(i,i[s]);const a=new n(i);return "generation_config"in this&&Object.assign(a,this.generation_config),e&&Object.assign(a,e),r&&Object.assign(a,zr$2(r,Object.getOwnPropertyNames(a))),a}_get_stopping_criteria(e,r=null){const n=new To$2;return e.max_length!==null&&n.push(new xy(e.max_length,this.config.max_position_embeddings??null)),e.eos_token_id!==null&&n.push(new Sy(e.eos_token_id)),r&&n.extend(r),n}_validate_model_class(){if(!this.can_generate){const e=[Cg,Eg,Sg,xg],r=qn$2.get(this.constructor),n=new Set,i=this.config.model_type;for(const s of e){const o=s.get(i);o&&n.add(o[0]);}let a=`The current model class (${r}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;throw n.size>0&&(a+=` Please use the following class instead: ${[...n].join(", ")}`),Error(a)}}prepare_inputs_for_generation(...e){return this._prepare_inputs_for_generation(this,...e)}_update_model_kwargs_for_generation({generated_input_ids:e,outputs:r,model_inputs:n,is_encoder_decoder:i}){return n.past_key_values=this.getPastKeyValues(r,n.past_key_values),n.input_ids=new ce$2("int64",e.flat(),[e.length,1]),i||(n.attention_mask=Jt$2([n.attention_mask,aa$2([n.attention_mask.dims[0],1])],1)),n.position_ids=null,n}_prepare_model_inputs({inputs:e,bos_token_id:r,model_kwargs:n}){const i=zr$2(n,this.forward_params),a=this.main_input_name;if(a in i){if(e)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else i[a]=e;return {inputs_tensor:i[a],model_inputs:i,model_input_name:a}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:e,model_inputs:r,model_input_name:n,generation_config:i}){const a=zr$2(r,this.sessions.model.inputNames);let{last_hidden_state:s}=await Jn$2(this,a);return i.guidance_scale!==null&&i.guidance_scale>1&&(s=Jt$2([s,ey(s,0)],0),"attention_mask"in r&&(r.attention_mask=Jt$2([r.attention_mask,ny(r.attention_mask)],0))),r.encoder_outputs=s,r}_prepare_decoder_input_ids_for_generation({batch_size:e,model_input_name:r,model_kwargs:n,decoder_start_token_id:i,bos_token_id:a,generation_config:s}){let{decoder_input_ids:o,...u}=n;if(!o)if(i??=a,this.config.model_type==="musicgen")o=Array.from({length:e*this.config.decoder.num_codebooks},()=>[i]);else if(Array.isArray(i)){if(i.length!==e)throw new Error(`\`decoder_start_token_id\` expcted to have length ${e} but got ${i.length}`);o=i;}else o=Array.from({length:e},()=>[i]);return o=wm(o),n.decoder_attention_mask=ty(o),{input_ids:o,model_inputs:u}}async generate({inputs:e=null,generation_config:r=null,logits_processor:n=null,stopping_criteria:i=null,streamer:a=null,...s}){this._validate_model_class(),r=this._prepare_generation_config(r,s);let{inputs_tensor:o,model_inputs:u,model_input_name:l}=this._prepare_model_inputs({inputs:e,model_kwargs:s});const h=this.config.is_encoder_decoder;h&&("encoder_outputs"in u||(u=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:o,model_inputs:u,model_input_name:l,generation_config:r})));let f;h?{input_ids:f,model_inputs:u}=this._prepare_decoder_input_ids_for_generation({batch_size:u[l].dims.at(0),model_input_name:l,model_kwargs:u,decoder_start_token_id:r.decoder_start_token_id,bos_token_id:r.bos_token_id,generation_config:r}):f=u[l];let m=f.dims.at(-1);r.max_new_tokens!==null&&(r.max_length=m+r.max_new_tokens);const c=this._get_logits_processor(r,m,n),y=this._get_stopping_criteria(r,i),b=u[l].dims.at(0),v=Si$1.getSampler(r),C=new Array(b).fill(0),x=f.tolist();a&&a.put(x);let T=null;for(;;){u=this.prepare_inputs_for_generation(x,u,r);const A=await this.forward(u),R=A.logits.slice(null,-1,null),z=c(x,R),P=[];for(let K=0;K<z.dims.at(0);++K){const ue=z[K],ie=await v(ue);for(const[ge,he]of ie){const D=BigInt(ge);C[K]+=he,x[K].push(D),P.push([D]);break}}if(a&&a.put(P),y(x).every(K=>K)){r.return_dict_in_generate&&(T=this.getPastKeyValues(A,u.past_key_values,false));break}u=this._update_model_kwargs_for_generation({generated_input_ids:P,outputs:A,model_inputs:u,is_encoder_decoder:h});}a&&a.end();const I=new ce$2("int64",x.flat(),[x.length,x[0].length]);return r.return_dict_in_generate?{sequences:I,past_key_values:T}:I}addAttentionsToBeam(e,r){if(this.config.is_encoder_decoder){if(!r.cross_attentions||r.cross_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce cross-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.cross_attentions||(e.cross_attentions=[]),e.cross_attentions.push(r.cross_attentions);}if(!r.decoder_attentions||r.decoder_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce decoder-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.decoder_attentions||(e.decoder_attentions=[]),e.decoder_attentions.push(r.decoder_attentions);}groupBeams(e){const r=Object.create(null);for(const n of e)r[n.id]===void 0?r[n.id]=[n]:r[n.id].push(n);return Object.values(r)}getPastKeyValues(e,r,n=true){const i=Object.create(null);for(const a in e)if(a.startsWith("present")){let s=a.replace("present","past_key_values");if(r&&a.includes("encoder"))i[s]=r[s];else {if(n&&r){const o=r[s];o.location==="gpu-buffer"&&o.dispose();}i[s]=e[a];}}return i}getAttentions(e){const r=Object.create(null);for(const n of ["cross_attentions","decoder_attentions"]){const i=[];for(const a in e)if(a.startsWith(n)){const s=a.split(".").pop();i[s]=e[a];}r[n]=i;}return r}addPastKeyValues(e,r){if(r)Object.assign(e,r);else {const n=this.custom_config.kv_cache_dtype??"float32",i=n==="float16"?new Uint16Array:[],a=fm(this.config);for(const s in a)e[s]=new ce$2(n,i,a[s]);}}};let Ot$2 = class Ot{};let ia$2 = class ia extends X$2{};class Ry extends ia$2{}class Py extends ia$2{async _call(e){return new dt$2(await super._call(e))}}class By extends ia$2{async _call(e){return new Ae$2(await super._call(e))}}class Dy extends ia$2{async _call(e){return new lt$2(await super._call(e))}}class Ny extends ia$2{async _call(e){return new mt$2(await super._call(e))}}class Fy extends X$2{}class Ly extends Fy{}let sa$2 = class sa extends X$2{};class Wy extends sa$2{}class Uy extends sa$2{async _call(e){return new dt$2(await super._call(e))}}class Vy extends sa$2{async _call(e){return new Ae$2(await super._call(e))}}class Gy extends sa$2{async _call(e){return new lt$2(await super._call(e))}}class Hy extends sa$2{async _call(e){return new mt$2(await super._call(e))}}let oa$2 = class oa extends X$2{};class qy extends oa$2{}class jy extends oa$2{async _call(e){return new dt$2(await super._call(e))}}class Ky extends oa$2{async _call(e){return new Ae$2(await super._call(e))}}class Yy extends oa$2{async _call(e){return new lt$2(await super._call(e))}}class Xy extends oa$2{async _call(e){return new mt$2(await super._call(e))}}let ua$2 = class ua extends X$2{};class Qy extends ua$2{}class Jy extends ua$2{async _call(e){return new dt$2(await super._call(e))}}class Zy extends ua$2{async _call(e){return new Ae$2(await super._call(e))}}class ew extends ua$2{async _call(e){return new lt$2(await super._call(e))}}class tw extends ua$2{async _call(e){return new mt$2(await super._call(e))}}let la$2 = class la extends X$2{};class rw extends la$2{}class nw extends la$2{async _call(e){return new dt$2(await super._call(e))}}class aw extends la$2{async _call(e){return new Ae$2(await super._call(e))}}class iw extends la$2{async _call(e){return new lt$2(await super._call(e))}}class sw extends la$2{async _call(e){return new mt$2(await super._call(e))}}let da$2 = class da extends X$2{};class ow extends da$2{}class uw extends da$2{async _call(e){return new dt$2(await super._call(e))}}class lw extends da$2{async _call(e){return new Ae$2(await super._call(e))}}class dw extends da$2{async _call(e){return new lt$2(await super._call(e))}}class cw extends da$2{async _call(e){return new mt$2(await super._call(e))}}let ca$2 = class ca extends X$2{};class pw extends ca$2{}class hw extends ca$2{async _call(e){return new dt$2(await super._call(e))}}class fw extends ca$2{async _call(e){return new Ae$2(await super._call(e))}}class mw extends ca$2{async _call(e){return new lt$2(await super._call(e))}}class gw extends ca$2{async _call(e){return new mt$2(await super._call(e))}}let pa$2 = class pa extends X$2{};class _w extends pa$2{}class yw extends pa$2{async _call(e){return new Ae$2(await super._call(e))}}class ww extends pa$2{async _call(e){return new lt$2(await super._call(e))}}class bw extends pa$2{async _call(e){return new mt$2(await super._call(e))}}class vw extends pa$2{async _call(e){return new dt$2(await super._call(e))}}let Ci$2 = class Ci extends X$2{};class $w extends Ci$2{}class xw extends Ci$2{async _call(e){return new dt$2(await super._call(e))}}class Sw extends Ci$2{async _call(e){return new Ae$2(await super._call(e))}}class Cw extends Ci$2{async _call(e){return new lt$2(await super._call(e))}}let Ei$1 = class Ei extends X$2{};class Ew extends Ei$1{}class Tw extends Ei$1{async _call(e){return new dt$2(await super._call(e))}}class kw extends Ei$1{async _call(e){return new Ae$2(await super._call(e))}}class Iw extends Ei$1{async _call(e){return new mt$2(await super._call(e))}}let ha$2 = class ha extends X$2{};class Aw extends ha$2{}class Mw extends ha$2{async _call(e){return new dt$2(await super._call(e))}}class Ow extends ha$2{async _call(e){return new Ae$2(await super._call(e))}}class zw extends ha$2{async _call(e){return new lt$2(await super._call(e))}}class Rw extends ha$2{async _call(e){return new mt$2(await super._call(e))}}let Ti$2 = class Ti extends X$2{};class Pw extends Ti$2{}class Bw extends Ti$2{async _call(e){return new dt$2(await super._call(e))}}class Dw extends Ti$2{async _call(e){return new Ae$2(await super._call(e))}}class Nw extends Ti$2{async _call(e){return new mt$2(await super._call(e))}}let ki$1 = class ki extends X$2{};class Fw extends ki$1{}class Lw extends ki$1{async _call(e){return new Ae$2(await super._call(e))}}class Ww extends ki$1{async _call(e){return new mt$2(await super._call(e))}}class Uw extends ki$1{async _call(e){return new dt$2(await super._call(e))}}class vm extends X$2{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class Vw extends vm{}class Gw extends vm{}class $m extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Hw extends $m{}class qw extends $m{}class xm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class jw extends xm{}class Kw extends xm{}let Io$2 = class Io extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}};class Yw extends Io$2{}class Xw extends Io$2{}class Qw extends Io$2{async _call(e){return new Ae$2(await super._call(e))}}let Ii$1 = class Ii extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}};class Jw extends Ii$1{}class Zw extends Ii$1{}class eb extends Ii$1{async _call(e){return new Ae$2(await super._call(e))}}class tb extends Ii$1{}class Sm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class rb extends Sm{}class nb extends Sm{}class Cm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class ab extends Cm{}class ib extends Cm{}let fa$2 = class fa extends X$2{};class sb extends fa$2{}class ob extends fa$2{async _call(e){return new dt$2(await super._call(e))}}class ub extends fa$2{async _call(e){return new Ae$2(await super._call(e))}}class lb extends fa$2{async _call(e){return new lt$2(await super._call(e))}}class db extends fa$2{async _call(e){return new mt$2(await super._call(e))}}let ma$2 = class ma extends X$2{};class cb extends ma$2{}class pb extends ma$2{async _call(e){return new dt$2(await super._call(e))}}class hb extends ma$2{async _call(e){return new Ae$2(await super._call(e))}}class fb extends ma$2{async _call(e){return new lt$2(await super._call(e))}}class mb extends ma$2{async _call(e){return new mt$2(await super._call(e))}}let ga$2 = class ga extends X$2{};class gb extends ga$2{}let _b$1 = class _b extends ga$2{async _call(e){return new dt$2(await super._call(e))}};class yb extends ga$2{async _call(e){return new Ae$2(await super._call(e))}}class wb extends ga$2{async _call(e){return new lt$2(await super._call(e))}}class bb extends ga$2{async _call(e){return new mt$2(await super._call(e))}}class Em extends X$2{}class vb extends Em{}class $b extends Em{}class Tm extends X$2{requires_attention_mask=false;main_input_name="input_features";forward_params=["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class xb extends Tm{}class Sb extends Tm{_prepare_generation_config(e,r){return super._prepare_generation_config(e,r,ky)}_retrieve_init_tokens(e){const r=[e.decoder_start_token_id];let n=e.language;const i=e.task;if(e.is_multilingual){n||(console.warn("No language specified - defaulting to English (en)."),n="en");const s=`<|${iy(n)}|>`;r.push(e.lang_to_id[s]),r.push(e.task_to_id[i??"transcribe"]);}else if(n||i)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return !e.return_timestamps&&e.no_timestamps_token_id&&r.at(-1)!==e.no_timestamps_token_id?r.push(e.no_timestamps_token_id):e.return_timestamps&&r.at(-1)===e.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),r.pop()),r.filter(a=>a!=null)}async generate({inputs:e=null,generation_config:r=null,logits_processor:n=null,stopping_criteria:i=null,...a}){r=this._prepare_generation_config(r,a);const s=this._retrieve_init_tokens(r);return r.return_timestamps&&(n??=new Ys$2,n.push(new hy(r,s))),await super.generate({inputs:e,generation_config:r,logits_processor:n,decoder_input_ids:s,...a})}_extract_token_timestamps(e,r,n=null,i=.02){if(!e.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");let a=this.config.median_filter_width;a===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),a=7);const s=e.cross_attentions.map(l=>{let h=Array.from({length:this.config.decoder_layers},(v,C)=>Jt$2(l.map(x=>x[C]),2)),f=Qn$2(r.map(([v,C])=>n?h[v].slice(null,C,null,[0,n]):h[v].slice(null,C)));f=f.transpose(1,0,2,3);let[m,c]=X_(f,-2,0,true),y=f.clone();for(let v=0;v<y.dims[0];++v){let C=y[v];for(let x=0;x<C.dims[0];++x){let T=C[x];const I=m[v][x][0],A=c[v][x][0];for(let R=0;R<T.dims[0];++R){let z=T[R];for(let P=0;P<z.data.length;++P)z.data[P]=(z.data[P]-A.data[P])/I.data[P];z.data.set(c0(z.data,a));}}}return xo$2(y,1)}),o=[e.sequences.length,e.sequences[0].length],u=new ce$2("float32",new Float32Array(o[0]*o[1]),o);for(let l=0;l<o[0];++l){const h=s[l].neg().squeeze_(0);let[f,m]=Q_(h),c=Array.from({length:f.length-1},(v,C)=>f[C+1]-f[C]),y=e0([1],c).map(v=>!!v),b=[];for(let v=0;v<y.length;++v)y[v]&&b.push(m[v]*i);u[l].data.set(b,1);}return u}}class Cb extends X$2{main_input_name="pixel_values";forward_params=["pixel_values","input_ids","encoder_hidden_states","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class Eb extends X$2{forward_params=["input_ids","pixel_values","attention_mask","position_ids","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class km extends Eb{async encode_image({pixel_values:e}){const r=(await gr$2(this.sessions.vision_encoder,{pixel_values:e})).image_features;return this.config.num_image_tokens||(console.warn(`The number of image tokens was not set in the model configuration. Setting it to the number of features detected by the vision encoder (${r.dims[1]}).`),this.config.num_image_tokens=r.dims[1]),r}async encode_text({input_ids:e}){return (await gr$2(this.sessions.embed_tokens,{input_ids:e})).inputs_embeds}_merge_input_ids_with_image_features({inputs_embeds:e,image_features:r,input_ids:n,attention_mask:i}){const a=this.config.image_token_index,o=n.tolist().map(m=>m.findIndex(c=>c==a)),u=o.every(m=>m===-1),l=o.every(m=>m!==-1);if(!u&&!l)throw new Error("Every input should contain either 0 or 1 image token.");if(u)return {inputs_embeds:e,attention_mask:i};const h=[],f=[];for(let m=0;m<o.length;++m){const c=o[m],y=e[m],b=r[m],v=i[m];h.push(Jt$2([y.slice([0,c]),b,y.slice([c+1,y.dims[0]])],0)),f.push(Jt$2([v.slice([0,c]),aa$2([b.dims[0]]),v.slice([c+1,v.dims[0]])],0));}return {inputs_embeds:Qn$2(h,0),attention_mask:Qn$2(f,0)}}}class Tb extends km{}let Ai$1 = class Ai extends X$2{};class kb extends Ai$1{}class Ib extends Ai$1{static async from_pretrained(e,r={}){return r.model_file_name??="text_model",super.from_pretrained(e,r)}}class Ab extends Ai$1{static async from_pretrained(e,r={}){return r.model_file_name??="vision_model",super.from_pretrained(e,r)}}class Im extends X$2{}class Mb extends Im{}class Ob extends Im{static async from_pretrained(e,r={}){return r.model_file_name??="text_model",super.from_pretrained(e,r)}}class zb extends Ai$1{static async from_pretrained(e,r={}){return r.model_file_name??="vision_model",super.from_pretrained(e,r)}}class Rb extends X$2{}class Pb extends Rb{}class Am extends X$2{}class Bb extends Am{}class Db extends Am{}class Mm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Nb extends Mm{}class Fb extends Mm{}class Om extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Lb extends Om{}class Wb extends Om{}class zm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Ub extends zm{}class Vb extends zm{}class Rm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Gb extends Rm{}class Hb extends Rm{}class Pm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class qb extends Pm{}class jb extends Pm{}class Bm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Kb extends Bm{}class Yb extends Bm{}class Dm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Xb extends Dm{}class Qb extends Dm{}class Nm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Jb extends Nm{}class Zb extends Nm{}class Fm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class e2 extends Fm{}class t2 extends Fm{}class Lm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class r2 extends Lm{}class n2 extends Lm{}class Wm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class a2 extends Wm{}class i2 extends Wm{}class Um extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class s2 extends Um{}class o2 extends Um{}class Vm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class u2 extends Vm{}class l2 extends Vm{}class Gm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class d2 extends Gm{}class c2 extends Gm{}class Hm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class p2 extends Hm{}class h2 extends Hm{}class qm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class f2 extends qm{}class m2 extends qm{}class jm extends X$2{}class g2 extends jm{}class _2 extends jm{async _call(e){return new Ae$2(await super._call(e))}}class Km extends X$2{}class y2 extends Km{}class w2 extends Km{async _call(e){return new Ae$2(await super._call(e))}}let b2$1 = class b2 extends X$2{};class v2 extends b2$1{async _call(e){return new Rv(await super._call(e))}}class Ym extends X$2{}class $2 extends Ym{}class x2 extends Ym{async _call(e){return new Ae$2(await super._call(e))}}class Xm extends X$2{}class S2 extends Xm{}class C2 extends Xm{async _call(e){return new Ae$2(await super._call(e))}}class Qm extends X$2{}class E2 extends Qm{}class T2 extends Qm{}class Jm extends X$2{}class k2 extends Jm{}class I2 extends Jm{}class Zm extends X$2{}class A2 extends Zm{}class M2 extends Zm{async _call(e){return new Ae$2(await super._call(e))}}let Ao$2 = class Ao extends X$2{};class O2 extends Ao$2{}class z2 extends Ao$2{async _call(e){return new eg(await super._call(e))}}class R2 extends Ao$2{async _call(e){return new P2(await super._call(e))}}class eg extends Ot$2{constructor({logits:e,pred_boxes:r}){super(),this.logits=e,this.pred_boxes=r;}}class P2 extends Ot$2{constructor({logits:e,pred_boxes:r,pred_masks:n}){super(),this.logits=e,this.pred_boxes=r,this.pred_masks=n;}}class tg extends X$2{}class B2 extends tg{}class D2 extends tg{async _call(e){return new N2(await super._call(e))}}class N2 extends eg{}class rg extends X$2{}class F2 extends rg{}class L2 extends rg{async _call(e){return new Ae$2(await super._call(e))}}class ng extends X$2{}class W2 extends ng{}class U2 extends ng{async _call(e){return new Ae$2(await super._call(e))}}class ag extends X$2{}class V2 extends ag{}class G2 extends ag{async _call(e){return new Ae$2(await super._call(e))}}class ig extends X$2{}class H2 extends ig{}class q2 extends ig{}class sg extends X$2{}class j2 extends sg{}class K2 extends sg{}class Y2 extends X$2{}class X2 extends Y2{}class og extends X$2{}class Q2 extends og{}class J2 extends og{}class Z2 extends X$2{}class e1 extends Z2{}class ug extends X$2{}class t1 extends ug{}class r1 extends ug{async _call(e){return new Ae$2(await super._call(e))}}class lg extends X$2{}class n1 extends lg{}class a1 extends lg{async _call(e){return new Ae$2(await super._call(e))}}class dg extends X$2{}class i1 extends dg{}class s1 extends dg{async _call(e){return new Ae$2(await super._call(e))}}class cg extends X$2{}class o1 extends cg{}class u1 extends cg{async _call(e){return new l1(await super._call(e))}}class l1 extends Ot$2{constructor({logits:e,pred_boxes:r}){super(),this.logits=e,this.pred_boxes=r;}}class d1 extends X$2{}class c1 extends d1{async get_image_embeddings({pixel_values:e}){return await Jn$2(this,{pixel_values:e})}async forward(e){if((!e.image_embeddings||!e.image_positional_embeddings)&&(e={...e,...await this.get_image_embeddings(e)}),!e.input_labels&&e.input_points){const n=e.input_points.dims.slice(0,-1),i=n.reduce((a,s)=>a*s,1);e.input_labels=new ce$2("int64",new BigInt64Array(i).fill(1n),n);}const r={image_embeddings:e.image_embeddings,image_positional_embeddings:e.image_positional_embeddings};return e.input_points&&(r.input_points=e.input_points),e.input_labels&&(r.input_labels=e.input_labels),e.input_boxes&&(r.input_boxes=e.input_boxes),await gr$2(this.sessions.prompt_encoder_mask_decoder,r)}async _call(e){return new p1(await super._call(e))}}class p1 extends Ot$2{constructor({iou_scores:e,pred_masks:r}){super(),this.iou_scores=e,this.pred_masks=r;}}class pg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class h1 extends pg{}class f1 extends pg{}class hg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class m1 extends hg{}class g1 extends hg{}let Ur$2 = class Ur extends X$2{};class _1 extends Ur$2{}class y1 extends Ur$2{async _call(e){return new gn$2(await super._call(e))}}class w1 extends Ur$2{async _call(e){return new Ae$2(await super._call(e))}}class b1 extends Ur$2{async _call(e){return new lt$2(await super._call(e))}}let Mo$2 = class Mo extends X$2{};class v1 extends Mo$2{}class $1 extends Mo$2{async _call(e){return new gn$2(await super._call(e))}}class x1 extends Mo$2{async _call(e){return new Ae$2(await super._call(e))}}let Mi$1 = class Mi extends X$2{};class S1 extends Mi$1{}class C1 extends Mi$1{async _call(e){return new gn$2(await super._call(e))}}class E1 extends Mi$1{async _call(e){return new Ae$2(await super._call(e))}}class T1 extends Mi$1{async _call(e){return new lt$2(await super._call(e))}}let Oo$2 = class Oo extends X$2{};class k1 extends Oo$2{}class I1 extends Oo$2{async _call(e){return new gn$2(await super._call(e))}}class A1 extends Oo$2{async _call(e){return new Ae$2(await super._call(e))}}class M1 extends Ur$2{}class O1 extends Ur$2{async _call(e){return new gn$2(await super._call(e))}}class z1 extends Ur$2{async _call(e){return new Ae$2(await super._call(e))}}let _a$3 = class _a extends X$2{};class R1 extends _a$3{}class P1 extends _a$3{async _call(e){return new gn$2(await super._call(e))}}class B1 extends _a$3{async _call(e){return new Ae$2(await super._call(e))}}class D1 extends _a$3{async _call(e){return new zv(await super._call(e))}}class N1 extends _a$3{async _call(e){return new lt$2(await super._call(e))}}class fg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class F1 extends fg{}class L1 extends fg{async generate_speech(e,r,{threshold:n=.5,minlenratio:i=0,maxlenratio:a=20,vocoder:s=null}={}){const o={input_ids:e},{encoder_outputs:u,encoder_attention_mask:l}=await Jn$2(this,o),h=u.dims[1]/this.config.reduction_factor,f=Math.floor(h*a),m=Math.floor(h*i),c=this.config.num_mel_bins;let y=[],b=null,v=null,C=0;for(;;){++C;const I=bm(!!v);let A;v?A=v.output_sequence_out:A=new ce$2("float32",new Float32Array(c),[1,1,c]);let R={use_cache_branch:I,output_sequence:A,encoder_attention_mask:l,speaker_embeddings:r,encoder_hidden_states:u};this.addPastKeyValues(R,b),v=await gr$2(this.sessions.decoder_model_merged,R),b=this.getPastKeyValues(v,b);const{prob:z,spectrum:P}=v;if(y.push(P),C>=m&&(Array.from(z.data).filter(J=>J>=n).length>0||C>=f))break}const x=Jt$2(y),{waveform:T}=await gr$2(s.sessions.model,{spectrogram:x});return {spectrogram:x,waveform:T}}}class W1 extends X$2{main_input_name="spectrogram"}class U1 extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class V1 extends U1{}class mg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class G1 extends mg{}class H1 extends mg{}class gg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class q1 extends gg{}class j1 extends gg{}class _g extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class K1 extends _g{}class Y1 extends _g{}let zo$2 = class zo extends X$2{};class X1 extends zo$2{}class Q1 extends zo$2{static async from_pretrained(e,r={}){return r.model_file_name??="text_model",super.from_pretrained(e,r)}}class J1 extends zo$2{static async from_pretrained(e,r={}){return r.model_file_name??="audio_model",super.from_pretrained(e,r)}}class Z1 extends X$2{}class yg extends Z1{async _call(e){return new Pv(await super._call(e))}}class wg extends X$2{}class ev extends wg{}class tv extends wg{}class bg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class rv extends bg{}class nv extends bg{}class vg extends X$2{}class av extends vg{}class iv extends vg{async _call(e){return new Ae$2(await super._call(e))}}class $g extends X$2{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}_apply_and_filter_by_delay_pattern_mask(e){const[r,n]=e.dims,i=this.config.decoder.num_codebooks,a=n-i;let s=0;for(let l=0;l<e.size;++l){if(e.data[l]===this.config.decoder.pad_token_id)continue;const h=l%n,f=Math.floor(l/n)%i,m=h-f;m>0&&m<=a&&(e.data[s++]=e.data[l]);}const o=Math.floor(r/i),u=s/(o*i);return new ce$2(e.type,e.data.slice(0,s),[o,i,u])}prepare_inputs_for_generation(e,r,n){let i=structuredClone(e);for(let s=0;s<i.length;++s)for(let o=0;o<i[s].length;++o)s%this.config.decoder.num_codebooks>=o&&(i[s][o]=BigInt(this.config.decoder.pad_token_id));return n.guidance_scale!==null&&n.guidance_scale>1&&(i=i.concat(i)),super.prepare_inputs_for_generation(i,r,n)}async generate(e){const r=await super.generate(e),n=this._apply_and_filter_by_delay_pattern_mask(r).unsqueeze_(0),{audio_values:i}=await gr$2(this.sessions.encodec_decode,{audio_codes:n});return i}}class sv{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=false;static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main",model_file_name:o=null,subfolder:u="onnx",device:l=null,dtype:h=null,use_external_data_format:f=null,session_options:m={}}={}){let c={progress_callback:r,config:n,cache_dir:i,local_files_only:a,revision:s,model_file_name:o,subfolder:u,device:l,dtype:h,use_external_data_format:f,session_options:m};if(c.config=await mm.from_pretrained(e,c),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);for(let y of this.MODEL_CLASS_MAPPINGS){const b=y.get(c.config.model_type);if(b)return await b[1].from_pretrained(e,c)}if(this.BASE_IF_FAIL)return console.warn(`Unknown model class "${c.config.model_type}", attempting to construct from base class.`),await X$2.from_pretrained(e,c);throw Error(`Unsupported model type: ${c.config.model_type}`)}}const ov=new Map([["bert",["BertModel",Ry]],["nomic_bert",["NomicBertModel",Ly]],["roformer",["RoFormerModel",Wy]],["electra",["ElectraModel",Qy]],["esm",["EsmModel",$w]],["convbert",["ConvBertModel",qy]],["camembert",["CamembertModel",rw]],["deberta",["DebertaModel",ow]],["deberta-v2",["DebertaV2Model",pw]],["mpnet",["MPNetModel",Aw]],["albert",["AlbertModel",Fw]],["distilbert",["DistilBertModel",_w]],["roberta",["RobertaModel",sb]],["xlm",["XLMModel",cb]],["xlm-roberta",["XLMRobertaModel",gb]],["clap",["ClapModel",X1]],["clip",["CLIPModel",kb]],["clipseg",["CLIPSegModel",Bb]],["chinese_clip",["ChineseCLIPModel",Pb]],["siglip",["SiglipModel",Mb]],["mobilebert",["MobileBertModel",Ew]],["squeezebert",["SqueezeBertModel",Pw]],["wav2vec2",["Wav2Vec2Model",_1]],["wav2vec2-bert",["Wav2Vec2BertModel",k1]],["unispeech",["UniSpeechModel",v1]],["unispeech-sat",["UniSpeechSatModel",S1]],["hubert",["HubertModel",M1]],["wavlm",["WavLMModel",R1]],["audio-spectrogram-transformer",["ASTModel",vb]],["vits",["VitsModel",yg]],["detr",["DetrModel",O2]],["table-transformer",["TableTransformerModel",B2]],["vit",["ViTModel",g2]],["fastvit",["FastViTModel",y2]],["mobilevit",["MobileViTModel",$2]],["mobilevitv2",["MobileViTV2Model",S2]],["owlvit",["OwlViTModel",E2]],["owlv2",["Owlv2Model",k2]],["beit",["BeitModel",A2]],["deit",["DeiTModel",F2]],["convnext",["ConvNextModel",t1]],["convnextv2",["ConvNextV2Model",n1]],["dinov2",["Dinov2Model",i1]],["resnet",["ResNetModel",W2]],["swin",["SwinModel",V2]],["swin2sr",["Swin2SRModel",H2]],["donut-swin",["DonutSwinModel",e1]],["yolos",["YolosModel",o1]],["dpt",["DPTModel",j2]],["glpn",["GLPNModel",Q2]],["hifigan",["SpeechT5HifiGan",W1]],["efficientnet",["EfficientNetModel",av]]]),uv=new Map([["t5",["T5Model",Vw]],["longt5",["LongT5Model",Hw]],["mt5",["MT5Model",jw]],["bart",["BartModel",Yw]],["mbart",["MBartModel",Jw]],["marian",["MarianModel",h1]],["whisper",["WhisperModel",xb]],["m2m_100",["M2M100Model",m1]],["blenderbot",["BlenderbotModel",rb]],["blenderbot-small",["BlenderbotSmallModel",ab]]]),lv=new Map([["bloom",["BloomModel",d2]],["gpt2",["GPT2Model",Nb]],["gptj",["GPTJModel",Gb]],["gpt_bigcode",["GPTBigCodeModel",qb]],["gpt_neo",["GPTNeoModel",Lb]],["gpt_neox",["GPTNeoXModel",Ub]],["codegen",["CodeGenModel",Kb]],["llama",["LlamaModel",Xb]],["cohere",["CohereModel",Jb]],["gemma",["GemmaModel",e2]],["openelm",["OpenELMModel",r2]],["qwen2",["Qwen2Model",a2]],["phi",["PhiModel",s2]],["phi3",["Phi3Model",u2]],["mpt",["MptModel",p2]],["opt",["OPTModel",f2]],["mistral",["MistralModel",G1]],["starcoder2",["Starcoder2Model",q1]],["falcon",["FalconModel",K1]],["stablelm",["StableLmModel",rv]]]),xg=new Map([["speecht5",["SpeechT5ForSpeechToText",F1]],["whisper",["WhisperForConditionalGeneration",Sb]]]),dv=new Map([["speecht5",["SpeechT5ForTextToSpeech",L1]]]),cv=new Map([["vits",["VitsModel",yg]],["musicgen",["MusicgenForConditionalGeneration",$g]]]),pv=new Map([["bert",["BertForSequenceClassification",By]],["roformer",["RoFormerForSequenceClassification",Vy]],["electra",["ElectraForSequenceClassification",Zy]],["esm",["EsmForSequenceClassification",Sw]],["convbert",["ConvBertForSequenceClassification",Ky]],["camembert",["CamembertForSequenceClassification",aw]],["deberta",["DebertaForSequenceClassification",lw]],["deberta-v2",["DebertaV2ForSequenceClassification",fw]],["mpnet",["MPNetForSequenceClassification",Ow]],["albert",["AlbertForSequenceClassification",Lw]],["distilbert",["DistilBertForSequenceClassification",yw]],["roberta",["RobertaForSequenceClassification",ub]],["xlm",["XLMForSequenceClassification",hb]],["xlm-roberta",["XLMRobertaForSequenceClassification",yb]],["bart",["BartForSequenceClassification",Qw]],["mbart",["MBartForSequenceClassification",eb]],["mobilebert",["MobileBertForSequenceClassification",kw]],["squeezebert",["SqueezeBertForSequenceClassification",Dw]]]),hv=new Map([["bert",["BertForTokenClassification",Dy]],["roformer",["RoFormerForTokenClassification",Gy]],["electra",["ElectraForTokenClassification",ew]],["esm",["EsmForTokenClassification",Cw]],["convbert",["ConvBertForTokenClassification",Yy]],["camembert",["CamembertForTokenClassification",iw]],["deberta",["DebertaForTokenClassification",dw]],["deberta-v2",["DebertaV2ForTokenClassification",mw]],["mpnet",["MPNetForTokenClassification",zw]],["distilbert",["DistilBertForTokenClassification",ww]],["roberta",["RobertaForTokenClassification",lb]],["xlm",["XLMForTokenClassification",fb]],["xlm-roberta",["XLMRobertaForTokenClassification",wb]]]),Sg=new Map([["t5",["T5ForConditionalGeneration",Gw]],["longt5",["LongT5ForConditionalGeneration",qw]],["mt5",["MT5ForConditionalGeneration",Kw]],["bart",["BartForConditionalGeneration",Xw]],["mbart",["MBartForConditionalGeneration",Zw]],["marian",["MarianMTModel",f1]],["m2m_100",["M2M100ForConditionalGeneration",g1]],["blenderbot",["BlenderbotForConditionalGeneration",nb]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",ib]]]),Cg=new Map([["bloom",["BloomForCausalLM",c2]],["gpt2",["GPT2LMHeadModel",Fb]],["gptj",["GPTJForCausalLM",Hb]],["gpt_bigcode",["GPTBigCodeForCausalLM",jb]],["gpt_neo",["GPTNeoForCausalLM",Wb]],["gpt_neox",["GPTNeoXForCausalLM",Vb]],["codegen",["CodeGenForCausalLM",Yb]],["llama",["LlamaForCausalLM",Qb]],["cohere",["CohereForCausalLM",Zb]],["gemma",["GemmaForCausalLM",t2]],["openelm",["OpenELMForCausalLM",n2]],["qwen2",["Qwen2ForCausalLM",i2]],["phi",["PhiForCausalLM",o2]],["phi3",["Phi3ForCausalLM",l2]],["mpt",["MptForCausalLM",h2]],["opt",["OPTForCausalLM",m2]],["mbart",["MBartForCausalLM",tb]],["mistral",["MistralForCausalLM",H1]],["starcoder2",["Starcoder2ForCausalLM",j1]],["falcon",["FalconForCausalLM",Y1]],["trocr",["TrOCRForCausalLM",V1]],["stablelm",["StableLmForCausalLM",nv]]]),fv=new Map([["bert",["BertForMaskedLM",Py]],["roformer",["RoFormerForMaskedLM",Uy]],["electra",["ElectraForMaskedLM",Jy]],["esm",["EsmForMaskedLM",xw]],["convbert",["ConvBertForMaskedLM",jy]],["camembert",["CamembertForMaskedLM",nw]],["deberta",["DebertaForMaskedLM",uw]],["deberta-v2",["DebertaV2ForMaskedLM",hw]],["mpnet",["MPNetForMaskedLM",Mw]],["albert",["AlbertForMaskedLM",Uw]],["distilbert",["DistilBertForMaskedLM",vw]],["roberta",["RobertaForMaskedLM",ob]],["xlm",["XLMWithLMHeadModel",pb]],["xlm-roberta",["XLMRobertaForMaskedLM",_b$1]],["mobilebert",["MobileBertForMaskedLM",Tw]],["squeezebert",["SqueezeBertForMaskedLM",Bw]]]),mv=new Map([["bert",["BertForQuestionAnswering",Ny]],["roformer",["RoFormerForQuestionAnswering",Hy]],["electra",["ElectraForQuestionAnswering",tw]],["convbert",["ConvBertForQuestionAnswering",Xy]],["camembert",["CamembertForQuestionAnswering",sw]],["deberta",["DebertaForQuestionAnswering",cw]],["deberta-v2",["DebertaV2ForQuestionAnswering",gw]],["mpnet",["MPNetForQuestionAnswering",Rw]],["albert",["AlbertForQuestionAnswering",Ww]],["distilbert",["DistilBertForQuestionAnswering",bw]],["roberta",["RobertaForQuestionAnswering",db]],["xlm",["XLMForQuestionAnswering",mb]],["xlm-roberta",["XLMRobertaForQuestionAnswering",bb]],["mobilebert",["MobileBertForQuestionAnswering",Iw]],["squeezebert",["SqueezeBertForQuestionAnswering",Nw]]]),Eg=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",Cb]]]),gv=new Map([["llava",["LlavaForConditionalGeneration",km]],["moondream1",["Moondream1ForConditionalGeneration",Tb]]]),_v=new Map([["vit",["ViTForImageClassification",_2]],["fastvit",["FastViTForImageClassification",w2]],["mobilevit",["MobileViTForImageClassification",x2]],["mobilevitv2",["MobileViTV2ForImageClassification",C2]],["beit",["BeitForImageClassification",M2]],["deit",["DeiTForImageClassification",L2]],["convnext",["ConvNextForImageClassification",r1]],["convnextv2",["ConvNextV2ForImageClassification",a1]],["dinov2",["Dinov2ForImageClassification",s1]],["resnet",["ResNetForImageClassification",U2]],["swin",["SwinForImageClassification",G2]],["segformer",["SegformerForImageClassification",ev]],["efficientnet",["EfficientNetForImageClassification",iv]]]),yv=new Map([["detr",["DetrForObjectDetection",z2]],["table-transformer",["TableTransformerForObjectDetection",D2]],["yolos",["YolosForObjectDetection",u1]]]),wv=new Map([["owlvit",["OwlViTForObjectDetection",T2]],["owlv2",["Owlv2ForObjectDetection",I2]]]),bv=new Map([["detr",["DetrForSegmentation",R2]],["clipseg",["CLIPSegForImageSegmentation",Db]]]),vv=new Map([["segformer",["SegformerForSemanticSegmentation",tv]]]),$v=new Map([["sam",["SamModel",c1]]]),xv=new Map([["wav2vec2",["Wav2Vec2ForCTC",y1]],["wav2vec2-bert",["Wav2Vec2BertForCTC",I1]],["unispeech",["UniSpeechForCTC",$1]],["unispeech-sat",["UniSpeechSatForCTC",C1]],["wavlm",["WavLMForCTC",P1]],["hubert",["HubertForCTC",O1]]]),Sv=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",w1]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",A1]],["unispeech",["UniSpeechForSequenceClassification",x1]],["unispeech-sat",["UniSpeechSatForSequenceClassification",E1]],["wavlm",["WavLMForSequenceClassification",B1]],["hubert",["HubertForSequenceClassification",z1]],["audio-spectrogram-transformer",["ASTForAudioClassification",$b]]]),Cv=new Map([["wavlm",["WavLMForXVector",D1]]]),Ev=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",T1]],["wavlm",["WavLMForAudioFrameClassification",N1]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",b1]]]),Tv=new Map([["vitmatte",["VitMatteForImageMatting",v2]]]),kv=new Map([["swin2sr",["Swin2SRForImageSuperResolution",q2]]]),Iv=new Map([["dpt",["DPTForDepthEstimation",K2]],["depth_anything",["DepthAnythingForDepthEstimation",X2]],["glpn",["GLPNForDepthEstimation",J2]]]),Av=new Map([["clip",["CLIPVisionModelWithProjection",Ab]],["siglip",["SiglipVisionModel",zb]]]),Tg=[[ov,be$2.EncoderOnly],[uv,be$2.EncoderDecoder],[lv,be$2.DecoderOnly],[pv,be$2.EncoderOnly],[hv,be$2.EncoderOnly],[Sg,be$2.Seq2Seq],[xg,be$2.Seq2Seq],[Cg,be$2.DecoderOnly],[fv,be$2.EncoderOnly],[mv,be$2.EncoderOnly],[Eg,be$2.Vision2Seq],[gv,be$2.ImageTextToText],[_v,be$2.EncoderOnly],[bv,be$2.EncoderOnly],[vv,be$2.EncoderOnly],[Tv,be$2.EncoderOnly],[kv,be$2.EncoderOnly],[Iv,be$2.EncoderOnly],[yv,be$2.EncoderOnly],[wv,be$2.EncoderOnly],[$v,be$2.MaskGeneration],[xv,be$2.EncoderOnly],[Sv,be$2.EncoderOnly],[dv,be$2.Seq2Seq],[cv,be$2.EncoderOnly],[Cv,be$2.EncoderOnly],[Ev,be$2.EncoderOnly],[Av,be$2.EncoderOnly]];for(const[t,e]of Tg)for(const[r,n]of t.values())wi$1.set(r,e),qn$2.set(n,r),_m.set(r,n);const Mv=[["MusicgenForConditionalGeneration",$g,be$2.Musicgen],["CLIPTextModelWithProjection",Ib,be$2.EncoderOnly],["SiglipTextModel",Ob,be$2.EncoderOnly],["ClapTextModelWithProjection",Q1,be$2.EncoderOnly],["ClapAudioModelWithProjection",J1,be$2.EncoderOnly]];for(const[t,e,r]of Mv)wi$1.set(t,r),qn$2.set(e,t),_m.set(t,e);class Ov extends sv{static MODEL_CLASS_MAPPINGS=Tg.map(e=>e[0]);static BASE_IF_FAIL=true}let Ae$2 = class Ae extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};class zv extends Ot$2{constructor({logits:e,embeddings:r}){super(),this.logits=e,this.embeddings=r;}}let lt$2 = class lt extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};let dt$2 = class dt extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};let mt$2 = class mt extends Ot$2{constructor({start_logits:e,end_logits:r}){super(),this.start_logits=e,this.end_logits=r;}};let gn$2 = class gn extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};class Rv extends Ot$2{constructor({alphas:e}){super(),this.alphas=e;}}class Pv extends Ot$2{constructor({waveform:e,spectrogram:r}){super(),this.waveform=e,this.spectrogram=r;}}const It$2=typeof self<"u",Bv=It$2&&self.constructor.name==="DedicatedWorkerGlobalScope";let kr$2,kg,fr$2;if(It$2)kr$2=(t,e)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(t,e)},fr$2=self.createImageBitmap,kg=self.ImageData;else if(Ye$2)fr$2=async t=>{const r=(await t.metadata()).channels,{data:n,info:i}=await t.rotate().raw().toBuffer({resolveWithObject:true}),a=new Vt$2(new Uint8ClampedArray(n),i.width,i.height,i.channels);return r!==void 0&&r!==i.channels&&a.convert(r),a};else throw new Error("Unable to load image processing library.");const Dv={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},Nv=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);let Vt$2 = class Vt{constructor(e,r,n,i){this.data=e,this.width=r,this.height=n,this.channels=i;}get size(){return [this.width,this.height]}static async read(e){if(e instanceof Vt)return e;if(typeof e=="string"||e instanceof URL)return await this.fromURL(e);throw new Error(`Unsupported input type: ${typeof e}`)}static fromCanvas(e){if(!It$2)throw new Error("fromCanvas() is only supported in browser environments.");const n=e.getContext("2d").getImageData(0,0,e.width,e.height).data;return new Vt(n,e.width,e.height,4)}static async fromURL(e){const r=await Rs$2(e);if(r.status!==200)throw new Error(`Unable to read image from "${e}" (${r.status} ${r.statusText})`);const n=await r.blob();return this.fromBlob(n)}static async fromBlob(e){if(It$2){const r=await fr$2(e),n=kr$2(r.width,r.height).getContext("2d");return n.drawImage(r,0,0),new this(n.getImageData(0,0,r.width,r.height).data,r.width,r.height,4)}else {const r=Ye$2(await e.arrayBuffer());return await fr$2(r)}}static fromTensor(e,r="CHW"){if(e.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${e.dims.length} dimensions.`);if(r==="CHW")e=e.transpose(1,2,0);else if(r!=="HWC")throw new Error(`Unsupported channel format: ${r}`);if(!(e.data instanceof Uint8ClampedArray||e.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${e.type}`);switch(e.dims[2]){case 1:case 2:case 3:case 4:return new Vt(e.data,e.dims[1],e.dims[0],e.dims[2]);default:throw new Error(`Unsupported number of channels: ${e.dims[2]}`)}}grayscale(){if(this.channels===1)return this;const e=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let r=0,n=0;r<this.data.length;r+=this.channels){const i=this.data[r],a=this.data[r+1],s=this.data[r+2];e[n++]=Math.round(.2989*i+.587*a+.114*s);}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,1)}rgb(){if(this.channels===3)return this;const e=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let r=0,n=0;r<this.data.length;++r)e[n++]=this.data[r],e[n++]=this.data[r],e[n++]=this.data[r];break;case 4:for(let r=0,n=0;r<this.data.length;r+=4)e[n++]=this.data[r],e[n++]=this.data[r+1],e[n++]=this.data[r+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,3)}rgba(){if(this.channels===4)return this;const e=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let r=0,n=0;r<this.data.length;++r)e[n++]=this.data[r],e[n++]=this.data[r],e[n++]=this.data[r],e[n++]=255;break;case 3:for(let r=0,n=0;r<this.data.length;r+=3)e[n++]=this.data[r],e[n++]=this.data[r+1],e[n++]=this.data[r+2],e[n++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,4)}async resize(e,r,{resample:n=2}={}){let i=Dv[n]??n;if(It$2){const a=this.channels,s=this.toCanvas(),o=kr$2(e,r).getContext("2d");return o.drawImage(s,0,0,e,r),new Vt(o.getImageData(0,0,e,r).data,e,r,4).convert(a)}else {let a=this.toSharp();switch(i){case "box":case "hamming":(i==="box"||i==="hamming")&&(console.warn(`Resampling method ${i} is not yet supported. Using bilinear instead.`),i="bilinear");case "nearest":case "bilinear":case "bicubic":a=a.affine([e/this.width,0,0,r/this.height],{interpolator:i});break;case "lanczos":a=a.resize({width:e,height:r,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${i} is not supported.`)}return await fr$2(a)}}async pad([e,r,n,i]){if(e=Math.max(e,0),r=Math.max(r,0),n=Math.max(n,0),i=Math.max(i,0),e===0&&r===0&&n===0&&i===0)return this;if(It$2){const a=this.channels,s=this.toCanvas(),o=this.width+e+r,u=this.height+n+i,l=kr$2(o,u).getContext("2d");return l.drawImage(s,0,0,this.width,this.height,e,n,o,u),new Vt(l.getImageData(0,0,o,u).data,o,u,4).convert(a)}else {const a=this.toSharp().extend({left:e,right:r,top:n,bottom:i});return await fr$2(a)}}async crop([e,r,n,i]){if(e=Math.max(e,0),r=Math.max(r,0),n=Math.min(n,this.width-1),i=Math.min(i,this.height-1),e===0&&r===0&&n===this.width-1&&i===this.height-1)return this;const a=n-e+1,s=i-r+1;if(It$2){const o=this.channels,u=this.toCanvas(),l=kr$2(a,s).getContext("2d");return l.drawImage(u,e,r,a,s,0,0,a,s),new Vt(l.getImageData(0,0,a,s).data,a,s,4).convert(o)}else {const o=this.toSharp().extract({left:e,top:r,width:a,height:s});return await fr$2(o)}}async center_crop(e,r){if(this.width===e&&this.height===r)return this;const n=(this.width-e)/2,i=(this.height-r)/2;if(It$2){const a=this.channels,s=this.toCanvas(),o=kr$2(e,r).getContext("2d");let u=0,l=0,h=0,f=0;return n>=0?u=n:h=-n,i>=0?l=i:f=-i,o.drawImage(s,u,l,e,r,h,f,e,r),new Vt(o.getImageData(0,0,e,r).data,e,r,4).convert(a)}else {let a=this.toSharp();if(n>=0&&i>=0)a=a.extract({left:Math.floor(n),top:Math.floor(i),width:e,height:r});else if(n<=0&&i<=0){const s=Math.floor(-i),o=Math.floor(-n);a=a.extend({top:s,left:o,right:e-this.width-o,bottom:r-this.height-s});}else {let s=[0,0],o=0;i<0?(s[0]=Math.floor(-i),s[1]=r-this.height-s[0]):o=Math.floor(i);let u=[0,0],l=0;n<0?(u[0]=Math.floor(-n),u[1]=e-this.width-u[0]):l=Math.floor(n),a=a.extend({top:s[0],bottom:s[1],left:u[0],right:u[1]}).extract({left:l,top:o,width:e,height:r});}return await fr$2(a)}}async toBlob(e="image/png",r=1){if(!It$2)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:e,quality:r})}toTensor(e="CHW"){let r=new ce$2("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(e!=="HWC")if(e==="CHW")r=r.permute(2,0,1);else throw new Error(`Unsupported channel format: ${e}`);return r}toCanvas(){if(!It$2)throw new Error("toCanvas() is only supported in browser environments.");const e=this.clone().rgba(),r=kr$2(e.width,e.height),n=new kg(e.data,e.width,e.height);return r.getContext("2d").putImageData(n,0,0),r}_update(e,r,n,i=null){return this.data=e,this.width=r,this.height=n,i!==null&&(this.channels=i),this}clone(){return new Vt(this.data.slice(),this.width,this.height,this.channels)}convert(e){if(this.channels===e)return this;switch(e){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(e){if(It$2){if(Bv)throw new Error("Unable to save an image from a Web Worker.");const r=e.split(".").pop().toLowerCase(),n=Nv.get(r)??"image/png",i=await this.toBlob(n),a=URL.createObjectURL(i),s=document.createElement("a");s.href=a,s.download=e,s.click(),s.remove();}else {if(bt$2.useFS)return await this.toSharp().toFile(e);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(It$2)throw new Error("toSharp() is only supported in server-side environments.");return Ye$2(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}};function Tc$1(t){if(t<1)return new Float64Array;if(t===1)return new Float64Array([1]);const e=t-1,r=Math.PI/e,n=new Float64Array(t);for(let i=0;i<t;++i){const a=2*i-e;n[i]=.5+.5*Math.cos(r*a);}return n}const Fv={htk:t=>2595*Math.log10(1+t/700),kaldi:t=>1127*Math.log(1+t/700),slaney:(t,e=1e3,r=15,n=27/Math.log(6.4))=>t>=e?r+Math.log(t/e)*n:3*t/200};function Is$2(t,e="htk"){const r=Fv[e];if(!r)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof t=="number"?r(t):t.map(n=>r(n))}const Lv={htk:t=>700*(10**(t/2595)-1),kaldi:t=>700*(Math.exp(t/1127)-1),slaney:(t,e=1e3,r=15,n=Math.log(6.4)/27)=>t>=r?e*Math.exp(n*(t-r)):200*t/3};function Wv(t,e="htk"){const r=Lv[e];if(!r)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof t=="number"?r(t):t.map(n=>r(n))}function Uv(t,e){const r=Float64Array.from({length:e.length-1},(s,o)=>e[o+1]-e[o]),n=Array.from({length:t.length},()=>new Array(e.length));for(let s=0;s<t.length;++s){const o=n[s];for(let u=0;u<e.length;++u)o[u]=e[u]-t[s];}const i=e.length-2,a=Array.from({length:i},()=>new Array(t.length));for(let s=0;s<t.length;++s){const o=n[s];for(let u=0;u<i;++u){const l=-o[u]/r[u],h=o[u+2]/r[u+1];a[u][s]=Math.max(0,Math.min(l,h));}}return a}function kc$1(t,e,r){const n=(e-t)/(r-1);return Float64Array.from({length:r},(i,a)=>t+n*a)}function Zn$2(t,e,r,n,i,a=null,s="htk",o=false){if(a!==null&&a!=="slaney")throw new Error('norm must be one of null or "slaney"');const u=Is$2(r,s),l=Is$2(n,s),h=kc$1(u,l,e+2);let f=Wv(h,s),m;if(o){const y=i/(t*2);m=Is$2(Float64Array.from({length:t},(b,v)=>v*y),s),f=h;}else m=kc$1(0,Math.floor(i/2),t);const c=Uv(m,f);if(a!==null&&a==="slaney")for(let y=0;y<e;++y){const b=c[y],v=2/(f[y+2]-f[y]);for(let C=0;C<t;++C)b[C]*=v;}return c}function Vv(t,e,r){const n=new t.constructor(t.length+e+r),i=t.length-1;for(let a=0;a<t.length;++a)n[e+a]=t[a];for(let a=1;a<=e;++a)n[e-a]=t[oi$2(a,i)];for(let a=1;a<=r;++a)n[i+e+a]=t[oi$2(i-a,i)];return n}function Ig(t,e,r,n,i){if(r<=0)throw new Error("reference must be greater than zero");if(n<=0)throw new Error("min_value must be greater than zero");r=Math.max(n,r);const a=Math.log10(r);for(let s=0;s<t.length;++s)t[s]=e*Math.log10(Math.max(n,t[s])-a);if(i!==null){if(i<=0)throw new Error("db_range must be greater than zero");const s=_r$2(t)[0]-i;for(let o=0;o<t.length;++o)t[o]=Math.max(t[o],s);}return t}function Gv(t,e=1,r=1e-5,n=null){return Ig(t,20,e,r,n)}function Hv(t,e=1,r=1e-10,n=null){return Ig(t,10,e,r,n)}async function Oi$1(t,e,r,n,{fft_length:i=null,power:a=1,center:s=true,pad_mode:o="reflect",onesided:u=true,preemphasis:l=null,mel_filters:h=null,mel_floor:f=1e-10,log_mel:m=null,reference:c=1,min_value:y=1e-10,db_range:b=null,remove_dc_offset:v=null,max_num_frames:C=null,do_pad:x=true,transpose:T=false}={}){const I=e.length;if(i===null&&(i=r),r>i)throw Error(`frame_length (${r}) may not be larger than fft_length (${i})`);if(I!==r)throw new Error(`Length of the window (${I}) must equal frame_length (${r})`);if(n<=0)throw new Error("hop_length must be greater than zero");if(a===null&&h!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(s){if(o!=="reflect")throw new Error(`pad_mode="${o}" not implemented yet.`);const U=Math.floor((i-1)/2)+1;t=Vv(t,U,U);}const A=Math.floor(1+Math.floor((t.length-r)/n)),R=u?Math.floor(i/2)+1:i;let z=A,P=A;C!==null&&(C>A?x&&(P=C):P=z=C);const J=new d0(i),K=new Float64Array(i),ue=new Float64Array(J.outputBufferSize),ie=new Float32Array(R*P);for(let U=0;U<z;++U){const de=U*n;for(let re=0;re<r;++re)K[re]=t[de+re];if(v){let re=0;for(let Z=0;Z<r;++Z)re+=K[Z];const Q=re/r;for(let Z=0;Z<r;++Z)K[Z]-=Q;}if(l!==null){for(let re=r-1;re>=1;--re)K[re]-=l*K[re-1];K[0]*=1-l;}for(let re=0;re<e.length;++re)K[re]*=e[re];J.realTransform(ue,K);for(let re=0;re<R;++re){const Q=re<<1;ie[re*P+U]=ue[Q]**2+ue[Q+1]**2;}}if(a!==null&&a!==2){const U=2/a;for(let de=0;de<ie.length;++de)ie[de]**=U;}const ge=h.length;let he=await Y_(new ce$2("float32",h.flat(),[ge,R]),new ce$2("float32",ie,[R,P]));T&&(he=he.transpose(1,0));const D=he.data;for(let U=0;U<D.length;++U)D[U]=Math.max(f,D[U]);if(a!==null&&m!==null){const U=Math.min(D.length,z*ge);switch(m){case "log":for(let de=0;de<U;++de)D[de]=Math.log(D[de]);break;case "log10":for(let de=0;de<U;++de)D[de]=Math.log10(D[de]);break;case "dB":if(a===1)Gv(D,c,y,b);else if(a===2)Hv(D,c,y,b);else throw new Error(`Cannot use log_mel option '${m}' with power ${a}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${m}'`)}}return he}function zi$2(t,e,{periodic:r=true,frame_length:n=null,center:i=true}={}){const a=r?t+1:t;let s;switch(e){case "boxcar":s=new Float64Array(a).fill(1);break;case "hann":case "hann_window":s=Tc$1(a);break;case "povey":s=Tc$1(a).map(o=>Math.pow(o,.85));break;default:throw new Error(`Unknown window type ${e}.`)}if(r&&(s=s.subarray(0,t)),n===null)return s;if(t>n)throw new Error(`Length of the window (${t}) may not be larger than frame_length (${n})`);return s}function qv([t,e,r,n]){return [t-r/2,e-n/2,t+r/2,e+n/2]}function Ro$2(t,e=.5,r=null,n=false){const i=t.logits,a=t.pred_boxes,[s,o,u]=i.dims;if(r!==null&&r.length!==s)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let l=[];for(let h=0;h<s;++h){let f=r!==null?r[h]:null,m={boxes:[],classes:[],scores:[]},c=i[h],y=a[h];for(let b=0;b<o;++b){let v=c[b],C=[],x;if(n){x=v.sigmoid().data;for(let T=0;T<x.length;++T)x[T]>e&&C.push(T);}else {let T=_r$2(v.data)[1];if(T===u-1||(x=ta$2(v.data),x[T]<e))continue;C.push(T);}for(const T of C){let I=y[b].data;I=qv(I),f!==null&&(I=I.map((A,R)=>A*f[(R+1)%2])),m.boxes.push(I),m.classes.push(T),m.scores.push(x[T]);}}l.push(m);}return l}function ya$2(t,e){if(!(t instanceof Float32Array||t instanceof Float64Array))throw new Error(`${e} expects input to be a Float32Array or a Float64Array, but got ${t?.constructor?.name??typeof t} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}function Ic$1(t,e,r=0,n=null){const i=t/e;let a=p0(i)*e;return n!==null&&a>n&&(a=Math.floor(i)*e),a<r&&(a=Math.ceil(i)*e),a}function As$2([t,e],r){return [Math.max(Math.floor(t/r),1)*r,Math.max(Math.floor(e/r),1)*r]}let Vr$2 = class Vr extends or$2{constructor(e){super(),this.config=e;}};let je$2 = class je extends Vr$2{constructor(e){super(e),this.image_mean=this.config.image_mean??this.config.mean,this.image_std=this.config.image_std??this.config.std,this.resample=this.config.resample??2,this.do_rescale=this.config.do_rescale??true,this.rescale_factor=this.config.rescale_factor??1/255,this.do_normalize=this.config.do_normalize,this.do_resize=this.config.do_resize,this.do_thumbnail=this.config.do_thumbnail,this.size=this.config.size,this.size_divisibility=this.config.size_divisibility??this.config.size_divisor,this.do_center_crop=this.config.do_center_crop,this.crop_size=this.config.crop_size,this.do_convert_rgb=this.config.do_convert_rgb??true,this.do_crop_margin=this.config.do_crop_margin,this.pad_size=this.config.pad_size,this.do_pad=this.config.do_pad,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=this.config.do_flip_channel_order??false;}async thumbnail(e,r,n=2){const i=e.height,a=e.width,s=r.height,o=r.width;let u=Math.min(i,s),l=Math.min(a,o);return u===i&&l===a?e:(i>a?l=Math.floor(a*u/i):a>i&&(u=Math.floor(i*l/a)),await e.resize(l,u,{resample:n}))}async crop_margin(e,r=200){const n=e.clone().grayscale(),i=u0(n.data)[0],s=_r$2(n.data)[0]-i;if(s===0)return e;const o=r/255;let u=n.width,l=n.height,h=0,f=0;const m=n.data;for(let c=0;c<n.height;++c){const y=c*n.width;for(let b=0;b<n.width;++b)(m[y+b]-i)/s<o&&(u=Math.min(u,b),l=Math.min(l,c),h=Math.max(h,b),f=Math.max(f,c));}return e=await e.crop([u,l,h,f]),e}pad_image(e,r,n,{mode:i="constant",center:a=false,constant_values:s=0}={}){const[o,u,l]=r;let h,f;if(typeof n=="number"?(h=n,f=n):(h=n.width,f=n.height),h!==u||f!==o){const m=new Float32Array(h*f*l);if(Array.isArray(s))for(let b=0;b<m.length;++b)m[b]=s[b%l];else s!==0&&m.fill(s);const[c,y]=a?[Math.floor((h-u)/2),Math.floor((f-o)/2)]:[0,0];for(let b=0;b<o;++b){const v=(b+y)*h,C=b*u;for(let x=0;x<u;++x){const T=(v+x+c)*l,I=(C+x)*l;for(let A=0;A<l;++A)m[T+A]=e[I+A];}}if(i==="symmetric"){if(a)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const b=o-1,v=u-1;for(let C=0;C<f;++C){const x=C*h,T=oi$2(C,b)*u;for(let I=0;I<h;++I){if(C<o&&I<u)continue;const A=(x+I)*l,R=(T+oi$2(I,v))*l;for(let z=0;z<l;++z)m[A+z]=e[R+z];}}}e=m,r=[f,h,l];}return [e,r]}rescale(e){for(let r=0;r<e.length;++r)e[r]=this.rescale_factor*e[r];}get_resize_output_image_size(e,r){const[n,i]=e.size;let a,s;if(this.do_thumbnail){const{height:o,width:u}=r;a=Math.min(o,u);}else Number.isInteger(r)?(a=r,s=this.config.max_size??a):r!==void 0&&(a=r.shortest_edge,s=r.longest_edge);if(a!==void 0||s!==void 0){const o=a===void 0?1:Math.max(a/n,a/i),u=n*o,l=i*o,h=s===void 0?1:Math.min(s/u,s/l);let f=Math.floor(Number((u*h).toFixed(2))),m=Math.floor(Number((l*h).toFixed(2)));return this.size_divisibility!==void 0&&([f,m]=As$2([f,m],this.size_divisibility)),[f,m]}else if(r!==void 0&&r.width!==void 0&&r.height!==void 0){let o=r.width,u=r.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let l=u/i,h=o/n;Math.abs(1-h)<Math.abs(1-l)?l=h:h=l,u=Ic$1(l*i,this.config.ensure_multiple_of),o=Ic$1(h*n,this.config.ensure_multiple_of);}return [o,u]}else {if(this.size_divisibility!==void 0)return As$2([n,i],this.size_divisibility);throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(r)}`)}}async resize(e){const[r,n]=this.get_resize_output_image_size(e,this.size);return await e.resize(r,n,{resample:this.resample})}async preprocess(e,{do_normalize:r=null,do_pad:n=null,do_convert_rgb:i=null,do_convert_grayscale:a=null,do_flip_channel_order:s=null}={}){this.do_crop_margin&&(e=await this.crop_margin(e));const[o,u]=e.size;if(i??this.do_convert_rgb?e=e.rgb():a&&(e=e.grayscale()),this.do_resize&&(e=await this.resize(e)),this.do_thumbnail&&(e=await this.thumbnail(e,this.size,this.resample)),this.do_center_crop){let c,y;Number.isInteger(this.crop_size)?(c=this.crop_size,y=this.crop_size):(c=this.crop_size.width,y=this.crop_size.height),e=await e.center_crop(c,y);}const l=[e.height,e.width];let h=Float32Array.from(e.data),f=[e.height,e.width,e.channels];if(this.do_rescale&&this.rescale(h),r??this.do_normalize){let c=this.image_mean;Array.isArray(this.image_mean)||(c=new Array(e.channels).fill(c));let y=this.image_std;if(Array.isArray(this.image_std)||(y=new Array(e.channels).fill(c)),c.length!==e.channels||y.length!==e.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${c.length}) and \`image_std\` (${y.length}) must match the number of channels in the image (${e.channels}).`);for(let b=0;b<h.length;b+=e.channels)for(let v=0;v<e.channels;++v)h[b+v]=(h[b+v]-c[v])/y[v];}if(n??this.do_pad){if(this.pad_size)[h,f]=this.pad_image(h,[e.height,e.width,e.channels],this.pad_size);else if(this.size_divisibility){const[c,y]=As$2([f[1],f[0]],this.size_divisibility);[h,f]=this.pad_image(h,f,{width:c,height:y});}}if(s??this.do_flip_channel_order){if(f[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let c=0;c<h.length;c+=3){const y=h[c];h[c]=h[c+2],h[c+2]=y;}}const m=new ce$2("float32",h,f).permute(2,0,1);return {original_size:[u,o],reshaped_input_size:l,pixel_values:m}}async _call(e,...r){Array.isArray(e)||(e=[e]);const n=await Promise.all(e.map(a=>this.preprocess(a)));return {pixel_values:Qn$2(n.map(a=>a.pixel_values),0),original_sizes:n.map(a=>a.original_size),reshaped_input_sizes:n.map(a=>a.reshaped_input_size)}}};class jv extends je$2{post_process_semantic_segmentation(e,r=null){const n=e.logits,i=n.dims[0];if(r!==null&&r.length!==i)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const a=[];for(let s=0;s<i;++s){const o=r!==null?r[s]:null;let u=n[s];o!==null&&(u=cm(u,o,"bilinear",false));const[l,h]=o??u.dims.slice(-2),f=new ce$2("int32",new Int32Array(l*h),[l,h]),m=u[0].data,c=f.data;for(let C=1;C<u.dims[0];++C){const x=u[C].data;for(let T=0;T<x.length;++T)x[T]>m[T]&&(m[T]=x[T],c[T]=C);}const y=new Array(u.dims[0]),b=f.data;for(let C=0;C<b.length;++C){const x=b[C];y[x]=x;}const v=y.filter(C=>C!==void 0);a.push({segmentation:f,labels:v});}return a}}class Ag extends je$2{}class Kv extends Ag{}class Yv extends je$2{}class Xv extends je$2{}class Mg extends je$2{}class Qv extends Mg{}class Jv extends je$2{}class Zv extends je$2{}class Og extends je$2{constructor(e){super(e),this.crop_pct=this.config.crop_pct??224/256;}async resize(e){const r=this.size?.shortest_edge;if(r===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(r<384){const n=Math.floor(r/this.crop_pct),[i,a]=this.get_resize_output_image_size(e,{shortest_edge:n});e=await e.resize(i,a,{resample:this.resample}),e=await e.center_crop(r,r);}else e=await e.resize(r,r,{resample:this.resample});return e}}class e$ extends Og{}class t$ extends je$2{}class r$ extends je$2{}class n$ extends je$2{constructor(e){super(e),this.include_top=this.config.include_top??true,this.include_top&&(this.image_std=this.image_std.map(r=>r*r));}}class zg extends je$2{}class a$ extends zg{}class Rg extends je$2{post_process_object_detection(...e){return Ro$2(...e)}}class i$ extends Rg{}class s$ extends je$2{}class o$ extends je$2{}class Pg extends je$2{pad_image(e,r,n,i={}){const[a,s,o]=r;let u=this.image_mean;Array.isArray(this.image_mean)||(u=new Array(o).fill(u));let l=this.image_std;Array.isArray(l)||(l=new Array(o).fill(u));const h=u.map((f,m)=>-f/l[m]);return super.pad_image(e,r,n,{center:true,constant_values:h,...i})}}class u$ extends Pg{}class l$ extends je$2{async _call(e){const r=await super._call(e),n=[r.pixel_values.dims[0],64,64],i=new ce$2("int64",new BigInt64Array(n.reduce((a,s)=>a*s)).fill(1n),n);return {...r,pixel_mask:i}}post_process_object_detection(...e){return Ro$2(...e)}remove_low_and_no_objects(e,r,n,i){let a=[],s=[],o=[];for(let u=0;u<e.dims[0];++u){let l=e[u],h=r[u],f=_r$2(l.data)[1];if(f===i)continue;let c=ta$2(l.data)[f];c>n&&(a.push(h),s.push(c),o.push(f));}return [a,s,o]}check_segment_validity(e,r,n,i=.5,a=.8){let s=[],o=0,u=0;const l=r[n].data;for(let f=0;f<e.length;++f)e[f]===n&&(s.push(f),++o),l[f]>=i&&++u;let h=o>0&&u>0;return h&&(h=o/u>a),[h,s]}compute_segments(e,r,n,i,a,s=null,o=null){let[u,l]=o??e[0].dims,h=new ce$2("int32",new Int32Array(u*l),[u,l]),f=[];if(o!==null)for(let v=0;v<e.length;++v)e[v]=cm(e[v],o,"bilinear",false);let m=new Int32Array(e[0].data.length),c=new Float32Array(e[0].data.length);for(let v=0;v<e.length;++v){let C=r[v];const x=e[v].data;for(let T=0;T<x.length;++T)x[T]*=C,x[T]>c[T]&&(m[T]=v,c[T]=x[T]);}let y=0;const b=h.data;for(let v=0;v<n.length;++v){let C=n[v],[x,T]=this.check_segment_validity(m,e,v,i,a);if(x){++y;for(let I of T)b[I]=y;f.push({id:y,label_id:C,score:r[v]});}}return [h,f]}post_process_panoptic_segmentation(e,r=.5,n=.5,i=.8,a=null,s=null){a===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),a=new Set);const o=e.logits,l=e.pred_masks.sigmoid();let[h,f,m]=o.dims;if(m-=1,s!==null&&s.length!==h)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let c=[];for(let y=0;y<h;++y){let b=s!==null?s[y]:null,v=o[y],C=l[y],[x,T,I]=this.remove_low_and_no_objects(v,C,r,m);if(I.length===0){let[z,P]=b??C.dims.slice(-2),J=new ce$2("int32",new Int32Array(z*P).fill(-1),[z,P]);c.push({segmentation:J,segments_info:[]});continue}let[A,R]=this.compute_segments(x,T,I,n,i,a,b);c.push({segmentation:A,segments_info:R});}return c}post_process_instance_segmentation(){throw Error("Not implemented yet")}}class d$ extends je$2{post_process_object_detection(...e){return Ro$2(...e)}}class c$ extends je$2{reshape_input_points(e,r,n,i=false){e=structuredClone(e);let a=cu(e);if(a.length===3)i||(a=[1,...a]),e=[e];else if(a.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let s=0;s<e.length;++s){let o=r[s],u=n[s],l=[u[0]/o[0],u[1]/o[1]];for(let h=0;h<e[s].length;++h)for(let f=0;f<e[s][h].length;++f)for(let m=0;m<e[s][h][f].length;++m)e[s][h][f][m]*=l[m%2];}return new ce$2("float32",Float32Array.from(e.flat(1/0)),a)}add_input_labels(e,r){let n=cu(e);if(n.length===2)n=[1,...n],e=[e];else if(n.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(n.some((i,a)=>i!==r.dims[a]))throw Error(`The first ${n.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new ce$2("int64",e.flat(1/0).map(BigInt),n)}async _call(e,{input_points:r=null,input_labels:n=null,input_boxes:i=null}={}){const a=await super._call(e);if(r&&(a.input_points=this.reshape_input_points(r,a.original_sizes,a.reshaped_input_sizes)),n){if(!a.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");a.input_labels=this.add_input_labels(n,a.input_points);}return i&&(a.input_boxes=this.reshape_input_points(i,a.original_sizes,a.reshaped_input_sizes,true)),a}async post_process_masks(e,r,n,{mask_threshold:i=0,binarize:a=true,pad_size:s=null}={}){const o=[];s=s??this.pad_size;const u=[s.height,s.width];for(let l=0;l<r.length;++l){const h=r[l],f=n[l];let m=await vc$2(e[l],{mode:"bilinear",size:u});if(m=m.slice(null,null,[0,f[0]],[0,f[1]]),m=await vc$2(m,{mode:"bilinear",size:h}),a){const c=m.data,y=new Uint8Array(c.length);for(let b=0;b<c.length;++b)c[b]>i&&(y[b]=1);m=new ce$2("bool",y,m.dims);}o.push(m);}return o}generate_crop_boxes(e,r,{crop_n_layers:n=0,overlap_ratio:i=512/1500,points_per_crop:a=32,crop_n_points_downscale_factor:s=1}={}){}}class p$ extends je$2{pad_image(e,r,n,i={}){const[a,s,o]=r;return super.pad_image(e,r,{width:s+(n-s%n)%n,height:a+(n-a%n)%n},{mode:"symmetric",center:false,constant_values:-1,...i})}}class h$ extends je$2{async _call(e,r){Array.isArray(e)||(e=[e]),Array.isArray(r)||(r=[r]);const n=await Promise.all(e.map(s=>this.preprocess(s))),i=await Promise.all(r.map(s=>this.preprocess(s,{do_normalize:false,do_convert_rgb:false,do_convert_grayscale:true})));return {pixel_values:Qn$2(n.map((s,o)=>Jt$2([s.pixel_values,i[o].pixel_values],0)),0),original_sizes:n.map(s=>s.original_size),reshaped_input_sizes:n.map(s=>s.reshaped_input_size)}}}class f$ extends Vr$2{constructor(e){super(e),this.config.mel_filters??=Zn$2(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney"),this.window=zi$2(this.config.n_fft,"hann");}async _extract_fbank_features(e){const r=await Oi$1(e,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:this.config.nb_max_frames}),n=r.data,i=_r$2(n)[0];for(let a=0;a<n.length;++a)n[a]=(Math.max(n[a],i-8)+4)/4;return r}async _call(e){ya$2(e,"WhisperFeatureExtractor");let r;return e.length>this.config.n_samples?(console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),r=e.slice(0,this.config.n_samples)):(r=new Float32Array(this.config.n_samples),r.set(e)),{input_features:(await this._extract_fbank_features(r)).unsqueeze_(0)}}}class m$ extends Vr$2{_zero_mean_unit_var_norm(e){const n=e.reduce((a,s)=>a+s,0)/e.length,i=e.reduce((a,s)=>a+(s-n)**2,0)/e.length;return e.map(a=>(a-n)/Math.sqrt(i+1e-7))}async _call(e){ya$2(e,"Wav2Vec2FeatureExtractor"),e instanceof Float64Array&&(e=new Float32Array(e));let r=e;this.config.do_normalize&&(r=this._zero_mean_unit_var_norm(r));const n=[1,r.length];return {input_values:new ce$2("float32",r,n),attention_mask:new ce$2("int64",new BigInt64Array(r.length).fill(1n),n)}}}class g$ extends Vr$2{constructor(e){super(e);const r=this.config.sampling_rate,n=Zn$2(256,this.config.num_mel_bins,20,Math.floor(r/2),r,null,"kaldi",true);for(let i=0;i<n.length;++i)n[i].push(0);this.mel_filters=n,this.window=zi$2(400,"povey",{periodic:false});}async _extract_fbank_features(e,r){return e=e.map(n=>n*32768),Oi$1(e,this.window,400,160,{fft_length:512,power:2,center:false,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:true,max_num_frames:r,transpose:true})}async _call(e,{padding:r=true,pad_to_multiple_of:n=2,do_normalize_per_mel_bins:i=true,return_attention_mask:a=true}={}){ya$2(e,"SeamlessM4TFeatureExtractor");let s=await this._extract_fbank_features(e,this.config.max_length);if(i){const[y,b]=s.dims,v=s.data;for(let C=0;C<b;++C){let x=0;for(let R=0;R<y;++R)x+=v[R*b+C];const T=x/y;let I=0;for(let R=0;R<y;++R)I+=(v[R*b+C]-T)**2;I/=y-1;const A=Math.sqrt(I+1e-7);for(let R=0;R<y;++R){const z=R*b+C;v[z]=(v[z]-T)/A;}}}let o;if(r){const[y,b]=s.dims,v=s.data,C=y%n;if(C>0){const x=new Float32Array(b*(y+C));x.set(v),x.fill(this.config.padding_value,v.length);const T=y+C;s=new ce$2(s.type,x,[T,b]),a&&(o=new ce$2("int64",new BigInt64Array(T),[1,T]),o.data.fill(1n,0,y));}}const[u,l]=s.dims,h=this.config.stride;if(u%h!==0)throw new Error(`The number of frames (${u}) must be a multiple of the stride (${h}).`);const m=s.view(1,Math.floor(u/h),l*h),c={input_features:m};if(a){const y=m.dims[1],b=new BigInt64Array(y);if(o){const v=o.data;for(let C=1,x=0;C<u;C+=h,++x)b[x]=v[C];}else b.fill(1n);c.attention_mask=new ce$2("int64",b,[1,y]);}return c}}class _$ extends Vr$2{constructor(e){super(e);const r=this.config.sampling_rate,n=Zn$2(256,this.config.num_mel_bins,20,Math.floor(r/2),r,null,"kaldi",true);for(let i=0;i<n.length;++i)n[i].push(0);this.mel_filters=n,this.window=zi$2(400,"hann",{periodic:false}),this.mean=this.config.mean,this.std=this.config.std;}async _extract_fbank_features(e,r){return Oi$1(e,this.window,400,160,{fft_length:512,power:2,center:false,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:true,max_num_frames:r,transpose:true})}async _call(e){ya$2(e,"ASTFeatureExtractor");const r=await this._extract_fbank_features(e,this.config.max_length);if(this.config.do_normalize){const n=this.std*2,i=r.data;for(let a=0;a<i.length;++a)i[a]=(i[a]-this.mean)/n;}return {input_values:r.unsqueeze_(0)}}}class y$ extends Vr$2{constructor(e){super(e),this.mel_filters=Zn$2(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=Zn$2(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=zi$2(this.config.fft_window_size,"hann");}async _get_input_mel(e,r,n,i){let a;const s=e.length-r;if(s>0)if(n==="rand_trunc"){const o=Math.floor(Math.random()*(s+1));e=e.subarray(o,o+r),a=await this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples);}else throw new Error(`Truncation strategy "${n}" not implemented`);else {if(s<0){let o=new Float64Array(r);if(o.set(e),i==="repeat")for(let u=e.length;u<r;u+=e.length)o.set(e.subarray(0,Math.min(e.length,r-u)),u);else if(i==="repeatpad")for(let u=e.length;u<-s;u+=e.length)o.set(e,u);e=o;}if(n==="fusion")throw new Error(`Truncation strategy "${n}" not implemented`);a=await this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples);}return a.unsqueeze_(0)}async _extract_fbank_features(e,r,n=null){return Oi$1(e,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:r,log_mel:"dB",max_num_frames:n,do_pad:false,transpose:true})}async _call(e,{max_length:r=null}={}){return ya$2(e,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(e,r??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}class w$ extends Vr$2{}let _n$2 = class _n extends or$2{constructor(e){super(),this.feature_extractor=e;}async _call(e,...r){return await this.feature_extractor(e,...r)}};class b$ extends _n$2{async _call(...e){return await this.feature_extractor(...e)}post_process_masks(...e){return this.feature_extractor.post_process_masks(...e)}reshape_input_points(...e){return this.feature_extractor.reshape_input_points(...e)}}class v$ extends _n$2{async _call(e){return await this.feature_extractor(e)}}class $$ extends _n$2{async _call(e){return await this.feature_extractor(e)}}class x$ extends _n$2{async _call(e){return await this.feature_extractor(e)}}class S$ extends _n$2{}class C${static FEATURE_EXTRACTOR_CLASS_MAPPING={ImageFeatureExtractor:je$2,WhisperFeatureExtractor:f$,ViTFeatureExtractor:t$,MobileViTFeatureExtractor:zg,MobileViTImageProcessor:a$,OwlViTFeatureExtractor:Rg,Owlv2ImageProcessor:i$,CLIPFeatureExtractor:Mg,CLIPImageProcessor:Qv,ChineseCLIPFeatureExtractor:Jv,SiglipImageProcessor:Zv,ConvNextFeatureExtractor:Og,ConvNextImageProcessor:e$,SegformerFeatureExtractor:jv,BitImageProcessor:Yv,DPTImageProcessor:Kv,DPTFeatureExtractor:Ag,GLPNFeatureExtractor:Xv,BeitFeatureExtractor:o$,DeiTFeatureExtractor:s$,DetrFeatureExtractor:l$,YolosFeatureExtractor:d$,DonutFeatureExtractor:Pg,NougatImageProcessor:u$,EfficientNetImageProcessor:n$,ViTImageProcessor:r$,VitMatteImageProcessor:h$,SamImageProcessor:c$,Swin2SRImageProcessor:p$,Wav2Vec2FeatureExtractor:m$,SeamlessM4TFeatureExtractor:g$,SpeechT5FeatureExtractor:w$,ASTFeatureExtractor:_$,ClapFeatureExtractor:y$};static PROCESSOR_CLASS_MAPPING={WhisperProcessor:v$,Wav2Vec2ProcessorWithLM:$$,SamProcessor:b$,SpeechT5Processor:x$,OwlViTProcessor:S$};static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main"}={}){let o=n??await on$2(e,"preprocessor_config.json",true,{progress_callback:r,cache_dir:i,local_files_only:a,revision:s}),u=o.feature_extractor_type??o.image_processor_type,l=this.FEATURE_EXTRACTOR_CLASS_MAPPING[u];if(!l)if(o.size!==void 0)console.warn(`Feature extractor type "${u}" not found, assuming ImageFeatureExtractor due to size parameter in config.`),l=je$2;else throw new Error(`Unknown Feature Extractor type: ${u}`);let h=this.PROCESSOR_CLASS_MAPPING[o.processor_class]??_n$2,f=new l(o);return new h(f)}}Pr$2.IS_PROCESS_AVAILABLE;async function E$(){try{return (await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch{return  false}}const Ri$1=document.getElementById("status"),bi$1=document.createElement("canvas"),ea$2=document.getElementById("output-canvas"),Fr$2=document.getElementById("video"),Xs$2=document.getElementById("size"),T$=document.getElementById("size-value"),Qs$2=document.getElementById("scale"),k$=document.getElementById("scale-value");function Bg(t,e){Fr$2.width=ea$2.width=bi$1.width=Math.round(t),Fr$2.height=ea$2.height=bi$1.height=Math.round(e);}Ri$1.textContent="Loading model...";const Dg="onnx-community/depth-anything-v2-small";let Ng;try{Ng=await Ov.from_pretrained(Dg,{device:"webgpu",dtype:await E$()?"fp16":"fp32"});}catch(t){throw Ri$1.textContent=t.message,alert(t.message),t}const Po$2=await C$.from_pretrained(Dg);let dn$2=504;Po$2.feature_extractor.size={width:dn$2,height:dn$2};Xs$2.addEventListener("input",()=>{dn$2=Number(Xs$2.value),Po$2.feature_extractor.size={width:dn$2,height:dn$2},T$.textContent=dn$2;});Xs$2.disabled=false;let cn$2=.4;Qs$2.addEventListener("input",()=>{cn$2=Number(Qs$2.value),Bg(Fr$2.videoWidth*cn$2,Fr$2.videoHeight*cn$2),k$.textContent=cn$2;});Qs$2.disabled=false;Ri$1.textContent="Ready";let Ms$2=false,Os$2;const Ac$1=bi$1.getContext("2d",{willReadFrequently:true}),I$=ea$2.getContext("2d",{willReadFrequently:true});function Fg(){const{width:t,height:e}=bi$1;Ms$2||(Ms$2=true,async function(){Ac$1.drawImage(Fr$2,0,0,t,e);const r=Ac$1.getImageData(0,0,t,e),n=new Vt$2(r.data,t,e,4),i=await Po$2(n),{predicted_depth:a}=await Ng(i),s=a.data,[o,u,l]=a.dims;let h=1/0,f=-1/0;ea$2.width=l,ea$2.height=u;for(let b=0;b<s.length;++b){const v=s[b];v<h&&(h=v),v>f&&(f=v);}const m=f-h,c=new Uint8ClampedArray(4*s.length);for(let b=0;b<s.length;++b){const v=4*b;c[v]=255,c[v+3]=255*(1-(s[b]-h)/m);}const y=new ImageData(c,l,u);if(I$.putImageData(y,0,0),Os$2!==void 0){const b=1e3/(performance.now()-Os$2);Ri$1.textContent=`FPS: ${b.toFixed(2)}`;}Os$2=performance.now(),Ms$2=false;}()),window.requestAnimationFrame(Fg);}navigator.mediaDevices.getUserMedia({video:{width:720,height:720}}).then(t=>{Fr$2.srcObject=t,Fr$2.play();const e=t.getVideoTracks()[0],{width:r,height:n}=e.getSettings();Bg(r*cn$2,n*cn$2),setTimeout(Fg,50);}).catch(t=>{alert(t);});
   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ^
2392|  
2393|  const scriptRel = 'modulepreload';const assetsURL = function(dep) { return "/chess/"+dep };const seen = {};const __vitePreload = function preload(baseModule, deps, importerUrl) {

Top-level await is not available in the configured target environment ("chrome87", "edge88", "es2020", "firefox78", "safari14" + 2 overrides)
2389|   * limitations under the License.
2390|   * =============================================================================
2391|   */const z_=Object.freeze(Object.defineProperty({__proto__:null,get InferenceSession(){return ao$2},get TRACE(){return jn$2},get TRACE_FUNC_BEGIN(){return Ht$2},get TRACE_FUNC_END(){return Mt$2},get Tensor(){return ft$2},get TrainingSession(){return io$2},default:O_,get env(){return Fe$2},get registerBackend(){return Or$2}},Symbol.toStringTag,{value:"Module"})),R_=(t,e)=>{const r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=t.dims[3],r.height=t.dims[2];const n=r.getContext("2d");if(n!=null){let i,a;e?.tensorLayout!==void 0&&e.tensorLayout==="NHWC"?(i=t.dims[2],a=t.dims[3]):(i=t.dims[3],a=t.dims[2]);const s=e?.format!==void 0?e.format:"RGB",o=e?.norm;let u,l;o===void 0||o.mean===void 0?u=[255,255,255,255]:typeof o.mean=="number"?u=[o.mean,o.mean,o.mean,o.mean]:(u=[o.mean[0],o.mean[1],o.mean[2],0],o.mean[3]!==void 0&&(u[3]=o.mean[3])),o===void 0||o.bias===void 0?l=[0,0,0,0]:typeof o.bias=="number"?l=[o.bias,o.bias,o.bias,o.bias]:(l=[o.bias[0],o.bias[1],o.bias[2],0],o.bias[3]!==void 0&&(l[3]=o.bias[3]));const h=a*i;let f=0,m=h,c=h*2,y=-1;s==="RGBA"?(f=0,m=h,c=h*2,y=h*3):s==="RGB"?(f=0,m=h,c=h*2):s==="RBG"&&(f=0,c=h,m=h*2);for(let b=0;b<a;b++)for(let v=0;v<i;v++){const C=(t.data[f++]-l[0])*u[0],x=(t.data[m++]-l[1])*u[1],T=(t.data[c++]-l[2])*u[2],I=y===-1?255:(t.data[y++]-l[3])*u[3];n.fillStyle="rgba("+C+","+x+","+T+","+I+")",n.fillRect(v,b,1,1);}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},P_=(t,e)=>{const r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");let n;if(r!=null){let i,a,s;e?.tensorLayout!==void 0&&e.tensorLayout==="NHWC"?(i=t.dims[2],a=t.dims[1],s=t.dims[3]):(i=t.dims[3],a=t.dims[2],s=t.dims[1]);const o=e!==void 0&&e.format!==void 0?e.format:"RGB",u=e?.norm;let l,h;u===void 0||u.mean===void 0?l=[255,255,255,255]:typeof u.mean=="number"?l=[u.mean,u.mean,u.mean,u.mean]:(l=[u.mean[0],u.mean[1],u.mean[2],255],u.mean[3]!==void 0&&(l[3]=u.mean[3])),u===void 0||u.bias===void 0?h=[0,0,0,0]:typeof u.bias=="number"?h=[u.bias,u.bias,u.bias,u.bias]:(h=[u.bias[0],u.bias[1],u.bias[2],0],u.bias[3]!==void 0&&(h[3]=u.bias[3]));const f=a*i;if(e!==void 0&&(e.format!==void 0&&s===4&&e.format!=="RGBA"||s===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");const m=4;let c=0,y=1,b=2,v=3,C=0,x=f,T=f*2,I=-1;o==="RGBA"?(C=0,x=f,T=f*2,I=f*3):o==="RGB"?(C=0,x=f,T=f*2):o==="RBG"&&(C=0,T=f,x=f*2),n=r.createImageData(i,a);for(let A=0;A<a*i;c+=m,y+=m,b+=m,v+=m,A++)n.data[c]=(t.data[C++]-h[0])*l[0],n.data[y]=(t.data[x++]-h[1])*l[1],n.data[b]=(t.data[T++]-h[2])*l[2],n.data[v]=I===-1?255:(t.data[I++]-h[3])*l[3];}else throw new Error("Can not access image data");return n},Ts$2=(t,e)=>{if(t===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");const{height:r,width:n}=e,i=e.norm??{mean:255,bias:0};let a,s;typeof i.mean=="number"?a=[i.mean,i.mean,i.mean,i.mean]:a=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?s=[i.bias,i.bias,i.bias,i.bias]:s=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];const o=e.format!==void 0?e.format:"RGBA",u=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",l=r*n,h=u==="RGBA"?new Float32Array(l*4):new Float32Array(l*3);let f=4,m=0,c=1,y=2,b=3,v=0,C=l,x=l*2,T=-1;o==="RGB"&&(f=3,m=0,c=1,y=2,b=-1),u==="RGBA"?T=l*3:u==="RBG"?(v=0,x=l,C=l*2):u==="BGR"&&(x=0,C=l,v=l*2);for(let A=0;A<l;A++,m+=f,y+=f,c+=f,b+=f)h[v++]=(t[m]+s[0])/a[0],h[C++]=(t[c]+s[1])/a[1],h[x++]=(t[y]+s[2])/a[2],T!==-1&&b!==-1&&(h[T++]=(t[b]+s[3])/a[3]);return u==="RGBA"?new Qt$2("float32",h,[1,4,r,n]):new Qt$2("float32",h,[1,3,r,n])},B_=async(t,e)=>{const r=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,n=typeof ImageData<"u"&&t instanceof ImageData,i=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,a=typeof t=="string";let s,o=e??{};const u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},l=h=>h instanceof HTMLCanvasElement||h instanceof OffscreenCanvas?h.getContext("2d"):null;if(r){const h=u();h.width=t.width,h.height=t.height;const f=l(h);if(f!=null){let m=t.height,c=t.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(m=e.resizedHeight,c=e.resizedWidth),e!==void 0){if(o=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");o.tensorFormat="RGBA",o.height=m,o.width=c;}else o.tensorFormat="RGBA",o.height=m,o.width=c;f.drawImage(t,0,0),s=f.getImageData(0,0,c,m).data;}else throw new Error("Can not access image data")}else if(n){let h,f;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(h=e.resizedHeight,f=e.resizedWidth):(h=t.height,f=t.width),e!==void 0&&(o=e),o.format="RGBA",o.height=h,o.width=f,e!==void 0){const m=u();m.width=f,m.height=h;const c=l(m);if(c!=null)c.putImageData(t,0,0),s=c.getImageData(0,0,f,h).data;else throw new Error("Can not access image data")}else s=t.data;}else if(i){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");const h=u();h.width=t.width,h.height=t.height;const f=l(h);if(f!=null){const m=t.height,c=t.width;return f.drawImage(t,0,0,c,m),s=f.getImageData(0,0,c,m).data,o.height=m,o.width=c,Ts$2(s,o)}else throw new Error("Can not access image data")}else {if(a)return new Promise((h,f)=>{const m=u(),c=l(m);if(!t||!c)return f();const y=new Image;y.crossOrigin="Anonymous",y.src=t,y.onload=()=>{m.width=y.width,m.height=y.height,c.drawImage(y,0,0,m.width,m.height);const b=c.getImageData(0,0,m.width,m.height);o.height=m.height,o.width=m.width,h(Ts$2(b.data,o));};});throw new Error("Input data provided is not supported - aborted tensor creation")}if(s!==void 0)return Ts$2(s,o);throw new Error("Input data provided is not supported - aborted tensor creation")},D_=(t,e)=>{const{width:r,height:n,download:i,dispose:a}=e,s=[1,n,r,4];return new Qt$2({location:"texture",type:"float32",texture:t,dims:s,download:i,dispose:a})},N_=(t,e)=>{const{dataType:r,dims:n,download:i,dispose:a}=e;return new Qt$2({location:"gpu-buffer",type:r??"float32",gpuBuffer:t,dims:n,download:i,dispose:a})},F_=(t,e,r)=>new Qt$2({location:"cpu-pinned",type:t,data:e,dims:r??[e.length]}),ln$1=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),ii$2=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);let wc$2=false;const L_=()=>{if(!wc$2){wc$2=true;const t=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,r=typeof Float16Array<"u"&&Float16Array.from;t&&(ln$1.set("int64",BigInt64Array),ii$2.set(BigInt64Array,"int64")),e&&(ln$1.set("uint64",BigUint64Array),ii$2.set(BigUint64Array,"uint64")),r?(ln$1.set("float16",Float16Array),ii$2.set(Float16Array,"float16")):ln$1.set("float16",Uint16Array);}},W_=t=>{let e=1;for(let r=0;r<t.length;r++){const n=t[r];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);e*=n;}return e},U_=(t,e)=>{switch(t.location){case "cpu":return new Qt$2(t.type,t.data,e);case "cpu-pinned":return new Qt$2({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case "texture":return new Qt$2({location:"texture",texture:t.texture,type:t.type,dims:e});case "gpu-buffer":return new Qt$2({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}};let Qt$2=class Qt{constructor(e,r,n){L_();let i,a;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,i=e.type,a=e.dims,e.location){case "cpu-pinned":{const o=ln$1.get(i);if(!o)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(e.data instanceof o))throw new TypeError(`buffer should be of type ${o.name}`);this.cpuData=e.data;break}case "texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case "gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else {let o,u;if(typeof e=="string")if(i=e,u=n,e==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor's data must be a string array.");o=r;}else {const l=ln$1.get(e);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(r)){if(e==="float16"&&l===Uint16Array)throw new TypeError("Creating a float16 tensor from number array is not supported. Please use Uint16Array as data.");e==="uint64"||e==="int64"?o=l.from(r,BigInt):o=l.from(r);}else if(r instanceof l)o=r;else throw new TypeError(`A ${i} tensor's data must be type of ${l}`)}else if(u=r,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const l=typeof e[0];if(l==="string")i="string",o=e;else if(l==="boolean")i="bool",o=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else {const l=ii$2.get(e.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);i=l,o=e;}if(u===void 0)u=[o.length];else if(!Array.isArray(u))throw new TypeError("A tensor's dims must be a number array");a=u,this.cpuData=o,this.dataLocation="cpu";}const s=W_(a);if(this.cpuData&&s!==this.cpuData.length)throw new Error(`Tensor's size(${s}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=a,this.size=s;}static async fromImage(e,r){return B_(e,r)}static fromTexture(e,r){return D_(e,r)}static fromGpuBuffer(e,r){return N_(e,r)}static fromPinnedBuffer(e,r,n){return F_(e,r,n)}toDataURL(e){return R_(this,e)}toImageData(e){return P_(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}async getData(e){switch(this.ensureValid(),this.dataLocation){case "cpu":case "cpu-pinned":return this.data;case "texture":case "gpu-buffer":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;const r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,e&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=false;}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none";}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return U_(this,e)}};const V_=Qt$2,Hn$2=[];let Ks$2,Xn$2;Pr$2.IS_NODE_ENV?(Xn$2=Ye$2??qg,Hn$2.push("cpu"),Ks$2=["cpu"]):(Xn$2=z_,Pr$2.IS_WEBGPU_AVAILABLE&&Hn$2.push("webgpu"),Hn$2.push("wasm"),Ks$2=["wasm"]);const G_=Xn$2.InferenceSession;function H_(t){let e=Ks$2;if(t){if(!Hn$2.includes(t))throw new Error(`Unsupported device: "${t}". Should be one of: ${Hn$2.join(", ")}.`);e=[t];}return e}async function lm(t,e){return await G_.create(t,e)}function dm(t){return t instanceof Xn$2.Tensor}const Mr$2=Xn$2?.env;Mr$2?.wasm&&(Mr$2.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.18.0/dist/",Mr$2.wasm.proxy=!Pr$2.IS_WEBWORKER_ENV,(typeof crossOriginIsolated>"u"||!crossOriginIsolated)&&(Mr$2.wasm.numThreads=1),typeof navigator<"u"&&/iP(hone|od|ad).+16_4.+AppleWebKit/.test(navigator.userAgent)&&(Mr$2.wasm.simd=false));function q_(){return Mr$2?.wasm?.proxy}bt$2.backends.onnx=Mr$2;const an$2=async(t,e,r)=>{const n=await lm(new Uint8Array(t),e);return async i=>{const a=Object.fromEntries(Object.entries(i).map(([o,u])=>[o,u.ort_tensor])),s=await n.run(a);return Array.isArray(r)?r.map(o=>new ce$2(s[o])):new ce$2(s[r])}};let _i$1 = class _i{static session_options={};static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=an$2([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=an$2([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=an$2([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=an$2([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=an$2([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=an$2([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}};const bc$2=Object.freeze({float32:Float32Array,float16:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array});let ce$2 = class ce{get dims(){return this.ort_tensor.dims}set dims(e){this.ort_tensor.dims=e;}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}ort_tensor;constructor(...e){return dm(e[0])?this.ort_tensor=e[0]:this.ort_tensor=new V_(e[0],e[1],e[2]),new Proxy(this,{get:(r,n)=>{if(typeof n=="string"){let i=Number(n);if(Number.isInteger(i))return r._getitem(i)}return r[n]},set:(r,n,i)=>r[n]=i})}dispose(){this.ort_tensor.dispose();}*[Symbol.iterator](){const[e,...r]=this.dims;if(r.length>0){const n=r.reduce((i,a)=>i*a);for(let i=0;i<e;++i)yield this._subarray(i,n,r);}else yield*this.data;}_getitem(e){const[r,...n]=this.dims;if(e=Xt$2(e,r),n.length>0){const i=n.reduce((a,s)=>a*s);return this._subarray(e,i,n)}else return new ce(this.type,[this.data[e]],n)}indexOf(e){const r=this.data;for(let n=0;n<r.length;++n)if(r[n]==e)return n;return  -1}_subarray(e,r,n){const i=e*r,a=(e+1)*r,s="subarray"in this.data?this.data.subarray(i,a):this.data.slice(i,a);return new ce(this.type,s,n)}item(){const e=this.data;if(e.length!==1)throw new Error(`a Tensor with ${e.length} elements cannot be converted to Scalar`);return e[0]}tolist(){return j_(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){const e=this.data;for(let r=0;r<e.length;++r)e[r]=1/(1+Math.exp(-e[r]));return this}mul(e){return this.clone().mul_(e)}mul_(e){const r=this.data;for(let n=0;n<r.length;++n)r[n]*=e;return this}div(e){return this.clone().div_(e)}div_(e){const r=this.data;for(let n=0;n<r.length;++n)r[n]/=e;return this}add(e){return this.clone().add_(e)}add_(e){const r=this.data;for(let n=0;n<r.length;++n)r[n]+=e;return this}clone(){return new ce(this.type,this.data.slice(),this.dims.slice())}slice(...e){let r=[],n=[];for(let l=0;l<this.dims.length;++l){let h=e[l];if(h==null)n.push([0,this.dims[l]]),r.push(this.dims[l]);else if(typeof h=="number")h=Xt$2(h,this.dims[l],l),n.push([h,h+1]);else if(Array.isArray(h)&&h.length===2){let[f,m]=h;if(f=f===null?0:Xt$2(f,this.dims[l],l,false),m=m===null?this.dims[l]:Xt$2(m,this.dims[l],l,false),f>m)throw new Error(`Invalid slice: ${h}`);let c=[Math.max(f,0),Math.min(m,this.dims[l])];n.push(c),r.push(c[1]-c[0]);}else throw new Error(`Invalid slice: ${h}`)}let i=n.map(([l,h])=>h-l),a=i.reduce((l,h)=>l*h);const s=this.data;let o=new s.constructor(a);const u=this.stride();for(let l=0;l<a;++l){let h=0;for(let f=i.length-1,m=l;f>=0;--f){const c=i[f];h+=(m%c+n[f][0])*u[f],m=Math.floor(m/c);}o[l]=s[h];}return new ce(this.type,o,r)}permute(...e){return K_(this,e)}transpose(...e){return this.permute(...e)}sum(e=null,r=false){return this.norm(1,e,r)}norm(e="fro",r=null,n=false){if(e==="fro")e=2;else if(typeof e=="string")throw Error(`Unsupported norm: ${e}`);const i=this.data;if(r===null){let o=i.reduce((u,l)=>u+l**e,0)**(1/e);return new ce(this.type,[o],[])}r=Xt$2(r,this.dims.length);const a=this.dims.slice();a[r]=1;const s=new i.constructor(i.length/this.dims[r]);for(let o=0;o<i.length;++o){let u=0;for(let l=this.dims.length-1,h=o,f=1;l>=0;--l){const m=this.dims[l];if(l!==r){const c=h%m;u+=c*f,f*=a[l];}h=Math.floor(h/m);}s[u]+=i[o]**e;}if(e!==1)for(let o=0;o<s.length;++o)s[o]=s[o]**(1/e);return n||a.splice(r,1),new ce(this.type,s,a)}normalize_(e=2,r=1){r=Xt$2(r,this.dims.length);const n=this.norm(e,r,true),i=this.data;for(let a=0;a<i.length;++a){let s=0;for(let o=this.dims.length-1,u=a,l=1;o>=0;--o){const h=this.dims[o];if(o!==r){const f=u%h;s+=f*l,l*=this.dims[o];}u=Math.floor(u/h);}i[a]/=n.data[s];}return this}normalize(e=2,r=1){return this.clone().normalize_(e,r)}stride(){return J_(this.dims)}squeeze(e=null){return new ce(this.type,this.data,$c$1(this.dims,e))}squeeze_(e=null){return this.dims=$c$1(this.dims,e),this}unsqueeze(e=null){return new ce(this.type,this.data,xc$1(this.dims,e))}unsqueeze_(e=null){return this.dims=xc$1(this.dims,e),this}flatten_(e=0,r=-1){r=(r+this.dims.length)%this.dims.length;let n=this.dims.slice(0,e),i=this.dims.slice(e,r+1),a=this.dims.slice(r+1);return this.dims=[...n,i.reduce((s,o)=>s*o,1),...a],this}flatten(e=0,r=-1){return this.clone().flatten_(e,r)}view(...e){let r=-1;for(let n=0;n<e.length;++n)if(e[n]===-1){if(r!==-1)throw new Error("Only one dimension can be inferred");r=n;}if(r!==-1){const n=e.reduce((i,a,s)=>s!==r?i*a:i,1);e[r]=this.data.length/n;}return new ce(this.type,this.data,e)}neg_(){const e=this.data;for(let r=0;r<e.length;++r)e[r]=-e[r];return this}neg(){return this.clone().neg_()}clamp_(e,r){const n=this.data;for(let i=0;i<n.length;++i)n[i]=Math.min(Math.max(n[i],e),r);return this}clamp(e,r){return this.clone().clamp_(e,r)}round_(){const e=this.data;for(let r=0;r<e.length;++r)e[r]=Math.round(e[r]);return this}round(){return this.clone().round_()}mean(e=null,r=false){return xo$2(this,e,r)}to(e){if(this.type===e)return this;if(!bc$2.hasOwnProperty(e))throw new Error(`Unsupported type: ${e}`);return new ce(e,bc$2[e].from(this.data),this.dims)}};function j_(t,e){const r=t.length,n=e.reduce((a,s)=>a*s);if(r!==n)throw Error(`cannot reshape array of size ${r} into shape (${e})`);let i=t;for(let a=e.length-1;a>=0;a--)i=i.reduce((s,o)=>{let u=s[s.length-1];return u.length<e[a]?u.push(o):s.push([o]),s},[[]]);return i[0]}function K_(t,e){const[r,n]=s0(t.data,t.dims,e);return new ce$2(t.type,r,n)}function cm(t,[e,r],n="bilinear",i=false){const a=t.dims.at(-3)??1,s=t.dims.at(-2),o=t.dims.at(-1);let u=i0(t.data,[a,s,o],[e,r],n,i);return new ce$2(t.type,u,[a,e,r])}async function vc$2(t,{size:e=null,mode:r="bilinear"}={}){if(t.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!e)throw new Error("`interpolate_4d` requires a `size` argument.");let n;if(e.length===2)n=[...t.dims.slice(0,2),...e];else if(e.length===3)n=[t.dims[0],...e];else if(e.length===4)n=e;else throw new Error("`size` must be of length 2, 3, or 4.");let i;if(r==="bilinear")i=await _i$1.bilinear_interpolate_4d;else if(r==="bicubic")i=await _i$1.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${r}`);const a=new ce$2("int64",new BigInt64Array(n.map(BigInt)),[n.length]);return await i({x:t,s:a})}async function Y_(t,e){return await(await _i$1.matmul)({a:t,b:e})}async function pm(t,e){const r=await _i$1.top_k;return e===null?e=t.dims.at(-1):e=Math.min(e,t.dims.at(-1)),await r({x:t,k:new ce$2("int64",[BigInt(e)],[1])})}function $c$1(t,e){return t=t.slice(),e===null?t=t.filter(r=>r!==1):typeof e=="number"?t[e]===1&&t.splice(e,1):Array.isArray(e)&&(t=t.filter((r,n)=>r!==1||!e.includes(n))),t}function xc$1(t,e){return e=Xt$2(e,t.length+1),t=t.slice(),t.splice(e,0,1),t}function Xt$2(t,e,r=null,n=true){if(n&&(t<-e||t>=e))throw new Error(`IndexError: index ${t} is out of bounds for dimension${r===null?"":" "+r} with size ${e}`);return t<0&&(t=(t%e+e)%e),t}function Jt$2(t,e=0){e=Xt$2(e,t[0].dims.length);const r=t[0].dims.slice();r[e]=t.reduce((s,o)=>s+o.dims[e],0);const n=r.reduce((s,o)=>s*o,1),i=new t[0].data.constructor(n),a=t[0].type;if(e===0){let s=0;for(let o of t)i.set(o.data,s),s+=o.data.length;}else {let s=0;for(let o=0;o<t.length;++o){let u=t[o];for(let l=0;l<u.data.length;++l){let h=0;for(let f=u.dims.length-1,m=l,c=1;f>=0;--f){const y=u.dims[f];let b=m%y;f===e&&(b+=s),h+=b*c,c*=r[f],m=Math.floor(m/y);}i[h]=u.data[l];}s+=u.dims[e];}}return new ce$2(a,i,r)}function Qn$2(t,e=0){return Jt$2(t.map(r=>r.unsqueeze(e)),e)}function X_(t,e=null,r=1,n=false){if(e===null){const l=t.data.reduce((c,y)=>c+y,0)/t.data.length,h=Math.sqrt(t.data.reduce((c,y)=>c+(y-l)**2,0)/(t.data.length-r)),f=new ce$2(t.type,[l],[]);return [new ce$2(t.type,[h],[]),f]}e=Xt$2(e,t.dims.length);const i=xo$2(t,e,n),a=t.dims.slice();a[e]=1;const s=new t.data.constructor(t.data.length/t.dims[e]);for(let u=0;u<t.data.length;++u){let l=0;for(let h=t.dims.length-1,f=u,m=1;h>=0;--h){const c=t.dims[h];if(h!==e){const y=f%c;l+=y*m,m*=a[h];}f=Math.floor(f/c);}s[l]+=(t.data[u]-i.data[l])**2;}for(let u=0;u<s.length;++u)s[u]=Math.sqrt(s[u]/(t.dims[e]-r));return n||a.splice(e,1),[new ce$2(t.type,s,a),i]}function xo$2(t,e=null,r=false){if(e===null){let a=t.data.reduce((s,o)=>s+o,0);return new ce$2(t.type,[a/t.data.length],[])}e=Xt$2(e,t.dims.length);const n=t.dims.slice();n[e]=1;const i=new t.data.constructor(t.data.length/t.dims[e]);for(let a=0;a<t.data.length;++a){let s=0;for(let o=t.dims.length-1,u=a,l=1;o>=0;--o){const h=t.dims[o];if(o!==e){const f=u%h;s+=f*l,l*=n[o];}u=Math.floor(u/h);}i[s]+=t.data[a];}if(t.dims[e]!==1)for(let a=0;a<i.length;++a)i[a]=i[a]/t.dims[e];return r||n.splice(e,1),new ce$2(t.type,i,n)}function Q_(t){const[e,r]=t.dims,n=[e+1,r+1],i=new ce$2("float32",new Float32Array(n[0]*n[1]).fill(1/0),n),a=new ce$2("float32",new Float32Array(n[0]*n[1]).fill(-1),n);i[0].data[0]=0;for(let h=1;h<r+1;++h)for(let f=1;f<e+1;++f){const m=i[f-1][h-1].item(),c=i[f-1][h].item(),y=i[f][h-1].item();let b,v;m<c&&m<y?(b=m,v=0):c<m&&c<y?(b=c,v=1):(b=y,v=2),i[f].data[h]=t[f-1][h-1].item()+b,a[f].data[h]=v;}let s=e,o=r;a.data.fill(2,0,n[1]);for(let h=0;h<n[0];++h)a[h].data[0]=1;let u=[],l=[];for(;s>0||o>0;)switch(u.push(s-1),l.push(o-1),a[s][o].item()){case 0:--s,--o;break;case 1:--s;break;case 2:--o;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${s}, ${o}]. Please file a bug report.`)}return u.reverse(),l.reverse(),[u,l]}function J_(t){const e=new Array(t.length);for(let r=t.length-1,n=1;r>=0;--r)e[r]=n,n*=t[r];return e}function So$2(t,e,r,n){const i=t.reduce((a,s)=>a*s,1);return new ce$2(r,new n(i).fill(e),t)}function Z_(t,e){let r,n;return r="float32",n=Float32Array,So$2(t,e,r,n)}function ey(t,e){return Z_(t.dims,e)}function aa$2(t){return So$2(t,1n,"int64",BigInt64Array)}function ty(t){return aa$2(t.dims)}function ry(t){return So$2(t,0n,"int64",BigInt64Array)}function ny(t){return ry(t.dims)}var Ce$2=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator"});Object.freeze({set:Ce$2.Set,for:Ce$2.For,in:Ce$2.In,is:Ce$2.Is,if:Ce$2.If,else:Ce$2.Else,endif:Ce$2.EndIf,elif:Ce$2.ElseIf,endfor:Ce$2.EndFor,and:Ce$2.And,or:Ce$2.Or,not:Ce$2.Not,"not in":Ce$2.NotIn,true:Ce$2.BooleanLiteral,false:Ce$2.BooleanLiteral});Ce$2.OpenStatement,Ce$2.CloseStatement,Ce$2.OpenExpression,Ce$2.CloseExpression,Ce$2.OpenParen,Ce$2.CloseParen,Ce$2.OpenCurlyBracket,Ce$2.CloseCurlyBracket,Ce$2.OpenSquareBracket,Ce$2.CloseSquareBracket,Ce$2.Comma,Ce$2.Dot,Ce$2.Colon,Ce$2.Pipe,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.AdditiveBinaryOperator,Ce$2.AdditiveBinaryOperator,Ce$2.MultiplicativeBinaryOperator,Ce$2.MultiplicativeBinaryOperator,Ce$2.MultiplicativeBinaryOperator,Ce$2.Equals;const hm=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],ks$2=new Map(hm),ay=new Map([...hm.map(([t,e])=>[e,t]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function iy(t){t=t.toLowerCase();let e=ay.get(t);if(e===void 0)if(ks$2.has(t))e=t;else {const n=t.length===2?ks$2.keys():ks$2.values();throw new Error(`Language "${t}" is not supported. Must be one of: ${JSON.stringify(n)}`)}return e}const sy=(()=>{const t=[...Array.from({length:94},(i,a)=>a+33),...Array.from({length:12},(i,a)=>a+161),...Array.from({length:82},(i,a)=>a+174)],e=t.slice();let r=0;for(let i=0;i<256;++i)t.includes(i)||(t.push(i),e.push(256+r),r+=1);const n=e.map(i=>String.fromCharCode(i));return Object.fromEntries(t.map((i,a)=>[i,n[a]]))})();Zg(sy);async function oy(t,e){return await on$2(t,"config.json",true,e)}function sn$2(t){const e={};let r={};switch(t.model_type){case "llava":case "paligemma":r=sn$2(t.text_config);break;case "moondream1":r=sn$2(t.phi_config);break;case "musicgen":r=sn$2(t.decoder);break;case "gpt2":case "gptj":case "codegen":case "gpt_bigcode":e.num_heads="n_head",e.num_layers="n_layer",e.hidden_size="n_embd";break;case "gpt_neox":case "stablelm":case "opt":case "phi":case "phi3":case "falcon":e.num_heads="num_attention_heads",e.num_layers="num_hidden_layers",e.hidden_size="hidden_size";break;case "llama":case "cohere":case "mistral":case "starcoder2":case "qwen2":e.num_heads="num_key_value_heads",e.num_layers="num_hidden_layers",e.hidden_size="hidden_size",e.num_attention_heads="num_attention_heads";break;case "gemma":e.num_heads="num_key_value_heads",e.num_layers="num_hidden_layers",e.dim_kv="head_dim";break;case "openelm":e.num_heads="num_kv_heads",e.num_layers="num_transformer_layers",e.dim_kv="head_dim";break;case "gpt_neo":e.num_heads="num_heads",e.num_layers="num_layers",e.hidden_size="hidden_size";break;case "bloom":e.num_heads="n_head",e.num_layers="n_layer",e.hidden_size="hidden_size";break;case "mpt":e.num_heads="n_heads",e.num_layers="n_layers",e.hidden_size="d_model";break;case "t5":case "mt5":case "longt5":e.num_decoder_layers="num_decoder_layers",e.num_decoder_heads="num_heads",e.decoder_dim_kv="d_kv",e.num_encoder_layers="num_layers",e.num_encoder_heads="num_heads",e.encoder_dim_kv="d_kv";break;case "bart":case "mbart":case "marian":case "whisper":case "m2m_100":case "blenderbot":case "blenderbot-small":e.num_decoder_layers="decoder_layers",e.num_decoder_heads="decoder_attention_heads",e.decoder_hidden_size="d_model",e.num_encoder_layers="encoder_layers",e.num_encoder_heads="encoder_attention_heads",e.encoder_hidden_size="d_model";break;case "speecht5":e.num_decoder_layers="decoder_layers",e.num_decoder_heads="decoder_attention_heads",e.decoder_hidden_size="hidden_size",e.num_encoder_layers="encoder_layers",e.num_encoder_heads="encoder_attention_heads",e.encoder_hidden_size="hidden_size";break;case "trocr":e.num_encoder_layers=e.num_decoder_layers="decoder_layers",e.num_encoder_heads=e.num_decoder_heads="decoder_attention_heads",e.encoder_hidden_size=e.decoder_hidden_size="d_model";break;case "musicgen_decoder":e.num_encoder_layers=e.num_decoder_layers="num_hidden_layers",e.num_encoder_heads=e.num_decoder_heads="num_attention_heads",e.encoder_hidden_size=e.decoder_hidden_size="hidden_size";break;case "vision-encoder-decoder":const i=sn$2(t.encoder),a=sn$2(t.decoder),s="num_decoder_layers"in a,o={};return s?(o.num_decoder_layers=a.num_layers,o.num_decoder_heads=a.num_heads,o.decoder_hidden_size=a.hidden_size,o.num_encoder_layers=i.num_layers,o.num_encoder_heads=i.num_heads,o.encoder_hidden_size=i.hidden_size):(o.num_layers=a.num_layers,o.num_heads=a.num_heads,o.hidden_size=a.hidden_size),o}const n={...r,...zr$2(t,["model_type","multi_query","is_encoder_decoder"])};for(const i in e)n[i]=t[e[i]];return n}function fm(t,{prefix:e="past_key_values",encoder_add_pkv:r=true}={}){const n={},i=t.normalized_config,a=1;if(i.is_encoder_decoder&&r){const s=i.encoder_dim_kv??i.encoder_hidden_size/i.num_encoder_heads,o=i.decoder_dim_kv??i.decoder_hidden_size/i.num_decoder_heads,u=[a,i.num_encoder_heads,0,s],l=[a,i.num_decoder_heads,0,o];for(let h=0;h<i.num_decoder_layers;++h)n[`${e}.${h}.encoder.key`]=u,n[`${e}.${h}.encoder.value`]=u,n[`${e}.${h}.decoder.key`]=l,n[`${e}.${h}.decoder.value`]=l;}else {const s=i.num_heads,o=i.num_layers,u=i.dim_kv??i.hidden_size/(i.num_attention_heads??s);if(i.model_type==="falcon"){const l=[a*s,0,u];for(let h=0;h<o;++h)n[`${e}.${h}.key`]=l,n[`${e}.${h}.value`]=l;}else if(i.multi_query){const l=[a*s,0,2*u];for(let h=0;h<o;++h)n[`${e}.${h}.key_value`]=l;}else if(i.model_type==="bloom"){const l=[a*s,u,0],h=[a*s,0,u];for(let f=0;f<o;++f)n[`${e}.${f}.key`]=l,n[`${e}.${f}.value`]=h;}else if(i.model_type==="openelm")for(let l=0;l<o;++l){const h=[a,s[l],0,u];n[`${e}.${l}.key`]=h,n[`${e}.${l}.value`]=h;}else {const l=[a,s,0,u];for(let h=0;h<o;++h)n[`${e}.${h}.key`]=l,n[`${e}.${h}.value`]=l;}}return n}let yi$2 = class yi{max_position_embeddings;constructor(e){this.model_type=null,this.is_encoder_decoder=false,Object.assign(this,e),this.normalized_config=sn$2(this);}static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main"}={}){n&&!(n instanceof yi)&&(n=new yi(n));const o=n??await oy(e,{progress_callback:r,cache_dir:i,local_files_only:a,revision:s});return new this(o)}};class mm{static async from_pretrained(...e){return yi$2.from_pretrained(...e)}}const Za$1=Object.freeze({cpu:"cpu",gpu:"gpu",wasm:"wasm",webgpu:"webgpu"}),uy=function(){let t;return async function(){if(t===void 0)if(Pr$2.IS_NODE_ENV)t=true;else if(!Pr$2.IS_WEBGPU_AVAILABLE)t=false;else try{t=(await navigator.gpu.requestAdapter()).features.has("shader-f16");}catch{t=false;}return t}}(),$t$2=Object.freeze({fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),ly=Object.freeze({[Za$1.cpu]:$t$2.q8,[Za$1.gpu]:$t$2.fp32,[Za$1.wasm]:$t$2.q8,[Za$1.webgpu]:$t$2.fp32}),Sc$1=Object.freeze({[$t$2.fp32]:"",[$t$2.fp16]:"_fp16",[$t$2.int8]:"_int8",[$t$2.uint8]:"_uint8",[$t$2.q8]:"_quantized",[$t$2.q4]:"_q4",[$t$2.q4f16]:"_q4f16",[$t$2.bnb4]:"_bnb4"});let Zt$2 = class Zt extends or$2{_call(e,r){throw Error("`_call` should be implemented in a subclass")}};let Co$2 = class Co extends or$2{_call(e,r){throw Error("`_call` should be implemented in a subclass")}};let Ys$2 = class Ys extends or$2{constructor(){super(),this.processors=[];}push(e){this.processors.push(e);}extend(e){this.processors.push(...e);}_call(e,r){let n=r;for(const i of this.processors)n=i(e,n);return n}[Symbol.iterator](){return this.processors.values()}};class dy extends Zt$2{constructor(e){super(),this.bos_token_id=e;}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length===1){const i=r[n];i.data.fill(-1/0),i.data[this.bos_token_id]=0;}return r}}class cy extends Zt$2{constructor(e,r){super(),this.max_length=e,this.eos_token_id=Array.isArray(r)?r:[r];}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length===this.max_length-1){const i=r[n];i.data.fill(-1/0);for(const a of this.eos_token_id)i.data[a]=0;}return r}}class py extends Zt$2{constructor(e,r){super(),this.begin_suppress_tokens=e,this.begin_index=r;}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length===this.begin_index){const i=r[n];for(const a of this.begin_suppress_tokens)i.data[a]=-1/0;}return r}}class hy extends Zt$2{constructor(e,r){super(),this.eos_token_id=Array.isArray(e.eos_token_id)?e.eos_token_id[0]:e.eos_token_id,this.no_timestamps_token_id=e.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=r.length,r.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=e.max_initial_timestamp_index;}_call(e,r){for(let n=0;n<e.length;++n){const a=r[n].data;if(a[this.no_timestamps_token_id]=-1/0,e[n].length===this.begin_index-1){a.fill(-1/0),a[this.timestamp_begin]=0;continue}const s=e[n].slice(this.begin_index),o=s.length>=1&&s[s.length-1]>=this.timestamp_begin,u=s.length<2||s[s.length-2]>=this.timestamp_begin;if(o&&(u?a.subarray(this.timestamp_begin).fill(-1/0):a.subarray(0,this.eos_token_id).fill(-1/0)),e[n].length===this.begin_index&&this.max_initial_timestamp_index!==null){const m=this.timestamp_begin+this.max_initial_timestamp_index;a.subarray(m+1).fill(-1/0);}const l=o0(a),h=Math.log(l.subarray(this.timestamp_begin).map(Math.exp).reduce((m,c)=>m+c)),f=_r$2(l.subarray(0,this.timestamp_begin))[0];h>f&&a.subarray(0,this.timestamp_begin).fill(-1/0);}return r}}class fy extends Zt$2{constructor(e){super(),this.no_repeat_ngram_size=e;}getNgrams(e){const r=e.length,n=[];for(let a=0;a<r+1-this.no_repeat_ngram_size;++a){const s=[];for(let o=0;o<this.no_repeat_ngram_size;++o)s.push(e[a+o]);n.push(s);}const i=new Map;for(const a of n){const s=a.slice(0,a.length-1),o=JSON.stringify(s),u=i.get(o)??[];u.push(a[a.length-1]),i.set(o,u);}return i}getGeneratedNgrams(e,r){const n=r.slice(r.length+1-this.no_repeat_ngram_size,r.length);return e.get(JSON.stringify(n))??[]}calcBannedNgramTokens(e){const r=[];if(e.length+1<this.no_repeat_ngram_size)return r;{const n=this.getNgrams(e);return this.getGeneratedNgrams(n,e)}}_call(e,r){for(let n=0;n<e.length;++n){const i=r[n],a=this.calcBannedNgramTokens(e[n]);for(const s of a)i.data[s]=-1/0;}return r}}class my extends Zt$2{constructor(e){super(),this.penalty=e;}_call(e,r){for(let n=0;n<e.length;++n){const i=r[n];for(const a of e[n])i.data[a]<0?i.data[a]*=this.penalty:i.data[a]/=this.penalty;}return r}}class gy extends Zt$2{constructor(e,r){super(),this.min_length=e,this.eos_token_id=Array.isArray(r)?r:[r];}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length<this.min_length){const i=r[n];for(const a of this.eos_token_id)i.data[a]=-1/0;}return r}}let _y$1 = class _y extends Zt$2{constructor(e,r,n){super(),this.prompt_length_to_skip=e,this.min_new_tokens=r,this.eos_token_id=Array.isArray(n)?n:[n];}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length-this.prompt_length_to_skip<this.min_new_tokens){const a=r[n];for(const s of this.eos_token_id)a[s]=-1/0;}return r}};class yy extends Zt$2{constructor(e,r){super(),this.bad_words_ids=e,this.eos_token_id=Array.isArray(r)?r:[r];}_call(e,r){for(let n=0;n<e.length;++n){const i=r[n];for(const a of this.bad_words_ids){let s=true;for(let o=1;o<=a.length-1&&a.length<e[o].length;++o)if(a.at(-o-1)!==e[o].at(-o)){s=false;break}s&&(i[a.at(-1)]=-1/0);}}return r}}class wy extends Zt$2{constructor(e){if(super(),e<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${e}.`);this.guidance_scale=e;}_call(e,r){if(r.dims[0]!==2*e.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${r.dims[0]} for the logits and ${e.length} for the input ids.`);const n=e.length,i=r.slice([0,n],null),a=r.slice([n,r.dims[0]],null);for(let s=0;s<a.data.length;++s)a.data[s]+=(i.data[s]-a.data[s])*this.guidance_scale;return a}}class by extends Co$2{constructor(e){super(),this.temperature=e;}_call(e,r){const n=r.data;for(let i=0;i<n.length;++i)n[i]/=this.temperature;return r}}class vy extends Co$2{constructor(e,{filter_value:r=-1/0,min_tokens_to_keep:n=1}={}){if(super(),e<0||e>1)throw new Error(`\`top_p\` must be a float > 0 and < 1, but is ${e}`);if(!Number.isInteger(n)||n<1)throw new Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${n}`);this.top_p=e,this.filter_value=r,this.min_tokens_to_keep=n;}}class $y extends Co$2{constructor(e,{filter_value:r=-1/0,min_tokens_to_keep:n=1}={}){if(super(),!Number.isInteger(e)||e<0)throw new Error(`\`top_k\` must be a positive integer, but is ${e}`);this.top_k=Math.max(e,n),this.filter_value=r;}}class gm{max_length=20;max_new_tokens=null;min_length=0;min_new_tokens=null;early_stopping=false;max_time=null;do_sample=false;num_beams=1;num_beam_groups=1;penalty_alpha=null;use_cache=true;temperature=1;top_k=50;top_p=1;typical_p=1;epsilon_cutoff=0;eta_cutoff=0;diversity_penalty=0;repetition_penalty=1;encoder_repetition_penalty=1;length_penalty=1;no_repeat_ngram_size=0;bad_words_ids=null;force_words_ids=null;renormalize_logits=false;constraints=null;forced_bos_token_id=null;forced_eos_token_id=null;remove_invalid_values=false;exponential_decay_length_penalty=null;suppress_tokens=null;begin_suppress_tokens=null;forced_decoder_ids=null;guidance_scale=null;num_return_sequences=1;output_attentions=false;output_hidden_states=false;output_scores=false;return_dict_in_generate=false;pad_token_id=null;bos_token_id=null;eos_token_id=null;encoder_no_repeat_ngram_size=0;decoder_start_token_id=null;generation_kwargs={};constructor(e){Object.assign(this,zr$2(e,Object.getOwnPropertyNames(this)));}}let Eo$2 = class Eo extends or$2{_call(e,r){throw Error("StoppingCriteria needs to be subclassed")}};let To$2 = class To extends or$2{constructor(){super(),this.criteria=[];}push(e){this.criteria.push(e);}extend(e){e instanceof To?e=e.criteria:e instanceof Eo$2&&(e=[e]),this.criteria.push(...e);}_call(e,r){const n=new Array(e.length).fill(false);for(const i of this.criteria){const a=i(e,r);for(let s=0;s<n.length;++s)n[s]||=a[s];}return n}[Symbol.iterator](){return this.criteria.values()}};class xy extends Eo$2{constructor(e,r=null){super(),this.max_length=e,this.max_position_embeddings=r;}_call(e){return e.map(r=>r.length>=this.max_length)}}class Sy extends Eo$2{constructor(e){super(),Array.isArray(e)||(e=[e]),this.eos_token_id=e;}_call(e,r){return e.map(n=>{const i=n.at(-1);return this.eos_token_id.some(a=>i==a)})}}let Si$1 = class Si extends or$2{constructor(e){super(),this.generation_config=e;}async _call(e){return this.sample(e)}async sample(e){throw Error("sample should be implemented in subclasses.")}getLogits(e,r){let n=e.dims.at(-1),i=e.data;if(r===-1)i=i.slice(-n);else {let a=r*n;i=i.slice(a,a+n);}return i}randomSelect(e){let r=0;for(let i=0;i<e.length;++i)r+=e[i];let n=Math.random()*r;for(let i=0;i<e.length;++i)if(n-=e[i],n<=0)return i;return 0}static getSampler(e){if(e.do_sample)return new Ey(e);if(e.num_beams>1)return new Ty(e);if(e.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${e.num_return_sequences}.`);return new Cy(e)}};class Cy extends Si$1{async sample(e){const r=_r$2(e.data)[1];return [[BigInt(r),0]]}}class Ey extends Si$1{async sample(e){let r=e.dims.at(-1);this.generation_config.top_k>0&&(r=Math.min(this.generation_config.top_k,r));const[n,i]=await pm(e,r),a=ta$2(n.data);return Array.from({length:this.generation_config.num_beams},()=>{const s=this.randomSelect(a);return [i.data[s],Math.log(a[s])]})}}class Ty extends Si$1{async sample(e){let r=e.dims.at(-1);this.generation_config.top_k>0&&(r=Math.min(this.generation_config.top_k,r));const[n,i]=await pm(e,r),a=ta$2(n.data);return Array.from({length:this.generation_config.num_beams},(s,o)=>[i.data[o],Math.log(a[o])])}}class ky extends gm{return_timestamps=null;return_token_timestamps=null;num_frames=null;alignment_heads=null;task=null;language=null;no_timestamps_token_id=null;prompt_ids=null;is_multilingual=null;lang_to_id=null;task_to_id=null;max_initial_timestamp_index=1}const be$2={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7},wi$1=new Map,_m=new Map,qn$2=new Map;async function Iy(t,e,r){let n=r.device;n&&typeof n!="string"&&(n.hasOwnProperty(e)?n=n[e]:(console.warn(`Device not specified for ${e}. Using the default device.`),n=null));const i=H_(n);let a=r.dtype;if(typeof a!="string"&&(a&&a.hasOwnProperty(e)?a=a[e]:(a=ly[i[0]],console.warn(`Dtype not specified for ${e}. Using the default dtype: ${a}.`))),Sc$1.hasOwnProperty(a)){if(a===$t$2.fp16&&!await uy())throw new Error("The device does not support fp16.")}else throw new Error(`Invalid dtype: ${a}. Should be one of: ${Object.keys($t$2).join(", ")}`);const s=Sc$1[a],o=`${r.subfolder??""}/${e}${s}.onnx`,u={...r.session_options};u.executionProviders??=i;const l=ei$2(t,o,true,r);let h=[];if(r.use_external_data_format){if(Pr$2.IS_NODE_ENV)throw new Error("External data format is not yet supported in Node.js");const m=`${e}${s}.onnx_data`,c=`${r.subfolder??""}/${m}`;h.push(new Promise(async(y,b)=>{const v=await ei$2(t,c,true,r);y({path:m,data:v});}));}else u.externalData!==void 0&&(h=u.externalData.map(async m=>{if(typeof m.data=="string"){const c=await ei$2(t,m.data,true,r);return {...m,data:c}}return m}));if(h.length>0&&(u.externalData=await Promise.all(h)),n==="webgpu"){const m=fm(r.config,{prefix:"present"});if(Object.keys(m).length>0){const c={};for(const y in m)c[y]="gpu-buffer";u.preferredOutputLocation=c;}}return {buffer:await l,session_options:u}}async function Tr$2(t,e,r){const n=Object.keys(e),i=await Promise.all(n.map(async s=>Iy(t,e[s],r))),a={};for(let s=0;s<n.length;++s){const{buffer:o,session_options:u}=i[s],l=await lm(o,u);a[n[s]]=l;}return a}function Ay(t,e){const r=Object.create(null),n=[];for(const s of t.inputNames){const o=e[s];if(!(o instanceof ce$2)){n.push(s);continue}r[s]=q_()?o.clone():o;}if(n.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${n.join(", ")}.`);const i=Object.keys(e).length,a=t.inputNames.length;if(i>a){let s=Object.keys(e).filter(o=>!t.inputNames.includes(o));console.warn(`WARNING: Too many inputs were provided (${i} > ${a}). The following inputs will be ignored: "${s.join(", ")}".`);}return r}async function gr$2(t,e){const r=Ay(t,e);try{const n=Object.fromEntries(Object.entries(r).map(([a,s])=>[a,s.ort_tensor]));let i=await t.run(n);return i=ym(i),i}catch(n){throw console.error(`An error occurred during model execution: "${n}".`),console.error("Inputs given to model:",r),n}}function ym(t){for(let e in t)dm(t[e])?t[e]=new ce$2(t[e]):typeof t[e]=="object"&&ym(t[e]);return t}function wm(t){if(t instanceof ce$2)return t;if(t.length===0)throw Error("items must be non-empty");if(Array.isArray(t[0])){if(t.some(e=>e.length!==t[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new ce$2("int64",BigInt64Array.from(t.flat().map(e=>BigInt(e))),[t.length,t[0].length])}else return new ce$2("int64",BigInt64Array.from(t.map(e=>BigInt(e))),[1,t.length])}function bm(t){return new ce$2("bool",[t],[1])}async function Cc$1(t,e){let{encoder_outputs:r,past_key_values:n}=e;if(!r){const u=zr$2(e,t.sessions.model.inputNames);r=(await Jn$2(t,u)).last_hidden_state;}const{input_ids:i,decoder_input_ids:a,...s}=e;return s.input_ids=a,s.encoder_hidden_states=r,t.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(s.encoder_attention_mask=e.attention_mask),await ko$2(t,s,true)}async function Jn$2(t,e){const r=t.sessions.model,n=Object.create(null);for(const i of r.inputNames)n[i]=e[i];return r.inputNames.includes("token_type_ids")&&!n.token_type_ids&&(n.token_type_ids=new ce$2("int64",new BigInt64Array(n.input_ids.data.length),n.input_ids.dims)),await gr$2(r,n)}async function ko$2(t,e,r=false){const n=t.sessions[r?"decoder_model_merged":"model"],{past_key_values:i,...a}=e;n.inputNames.includes("use_cache_branch")&&(a.use_cache_branch=bm(!!i)),n.inputNames.includes("position_ids")&&a.attention_mask&&!a.position_ids&&(a.position_ids=Oy(a,i)),t.addPastKeyValues(a,i);const s=zr$2(a,n.inputNames);return await gr$2(n,s)}async function My(t,{input_ids:e=null,attention_mask:r=null,pixel_values:n=null,position_ids:i=null,inputs_embeds:a=null,past_key_values:s=null,generation_config:o=null,logits_processor:u=null,...l}){if(!a){if(a=await t.encode_text({input_ids:e}),n&&e.dims[1]!==1){const f=await t.encode_image({pixel_values:n});({inputs_embeds:a,attention_mask:r}=t._merge_input_ids_with_image_features({image_features:f,inputs_embeds:a,input_ids:e,attention_mask:r}));}else if(s&&n&&e.dims[1]===1){const f=e.dims[1],m=Object.values(s)[0].dims.at(-2);r=Jt$2([aa$2([e.dims[0],m]),r.slice(null,[r.dims[1]-f,r.dims[1]])],1);}}return await ko$2(t,{inputs_embeds:a,past_key_values:s,attention_mask:r,position_ids:i,generation_config:o,logits_processor:u},true)}function Oy(t,e=null){const{input_ids:r,inputs_embeds:n,attention_mask:i}=t,[a,s]=i.dims,o=new BigInt64Array(i.data.length);for(let l=0;l<a;++l){const h=l*s;let f=BigInt(0);for(let m=0;m<s;++m){const c=h+m;i.data[c]===0n?o[c]=BigInt(1):(o[c]=f,f+=i.data[c]);}}let u=new ce$2("int64",o,i.dims);if(e){const l=-(r??n).dims.at(1);u=u.slice(null,[l,null]);}return u}function Ec$1(t,e,r,n){if(r.past_key_values){const i=Object.values(r.past_key_values)[0].dims.at(-2),{input_ids:a,attention_mask:s}=r;if(!(s&&s.dims[1]>a.dims[1])){if(i<a.dims[1])r.input_ids=a.slice(null,[i,null]);else if(t.config.image_token_index!=null&&a.data.some(o=>o==t.config.image_token_index)){const o=t.config.num_image_tokens;if(!o)throw new Error("`num_image_tokens` is missing in the model configuration.");const u=a.dims[1]-(i-o);r.input_ids=a.slice(null,[-u,null]),r.attention_mask=aa$2([1,i+u]);}}}return r}function zy(t,e,r,n){const{...i}=r;return r.past_key_values&&(e=e.map(s=>[s.at(-1)])),i.decoder_input_ids=wm(e),i}let X$2 = class X extends or$2{main_input_name="input_ids";forward_params=["input_ids","attention_mask"];constructor(e,r){super(),this.config=e,this.sessions=r;const n=qn$2.get(this.constructor),i=wi$1.get(n);this.can_generate=false,this._forward=null,this._prepare_inputs_for_generation=null,i===be$2.DecoderOnly?(this.can_generate=true,this._forward=ko$2,this._prepare_inputs_for_generation=Ec$1):i===be$2.Seq2Seq||i===be$2.Vision2Seq||i===be$2.Musicgen?(this.can_generate=true,this._forward=Cc$1,this._prepare_inputs_for_generation=zy):i===be$2.EncoderDecoder?this._forward=Cc$1:i===be$2.ImageTextToText?(this.can_generate=true,this._forward=My,this._prepare_inputs_for_generation=Ec$1):this._forward=Jn$2,this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=this.config["transformers.js_config"]??{};}async dispose(){const e=[];for(const r of Object.values(this.sessions))r?.handler?.dispose&&e.push(r.handler.dispose());return await Promise.all(e)}static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main",model_file_name:o=null,subfolder:u="onnx",device:l=null,dtype:h=null,use_external_data_format:f=null,session_options:m={}}={}){let c={progress_callback:r,config:n,cache_dir:i,local_files_only:a,revision:s,model_file_name:o,subfolder:u,device:l,dtype:h,use_external_data_format:f,session_options:m};const y=qn$2.get(this),b=wi$1.get(y);c.config=await mm.from_pretrained(e,c);let v;return b===be$2.DecoderOnly?v=await Promise.all([Tr$2(e,{model:c.model_file_name??"model"},c),on$2(e,"generation_config.json",false,c)]):b===be$2.Seq2Seq||b===be$2.Vision2Seq?v=await Promise.all([Tr$2(e,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},c),on$2(e,"generation_config.json",false,c)]):b===be$2.MaskGeneration?v=await Promise.all([Tr$2(e,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},c)]):b===be$2.EncoderDecoder?v=await Promise.all([Tr$2(e,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},c)]):b===be$2.ImageTextToText?v=await Promise.all([Tr$2(e,{embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"},c),on$2(e,"generation_config.json",false,c)]):b===be$2.Musicgen?v=await Promise.all([Tr$2(e,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},c),on$2(e,"generation_config.json",false,c)]):(b!==be$2.EncoderOnly&&console.warn(`Model type for '${y??n?.model_type}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`),v=await Promise.all([Tr$2(e,{model:c.model_file_name??"model"},c)])),new this(c.config,...v)}async _call(e){return await this.forward(e)}async forward(e){return await this._forward(this,e)}_get_logits_warper(e){const r=new Ys$2;return e.temperature!==null&&e.temperature!==1&&r.push(new by(e.temperature)),e.top_k!==null&&e.top_k!==0&&r.push(new $y(e.top_k)),e.top_p!==null&&e.top_p<1&&r.push(new vy(e.top_p)),r}_get_logits_processor(e,r,n=null){const i=new Ys$2;if(e.repetition_penalty!==null&&e.repetition_penalty!==1&&i.push(new my(e.repetition_penalty)),e.no_repeat_ngram_size!==null&&e.no_repeat_ngram_size>0&&i.push(new fy(e.no_repeat_ngram_size)),e.bad_words_ids!==null&&i.push(new yy(e.bad_words_ids,e.eos_token_id)),e.min_length!==null&&e.eos_token_id!==null&&e.min_length>0&&i.push(new gy(e.min_length,e.eos_token_id)),e.min_new_tokens!==null&&e.eos_token_id!==null&&e.min_new_tokens>0&&i.push(new _y$1(r,e.min_new_tokens,e.eos_token_id)),e.forced_bos_token_id!==null&&i.push(new dy(e.forced_bos_token_id)),e.forced_eos_token_id!==null&&i.push(new cy(e.max_length,e.forced_eos_token_id)),e.begin_suppress_tokens!==null){const a=r>1||e.forced_bos_token_id===null?r:r+1;i.push(new py(e.begin_suppress_tokens,a));}return e.guidance_scale!==null&&e.guidance_scale>1&&i.push(new wy(e.guidance_scale)),n!==null&&i.extend(n),i}_prepare_generation_config(e,r,n=gm){const i={...this.config};for(const s of ["decoder","generator","text_config"])s in i&&Object.assign(i,i[s]);const a=new n(i);return "generation_config"in this&&Object.assign(a,this.generation_config),e&&Object.assign(a,e),r&&Object.assign(a,zr$2(r,Object.getOwnPropertyNames(a))),a}_get_stopping_criteria(e,r=null){const n=new To$2;return e.max_length!==null&&n.push(new xy(e.max_length,this.config.max_position_embeddings??null)),e.eos_token_id!==null&&n.push(new Sy(e.eos_token_id)),r&&n.extend(r),n}_validate_model_class(){if(!this.can_generate){const e=[Cg,Eg,Sg,xg],r=qn$2.get(this.constructor),n=new Set,i=this.config.model_type;for(const s of e){const o=s.get(i);o&&n.add(o[0]);}let a=`The current model class (${r}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;throw n.size>0&&(a+=` Please use the following class instead: ${[...n].join(", ")}`),Error(a)}}prepare_inputs_for_generation(...e){return this._prepare_inputs_for_generation(this,...e)}_update_model_kwargs_for_generation({generated_input_ids:e,outputs:r,model_inputs:n,is_encoder_decoder:i}){return n.past_key_values=this.getPastKeyValues(r,n.past_key_values),n.input_ids=new ce$2("int64",e.flat(),[e.length,1]),i||(n.attention_mask=Jt$2([n.attention_mask,aa$2([n.attention_mask.dims[0],1])],1)),n.position_ids=null,n}_prepare_model_inputs({inputs:e,bos_token_id:r,model_kwargs:n}){const i=zr$2(n,this.forward_params),a=this.main_input_name;if(a in i){if(e)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else i[a]=e;return {inputs_tensor:i[a],model_inputs:i,model_input_name:a}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:e,model_inputs:r,model_input_name:n,generation_config:i}){const a=zr$2(r,this.sessions.model.inputNames);let{last_hidden_state:s}=await Jn$2(this,a);return i.guidance_scale!==null&&i.guidance_scale>1&&(s=Jt$2([s,ey(s,0)],0),"attention_mask"in r&&(r.attention_mask=Jt$2([r.attention_mask,ny(r.attention_mask)],0))),r.encoder_outputs=s,r}_prepare_decoder_input_ids_for_generation({batch_size:e,model_input_name:r,model_kwargs:n,decoder_start_token_id:i,bos_token_id:a,generation_config:s}){let{decoder_input_ids:o,...u}=n;if(!o)if(i??=a,this.config.model_type==="musicgen")o=Array.from({length:e*this.config.decoder.num_codebooks},()=>[i]);else if(Array.isArray(i)){if(i.length!==e)throw new Error(`\`decoder_start_token_id\` expcted to have length ${e} but got ${i.length}`);o=i;}else o=Array.from({length:e},()=>[i]);return o=wm(o),n.decoder_attention_mask=ty(o),{input_ids:o,model_inputs:u}}async generate({inputs:e=null,generation_config:r=null,logits_processor:n=null,stopping_criteria:i=null,streamer:a=null,...s}){this._validate_model_class(),r=this._prepare_generation_config(r,s);let{inputs_tensor:o,model_inputs:u,model_input_name:l}=this._prepare_model_inputs({inputs:e,model_kwargs:s});const h=this.config.is_encoder_decoder;h&&("encoder_outputs"in u||(u=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:o,model_inputs:u,model_input_name:l,generation_config:r})));let f;h?{input_ids:f,model_inputs:u}=this._prepare_decoder_input_ids_for_generation({batch_size:u[l].dims.at(0),model_input_name:l,model_kwargs:u,decoder_start_token_id:r.decoder_start_token_id,bos_token_id:r.bos_token_id,generation_config:r}):f=u[l];let m=f.dims.at(-1);r.max_new_tokens!==null&&(r.max_length=m+r.max_new_tokens);const c=this._get_logits_processor(r,m,n),y=this._get_stopping_criteria(r,i),b=u[l].dims.at(0),v=Si$1.getSampler(r),C=new Array(b).fill(0),x=f.tolist();a&&a.put(x);let T=null;for(;;){u=this.prepare_inputs_for_generation(x,u,r);const A=await this.forward(u),R=A.logits.slice(null,-1,null),z=c(x,R),P=[];for(let K=0;K<z.dims.at(0);++K){const ue=z[K],ie=await v(ue);for(const[ge,he]of ie){const D=BigInt(ge);C[K]+=he,x[K].push(D),P.push([D]);break}}if(a&&a.put(P),y(x).every(K=>K)){r.return_dict_in_generate&&(T=this.getPastKeyValues(A,u.past_key_values,false));break}u=this._update_model_kwargs_for_generation({generated_input_ids:P,outputs:A,model_inputs:u,is_encoder_decoder:h});}a&&a.end();const I=new ce$2("int64",x.flat(),[x.length,x[0].length]);return r.return_dict_in_generate?{sequences:I,past_key_values:T}:I}addAttentionsToBeam(e,r){if(this.config.is_encoder_decoder){if(!r.cross_attentions||r.cross_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce cross-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.cross_attentions||(e.cross_attentions=[]),e.cross_attentions.push(r.cross_attentions);}if(!r.decoder_attentions||r.decoder_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce decoder-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.decoder_attentions||(e.decoder_attentions=[]),e.decoder_attentions.push(r.decoder_attentions);}groupBeams(e){const r=Object.create(null);for(const n of e)r[n.id]===void 0?r[n.id]=[n]:r[n.id].push(n);return Object.values(r)}getPastKeyValues(e,r,n=true){const i=Object.create(null);for(const a in e)if(a.startsWith("present")){let s=a.replace("present","past_key_values");if(r&&a.includes("encoder"))i[s]=r[s];else {if(n&&r){const o=r[s];o.location==="gpu-buffer"&&o.dispose();}i[s]=e[a];}}return i}getAttentions(e){const r=Object.create(null);for(const n of ["cross_attentions","decoder_attentions"]){const i=[];for(const a in e)if(a.startsWith(n)){const s=a.split(".").pop();i[s]=e[a];}r[n]=i;}return r}addPastKeyValues(e,r){if(r)Object.assign(e,r);else {const n=this.custom_config.kv_cache_dtype??"float32",i=n==="float16"?new Uint16Array:[],a=fm(this.config);for(const s in a)e[s]=new ce$2(n,i,a[s]);}}};let Ot$2 = class Ot{};let ia$2 = class ia extends X$2{};class Ry extends ia$2{}class Py extends ia$2{async _call(e){return new dt$2(await super._call(e))}}class By extends ia$2{async _call(e){return new Ae$2(await super._call(e))}}class Dy extends ia$2{async _call(e){return new lt$2(await super._call(e))}}class Ny extends ia$2{async _call(e){return new mt$2(await super._call(e))}}class Fy extends X$2{}class Ly extends Fy{}let sa$2 = class sa extends X$2{};class Wy extends sa$2{}class Uy extends sa$2{async _call(e){return new dt$2(await super._call(e))}}class Vy extends sa$2{async _call(e){return new Ae$2(await super._call(e))}}class Gy extends sa$2{async _call(e){return new lt$2(await super._call(e))}}class Hy extends sa$2{async _call(e){return new mt$2(await super._call(e))}}let oa$2 = class oa extends X$2{};class qy extends oa$2{}class jy extends oa$2{async _call(e){return new dt$2(await super._call(e))}}class Ky extends oa$2{async _call(e){return new Ae$2(await super._call(e))}}class Yy extends oa$2{async _call(e){return new lt$2(await super._call(e))}}class Xy extends oa$2{async _call(e){return new mt$2(await super._call(e))}}let ua$2 = class ua extends X$2{};class Qy extends ua$2{}class Jy extends ua$2{async _call(e){return new dt$2(await super._call(e))}}class Zy extends ua$2{async _call(e){return new Ae$2(await super._call(e))}}class ew extends ua$2{async _call(e){return new lt$2(await super._call(e))}}class tw extends ua$2{async _call(e){return new mt$2(await super._call(e))}}let la$2 = class la extends X$2{};class rw extends la$2{}class nw extends la$2{async _call(e){return new dt$2(await super._call(e))}}class aw extends la$2{async _call(e){return new Ae$2(await super._call(e))}}class iw extends la$2{async _call(e){return new lt$2(await super._call(e))}}class sw extends la$2{async _call(e){return new mt$2(await super._call(e))}}let da$2 = class da extends X$2{};class ow extends da$2{}class uw extends da$2{async _call(e){return new dt$2(await super._call(e))}}class lw extends da$2{async _call(e){return new Ae$2(await super._call(e))}}class dw extends da$2{async _call(e){return new lt$2(await super._call(e))}}class cw extends da$2{async _call(e){return new mt$2(await super._call(e))}}let ca$2 = class ca extends X$2{};class pw extends ca$2{}class hw extends ca$2{async _call(e){return new dt$2(await super._call(e))}}class fw extends ca$2{async _call(e){return new Ae$2(await super._call(e))}}class mw extends ca$2{async _call(e){return new lt$2(await super._call(e))}}class gw extends ca$2{async _call(e){return new mt$2(await super._call(e))}}let pa$2 = class pa extends X$2{};class _w extends pa$2{}class yw extends pa$2{async _call(e){return new Ae$2(await super._call(e))}}class ww extends pa$2{async _call(e){return new lt$2(await super._call(e))}}class bw extends pa$2{async _call(e){return new mt$2(await super._call(e))}}class vw extends pa$2{async _call(e){return new dt$2(await super._call(e))}}let Ci$2 = class Ci extends X$2{};class $w extends Ci$2{}class xw extends Ci$2{async _call(e){return new dt$2(await super._call(e))}}class Sw extends Ci$2{async _call(e){return new Ae$2(await super._call(e))}}class Cw extends Ci$2{async _call(e){return new lt$2(await super._call(e))}}let Ei$1 = class Ei extends X$2{};class Ew extends Ei$1{}class Tw extends Ei$1{async _call(e){return new dt$2(await super._call(e))}}class kw extends Ei$1{async _call(e){return new Ae$2(await super._call(e))}}class Iw extends Ei$1{async _call(e){return new mt$2(await super._call(e))}}let ha$2 = class ha extends X$2{};class Aw extends ha$2{}class Mw extends ha$2{async _call(e){return new dt$2(await super._call(e))}}class Ow extends ha$2{async _call(e){return new Ae$2(await super._call(e))}}class zw extends ha$2{async _call(e){return new lt$2(await super._call(e))}}class Rw extends ha$2{async _call(e){return new mt$2(await super._call(e))}}let Ti$2 = class Ti extends X$2{};class Pw extends Ti$2{}class Bw extends Ti$2{async _call(e){return new dt$2(await super._call(e))}}class Dw extends Ti$2{async _call(e){return new Ae$2(await super._call(e))}}class Nw extends Ti$2{async _call(e){return new mt$2(await super._call(e))}}let ki$1 = class ki extends X$2{};class Fw extends ki$1{}class Lw extends ki$1{async _call(e){return new Ae$2(await super._call(e))}}class Ww extends ki$1{async _call(e){return new mt$2(await super._call(e))}}class Uw extends ki$1{async _call(e){return new dt$2(await super._call(e))}}class vm extends X$2{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class Vw extends vm{}class Gw extends vm{}class $m extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Hw extends $m{}class qw extends $m{}class xm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class jw extends xm{}class Kw extends xm{}let Io$2 = class Io extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}};class Yw extends Io$2{}class Xw extends Io$2{}class Qw extends Io$2{async _call(e){return new Ae$2(await super._call(e))}}let Ii$1 = class Ii extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}};class Jw extends Ii$1{}class Zw extends Ii$1{}class eb extends Ii$1{async _call(e){return new Ae$2(await super._call(e))}}class tb extends Ii$1{}class Sm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class rb extends Sm{}class nb extends Sm{}class Cm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class ab extends Cm{}class ib extends Cm{}let fa$2 = class fa extends X$2{};class sb extends fa$2{}class ob extends fa$2{async _call(e){return new dt$2(await super._call(e))}}class ub extends fa$2{async _call(e){return new Ae$2(await super._call(e))}}class lb extends fa$2{async _call(e){return new lt$2(await super._call(e))}}class db extends fa$2{async _call(e){return new mt$2(await super._call(e))}}let ma$2 = class ma extends X$2{};class cb extends ma$2{}class pb extends ma$2{async _call(e){return new dt$2(await super._call(e))}}class hb extends ma$2{async _call(e){return new Ae$2(await super._call(e))}}class fb extends ma$2{async _call(e){return new lt$2(await super._call(e))}}class mb extends ma$2{async _call(e){return new mt$2(await super._call(e))}}let ga$2 = class ga extends X$2{};class gb extends ga$2{}let _b$1 = class _b extends ga$2{async _call(e){return new dt$2(await super._call(e))}};class yb extends ga$2{async _call(e){return new Ae$2(await super._call(e))}}class wb extends ga$2{async _call(e){return new lt$2(await super._call(e))}}class bb extends ga$2{async _call(e){return new mt$2(await super._call(e))}}class Em extends X$2{}class vb extends Em{}class $b extends Em{}class Tm extends X$2{requires_attention_mask=false;main_input_name="input_features";forward_params=["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class xb extends Tm{}class Sb extends Tm{_prepare_generation_config(e,r){return super._prepare_generation_config(e,r,ky)}_retrieve_init_tokens(e){const r=[e.decoder_start_token_id];let n=e.language;const i=e.task;if(e.is_multilingual){n||(console.warn("No language specified - defaulting to English (en)."),n="en");const s=`<|${iy(n)}|>`;r.push(e.lang_to_id[s]),r.push(e.task_to_id[i??"transcribe"]);}else if(n||i)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return !e.return_timestamps&&e.no_timestamps_token_id&&r.at(-1)!==e.no_timestamps_token_id?r.push(e.no_timestamps_token_id):e.return_timestamps&&r.at(-1)===e.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),r.pop()),r.filter(a=>a!=null)}async generate({inputs:e=null,generation_config:r=null,logits_processor:n=null,stopping_criteria:i=null,...a}){r=this._prepare_generation_config(r,a);const s=this._retrieve_init_tokens(r);return r.return_timestamps&&(n??=new Ys$2,n.push(new hy(r,s))),await super.generate({inputs:e,generation_config:r,logits_processor:n,decoder_input_ids:s,...a})}_extract_token_timestamps(e,r,n=null,i=.02){if(!e.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");let a=this.config.median_filter_width;a===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),a=7);const s=e.cross_attentions.map(l=>{let h=Array.from({length:this.config.decoder_layers},(v,C)=>Jt$2(l.map(x=>x[C]),2)),f=Qn$2(r.map(([v,C])=>n?h[v].slice(null,C,null,[0,n]):h[v].slice(null,C)));f=f.transpose(1,0,2,3);let[m,c]=X_(f,-2,0,true),y=f.clone();for(let v=0;v<y.dims[0];++v){let C=y[v];for(let x=0;x<C.dims[0];++x){let T=C[x];const I=m[v][x][0],A=c[v][x][0];for(let R=0;R<T.dims[0];++R){let z=T[R];for(let P=0;P<z.data.length;++P)z.data[P]=(z.data[P]-A.data[P])/I.data[P];z.data.set(c0(z.data,a));}}}return xo$2(y,1)}),o=[e.sequences.length,e.sequences[0].length],u=new ce$2("float32",new Float32Array(o[0]*o[1]),o);for(let l=0;l<o[0];++l){const h=s[l].neg().squeeze_(0);let[f,m]=Q_(h),c=Array.from({length:f.length-1},(v,C)=>f[C+1]-f[C]),y=e0([1],c).map(v=>!!v),b=[];for(let v=0;v<y.length;++v)y[v]&&b.push(m[v]*i);u[l].data.set(b,1);}return u}}class Cb extends X$2{main_input_name="pixel_values";forward_params=["pixel_values","input_ids","encoder_hidden_states","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class Eb extends X$2{forward_params=["input_ids","pixel_values","attention_mask","position_ids","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class km extends Eb{async encode_image({pixel_values:e}){const r=(await gr$2(this.sessions.vision_encoder,{pixel_values:e})).image_features;return this.config.num_image_tokens||(console.warn(`The number of image tokens was not set in the model configuration. Setting it to the number of features detected by the vision encoder (${r.dims[1]}).`),this.config.num_image_tokens=r.dims[1]),r}async encode_text({input_ids:e}){return (await gr$2(this.sessions.embed_tokens,{input_ids:e})).inputs_embeds}_merge_input_ids_with_image_features({inputs_embeds:e,image_features:r,input_ids:n,attention_mask:i}){const a=this.config.image_token_index,o=n.tolist().map(m=>m.findIndex(c=>c==a)),u=o.every(m=>m===-1),l=o.every(m=>m!==-1);if(!u&&!l)throw new Error("Every input should contain either 0 or 1 image token.");if(u)return {inputs_embeds:e,attention_mask:i};const h=[],f=[];for(let m=0;m<o.length;++m){const c=o[m],y=e[m],b=r[m],v=i[m];h.push(Jt$2([y.slice([0,c]),b,y.slice([c+1,y.dims[0]])],0)),f.push(Jt$2([v.slice([0,c]),aa$2([b.dims[0]]),v.slice([c+1,v.dims[0]])],0));}return {inputs_embeds:Qn$2(h,0),attention_mask:Qn$2(f,0)}}}class Tb extends km{}let Ai$1 = class Ai extends X$2{};class kb extends Ai$1{}class Ib extends Ai$1{static async from_pretrained(e,r={}){return r.model_file_name??="text_model",super.from_pretrained(e,r)}}class Ab extends Ai$1{static async from_pretrained(e,r={}){return r.model_file_name??="vision_model",super.from_pretrained(e,r)}}class Im extends X$2{}class Mb extends Im{}class Ob extends Im{static async from_pretrained(e,r={}){return r.model_file_name??="text_model",super.from_pretrained(e,r)}}class zb extends Ai$1{static async from_pretrained(e,r={}){return r.model_file_name??="vision_model",super.from_pretrained(e,r)}}class Rb extends X$2{}class Pb extends Rb{}class Am extends X$2{}class Bb extends Am{}class Db extends Am{}class Mm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Nb extends Mm{}class Fb extends Mm{}class Om extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Lb extends Om{}class Wb extends Om{}class zm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Ub extends zm{}class Vb extends zm{}class Rm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Gb extends Rm{}class Hb extends Rm{}class Pm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class qb extends Pm{}class jb extends Pm{}class Bm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Kb extends Bm{}class Yb extends Bm{}class Dm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Xb extends Dm{}class Qb extends Dm{}class Nm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Jb extends Nm{}class Zb extends Nm{}class Fm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class e2 extends Fm{}class t2 extends Fm{}class Lm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class r2 extends Lm{}class n2 extends Lm{}class Wm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class a2 extends Wm{}class i2 extends Wm{}class Um extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class s2 extends Um{}class o2 extends Um{}class Vm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class u2 extends Vm{}class l2 extends Vm{}class Gm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class d2 extends Gm{}class c2 extends Gm{}class Hm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class p2 extends Hm{}class h2 extends Hm{}class qm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class f2 extends qm{}class m2 extends qm{}class jm extends X$2{}class g2 extends jm{}class _2 extends jm{async _call(e){return new Ae$2(await super._call(e))}}class Km extends X$2{}class y2 extends Km{}class w2 extends Km{async _call(e){return new Ae$2(await super._call(e))}}let b2$1 = class b2 extends X$2{};class v2 extends b2$1{async _call(e){return new Rv(await super._call(e))}}class Ym extends X$2{}class $2 extends Ym{}class x2 extends Ym{async _call(e){return new Ae$2(await super._call(e))}}class Xm extends X$2{}class S2 extends Xm{}class C2 extends Xm{async _call(e){return new Ae$2(await super._call(e))}}class Qm extends X$2{}class E2 extends Qm{}class T2 extends Qm{}class Jm extends X$2{}class k2 extends Jm{}class I2 extends Jm{}class Zm extends X$2{}class A2 extends Zm{}class M2 extends Zm{async _call(e){return new Ae$2(await super._call(e))}}let Ao$2 = class Ao extends X$2{};class O2 extends Ao$2{}class z2 extends Ao$2{async _call(e){return new eg(await super._call(e))}}class R2 extends Ao$2{async _call(e){return new P2(await super._call(e))}}class eg extends Ot$2{constructor({logits:e,pred_boxes:r}){super(),this.logits=e,this.pred_boxes=r;}}class P2 extends Ot$2{constructor({logits:e,pred_boxes:r,pred_masks:n}){super(),this.logits=e,this.pred_boxes=r,this.pred_masks=n;}}class tg extends X$2{}class B2 extends tg{}class D2 extends tg{async _call(e){return new N2(await super._call(e))}}class N2 extends eg{}class rg extends X$2{}class F2 extends rg{}class L2 extends rg{async _call(e){return new Ae$2(await super._call(e))}}class ng extends X$2{}class W2 extends ng{}class U2 extends ng{async _call(e){return new Ae$2(await super._call(e))}}class ag extends X$2{}class V2 extends ag{}class G2 extends ag{async _call(e){return new Ae$2(await super._call(e))}}class ig extends X$2{}class H2 extends ig{}class q2 extends ig{}class sg extends X$2{}class j2 extends sg{}class K2 extends sg{}class Y2 extends X$2{}class X2 extends Y2{}class og extends X$2{}class Q2 extends og{}class J2 extends og{}class Z2 extends X$2{}class e1 extends Z2{}class ug extends X$2{}class t1 extends ug{}class r1 extends ug{async _call(e){return new Ae$2(await super._call(e))}}class lg extends X$2{}class n1 extends lg{}class a1 extends lg{async _call(e){return new Ae$2(await super._call(e))}}class dg extends X$2{}class i1 extends dg{}class s1 extends dg{async _call(e){return new Ae$2(await super._call(e))}}class cg extends X$2{}class o1 extends cg{}class u1 extends cg{async _call(e){return new l1(await super._call(e))}}class l1 extends Ot$2{constructor({logits:e,pred_boxes:r}){super(),this.logits=e,this.pred_boxes=r;}}class d1 extends X$2{}class c1 extends d1{async get_image_embeddings({pixel_values:e}){return await Jn$2(this,{pixel_values:e})}async forward(e){if((!e.image_embeddings||!e.image_positional_embeddings)&&(e={...e,...await this.get_image_embeddings(e)}),!e.input_labels&&e.input_points){const n=e.input_points.dims.slice(0,-1),i=n.reduce((a,s)=>a*s,1);e.input_labels=new ce$2("int64",new BigInt64Array(i).fill(1n),n);}const r={image_embeddings:e.image_embeddings,image_positional_embeddings:e.image_positional_embeddings};return e.input_points&&(r.input_points=e.input_points),e.input_labels&&(r.input_labels=e.input_labels),e.input_boxes&&(r.input_boxes=e.input_boxes),await gr$2(this.sessions.prompt_encoder_mask_decoder,r)}async _call(e){return new p1(await super._call(e))}}class p1 extends Ot$2{constructor({iou_scores:e,pred_masks:r}){super(),this.iou_scores=e,this.pred_masks=r;}}class pg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class h1 extends pg{}class f1 extends pg{}class hg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class m1 extends hg{}class g1 extends hg{}let Ur$2 = class Ur extends X$2{};class _1 extends Ur$2{}class y1 extends Ur$2{async _call(e){return new gn$2(await super._call(e))}}class w1 extends Ur$2{async _call(e){return new Ae$2(await super._call(e))}}class b1 extends Ur$2{async _call(e){return new lt$2(await super._call(e))}}let Mo$2 = class Mo extends X$2{};class v1 extends Mo$2{}class $1 extends Mo$2{async _call(e){return new gn$2(await super._call(e))}}class x1 extends Mo$2{async _call(e){return new Ae$2(await super._call(e))}}let Mi$1 = class Mi extends X$2{};class S1 extends Mi$1{}class C1 extends Mi$1{async _call(e){return new gn$2(await super._call(e))}}class E1 extends Mi$1{async _call(e){return new Ae$2(await super._call(e))}}class T1 extends Mi$1{async _call(e){return new lt$2(await super._call(e))}}let Oo$2 = class Oo extends X$2{};class k1 extends Oo$2{}class I1 extends Oo$2{async _call(e){return new gn$2(await super._call(e))}}class A1 extends Oo$2{async _call(e){return new Ae$2(await super._call(e))}}class M1 extends Ur$2{}class O1 extends Ur$2{async _call(e){return new gn$2(await super._call(e))}}class z1 extends Ur$2{async _call(e){return new Ae$2(await super._call(e))}}let _a$3 = class _a extends X$2{};class R1 extends _a$3{}class P1 extends _a$3{async _call(e){return new gn$2(await super._call(e))}}class B1 extends _a$3{async _call(e){return new Ae$2(await super._call(e))}}class D1 extends _a$3{async _call(e){return new zv(await super._call(e))}}class N1 extends _a$3{async _call(e){return new lt$2(await super._call(e))}}class fg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class F1 extends fg{}class L1 extends fg{async generate_speech(e,r,{threshold:n=.5,minlenratio:i=0,maxlenratio:a=20,vocoder:s=null}={}){const o={input_ids:e},{encoder_outputs:u,encoder_attention_mask:l}=await Jn$2(this,o),h=u.dims[1]/this.config.reduction_factor,f=Math.floor(h*a),m=Math.floor(h*i),c=this.config.num_mel_bins;let y=[],b=null,v=null,C=0;for(;;){++C;const I=bm(!!v);let A;v?A=v.output_sequence_out:A=new ce$2("float32",new Float32Array(c),[1,1,c]);let R={use_cache_branch:I,output_sequence:A,encoder_attention_mask:l,speaker_embeddings:r,encoder_hidden_states:u};this.addPastKeyValues(R,b),v=await gr$2(this.sessions.decoder_model_merged,R),b=this.getPastKeyValues(v,b);const{prob:z,spectrum:P}=v;if(y.push(P),C>=m&&(Array.from(z.data).filter(J=>J>=n).length>0||C>=f))break}const x=Jt$2(y),{waveform:T}=await gr$2(s.sessions.model,{spectrogram:x});return {spectrogram:x,waveform:T}}}class W1 extends X$2{main_input_name="spectrogram"}class U1 extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class V1 extends U1{}class mg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class G1 extends mg{}class H1 extends mg{}class gg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class q1 extends gg{}class j1 extends gg{}class _g extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class K1 extends _g{}class Y1 extends _g{}let zo$2 = class zo extends X$2{};class X1 extends zo$2{}class Q1 extends zo$2{static async from_pretrained(e,r={}){return r.model_file_name??="text_model",super.from_pretrained(e,r)}}class J1 extends zo$2{static async from_pretrained(e,r={}){return r.model_file_name??="audio_model",super.from_pretrained(e,r)}}class Z1 extends X$2{}class yg extends Z1{async _call(e){return new Pv(await super._call(e))}}class wg extends X$2{}class ev extends wg{}class tv extends wg{}class bg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class rv extends bg{}class nv extends bg{}class vg extends X$2{}class av extends vg{}class iv extends vg{async _call(e){return new Ae$2(await super._call(e))}}class $g extends X$2{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}_apply_and_filter_by_delay_pattern_mask(e){const[r,n]=e.dims,i=this.config.decoder.num_codebooks,a=n-i;let s=0;for(let l=0;l<e.size;++l){if(e.data[l]===this.config.decoder.pad_token_id)continue;const h=l%n,f=Math.floor(l/n)%i,m=h-f;m>0&&m<=a&&(e.data[s++]=e.data[l]);}const o=Math.floor(r/i),u=s/(o*i);return new ce$2(e.type,e.data.slice(0,s),[o,i,u])}prepare_inputs_for_generation(e,r,n){let i=structuredClone(e);for(let s=0;s<i.length;++s)for(let o=0;o<i[s].length;++o)s%this.config.decoder.num_codebooks>=o&&(i[s][o]=BigInt(this.config.decoder.pad_token_id));return n.guidance_scale!==null&&n.guidance_scale>1&&(i=i.concat(i)),super.prepare_inputs_for_generation(i,r,n)}async generate(e){const r=await super.generate(e),n=this._apply_and_filter_by_delay_pattern_mask(r).unsqueeze_(0),{audio_values:i}=await gr$2(this.sessions.encodec_decode,{audio_codes:n});return i}}class sv{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=false;static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main",model_file_name:o=null,subfolder:u="onnx",device:l=null,dtype:h=null,use_external_data_format:f=null,session_options:m={}}={}){let c={progress_callback:r,config:n,cache_dir:i,local_files_only:a,revision:s,model_file_name:o,subfolder:u,device:l,dtype:h,use_external_data_format:f,session_options:m};if(c.config=await mm.from_pretrained(e,c),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);for(let y of this.MODEL_CLASS_MAPPINGS){const b=y.get(c.config.model_type);if(b)return await b[1].from_pretrained(e,c)}if(this.BASE_IF_FAIL)return console.warn(`Unknown model class "${c.config.model_type}", attempting to construct from base class.`),await X$2.from_pretrained(e,c);throw Error(`Unsupported model type: ${c.config.model_type}`)}}const ov=new Map([["bert",["BertModel",Ry]],["nomic_bert",["NomicBertModel",Ly]],["roformer",["RoFormerModel",Wy]],["electra",["ElectraModel",Qy]],["esm",["EsmModel",$w]],["convbert",["ConvBertModel",qy]],["camembert",["CamembertModel",rw]],["deberta",["DebertaModel",ow]],["deberta-v2",["DebertaV2Model",pw]],["mpnet",["MPNetModel",Aw]],["albert",["AlbertModel",Fw]],["distilbert",["DistilBertModel",_w]],["roberta",["RobertaModel",sb]],["xlm",["XLMModel",cb]],["xlm-roberta",["XLMRobertaModel",gb]],["clap",["ClapModel",X1]],["clip",["CLIPModel",kb]],["clipseg",["CLIPSegModel",Bb]],["chinese_clip",["ChineseCLIPModel",Pb]],["siglip",["SiglipModel",Mb]],["mobilebert",["MobileBertModel",Ew]],["squeezebert",["SqueezeBertModel",Pw]],["wav2vec2",["Wav2Vec2Model",_1]],["wav2vec2-bert",["Wav2Vec2BertModel",k1]],["unispeech",["UniSpeechModel",v1]],["unispeech-sat",["UniSpeechSatModel",S1]],["hubert",["HubertModel",M1]],["wavlm",["WavLMModel",R1]],["audio-spectrogram-transformer",["ASTModel",vb]],["vits",["VitsModel",yg]],["detr",["DetrModel",O2]],["table-transformer",["TableTransformerModel",B2]],["vit",["ViTModel",g2]],["fastvit",["FastViTModel",y2]],["mobilevit",["MobileViTModel",$2]],["mobilevitv2",["MobileViTV2Model",S2]],["owlvit",["OwlViTModel",E2]],["owlv2",["Owlv2Model",k2]],["beit",["BeitModel",A2]],["deit",["DeiTModel",F2]],["convnext",["ConvNextModel",t1]],["convnextv2",["ConvNextV2Model",n1]],["dinov2",["Dinov2Model",i1]],["resnet",["ResNetModel",W2]],["swin",["SwinModel",V2]],["swin2sr",["Swin2SRModel",H2]],["donut-swin",["DonutSwinModel",e1]],["yolos",["YolosModel",o1]],["dpt",["DPTModel",j2]],["glpn",["GLPNModel",Q2]],["hifigan",["SpeechT5HifiGan",W1]],["efficientnet",["EfficientNetModel",av]]]),uv=new Map([["t5",["T5Model",Vw]],["longt5",["LongT5Model",Hw]],["mt5",["MT5Model",jw]],["bart",["BartModel",Yw]],["mbart",["MBartModel",Jw]],["marian",["MarianModel",h1]],["whisper",["WhisperModel",xb]],["m2m_100",["M2M100Model",m1]],["blenderbot",["BlenderbotModel",rb]],["blenderbot-small",["BlenderbotSmallModel",ab]]]),lv=new Map([["bloom",["BloomModel",d2]],["gpt2",["GPT2Model",Nb]],["gptj",["GPTJModel",Gb]],["gpt_bigcode",["GPTBigCodeModel",qb]],["gpt_neo",["GPTNeoModel",Lb]],["gpt_neox",["GPTNeoXModel",Ub]],["codegen",["CodeGenModel",Kb]],["llama",["LlamaModel",Xb]],["cohere",["CohereModel",Jb]],["gemma",["GemmaModel",e2]],["openelm",["OpenELMModel",r2]],["qwen2",["Qwen2Model",a2]],["phi",["PhiModel",s2]],["phi3",["Phi3Model",u2]],["mpt",["MptModel",p2]],["opt",["OPTModel",f2]],["mistral",["MistralModel",G1]],["starcoder2",["Starcoder2Model",q1]],["falcon",["FalconModel",K1]],["stablelm",["StableLmModel",rv]]]),xg=new Map([["speecht5",["SpeechT5ForSpeechToText",F1]],["whisper",["WhisperForConditionalGeneration",Sb]]]),dv=new Map([["speecht5",["SpeechT5ForTextToSpeech",L1]]]),cv=new Map([["vits",["VitsModel",yg]],["musicgen",["MusicgenForConditionalGeneration",$g]]]),pv=new Map([["bert",["BertForSequenceClassification",By]],["roformer",["RoFormerForSequenceClassification",Vy]],["electra",["ElectraForSequenceClassification",Zy]],["esm",["EsmForSequenceClassification",Sw]],["convbert",["ConvBertForSequenceClassification",Ky]],["camembert",["CamembertForSequenceClassification",aw]],["deberta",["DebertaForSequenceClassification",lw]],["deberta-v2",["DebertaV2ForSequenceClassification",fw]],["mpnet",["MPNetForSequenceClassification",Ow]],["albert",["AlbertForSequenceClassification",Lw]],["distilbert",["DistilBertForSequenceClassification",yw]],["roberta",["RobertaForSequenceClassification",ub]],["xlm",["XLMForSequenceClassification",hb]],["xlm-roberta",["XLMRobertaForSequenceClassification",yb]],["bart",["BartForSequenceClassification",Qw]],["mbart",["MBartForSequenceClassification",eb]],["mobilebert",["MobileBertForSequenceClassification",kw]],["squeezebert",["SqueezeBertForSequenceClassification",Dw]]]),hv=new Map([["bert",["BertForTokenClassification",Dy]],["roformer",["RoFormerForTokenClassification",Gy]],["electra",["ElectraForTokenClassification",ew]],["esm",["EsmForTokenClassification",Cw]],["convbert",["ConvBertForTokenClassification",Yy]],["camembert",["CamembertForTokenClassification",iw]],["deberta",["DebertaForTokenClassification",dw]],["deberta-v2",["DebertaV2ForTokenClassification",mw]],["mpnet",["MPNetForTokenClassification",zw]],["distilbert",["DistilBertForTokenClassification",ww]],["roberta",["RobertaForTokenClassification",lb]],["xlm",["XLMForTokenClassification",fb]],["xlm-roberta",["XLMRobertaForTokenClassification",wb]]]),Sg=new Map([["t5",["T5ForConditionalGeneration",Gw]],["longt5",["LongT5ForConditionalGeneration",qw]],["mt5",["MT5ForConditionalGeneration",Kw]],["bart",["BartForConditionalGeneration",Xw]],["mbart",["MBartForConditionalGeneration",Zw]],["marian",["MarianMTModel",f1]],["m2m_100",["M2M100ForConditionalGeneration",g1]],["blenderbot",["BlenderbotForConditionalGeneration",nb]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",ib]]]),Cg=new Map([["bloom",["BloomForCausalLM",c2]],["gpt2",["GPT2LMHeadModel",Fb]],["gptj",["GPTJForCausalLM",Hb]],["gpt_bigcode",["GPTBigCodeForCausalLM",jb]],["gpt_neo",["GPTNeoForCausalLM",Wb]],["gpt_neox",["GPTNeoXForCausalLM",Vb]],["codegen",["CodeGenForCausalLM",Yb]],["llama",["LlamaForCausalLM",Qb]],["cohere",["CohereForCausalLM",Zb]],["gemma",["GemmaForCausalLM",t2]],["openelm",["OpenELMForCausalLM",n2]],["qwen2",["Qwen2ForCausalLM",i2]],["phi",["PhiForCausalLM",o2]],["phi3",["Phi3ForCausalLM",l2]],["mpt",["MptForCausalLM",h2]],["opt",["OPTForCausalLM",m2]],["mbart",["MBartForCausalLM",tb]],["mistral",["MistralForCausalLM",H1]],["starcoder2",["Starcoder2ForCausalLM",j1]],["falcon",["FalconForCausalLM",Y1]],["trocr",["TrOCRForCausalLM",V1]],["stablelm",["StableLmForCausalLM",nv]]]),fv=new Map([["bert",["BertForMaskedLM",Py]],["roformer",["RoFormerForMaskedLM",Uy]],["electra",["ElectraForMaskedLM",Jy]],["esm",["EsmForMaskedLM",xw]],["convbert",["ConvBertForMaskedLM",jy]],["camembert",["CamembertForMaskedLM",nw]],["deberta",["DebertaForMaskedLM",uw]],["deberta-v2",["DebertaV2ForMaskedLM",hw]],["mpnet",["MPNetForMaskedLM",Mw]],["albert",["AlbertForMaskedLM",Uw]],["distilbert",["DistilBertForMaskedLM",vw]],["roberta",["RobertaForMaskedLM",ob]],["xlm",["XLMWithLMHeadModel",pb]],["xlm-roberta",["XLMRobertaForMaskedLM",_b$1]],["mobilebert",["MobileBertForMaskedLM",Tw]],["squeezebert",["SqueezeBertForMaskedLM",Bw]]]),mv=new Map([["bert",["BertForQuestionAnswering",Ny]],["roformer",["RoFormerForQuestionAnswering",Hy]],["electra",["ElectraForQuestionAnswering",tw]],["convbert",["ConvBertForQuestionAnswering",Xy]],["camembert",["CamembertForQuestionAnswering",sw]],["deberta",["DebertaForQuestionAnswering",cw]],["deberta-v2",["DebertaV2ForQuestionAnswering",gw]],["mpnet",["MPNetForQuestionAnswering",Rw]],["albert",["AlbertForQuestionAnswering",Ww]],["distilbert",["DistilBertForQuestionAnswering",bw]],["roberta",["RobertaForQuestionAnswering",db]],["xlm",["XLMForQuestionAnswering",mb]],["xlm-roberta",["XLMRobertaForQuestionAnswering",bb]],["mobilebert",["MobileBertForQuestionAnswering",Iw]],["squeezebert",["SqueezeBertForQuestionAnswering",Nw]]]),Eg=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",Cb]]]),gv=new Map([["llava",["LlavaForConditionalGeneration",km]],["moondream1",["Moondream1ForConditionalGeneration",Tb]]]),_v=new Map([["vit",["ViTForImageClassification",_2]],["fastvit",["FastViTForImageClassification",w2]],["mobilevit",["MobileViTForImageClassification",x2]],["mobilevitv2",["MobileViTV2ForImageClassification",C2]],["beit",["BeitForImageClassification",M2]],["deit",["DeiTForImageClassification",L2]],["convnext",["ConvNextForImageClassification",r1]],["convnextv2",["ConvNextV2ForImageClassification",a1]],["dinov2",["Dinov2ForImageClassification",s1]],["resnet",["ResNetForImageClassification",U2]],["swin",["SwinForImageClassification",G2]],["segformer",["SegformerForImageClassification",ev]],["efficientnet",["EfficientNetForImageClassification",iv]]]),yv=new Map([["detr",["DetrForObjectDetection",z2]],["table-transformer",["TableTransformerForObjectDetection",D2]],["yolos",["YolosForObjectDetection",u1]]]),wv=new Map([["owlvit",["OwlViTForObjectDetection",T2]],["owlv2",["Owlv2ForObjectDetection",I2]]]),bv=new Map([["detr",["DetrForSegmentation",R2]],["clipseg",["CLIPSegForImageSegmentation",Db]]]),vv=new Map([["segformer",["SegformerForSemanticSegmentation",tv]]]),$v=new Map([["sam",["SamModel",c1]]]),xv=new Map([["wav2vec2",["Wav2Vec2ForCTC",y1]],["wav2vec2-bert",["Wav2Vec2BertForCTC",I1]],["unispeech",["UniSpeechForCTC",$1]],["unispeech-sat",["UniSpeechSatForCTC",C1]],["wavlm",["WavLMForCTC",P1]],["hubert",["HubertForCTC",O1]]]),Sv=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",w1]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",A1]],["unispeech",["UniSpeechForSequenceClassification",x1]],["unispeech-sat",["UniSpeechSatForSequenceClassification",E1]],["wavlm",["WavLMForSequenceClassification",B1]],["hubert",["HubertForSequenceClassification",z1]],["audio-spectrogram-transformer",["ASTForAudioClassification",$b]]]),Cv=new Map([["wavlm",["WavLMForXVector",D1]]]),Ev=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",T1]],["wavlm",["WavLMForAudioFrameClassification",N1]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",b1]]]),Tv=new Map([["vitmatte",["VitMatteForImageMatting",v2]]]),kv=new Map([["swin2sr",["Swin2SRForImageSuperResolution",q2]]]),Iv=new Map([["dpt",["DPTForDepthEstimation",K2]],["depth_anything",["DepthAnythingForDepthEstimation",X2]],["glpn",["GLPNForDepthEstimation",J2]]]),Av=new Map([["clip",["CLIPVisionModelWithProjection",Ab]],["siglip",["SiglipVisionModel",zb]]]),Tg=[[ov,be$2.EncoderOnly],[uv,be$2.EncoderDecoder],[lv,be$2.DecoderOnly],[pv,be$2.EncoderOnly],[hv,be$2.EncoderOnly],[Sg,be$2.Seq2Seq],[xg,be$2.Seq2Seq],[Cg,be$2.DecoderOnly],[fv,be$2.EncoderOnly],[mv,be$2.EncoderOnly],[Eg,be$2.Vision2Seq],[gv,be$2.ImageTextToText],[_v,be$2.EncoderOnly],[bv,be$2.EncoderOnly],[vv,be$2.EncoderOnly],[Tv,be$2.EncoderOnly],[kv,be$2.EncoderOnly],[Iv,be$2.EncoderOnly],[yv,be$2.EncoderOnly],[wv,be$2.EncoderOnly],[$v,be$2.MaskGeneration],[xv,be$2.EncoderOnly],[Sv,be$2.EncoderOnly],[dv,be$2.Seq2Seq],[cv,be$2.EncoderOnly],[Cv,be$2.EncoderOnly],[Ev,be$2.EncoderOnly],[Av,be$2.EncoderOnly]];for(const[t,e]of Tg)for(const[r,n]of t.values())wi$1.set(r,e),qn$2.set(n,r),_m.set(r,n);const Mv=[["MusicgenForConditionalGeneration",$g,be$2.Musicgen],["CLIPTextModelWithProjection",Ib,be$2.EncoderOnly],["SiglipTextModel",Ob,be$2.EncoderOnly],["ClapTextModelWithProjection",Q1,be$2.EncoderOnly],["ClapAudioModelWithProjection",J1,be$2.EncoderOnly]];for(const[t,e,r]of Mv)wi$1.set(t,r),qn$2.set(e,t),_m.set(t,e);class Ov extends sv{static MODEL_CLASS_MAPPINGS=Tg.map(e=>e[0]);static BASE_IF_FAIL=true}let Ae$2 = class Ae extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};class zv extends Ot$2{constructor({logits:e,embeddings:r}){super(),this.logits=e,this.embeddings=r;}}let lt$2 = class lt extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};let dt$2 = class dt extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};let mt$2 = class mt extends Ot$2{constructor({start_logits:e,end_logits:r}){super(),this.start_logits=e,this.end_logits=r;}};let gn$2 = class gn extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};class Rv extends Ot$2{constructor({alphas:e}){super(),this.alphas=e;}}class Pv extends Ot$2{constructor({waveform:e,spectrogram:r}){super(),this.waveform=e,this.spectrogram=r;}}const It$2=typeof self<"u",Bv=It$2&&self.constructor.name==="DedicatedWorkerGlobalScope";let kr$2,kg,fr$2;if(It$2)kr$2=(t,e)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(t,e)},fr$2=self.createImageBitmap,kg=self.ImageData;else if(Ye$2)fr$2=async t=>{const r=(await t.metadata()).channels,{data:n,info:i}=await t.rotate().raw().toBuffer({resolveWithObject:true}),a=new Vt$2(new Uint8ClampedArray(n),i.width,i.height,i.channels);return r!==void 0&&r!==i.channels&&a.convert(r),a};else throw new Error("Unable to load image processing library.");const Dv={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},Nv=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);let Vt$2 = class Vt{constructor(e,r,n,i){this.data=e,this.width=r,this.height=n,this.channels=i;}get size(){return [this.width,this.height]}static async read(e){if(e instanceof Vt)return e;if(typeof e=="string"||e instanceof URL)return await this.fromURL(e);throw new Error(`Unsupported input type: ${typeof e}`)}static fromCanvas(e){if(!It$2)throw new Error("fromCanvas() is only supported in browser environments.");const n=e.getContext("2d").getImageData(0,0,e.width,e.height).data;return new Vt(n,e.width,e.height,4)}static async fromURL(e){const r=await Rs$2(e);if(r.status!==200)throw new Error(`Unable to read image from "${e}" (${r.status} ${r.statusText})`);const n=await r.blob();return this.fromBlob(n)}static async fromBlob(e){if(It$2){const r=await fr$2(e),n=kr$2(r.width,r.height).getContext("2d");return n.drawImage(r,0,0),new this(n.getImageData(0,0,r.width,r.height).data,r.width,r.height,4)}else {const r=Ye$2(await e.arrayBuffer());return await fr$2(r)}}static fromTensor(e,r="CHW"){if(e.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${e.dims.length} dimensions.`);if(r==="CHW")e=e.transpose(1,2,0);else if(r!=="HWC")throw new Error(`Unsupported channel format: ${r}`);if(!(e.data instanceof Uint8ClampedArray||e.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${e.type}`);switch(e.dims[2]){case 1:case 2:case 3:case 4:return new Vt(e.data,e.dims[1],e.dims[0],e.dims[2]);default:throw new Error(`Unsupported number of channels: ${e.dims[2]}`)}}grayscale(){if(this.channels===1)return this;const e=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let r=0,n=0;r<this.data.length;r+=this.channels){const i=this.data[r],a=this.data[r+1],s=this.data[r+2];e[n++]=Math.round(.2989*i+.587*a+.114*s);}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,1)}rgb(){if(this.channels===3)return this;const e=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let r=0,n=0;r<this.data.length;++r)e[n++]=this.data[r],e[n++]=this.data[r],e[n++]=this.data[r];break;case 4:for(let r=0,n=0;r<this.data.length;r+=4)e[n++]=this.data[r],e[n++]=this.data[r+1],e[n++]=this.data[r+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,3)}rgba(){if(this.channels===4)return this;const e=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let r=0,n=0;r<this.data.length;++r)e[n++]=this.data[r],e[n++]=this.data[r],e[n++]=this.data[r],e[n++]=255;break;case 3:for(let r=0,n=0;r<this.data.length;r+=3)e[n++]=this.data[r],e[n++]=this.data[r+1],e[n++]=this.data[r+2],e[n++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,4)}async resize(e,r,{resample:n=2}={}){let i=Dv[n]??n;if(It$2){const a=this.channels,s=this.toCanvas(),o=kr$2(e,r).getContext("2d");return o.drawImage(s,0,0,e,r),new Vt(o.getImageData(0,0,e,r).data,e,r,4).convert(a)}else {let a=this.toSharp();switch(i){case "box":case "hamming":(i==="box"||i==="hamming")&&(console.warn(`Resampling method ${i} is not yet supported. Using bilinear instead.`),i="bilinear");case "nearest":case "bilinear":case "bicubic":a=a.affine([e/this.width,0,0,r/this.height],{interpolator:i});break;case "lanczos":a=a.resize({width:e,height:r,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${i} is not supported.`)}return await fr$2(a)}}async pad([e,r,n,i]){if(e=Math.max(e,0),r=Math.max(r,0),n=Math.max(n,0),i=Math.max(i,0),e===0&&r===0&&n===0&&i===0)return this;if(It$2){const a=this.channels,s=this.toCanvas(),o=this.width+e+r,u=this.height+n+i,l=kr$2(o,u).getContext("2d");return l.drawImage(s,0,0,this.width,this.height,e,n,o,u),new Vt(l.getImageData(0,0,o,u).data,o,u,4).convert(a)}else {const a=this.toSharp().extend({left:e,right:r,top:n,bottom:i});return await fr$2(a)}}async crop([e,r,n,i]){if(e=Math.max(e,0),r=Math.max(r,0),n=Math.min(n,this.width-1),i=Math.min(i,this.height-1),e===0&&r===0&&n===this.width-1&&i===this.height-1)return this;const a=n-e+1,s=i-r+1;if(It$2){const o=this.channels,u=this.toCanvas(),l=kr$2(a,s).getContext("2d");return l.drawImage(u,e,r,a,s,0,0,a,s),new Vt(l.getImageData(0,0,a,s).data,a,s,4).convert(o)}else {const o=this.toSharp().extract({left:e,top:r,width:a,height:s});return await fr$2(o)}}async center_crop(e,r){if(this.width===e&&this.height===r)return this;const n=(this.width-e)/2,i=(this.height-r)/2;if(It$2){const a=this.channels,s=this.toCanvas(),o=kr$2(e,r).getContext("2d");let u=0,l=0,h=0,f=0;return n>=0?u=n:h=-n,i>=0?l=i:f=-i,o.drawImage(s,u,l,e,r,h,f,e,r),new Vt(o.getImageData(0,0,e,r).data,e,r,4).convert(a)}else {let a=this.toSharp();if(n>=0&&i>=0)a=a.extract({left:Math.floor(n),top:Math.floor(i),width:e,height:r});else if(n<=0&&i<=0){const s=Math.floor(-i),o=Math.floor(-n);a=a.extend({top:s,left:o,right:e-this.width-o,bottom:r-this.height-s});}else {let s=[0,0],o=0;i<0?(s[0]=Math.floor(-i),s[1]=r-this.height-s[0]):o=Math.floor(i);let u=[0,0],l=0;n<0?(u[0]=Math.floor(-n),u[1]=e-this.width-u[0]):l=Math.floor(n),a=a.extend({top:s[0],bottom:s[1],left:u[0],right:u[1]}).extract({left:l,top:o,width:e,height:r});}return await fr$2(a)}}async toBlob(e="image/png",r=1){if(!It$2)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:e,quality:r})}toTensor(e="CHW"){let r=new ce$2("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(e!=="HWC")if(e==="CHW")r=r.permute(2,0,1);else throw new Error(`Unsupported channel format: ${e}`);return r}toCanvas(){if(!It$2)throw new Error("toCanvas() is only supported in browser environments.");const e=this.clone().rgba(),r=kr$2(e.width,e.height),n=new kg(e.data,e.width,e.height);return r.getContext("2d").putImageData(n,0,0),r}_update(e,r,n,i=null){return this.data=e,this.width=r,this.height=n,i!==null&&(this.channels=i),this}clone(){return new Vt(this.data.slice(),this.width,this.height,this.channels)}convert(e){if(this.channels===e)return this;switch(e){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(e){if(It$2){if(Bv)throw new Error("Unable to save an image from a Web Worker.");const r=e.split(".").pop().toLowerCase(),n=Nv.get(r)??"image/png",i=await this.toBlob(n),a=URL.createObjectURL(i),s=document.createElement("a");s.href=a,s.download=e,s.click(),s.remove();}else {if(bt$2.useFS)return await this.toSharp().toFile(e);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(It$2)throw new Error("toSharp() is only supported in server-side environments.");return Ye$2(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}};function Tc$1(t){if(t<1)return new Float64Array;if(t===1)return new Float64Array([1]);const e=t-1,r=Math.PI/e,n=new Float64Array(t);for(let i=0;i<t;++i){const a=2*i-e;n[i]=.5+.5*Math.cos(r*a);}return n}const Fv={htk:t=>2595*Math.log10(1+t/700),kaldi:t=>1127*Math.log(1+t/700),slaney:(t,e=1e3,r=15,n=27/Math.log(6.4))=>t>=e?r+Math.log(t/e)*n:3*t/200};function Is$2(t,e="htk"){const r=Fv[e];if(!r)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof t=="number"?r(t):t.map(n=>r(n))}const Lv={htk:t=>700*(10**(t/2595)-1),kaldi:t=>700*(Math.exp(t/1127)-1),slaney:(t,e=1e3,r=15,n=Math.log(6.4)/27)=>t>=r?e*Math.exp(n*(t-r)):200*t/3};function Wv(t,e="htk"){const r=Lv[e];if(!r)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof t=="number"?r(t):t.map(n=>r(n))}function Uv(t,e){const r=Float64Array.from({length:e.length-1},(s,o)=>e[o+1]-e[o]),n=Array.from({length:t.length},()=>new Array(e.length));for(let s=0;s<t.length;++s){const o=n[s];for(let u=0;u<e.length;++u)o[u]=e[u]-t[s];}const i=e.length-2,a=Array.from({length:i},()=>new Array(t.length));for(let s=0;s<t.length;++s){const o=n[s];for(let u=0;u<i;++u){const l=-o[u]/r[u],h=o[u+2]/r[u+1];a[u][s]=Math.max(0,Math.min(l,h));}}return a}function kc$1(t,e,r){const n=(e-t)/(r-1);return Float64Array.from({length:r},(i,a)=>t+n*a)}function Zn$2(t,e,r,n,i,a=null,s="htk",o=false){if(a!==null&&a!=="slaney")throw new Error('norm must be one of null or "slaney"');const u=Is$2(r,s),l=Is$2(n,s),h=kc$1(u,l,e+2);let f=Wv(h,s),m;if(o){const y=i/(t*2);m=Is$2(Float64Array.from({length:t},(b,v)=>v*y),s),f=h;}else m=kc$1(0,Math.floor(i/2),t);const c=Uv(m,f);if(a!==null&&a==="slaney")for(let y=0;y<e;++y){const b=c[y],v=2/(f[y+2]-f[y]);for(let C=0;C<t;++C)b[C]*=v;}return c}function Vv(t,e,r){const n=new t.constructor(t.length+e+r),i=t.length-1;for(let a=0;a<t.length;++a)n[e+a]=t[a];for(let a=1;a<=e;++a)n[e-a]=t[oi$2(a,i)];for(let a=1;a<=r;++a)n[i+e+a]=t[oi$2(i-a,i)];return n}function Ig(t,e,r,n,i){if(r<=0)throw new Error("reference must be greater than zero");if(n<=0)throw new Error("min_value must be greater than zero");r=Math.max(n,r);const a=Math.log10(r);for(let s=0;s<t.length;++s)t[s]=e*Math.log10(Math.max(n,t[s])-a);if(i!==null){if(i<=0)throw new Error("db_range must be greater than zero");const s=_r$2(t)[0]-i;for(let o=0;o<t.length;++o)t[o]=Math.max(t[o],s);}return t}function Gv(t,e=1,r=1e-5,n=null){return Ig(t,20,e,r,n)}function Hv(t,e=1,r=1e-10,n=null){return Ig(t,10,e,r,n)}async function Oi$1(t,e,r,n,{fft_length:i=null,power:a=1,center:s=true,pad_mode:o="reflect",onesided:u=true,preemphasis:l=null,mel_filters:h=null,mel_floor:f=1e-10,log_mel:m=null,reference:c=1,min_value:y=1e-10,db_range:b=null,remove_dc_offset:v=null,max_num_frames:C=null,do_pad:x=true,transpose:T=false}={}){const I=e.length;if(i===null&&(i=r),r>i)throw Error(`frame_length (${r}) may not be larger than fft_length (${i})`);if(I!==r)throw new Error(`Length of the window (${I}) must equal frame_length (${r})`);if(n<=0)throw new Error("hop_length must be greater than zero");if(a===null&&h!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(s){if(o!=="reflect")throw new Error(`pad_mode="${o}" not implemented yet.`);const U=Math.floor((i-1)/2)+1;t=Vv(t,U,U);}const A=Math.floor(1+Math.floor((t.length-r)/n)),R=u?Math.floor(i/2)+1:i;let z=A,P=A;C!==null&&(C>A?x&&(P=C):P=z=C);const J=new d0(i),K=new Float64Array(i),ue=new Float64Array(J.outputBufferSize),ie=new Float32Array(R*P);for(let U=0;U<z;++U){const de=U*n;for(let re=0;re<r;++re)K[re]=t[de+re];if(v){let re=0;for(let Z=0;Z<r;++Z)re+=K[Z];const Q=re/r;for(let Z=0;Z<r;++Z)K[Z]-=Q;}if(l!==null){for(let re=r-1;re>=1;--re)K[re]-=l*K[re-1];K[0]*=1-l;}for(let re=0;re<e.length;++re)K[re]*=e[re];J.realTransform(ue,K);for(let re=0;re<R;++re){const Q=re<<1;ie[re*P+U]=ue[Q]**2+ue[Q+1]**2;}}if(a!==null&&a!==2){const U=2/a;for(let de=0;de<ie.length;++de)ie[de]**=U;}const ge=h.length;let he=await Y_(new ce$2("float32",h.flat(),[ge,R]),new ce$2("float32",ie,[R,P]));T&&(he=he.transpose(1,0));const D=he.data;for(let U=0;U<D.length;++U)D[U]=Math.max(f,D[U]);if(a!==null&&m!==null){const U=Math.min(D.length,z*ge);switch(m){case "log":for(let de=0;de<U;++de)D[de]=Math.log(D[de]);break;case "log10":for(let de=0;de<U;++de)D[de]=Math.log10(D[de]);break;case "dB":if(a===1)Gv(D,c,y,b);else if(a===2)Hv(D,c,y,b);else throw new Error(`Cannot use log_mel option '${m}' with power ${a}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${m}'`)}}return he}function zi$2(t,e,{periodic:r=true,frame_length:n=null,center:i=true}={}){const a=r?t+1:t;let s;switch(e){case "boxcar":s=new Float64Array(a).fill(1);break;case "hann":case "hann_window":s=Tc$1(a);break;case "povey":s=Tc$1(a).map(o=>Math.pow(o,.85));break;default:throw new Error(`Unknown window type ${e}.`)}if(r&&(s=s.subarray(0,t)),n===null)return s;if(t>n)throw new Error(`Length of the window (${t}) may not be larger than frame_length (${n})`);return s}function qv([t,e,r,n]){return [t-r/2,e-n/2,t+r/2,e+n/2]}function Ro$2(t,e=.5,r=null,n=false){const i=t.logits,a=t.pred_boxes,[s,o,u]=i.dims;if(r!==null&&r.length!==s)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let l=[];for(let h=0;h<s;++h){let f=r!==null?r[h]:null,m={boxes:[],classes:[],scores:[]},c=i[h],y=a[h];for(let b=0;b<o;++b){let v=c[b],C=[],x;if(n){x=v.sigmoid().data;for(let T=0;T<x.length;++T)x[T]>e&&C.push(T);}else {let T=_r$2(v.data)[1];if(T===u-1||(x=ta$2(v.data),x[T]<e))continue;C.push(T);}for(const T of C){let I=y[b].data;I=qv(I),f!==null&&(I=I.map((A,R)=>A*f[(R+1)%2])),m.boxes.push(I),m.classes.push(T),m.scores.push(x[T]);}}l.push(m);}return l}function ya$2(t,e){if(!(t instanceof Float32Array||t instanceof Float64Array))throw new Error(`${e} expects input to be a Float32Array or a Float64Array, but got ${t?.constructor?.name??typeof t} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}function Ic$1(t,e,r=0,n=null){const i=t/e;let a=p0(i)*e;return n!==null&&a>n&&(a=Math.floor(i)*e),a<r&&(a=Math.ceil(i)*e),a}function As$2([t,e],r){return [Math.max(Math.floor(t/r),1)*r,Math.max(Math.floor(e/r),1)*r]}let Vr$2 = class Vr extends or$2{constructor(e){super(),this.config=e;}};let je$2 = class je extends Vr$2{constructor(e){super(e),this.image_mean=this.config.image_mean??this.config.mean,this.image_std=this.config.image_std??this.config.std,this.resample=this.config.resample??2,this.do_rescale=this.config.do_rescale??true,this.rescale_factor=this.config.rescale_factor??1/255,this.do_normalize=this.config.do_normalize,this.do_resize=this.config.do_resize,this.do_thumbnail=this.config.do_thumbnail,this.size=this.config.size,this.size_divisibility=this.config.size_divisibility??this.config.size_divisor,this.do_center_crop=this.config.do_center_crop,this.crop_size=this.config.crop_size,this.do_convert_rgb=this.config.do_convert_rgb??true,this.do_crop_margin=this.config.do_crop_margin,this.pad_size=this.config.pad_size,this.do_pad=this.config.do_pad,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=this.config.do_flip_channel_order??false;}async thumbnail(e,r,n=2){const i=e.height,a=e.width,s=r.height,o=r.width;let u=Math.min(i,s),l=Math.min(a,o);return u===i&&l===a?e:(i>a?l=Math.floor(a*u/i):a>i&&(u=Math.floor(i*l/a)),await e.resize(l,u,{resample:n}))}async crop_margin(e,r=200){const n=e.clone().grayscale(),i=u0(n.data)[0],s=_r$2(n.data)[0]-i;if(s===0)return e;const o=r/255;let u=n.width,l=n.height,h=0,f=0;const m=n.data;for(let c=0;c<n.height;++c){const y=c*n.width;for(let b=0;b<n.width;++b)(m[y+b]-i)/s<o&&(u=Math.min(u,b),l=Math.min(l,c),h=Math.max(h,b),f=Math.max(f,c));}return e=await e.crop([u,l,h,f]),e}pad_image(e,r,n,{mode:i="constant",center:a=false,constant_values:s=0}={}){const[o,u,l]=r;let h,f;if(typeof n=="number"?(h=n,f=n):(h=n.width,f=n.height),h!==u||f!==o){const m=new Float32Array(h*f*l);if(Array.isArray(s))for(let b=0;b<m.length;++b)m[b]=s[b%l];else s!==0&&m.fill(s);const[c,y]=a?[Math.floor((h-u)/2),Math.floor((f-o)/2)]:[0,0];for(let b=0;b<o;++b){const v=(b+y)*h,C=b*u;for(let x=0;x<u;++x){const T=(v+x+c)*l,I=(C+x)*l;for(let A=0;A<l;++A)m[T+A]=e[I+A];}}if(i==="symmetric"){if(a)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const b=o-1,v=u-1;for(let C=0;C<f;++C){const x=C*h,T=oi$2(C,b)*u;for(let I=0;I<h;++I){if(C<o&&I<u)continue;const A=(x+I)*l,R=(T+oi$2(I,v))*l;for(let z=0;z<l;++z)m[A+z]=e[R+z];}}}e=m,r=[f,h,l];}return [e,r]}rescale(e){for(let r=0;r<e.length;++r)e[r]=this.rescale_factor*e[r];}get_resize_output_image_size(e,r){const[n,i]=e.size;let a,s;if(this.do_thumbnail){const{height:o,width:u}=r;a=Math.min(o,u);}else Number.isInteger(r)?(a=r,s=this.config.max_size??a):r!==void 0&&(a=r.shortest_edge,s=r.longest_edge);if(a!==void 0||s!==void 0){const o=a===void 0?1:Math.max(a/n,a/i),u=n*o,l=i*o,h=s===void 0?1:Math.min(s/u,s/l);let f=Math.floor(Number((u*h).toFixed(2))),m=Math.floor(Number((l*h).toFixed(2)));return this.size_divisibility!==void 0&&([f,m]=As$2([f,m],this.size_divisibility)),[f,m]}else if(r!==void 0&&r.width!==void 0&&r.height!==void 0){let o=r.width,u=r.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let l=u/i,h=o/n;Math.abs(1-h)<Math.abs(1-l)?l=h:h=l,u=Ic$1(l*i,this.config.ensure_multiple_of),o=Ic$1(h*n,this.config.ensure_multiple_of);}return [o,u]}else {if(this.size_divisibility!==void 0)return As$2([n,i],this.size_divisibility);throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(r)}`)}}async resize(e){const[r,n]=this.get_resize_output_image_size(e,this.size);return await e.resize(r,n,{resample:this.resample})}async preprocess(e,{do_normalize:r=null,do_pad:n=null,do_convert_rgb:i=null,do_convert_grayscale:a=null,do_flip_channel_order:s=null}={}){this.do_crop_margin&&(e=await this.crop_margin(e));const[o,u]=e.size;if(i??this.do_convert_rgb?e=e.rgb():a&&(e=e.grayscale()),this.do_resize&&(e=await this.resize(e)),this.do_thumbnail&&(e=await this.thumbnail(e,this.size,this.resample)),this.do_center_crop){let c,y;Number.isInteger(this.crop_size)?(c=this.crop_size,y=this.crop_size):(c=this.crop_size.width,y=this.crop_size.height),e=await e.center_crop(c,y);}const l=[e.height,e.width];let h=Float32Array.from(e.data),f=[e.height,e.width,e.channels];if(this.do_rescale&&this.rescale(h),r??this.do_normalize){let c=this.image_mean;Array.isArray(this.image_mean)||(c=new Array(e.channels).fill(c));let y=this.image_std;if(Array.isArray(this.image_std)||(y=new Array(e.channels).fill(c)),c.length!==e.channels||y.length!==e.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${c.length}) and \`image_std\` (${y.length}) must match the number of channels in the image (${e.channels}).`);for(let b=0;b<h.length;b+=e.channels)for(let v=0;v<e.channels;++v)h[b+v]=(h[b+v]-c[v])/y[v];}if(n??this.do_pad){if(this.pad_size)[h,f]=this.pad_image(h,[e.height,e.width,e.channels],this.pad_size);else if(this.size_divisibility){const[c,y]=As$2([f[1],f[0]],this.size_divisibility);[h,f]=this.pad_image(h,f,{width:c,height:y});}}if(s??this.do_flip_channel_order){if(f[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let c=0;c<h.length;c+=3){const y=h[c];h[c]=h[c+2],h[c+2]=y;}}const m=new ce$2("float32",h,f).permute(2,0,1);return {original_size:[u,o],reshaped_input_size:l,pixel_values:m}}async _call(e,...r){Array.isArray(e)||(e=[e]);const n=await Promise.all(e.map(a=>this.preprocess(a)));return {pixel_values:Qn$2(n.map(a=>a.pixel_values),0),original_sizes:n.map(a=>a.original_size),reshaped_input_sizes:n.map(a=>a.reshaped_input_size)}}};class jv extends je$2{post_process_semantic_segmentation(e,r=null){const n=e.logits,i=n.dims[0];if(r!==null&&r.length!==i)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const a=[];for(let s=0;s<i;++s){const o=r!==null?r[s]:null;let u=n[s];o!==null&&(u=cm(u,o,"bilinear",false));const[l,h]=o??u.dims.slice(-2),f=new ce$2("int32",new Int32Array(l*h),[l,h]),m=u[0].data,c=f.data;for(let C=1;C<u.dims[0];++C){const x=u[C].data;for(let T=0;T<x.length;++T)x[T]>m[T]&&(m[T]=x[T],c[T]=C);}const y=new Array(u.dims[0]),b=f.data;for(let C=0;C<b.length;++C){const x=b[C];y[x]=x;}const v=y.filter(C=>C!==void 0);a.push({segmentation:f,labels:v});}return a}}class Ag extends je$2{}class Kv extends Ag{}class Yv extends je$2{}class Xv extends je$2{}class Mg extends je$2{}class Qv extends Mg{}class Jv extends je$2{}class Zv extends je$2{}class Og extends je$2{constructor(e){super(e),this.crop_pct=this.config.crop_pct??224/256;}async resize(e){const r=this.size?.shortest_edge;if(r===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(r<384){const n=Math.floor(r/this.crop_pct),[i,a]=this.get_resize_output_image_size(e,{shortest_edge:n});e=await e.resize(i,a,{resample:this.resample}),e=await e.center_crop(r,r);}else e=await e.resize(r,r,{resample:this.resample});return e}}class e$ extends Og{}class t$ extends je$2{}class r$ extends je$2{}class n$ extends je$2{constructor(e){super(e),this.include_top=this.config.include_top??true,this.include_top&&(this.image_std=this.image_std.map(r=>r*r));}}class zg extends je$2{}class a$ extends zg{}class Rg extends je$2{post_process_object_detection(...e){return Ro$2(...e)}}class i$ extends Rg{}class s$ extends je$2{}class o$ extends je$2{}class Pg extends je$2{pad_image(e,r,n,i={}){const[a,s,o]=r;let u=this.image_mean;Array.isArray(this.image_mean)||(u=new Array(o).fill(u));let l=this.image_std;Array.isArray(l)||(l=new Array(o).fill(u));const h=u.map((f,m)=>-f/l[m]);return super.pad_image(e,r,n,{center:true,constant_values:h,...i})}}class u$ extends Pg{}class l$ extends je$2{async _call(e){const r=await super._call(e),n=[r.pixel_values.dims[0],64,64],i=new ce$2("int64",new BigInt64Array(n.reduce((a,s)=>a*s)).fill(1n),n);return {...r,pixel_mask:i}}post_process_object_detection(...e){return Ro$2(...e)}remove_low_and_no_objects(e,r,n,i){let a=[],s=[],o=[];for(let u=0;u<e.dims[0];++u){let l=e[u],h=r[u],f=_r$2(l.data)[1];if(f===i)continue;let c=ta$2(l.data)[f];c>n&&(a.push(h),s.push(c),o.push(f));}return [a,s,o]}check_segment_validity(e,r,n,i=.5,a=.8){let s=[],o=0,u=0;const l=r[n].data;for(let f=0;f<e.length;++f)e[f]===n&&(s.push(f),++o),l[f]>=i&&++u;let h=o>0&&u>0;return h&&(h=o/u>a),[h,s]}compute_segments(e,r,n,i,a,s=null,o=null){let[u,l]=o??e[0].dims,h=new ce$2("int32",new Int32Array(u*l),[u,l]),f=[];if(o!==null)for(let v=0;v<e.length;++v)e[v]=cm(e[v],o,"bilinear",false);let m=new Int32Array(e[0].data.length),c=new Float32Array(e[0].data.length);for(let v=0;v<e.length;++v){let C=r[v];const x=e[v].data;for(let T=0;T<x.length;++T)x[T]*=C,x[T]>c[T]&&(m[T]=v,c[T]=x[T]);}let y=0;const b=h.data;for(let v=0;v<n.length;++v){let C=n[v],[x,T]=this.check_segment_validity(m,e,v,i,a);if(x){++y;for(let I of T)b[I]=y;f.push({id:y,label_id:C,score:r[v]});}}return [h,f]}post_process_panoptic_segmentation(e,r=.5,n=.5,i=.8,a=null,s=null){a===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),a=new Set);const o=e.logits,l=e.pred_masks.sigmoid();let[h,f,m]=o.dims;if(m-=1,s!==null&&s.length!==h)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let c=[];for(let y=0;y<h;++y){let b=s!==null?s[y]:null,v=o[y],C=l[y],[x,T,I]=this.remove_low_and_no_objects(v,C,r,m);if(I.length===0){let[z,P]=b??C.dims.slice(-2),J=new ce$2("int32",new Int32Array(z*P).fill(-1),[z,P]);c.push({segmentation:J,segments_info:[]});continue}let[A,R]=this.compute_segments(x,T,I,n,i,a,b);c.push({segmentation:A,segments_info:R});}return c}post_process_instance_segmentation(){throw Error("Not implemented yet")}}class d$ extends je$2{post_process_object_detection(...e){return Ro$2(...e)}}class c$ extends je$2{reshape_input_points(e,r,n,i=false){e=structuredClone(e);let a=cu(e);if(a.length===3)i||(a=[1,...a]),e=[e];else if(a.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let s=0;s<e.length;++s){let o=r[s],u=n[s],l=[u[0]/o[0],u[1]/o[1]];for(let h=0;h<e[s].length;++h)for(let f=0;f<e[s][h].length;++f)for(let m=0;m<e[s][h][f].length;++m)e[s][h][f][m]*=l[m%2];}return new ce$2("float32",Float32Array.from(e.flat(1/0)),a)}add_input_labels(e,r){let n=cu(e);if(n.length===2)n=[1,...n],e=[e];else if(n.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(n.some((i,a)=>i!==r.dims[a]))throw Error(`The first ${n.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new ce$2("int64",e.flat(1/0).map(BigInt),n)}async _call(e,{input_points:r=null,input_labels:n=null,input_boxes:i=null}={}){const a=await super._call(e);if(r&&(a.input_points=this.reshape_input_points(r,a.original_sizes,a.reshaped_input_sizes)),n){if(!a.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");a.input_labels=this.add_input_labels(n,a.input_points);}return i&&(a.input_boxes=this.reshape_input_points(i,a.original_sizes,a.reshaped_input_sizes,true)),a}async post_process_masks(e,r,n,{mask_threshold:i=0,binarize:a=true,pad_size:s=null}={}){const o=[];s=s??this.pad_size;const u=[s.height,s.width];for(let l=0;l<r.length;++l){const h=r[l],f=n[l];let m=await vc$2(e[l],{mode:"bilinear",size:u});if(m=m.slice(null,null,[0,f[0]],[0,f[1]]),m=await vc$2(m,{mode:"bilinear",size:h}),a){const c=m.data,y=new Uint8Array(c.length);for(let b=0;b<c.length;++b)c[b]>i&&(y[b]=1);m=new ce$2("bool",y,m.dims);}o.push(m);}return o}generate_crop_boxes(e,r,{crop_n_layers:n=0,overlap_ratio:i=512/1500,points_per_crop:a=32,crop_n_points_downscale_factor:s=1}={}){}}class p$ extends je$2{pad_image(e,r,n,i={}){const[a,s,o]=r;return super.pad_image(e,r,{width:s+(n-s%n)%n,height:a+(n-a%n)%n},{mode:"symmetric",center:false,constant_values:-1,...i})}}class h$ extends je$2{async _call(e,r){Array.isArray(e)||(e=[e]),Array.isArray(r)||(r=[r]);const n=await Promise.all(e.map(s=>this.preprocess(s))),i=await Promise.all(r.map(s=>this.preprocess(s,{do_normalize:false,do_convert_rgb:false,do_convert_grayscale:true})));return {pixel_values:Qn$2(n.map((s,o)=>Jt$2([s.pixel_values,i[o].pixel_values],0)),0),original_sizes:n.map(s=>s.original_size),reshaped_input_sizes:n.map(s=>s.reshaped_input_size)}}}class f$ extends Vr$2{constructor(e){super(e),this.config.mel_filters??=Zn$2(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney"),this.window=zi$2(this.config.n_fft,"hann");}async _extract_fbank_features(e){const r=await Oi$1(e,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:this.config.nb_max_frames}),n=r.data,i=_r$2(n)[0];for(let a=0;a<n.length;++a)n[a]=(Math.max(n[a],i-8)+4)/4;return r}async _call(e){ya$2(e,"WhisperFeatureExtractor");let r;return e.length>this.config.n_samples?(console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),r=e.slice(0,this.config.n_samples)):(r=new Float32Array(this.config.n_samples),r.set(e)),{input_features:(await this._extract_fbank_features(r)).unsqueeze_(0)}}}class m$ extends Vr$2{_zero_mean_unit_var_norm(e){const n=e.reduce((a,s)=>a+s,0)/e.length,i=e.reduce((a,s)=>a+(s-n)**2,0)/e.length;return e.map(a=>(a-n)/Math.sqrt(i+1e-7))}async _call(e){ya$2(e,"Wav2Vec2FeatureExtractor"),e instanceof Float64Array&&(e=new Float32Array(e));let r=e;this.config.do_normalize&&(r=this._zero_mean_unit_var_norm(r));const n=[1,r.length];return {input_values:new ce$2("float32",r,n),attention_mask:new ce$2("int64",new BigInt64Array(r.length).fill(1n),n)}}}class g$ extends Vr$2{constructor(e){super(e);const r=this.config.sampling_rate,n=Zn$2(256,this.config.num_mel_bins,20,Math.floor(r/2),r,null,"kaldi",true);for(let i=0;i<n.length;++i)n[i].push(0);this.mel_filters=n,this.window=zi$2(400,"povey",{periodic:false});}async _extract_fbank_features(e,r){return e=e.map(n=>n*32768),Oi$1(e,this.window,400,160,{fft_length:512,power:2,center:false,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:true,max_num_frames:r,transpose:true})}async _call(e,{padding:r=true,pad_to_multiple_of:n=2,do_normalize_per_mel_bins:i=true,return_attention_mask:a=true}={}){ya$2(e,"SeamlessM4TFeatureExtractor");let s=await this._extract_fbank_features(e,this.config.max_length);if(i){const[y,b]=s.dims,v=s.data;for(let C=0;C<b;++C){let x=0;for(let R=0;R<y;++R)x+=v[R*b+C];const T=x/y;let I=0;for(let R=0;R<y;++R)I+=(v[R*b+C]-T)**2;I/=y-1;const A=Math.sqrt(I+1e-7);for(let R=0;R<y;++R){const z=R*b+C;v[z]=(v[z]-T)/A;}}}let o;if(r){const[y,b]=s.dims,v=s.data,C=y%n;if(C>0){const x=new Float32Array(b*(y+C));x.set(v),x.fill(this.config.padding_value,v.length);const T=y+C;s=new ce$2(s.type,x,[T,b]),a&&(o=new ce$2("int64",new BigInt64Array(T),[1,T]),o.data.fill(1n,0,y));}}const[u,l]=s.dims,h=this.config.stride;if(u%h!==0)throw new Error(`The number of frames (${u}) must be a multiple of the stride (${h}).`);const m=s.view(1,Math.floor(u/h),l*h),c={input_features:m};if(a){const y=m.dims[1],b=new BigInt64Array(y);if(o){const v=o.data;for(let C=1,x=0;C<u;C+=h,++x)b[x]=v[C];}else b.fill(1n);c.attention_mask=new ce$2("int64",b,[1,y]);}return c}}class _$ extends Vr$2{constructor(e){super(e);const r=this.config.sampling_rate,n=Zn$2(256,this.config.num_mel_bins,20,Math.floor(r/2),r,null,"kaldi",true);for(let i=0;i<n.length;++i)n[i].push(0);this.mel_filters=n,this.window=zi$2(400,"hann",{periodic:false}),this.mean=this.config.mean,this.std=this.config.std;}async _extract_fbank_features(e,r){return Oi$1(e,this.window,400,160,{fft_length:512,power:2,center:false,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:true,max_num_frames:r,transpose:true})}async _call(e){ya$2(e,"ASTFeatureExtractor");const r=await this._extract_fbank_features(e,this.config.max_length);if(this.config.do_normalize){const n=this.std*2,i=r.data;for(let a=0;a<i.length;++a)i[a]=(i[a]-this.mean)/n;}return {input_values:r.unsqueeze_(0)}}}class y$ extends Vr$2{constructor(e){super(e),this.mel_filters=Zn$2(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=Zn$2(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=zi$2(this.config.fft_window_size,"hann");}async _get_input_mel(e,r,n,i){let a;const s=e.length-r;if(s>0)if(n==="rand_trunc"){const o=Math.floor(Math.random()*(s+1));e=e.subarray(o,o+r),a=await this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples);}else throw new Error(`Truncation strategy "${n}" not implemented`);else {if(s<0){let o=new Float64Array(r);if(o.set(e),i==="repeat")for(let u=e.length;u<r;u+=e.length)o.set(e.subarray(0,Math.min(e.length,r-u)),u);else if(i==="repeatpad")for(let u=e.length;u<-s;u+=e.length)o.set(e,u);e=o;}if(n==="fusion")throw new Error(`Truncation strategy "${n}" not implemented`);a=await this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples);}return a.unsqueeze_(0)}async _extract_fbank_features(e,r,n=null){return Oi$1(e,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:r,log_mel:"dB",max_num_frames:n,do_pad:false,transpose:true})}async _call(e,{max_length:r=null}={}){return ya$2(e,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(e,r??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}class w$ extends Vr$2{}let _n$2 = class _n extends or$2{constructor(e){super(),this.feature_extractor=e;}async _call(e,...r){return await this.feature_extractor(e,...r)}};class b$ extends _n$2{async _call(...e){return await this.feature_extractor(...e)}post_process_masks(...e){return this.feature_extractor.post_process_masks(...e)}reshape_input_points(...e){return this.feature_extractor.reshape_input_points(...e)}}class v$ extends _n$2{async _call(e){return await this.feature_extractor(e)}}class $$ extends _n$2{async _call(e){return await this.feature_extractor(e)}}class x$ extends _n$2{async _call(e){return await this.feature_extractor(e)}}class S$ extends _n$2{}class C${static FEATURE_EXTRACTOR_CLASS_MAPPING={ImageFeatureExtractor:je$2,WhisperFeatureExtractor:f$,ViTFeatureExtractor:t$,MobileViTFeatureExtractor:zg,MobileViTImageProcessor:a$,OwlViTFeatureExtractor:Rg,Owlv2ImageProcessor:i$,CLIPFeatureExtractor:Mg,CLIPImageProcessor:Qv,ChineseCLIPFeatureExtractor:Jv,SiglipImageProcessor:Zv,ConvNextFeatureExtractor:Og,ConvNextImageProcessor:e$,SegformerFeatureExtractor:jv,BitImageProcessor:Yv,DPTImageProcessor:Kv,DPTFeatureExtractor:Ag,GLPNFeatureExtractor:Xv,BeitFeatureExtractor:o$,DeiTFeatureExtractor:s$,DetrFeatureExtractor:l$,YolosFeatureExtractor:d$,DonutFeatureExtractor:Pg,NougatImageProcessor:u$,EfficientNetImageProcessor:n$,ViTImageProcessor:r$,VitMatteImageProcessor:h$,SamImageProcessor:c$,Swin2SRImageProcessor:p$,Wav2Vec2FeatureExtractor:m$,SeamlessM4TFeatureExtractor:g$,SpeechT5FeatureExtractor:w$,ASTFeatureExtractor:_$,ClapFeatureExtractor:y$};static PROCESSOR_CLASS_MAPPING={WhisperProcessor:v$,Wav2Vec2ProcessorWithLM:$$,SamProcessor:b$,SpeechT5Processor:x$,OwlViTProcessor:S$};static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main"}={}){let o=n??await on$2(e,"preprocessor_config.json",true,{progress_callback:r,cache_dir:i,local_files_only:a,revision:s}),u=o.feature_extractor_type??o.image_processor_type,l=this.FEATURE_EXTRACTOR_CLASS_MAPPING[u];if(!l)if(o.size!==void 0)console.warn(`Feature extractor type "${u}" not found, assuming ImageFeatureExtractor due to size parameter in config.`),l=je$2;else throw new Error(`Unknown Feature Extractor type: ${u}`);let h=this.PROCESSOR_CLASS_MAPPING[o.processor_class]??_n$2,f=new l(o);return new h(f)}}Pr$2.IS_PROCESS_AVAILABLE;async function E$(){try{return (await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch{return  false}}const Ri$1=document.getElementById("status"),bi$1=document.createElement("canvas"),ea$2=document.getElementById("output-canvas"),Fr$2=document.getElementById("video"),Xs$2=document.getElementById("size"),T$=document.getElementById("size-value"),Qs$2=document.getElementById("scale"),k$=document.getElementById("scale-value");function Bg(t,e){Fr$2.width=ea$2.width=bi$1.width=Math.round(t),Fr$2.height=ea$2.height=bi$1.height=Math.round(e);}Ri$1.textContent="Loading model...";const Dg="onnx-community/depth-anything-v2-small";let Ng;try{Ng=await Ov.from_pretrained(Dg,{device:"webgpu",dtype:await E$()?"fp16":"fp32"});}catch(t){throw Ri$1.textContent=t.message,alert(t.message),t}const Po$2=await C$.from_pretrained(Dg);let dn$2=504;Po$2.feature_extractor.size={width:dn$2,height:dn$2};Xs$2.addEventListener("input",()=>{dn$2=Number(Xs$2.value),Po$2.feature_extractor.size={width:dn$2,height:dn$2},T$.textContent=dn$2;});Xs$2.disabled=false;let cn$2=.4;Qs$2.addEventListener("input",()=>{cn$2=Number(Qs$2.value),Bg(Fr$2.videoWidth*cn$2,Fr$2.videoHeight*cn$2),k$.textContent=cn$2;});Qs$2.disabled=false;Ri$1.textContent="Ready";let Ms$2=false,Os$2;const Ac$1=bi$1.getContext("2d",{willReadFrequently:true}),I$=ea$2.getContext("2d",{willReadFrequently:true});function Fg(){const{width:t,height:e}=bi$1;Ms$2||(Ms$2=true,async function(){Ac$1.drawImage(Fr$2,0,0,t,e);const r=Ac$1.getImageData(0,0,t,e),n=new Vt$2(r.data,t,e,4),i=await Po$2(n),{predicted_depth:a}=await Ng(i),s=a.data,[o,u,l]=a.dims;let h=1/0,f=-1/0;ea$2.width=l,ea$2.height=u;for(let b=0;b<s.length;++b){const v=s[b];v<h&&(h=v),v>f&&(f=v);}const m=f-h,c=new Uint8ClampedArray(4*s.length);for(let b=0;b<s.length;++b){const v=4*b;c[v]=255,c[v+3]=255*(1-(s[b]-h)/m);}const y=new ImageData(c,l,u);if(I$.putImageData(y,0,0),Os$2!==void 0){const b=1e3/(performance.now()-Os$2);Ri$1.textContent=`FPS: ${b.toFixed(2)}`;}Os$2=performance.now(),Ms$2=false;}()),window.requestAnimationFrame(Fg);}navigator.mediaDevices.getUserMedia({video:{width:720,height:720}}).then(t=>{Fr$2.srcObject=t,Fr$2.play();const e=t.getVideoTracks()[0],{width:r,height:n}=e.getSettings();Bg(r*cn$2,n*cn$2),setTimeout(Fg,50);}).catch(t=>{alert(t);});
   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ^
2392|  
2393|  const scriptRel = 'modulepreload';const assetsURL = function(dep) { return "/chess/"+dep };const seen = {};const __vitePreload = function preload(baseModule, deps, importerUrl) {

Top-level await is not available in the configured target environment ("chrome87", "edge88", "es2020", "firefox78", "safari14" + 2 overrides)
2389|   * limitations under the License.
2390|   * =============================================================================
2391|   */const z_=Object.freeze(Object.defineProperty({__proto__:null,get InferenceSession(){return ao$2},get TRACE(){return jn$2},get TRACE_FUNC_BEGIN(){return Ht$2},get TRACE_FUNC_END(){return Mt$2},get Tensor(){return ft$2},get TrainingSession(){return io$2},default:O_,get env(){return Fe$2},get registerBackend(){return Or$2}},Symbol.toStringTag,{value:"Module"})),R_=(t,e)=>{const r=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);r.width=t.dims[3],r.height=t.dims[2];const n=r.getContext("2d");if(n!=null){let i,a;e?.tensorLayout!==void 0&&e.tensorLayout==="NHWC"?(i=t.dims[2],a=t.dims[3]):(i=t.dims[3],a=t.dims[2]);const s=e?.format!==void 0?e.format:"RGB",o=e?.norm;let u,l;o===void 0||o.mean===void 0?u=[255,255,255,255]:typeof o.mean=="number"?u=[o.mean,o.mean,o.mean,o.mean]:(u=[o.mean[0],o.mean[1],o.mean[2],0],o.mean[3]!==void 0&&(u[3]=o.mean[3])),o===void 0||o.bias===void 0?l=[0,0,0,0]:typeof o.bias=="number"?l=[o.bias,o.bias,o.bias,o.bias]:(l=[o.bias[0],o.bias[1],o.bias[2],0],o.bias[3]!==void 0&&(l[3]=o.bias[3]));const h=a*i;let f=0,m=h,c=h*2,y=-1;s==="RGBA"?(f=0,m=h,c=h*2,y=h*3):s==="RGB"?(f=0,m=h,c=h*2):s==="RBG"&&(f=0,c=h,m=h*2);for(let b=0;b<a;b++)for(let v=0;v<i;v++){const C=(t.data[f++]-l[0])*u[0],x=(t.data[m++]-l[1])*u[1],T=(t.data[c++]-l[2])*u[2],I=y===-1?255:(t.data[y++]-l[3])*u[3];n.fillStyle="rgba("+C+","+x+","+T+","+I+")",n.fillRect(v,b,1,1);}if("toDataURL"in r)return r.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},P_=(t,e)=>{const r=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");let n;if(r!=null){let i,a,s;e?.tensorLayout!==void 0&&e.tensorLayout==="NHWC"?(i=t.dims[2],a=t.dims[1],s=t.dims[3]):(i=t.dims[3],a=t.dims[2],s=t.dims[1]);const o=e!==void 0&&e.format!==void 0?e.format:"RGB",u=e?.norm;let l,h;u===void 0||u.mean===void 0?l=[255,255,255,255]:typeof u.mean=="number"?l=[u.mean,u.mean,u.mean,u.mean]:(l=[u.mean[0],u.mean[1],u.mean[2],255],u.mean[3]!==void 0&&(l[3]=u.mean[3])),u===void 0||u.bias===void 0?h=[0,0,0,0]:typeof u.bias=="number"?h=[u.bias,u.bias,u.bias,u.bias]:(h=[u.bias[0],u.bias[1],u.bias[2],0],u.bias[3]!==void 0&&(h[3]=u.bias[3]));const f=a*i;if(e!==void 0&&(e.format!==void 0&&s===4&&e.format!=="RGBA"||s===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");const m=4;let c=0,y=1,b=2,v=3,C=0,x=f,T=f*2,I=-1;o==="RGBA"?(C=0,x=f,T=f*2,I=f*3):o==="RGB"?(C=0,x=f,T=f*2):o==="RBG"&&(C=0,T=f,x=f*2),n=r.createImageData(i,a);for(let A=0;A<a*i;c+=m,y+=m,b+=m,v+=m,A++)n.data[c]=(t.data[C++]-h[0])*l[0],n.data[y]=(t.data[x++]-h[1])*l[1],n.data[b]=(t.data[T++]-h[2])*l[2],n.data[v]=I===-1?255:(t.data[I++]-h[3])*l[3];}else throw new Error("Can not access image data");return n},Ts$2=(t,e)=>{if(t===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");const{height:r,width:n}=e,i=e.norm??{mean:255,bias:0};let a,s;typeof i.mean=="number"?a=[i.mean,i.mean,i.mean,i.mean]:a=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?s=[i.bias,i.bias,i.bias,i.bias]:s=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];const o=e.format!==void 0?e.format:"RGBA",u=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",l=r*n,h=u==="RGBA"?new Float32Array(l*4):new Float32Array(l*3);let f=4,m=0,c=1,y=2,b=3,v=0,C=l,x=l*2,T=-1;o==="RGB"&&(f=3,m=0,c=1,y=2,b=-1),u==="RGBA"?T=l*3:u==="RBG"?(v=0,x=l,C=l*2):u==="BGR"&&(x=0,C=l,v=l*2);for(let A=0;A<l;A++,m+=f,y+=f,c+=f,b+=f)h[v++]=(t[m]+s[0])/a[0],h[C++]=(t[c]+s[1])/a[1],h[x++]=(t[y]+s[2])/a[2],T!==-1&&b!==-1&&(h[T++]=(t[b]+s[3])/a[3]);return u==="RGBA"?new Qt$2("float32",h,[1,4,r,n]):new Qt$2("float32",h,[1,3,r,n])},B_=async(t,e)=>{const r=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,n=typeof ImageData<"u"&&t instanceof ImageData,i=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,a=typeof t=="string";let s,o=e??{};const u=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},l=h=>h instanceof HTMLCanvasElement||h instanceof OffscreenCanvas?h.getContext("2d"):null;if(r){const h=u();h.width=t.width,h.height=t.height;const f=l(h);if(f!=null){let m=t.height,c=t.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(m=e.resizedHeight,c=e.resizedWidth),e!==void 0){if(o=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");o.tensorFormat="RGBA",o.height=m,o.width=c;}else o.tensorFormat="RGBA",o.height=m,o.width=c;f.drawImage(t,0,0),s=f.getImageData(0,0,c,m).data;}else throw new Error("Can not access image data")}else if(n){let h,f;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(h=e.resizedHeight,f=e.resizedWidth):(h=t.height,f=t.width),e!==void 0&&(o=e),o.format="RGBA",o.height=h,o.width=f,e!==void 0){const m=u();m.width=f,m.height=h;const c=l(m);if(c!=null)c.putImageData(t,0,0),s=c.getImageData(0,0,f,h).data;else throw new Error("Can not access image data")}else s=t.data;}else if(i){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");const h=u();h.width=t.width,h.height=t.height;const f=l(h);if(f!=null){const m=t.height,c=t.width;return f.drawImage(t,0,0,c,m),s=f.getImageData(0,0,c,m).data,o.height=m,o.width=c,Ts$2(s,o)}else throw new Error("Can not access image data")}else {if(a)return new Promise((h,f)=>{const m=u(),c=l(m);if(!t||!c)return f();const y=new Image;y.crossOrigin="Anonymous",y.src=t,y.onload=()=>{m.width=y.width,m.height=y.height,c.drawImage(y,0,0,m.width,m.height);const b=c.getImageData(0,0,m.width,m.height);o.height=m.height,o.width=m.width,h(Ts$2(b.data,o));};});throw new Error("Input data provided is not supported - aborted tensor creation")}if(s!==void 0)return Ts$2(s,o);throw new Error("Input data provided is not supported - aborted tensor creation")},D_=(t,e)=>{const{width:r,height:n,download:i,dispose:a}=e,s=[1,n,r,4];return new Qt$2({location:"texture",type:"float32",texture:t,dims:s,download:i,dispose:a})},N_=(t,e)=>{const{dataType:r,dims:n,download:i,dispose:a}=e;return new Qt$2({location:"gpu-buffer",type:r??"float32",gpuBuffer:t,dims:n,download:i,dispose:a})},F_=(t,e,r)=>new Qt$2({location:"cpu-pinned",type:t,data:e,dims:r??[e.length]}),ln$1=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),ii$2=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);let wc$2=false;const L_=()=>{if(!wc$2){wc$2=true;const t=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,r=typeof Float16Array<"u"&&Float16Array.from;t&&(ln$1.set("int64",BigInt64Array),ii$2.set(BigInt64Array,"int64")),e&&(ln$1.set("uint64",BigUint64Array),ii$2.set(BigUint64Array,"uint64")),r?(ln$1.set("float16",Float16Array),ii$2.set(Float16Array,"float16")):ln$1.set("float16",Uint16Array);}},W_=t=>{let e=1;for(let r=0;r<t.length;r++){const n=t[r];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${r}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${r}] must be a non-negative integer, got: ${n}`);e*=n;}return e},U_=(t,e)=>{switch(t.location){case "cpu":return new Qt$2(t.type,t.data,e);case "cpu-pinned":return new Qt$2({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case "texture":return new Qt$2({location:"texture",texture:t.texture,type:t.type,dims:e});case "gpu-buffer":return new Qt$2({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}};let Qt$2=class Qt{constructor(e,r,n){L_();let i,a;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,i=e.type,a=e.dims,e.location){case "cpu-pinned":{const o=ln$1.get(i);if(!o)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(e.data instanceof o))throw new TypeError(`buffer should be of type ${o.name}`);this.cpuData=e.data;break}case "texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case "gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else {let o,u;if(typeof e=="string")if(i=e,u=n,e==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor's data must be a string array.");o=r;}else {const l=ln$1.get(e);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(r)){if(e==="float16"&&l===Uint16Array)throw new TypeError("Creating a float16 tensor from number array is not supported. Please use Uint16Array as data.");e==="uint64"||e==="int64"?o=l.from(r,BigInt):o=l.from(r);}else if(r instanceof l)o=r;else throw new TypeError(`A ${i} tensor's data must be type of ${l}`)}else if(u=r,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const l=typeof e[0];if(l==="string")i="string",o=e;else if(l==="boolean")i="bool",o=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else {const l=ii$2.get(e.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);i=l,o=e;}if(u===void 0)u=[o.length];else if(!Array.isArray(u))throw new TypeError("A tensor's dims must be a number array");a=u,this.cpuData=o,this.dataLocation="cpu";}const s=W_(a);if(this.cpuData&&s!==this.cpuData.length)throw new Error(`Tensor's size(${s}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=a,this.size=s;}static async fromImage(e,r){return B_(e,r)}static fromTexture(e,r){return D_(e,r)}static fromGpuBuffer(e,r){return N_(e,r)}static fromPinnedBuffer(e,r,n){return F_(e,r,n)}toDataURL(e){return R_(this,e)}toImageData(e){return P_(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}async getData(e){switch(this.ensureValid(),this.dataLocation){case "cpu":case "cpu-pinned":return this.data;case "texture":case "gpu-buffer":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;const r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,e&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=false;}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none";}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return U_(this,e)}};const V_=Qt$2,Hn$2=[];let Ks$2,Xn$2;Pr$2.IS_NODE_ENV?(Xn$2=Ye$2??qg,Hn$2.push("cpu"),Ks$2=["cpu"]):(Xn$2=z_,Pr$2.IS_WEBGPU_AVAILABLE&&Hn$2.push("webgpu"),Hn$2.push("wasm"),Ks$2=["wasm"]);const G_=Xn$2.InferenceSession;function H_(t){let e=Ks$2;if(t){if(!Hn$2.includes(t))throw new Error(`Unsupported device: "${t}". Should be one of: ${Hn$2.join(", ")}.`);e=[t];}return e}async function lm(t,e){return await G_.create(t,e)}function dm(t){return t instanceof Xn$2.Tensor}const Mr$2=Xn$2?.env;Mr$2?.wasm&&(Mr$2.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.18.0/dist/",Mr$2.wasm.proxy=!Pr$2.IS_WEBWORKER_ENV,(typeof crossOriginIsolated>"u"||!crossOriginIsolated)&&(Mr$2.wasm.numThreads=1),typeof navigator<"u"&&/iP(hone|od|ad).+16_4.+AppleWebKit/.test(navigator.userAgent)&&(Mr$2.wasm.simd=false));function q_(){return Mr$2?.wasm?.proxy}bt$2.backends.onnx=Mr$2;const an$2=async(t,e,r)=>{const n=await lm(new Uint8Array(t),e);return async i=>{const a=Object.fromEntries(Object.entries(i).map(([o,u])=>[o,u.ort_tensor])),s=await n.run(a);return Array.isArray(r)?r.map(o=>new ce$2(s[o])):new ce$2(s[r])}};let _i$1 = class _i{static session_options={};static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=an$2([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=an$2([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=an$2([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=an$2([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=an$2([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=an$2([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}};const bc$2=Object.freeze({float32:Float32Array,float16:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array});let ce$2 = class ce{get dims(){return this.ort_tensor.dims}set dims(e){this.ort_tensor.dims=e;}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}ort_tensor;constructor(...e){return dm(e[0])?this.ort_tensor=e[0]:this.ort_tensor=new V_(e[0],e[1],e[2]),new Proxy(this,{get:(r,n)=>{if(typeof n=="string"){let i=Number(n);if(Number.isInteger(i))return r._getitem(i)}return r[n]},set:(r,n,i)=>r[n]=i})}dispose(){this.ort_tensor.dispose();}*[Symbol.iterator](){const[e,...r]=this.dims;if(r.length>0){const n=r.reduce((i,a)=>i*a);for(let i=0;i<e;++i)yield this._subarray(i,n,r);}else yield*this.data;}_getitem(e){const[r,...n]=this.dims;if(e=Xt$2(e,r),n.length>0){const i=n.reduce((a,s)=>a*s);return this._subarray(e,i,n)}else return new ce(this.type,[this.data[e]],n)}indexOf(e){const r=this.data;for(let n=0;n<r.length;++n)if(r[n]==e)return n;return  -1}_subarray(e,r,n){const i=e*r,a=(e+1)*r,s="subarray"in this.data?this.data.subarray(i,a):this.data.slice(i,a);return new ce(this.type,s,n)}item(){const e=this.data;if(e.length!==1)throw new Error(`a Tensor with ${e.length} elements cannot be converted to Scalar`);return e[0]}tolist(){return j_(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){const e=this.data;for(let r=0;r<e.length;++r)e[r]=1/(1+Math.exp(-e[r]));return this}mul(e){return this.clone().mul_(e)}mul_(e){const r=this.data;for(let n=0;n<r.length;++n)r[n]*=e;return this}div(e){return this.clone().div_(e)}div_(e){const r=this.data;for(let n=0;n<r.length;++n)r[n]/=e;return this}add(e){return this.clone().add_(e)}add_(e){const r=this.data;for(let n=0;n<r.length;++n)r[n]+=e;return this}clone(){return new ce(this.type,this.data.slice(),this.dims.slice())}slice(...e){let r=[],n=[];for(let l=0;l<this.dims.length;++l){let h=e[l];if(h==null)n.push([0,this.dims[l]]),r.push(this.dims[l]);else if(typeof h=="number")h=Xt$2(h,this.dims[l],l),n.push([h,h+1]);else if(Array.isArray(h)&&h.length===2){let[f,m]=h;if(f=f===null?0:Xt$2(f,this.dims[l],l,false),m=m===null?this.dims[l]:Xt$2(m,this.dims[l],l,false),f>m)throw new Error(`Invalid slice: ${h}`);let c=[Math.max(f,0),Math.min(m,this.dims[l])];n.push(c),r.push(c[1]-c[0]);}else throw new Error(`Invalid slice: ${h}`)}let i=n.map(([l,h])=>h-l),a=i.reduce((l,h)=>l*h);const s=this.data;let o=new s.constructor(a);const u=this.stride();for(let l=0;l<a;++l){let h=0;for(let f=i.length-1,m=l;f>=0;--f){const c=i[f];h+=(m%c+n[f][0])*u[f],m=Math.floor(m/c);}o[l]=s[h];}return new ce(this.type,o,r)}permute(...e){return K_(this,e)}transpose(...e){return this.permute(...e)}sum(e=null,r=false){return this.norm(1,e,r)}norm(e="fro",r=null,n=false){if(e==="fro")e=2;else if(typeof e=="string")throw Error(`Unsupported norm: ${e}`);const i=this.data;if(r===null){let o=i.reduce((u,l)=>u+l**e,0)**(1/e);return new ce(this.type,[o],[])}r=Xt$2(r,this.dims.length);const a=this.dims.slice();a[r]=1;const s=new i.constructor(i.length/this.dims[r]);for(let o=0;o<i.length;++o){let u=0;for(let l=this.dims.length-1,h=o,f=1;l>=0;--l){const m=this.dims[l];if(l!==r){const c=h%m;u+=c*f,f*=a[l];}h=Math.floor(h/m);}s[u]+=i[o]**e;}if(e!==1)for(let o=0;o<s.length;++o)s[o]=s[o]**(1/e);return n||a.splice(r,1),new ce(this.type,s,a)}normalize_(e=2,r=1){r=Xt$2(r,this.dims.length);const n=this.norm(e,r,true),i=this.data;for(let a=0;a<i.length;++a){let s=0;for(let o=this.dims.length-1,u=a,l=1;o>=0;--o){const h=this.dims[o];if(o!==r){const f=u%h;s+=f*l,l*=this.dims[o];}u=Math.floor(u/h);}i[a]/=n.data[s];}return this}normalize(e=2,r=1){return this.clone().normalize_(e,r)}stride(){return J_(this.dims)}squeeze(e=null){return new ce(this.type,this.data,$c$1(this.dims,e))}squeeze_(e=null){return this.dims=$c$1(this.dims,e),this}unsqueeze(e=null){return new ce(this.type,this.data,xc$1(this.dims,e))}unsqueeze_(e=null){return this.dims=xc$1(this.dims,e),this}flatten_(e=0,r=-1){r=(r+this.dims.length)%this.dims.length;let n=this.dims.slice(0,e),i=this.dims.slice(e,r+1),a=this.dims.slice(r+1);return this.dims=[...n,i.reduce((s,o)=>s*o,1),...a],this}flatten(e=0,r=-1){return this.clone().flatten_(e,r)}view(...e){let r=-1;for(let n=0;n<e.length;++n)if(e[n]===-1){if(r!==-1)throw new Error("Only one dimension can be inferred");r=n;}if(r!==-1){const n=e.reduce((i,a,s)=>s!==r?i*a:i,1);e[r]=this.data.length/n;}return new ce(this.type,this.data,e)}neg_(){const e=this.data;for(let r=0;r<e.length;++r)e[r]=-e[r];return this}neg(){return this.clone().neg_()}clamp_(e,r){const n=this.data;for(let i=0;i<n.length;++i)n[i]=Math.min(Math.max(n[i],e),r);return this}clamp(e,r){return this.clone().clamp_(e,r)}round_(){const e=this.data;for(let r=0;r<e.length;++r)e[r]=Math.round(e[r]);return this}round(){return this.clone().round_()}mean(e=null,r=false){return xo$2(this,e,r)}to(e){if(this.type===e)return this;if(!bc$2.hasOwnProperty(e))throw new Error(`Unsupported type: ${e}`);return new ce(e,bc$2[e].from(this.data),this.dims)}};function j_(t,e){const r=t.length,n=e.reduce((a,s)=>a*s);if(r!==n)throw Error(`cannot reshape array of size ${r} into shape (${e})`);let i=t;for(let a=e.length-1;a>=0;a--)i=i.reduce((s,o)=>{let u=s[s.length-1];return u.length<e[a]?u.push(o):s.push([o]),s},[[]]);return i[0]}function K_(t,e){const[r,n]=s0(t.data,t.dims,e);return new ce$2(t.type,r,n)}function cm(t,[e,r],n="bilinear",i=false){const a=t.dims.at(-3)??1,s=t.dims.at(-2),o=t.dims.at(-1);let u=i0(t.data,[a,s,o],[e,r],n,i);return new ce$2(t.type,u,[a,e,r])}async function vc$2(t,{size:e=null,mode:r="bilinear"}={}){if(t.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!e)throw new Error("`interpolate_4d` requires a `size` argument.");let n;if(e.length===2)n=[...t.dims.slice(0,2),...e];else if(e.length===3)n=[t.dims[0],...e];else if(e.length===4)n=e;else throw new Error("`size` must be of length 2, 3, or 4.");let i;if(r==="bilinear")i=await _i$1.bilinear_interpolate_4d;else if(r==="bicubic")i=await _i$1.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${r}`);const a=new ce$2("int64",new BigInt64Array(n.map(BigInt)),[n.length]);return await i({x:t,s:a})}async function Y_(t,e){return await(await _i$1.matmul)({a:t,b:e})}async function pm(t,e){const r=await _i$1.top_k;return e===null?e=t.dims.at(-1):e=Math.min(e,t.dims.at(-1)),await r({x:t,k:new ce$2("int64",[BigInt(e)],[1])})}function $c$1(t,e){return t=t.slice(),e===null?t=t.filter(r=>r!==1):typeof e=="number"?t[e]===1&&t.splice(e,1):Array.isArray(e)&&(t=t.filter((r,n)=>r!==1||!e.includes(n))),t}function xc$1(t,e){return e=Xt$2(e,t.length+1),t=t.slice(),t.splice(e,0,1),t}function Xt$2(t,e,r=null,n=true){if(n&&(t<-e||t>=e))throw new Error(`IndexError: index ${t} is out of bounds for dimension${r===null?"":" "+r} with size ${e}`);return t<0&&(t=(t%e+e)%e),t}function Jt$2(t,e=0){e=Xt$2(e,t[0].dims.length);const r=t[0].dims.slice();r[e]=t.reduce((s,o)=>s+o.dims[e],0);const n=r.reduce((s,o)=>s*o,1),i=new t[0].data.constructor(n),a=t[0].type;if(e===0){let s=0;for(let o of t)i.set(o.data,s),s+=o.data.length;}else {let s=0;for(let o=0;o<t.length;++o){let u=t[o];for(let l=0;l<u.data.length;++l){let h=0;for(let f=u.dims.length-1,m=l,c=1;f>=0;--f){const y=u.dims[f];let b=m%y;f===e&&(b+=s),h+=b*c,c*=r[f],m=Math.floor(m/y);}i[h]=u.data[l];}s+=u.dims[e];}}return new ce$2(a,i,r)}function Qn$2(t,e=0){return Jt$2(t.map(r=>r.unsqueeze(e)),e)}function X_(t,e=null,r=1,n=false){if(e===null){const l=t.data.reduce((c,y)=>c+y,0)/t.data.length,h=Math.sqrt(t.data.reduce((c,y)=>c+(y-l)**2,0)/(t.data.length-r)),f=new ce$2(t.type,[l],[]);return [new ce$2(t.type,[h],[]),f]}e=Xt$2(e,t.dims.length);const i=xo$2(t,e,n),a=t.dims.slice();a[e]=1;const s=new t.data.constructor(t.data.length/t.dims[e]);for(let u=0;u<t.data.length;++u){let l=0;for(let h=t.dims.length-1,f=u,m=1;h>=0;--h){const c=t.dims[h];if(h!==e){const y=f%c;l+=y*m,m*=a[h];}f=Math.floor(f/c);}s[l]+=(t.data[u]-i.data[l])**2;}for(let u=0;u<s.length;++u)s[u]=Math.sqrt(s[u]/(t.dims[e]-r));return n||a.splice(e,1),[new ce$2(t.type,s,a),i]}function xo$2(t,e=null,r=false){if(e===null){let a=t.data.reduce((s,o)=>s+o,0);return new ce$2(t.type,[a/t.data.length],[])}e=Xt$2(e,t.dims.length);const n=t.dims.slice();n[e]=1;const i=new t.data.constructor(t.data.length/t.dims[e]);for(let a=0;a<t.data.length;++a){let s=0;for(let o=t.dims.length-1,u=a,l=1;o>=0;--o){const h=t.dims[o];if(o!==e){const f=u%h;s+=f*l,l*=n[o];}u=Math.floor(u/h);}i[s]+=t.data[a];}if(t.dims[e]!==1)for(let a=0;a<i.length;++a)i[a]=i[a]/t.dims[e];return r||n.splice(e,1),new ce$2(t.type,i,n)}function Q_(t){const[e,r]=t.dims,n=[e+1,r+1],i=new ce$2("float32",new Float32Array(n[0]*n[1]).fill(1/0),n),a=new ce$2("float32",new Float32Array(n[0]*n[1]).fill(-1),n);i[0].data[0]=0;for(let h=1;h<r+1;++h)for(let f=1;f<e+1;++f){const m=i[f-1][h-1].item(),c=i[f-1][h].item(),y=i[f][h-1].item();let b,v;m<c&&m<y?(b=m,v=0):c<m&&c<y?(b=c,v=1):(b=y,v=2),i[f].data[h]=t[f-1][h-1].item()+b,a[f].data[h]=v;}let s=e,o=r;a.data.fill(2,0,n[1]);for(let h=0;h<n[0];++h)a[h].data[0]=1;let u=[],l=[];for(;s>0||o>0;)switch(u.push(s-1),l.push(o-1),a[s][o].item()){case 0:--s,--o;break;case 1:--s;break;case 2:--o;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${s}, ${o}]. Please file a bug report.`)}return u.reverse(),l.reverse(),[u,l]}function J_(t){const e=new Array(t.length);for(let r=t.length-1,n=1;r>=0;--r)e[r]=n,n*=t[r];return e}function So$2(t,e,r,n){const i=t.reduce((a,s)=>a*s,1);return new ce$2(r,new n(i).fill(e),t)}function Z_(t,e){let r,n;return r="float32",n=Float32Array,So$2(t,e,r,n)}function ey(t,e){return Z_(t.dims,e)}function aa$2(t){return So$2(t,1n,"int64",BigInt64Array)}function ty(t){return aa$2(t.dims)}function ry(t){return So$2(t,0n,"int64",BigInt64Array)}function ny(t){return ry(t.dims)}var Ce$2=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",BooleanLiteral:"BooleanLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Set:"Set",If:"If",For:"For",In:"In",Is:"Is",NotIn:"NotIn",Else:"Else",EndIf:"EndIf",ElseIf:"ElseIf",EndFor:"EndFor",And:"And",Or:"Or",Not:"UnaryOperator"});Object.freeze({set:Ce$2.Set,for:Ce$2.For,in:Ce$2.In,is:Ce$2.Is,if:Ce$2.If,else:Ce$2.Else,endif:Ce$2.EndIf,elif:Ce$2.ElseIf,endfor:Ce$2.EndFor,and:Ce$2.And,or:Ce$2.Or,not:Ce$2.Not,"not in":Ce$2.NotIn,true:Ce$2.BooleanLiteral,false:Ce$2.BooleanLiteral});Ce$2.OpenStatement,Ce$2.CloseStatement,Ce$2.OpenExpression,Ce$2.CloseExpression,Ce$2.OpenParen,Ce$2.CloseParen,Ce$2.OpenCurlyBracket,Ce$2.CloseCurlyBracket,Ce$2.OpenSquareBracket,Ce$2.CloseSquareBracket,Ce$2.Comma,Ce$2.Dot,Ce$2.Colon,Ce$2.Pipe,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.ComparisonBinaryOperator,Ce$2.AdditiveBinaryOperator,Ce$2.AdditiveBinaryOperator,Ce$2.MultiplicativeBinaryOperator,Ce$2.MultiplicativeBinaryOperator,Ce$2.MultiplicativeBinaryOperator,Ce$2.Equals;const hm=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],ks$2=new Map(hm),ay=new Map([...hm.map(([t,e])=>[e,t]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function iy(t){t=t.toLowerCase();let e=ay.get(t);if(e===void 0)if(ks$2.has(t))e=t;else {const n=t.length===2?ks$2.keys():ks$2.values();throw new Error(`Language "${t}" is not supported. Must be one of: ${JSON.stringify(n)}`)}return e}const sy=(()=>{const t=[...Array.from({length:94},(i,a)=>a+33),...Array.from({length:12},(i,a)=>a+161),...Array.from({length:82},(i,a)=>a+174)],e=t.slice();let r=0;for(let i=0;i<256;++i)t.includes(i)||(t.push(i),e.push(256+r),r+=1);const n=e.map(i=>String.fromCharCode(i));return Object.fromEntries(t.map((i,a)=>[i,n[a]]))})();Zg(sy);async function oy(t,e){return await on$2(t,"config.json",true,e)}function sn$2(t){const e={};let r={};switch(t.model_type){case "llava":case "paligemma":r=sn$2(t.text_config);break;case "moondream1":r=sn$2(t.phi_config);break;case "musicgen":r=sn$2(t.decoder);break;case "gpt2":case "gptj":case "codegen":case "gpt_bigcode":e.num_heads="n_head",e.num_layers="n_layer",e.hidden_size="n_embd";break;case "gpt_neox":case "stablelm":case "opt":case "phi":case "phi3":case "falcon":e.num_heads="num_attention_heads",e.num_layers="num_hidden_layers",e.hidden_size="hidden_size";break;case "llama":case "cohere":case "mistral":case "starcoder2":case "qwen2":e.num_heads="num_key_value_heads",e.num_layers="num_hidden_layers",e.hidden_size="hidden_size",e.num_attention_heads="num_attention_heads";break;case "gemma":e.num_heads="num_key_value_heads",e.num_layers="num_hidden_layers",e.dim_kv="head_dim";break;case "openelm":e.num_heads="num_kv_heads",e.num_layers="num_transformer_layers",e.dim_kv="head_dim";break;case "gpt_neo":e.num_heads="num_heads",e.num_layers="num_layers",e.hidden_size="hidden_size";break;case "bloom":e.num_heads="n_head",e.num_layers="n_layer",e.hidden_size="hidden_size";break;case "mpt":e.num_heads="n_heads",e.num_layers="n_layers",e.hidden_size="d_model";break;case "t5":case "mt5":case "longt5":e.num_decoder_layers="num_decoder_layers",e.num_decoder_heads="num_heads",e.decoder_dim_kv="d_kv",e.num_encoder_layers="num_layers",e.num_encoder_heads="num_heads",e.encoder_dim_kv="d_kv";break;case "bart":case "mbart":case "marian":case "whisper":case "m2m_100":case "blenderbot":case "blenderbot-small":e.num_decoder_layers="decoder_layers",e.num_decoder_heads="decoder_attention_heads",e.decoder_hidden_size="d_model",e.num_encoder_layers="encoder_layers",e.num_encoder_heads="encoder_attention_heads",e.encoder_hidden_size="d_model";break;case "speecht5":e.num_decoder_layers="decoder_layers",e.num_decoder_heads="decoder_attention_heads",e.decoder_hidden_size="hidden_size",e.num_encoder_layers="encoder_layers",e.num_encoder_heads="encoder_attention_heads",e.encoder_hidden_size="hidden_size";break;case "trocr":e.num_encoder_layers=e.num_decoder_layers="decoder_layers",e.num_encoder_heads=e.num_decoder_heads="decoder_attention_heads",e.encoder_hidden_size=e.decoder_hidden_size="d_model";break;case "musicgen_decoder":e.num_encoder_layers=e.num_decoder_layers="num_hidden_layers",e.num_encoder_heads=e.num_decoder_heads="num_attention_heads",e.encoder_hidden_size=e.decoder_hidden_size="hidden_size";break;case "vision-encoder-decoder":const i=sn$2(t.encoder),a=sn$2(t.decoder),s="num_decoder_layers"in a,o={};return s?(o.num_decoder_layers=a.num_layers,o.num_decoder_heads=a.num_heads,o.decoder_hidden_size=a.hidden_size,o.num_encoder_layers=i.num_layers,o.num_encoder_heads=i.num_heads,o.encoder_hidden_size=i.hidden_size):(o.num_layers=a.num_layers,o.num_heads=a.num_heads,o.hidden_size=a.hidden_size),o}const n={...r,...zr$2(t,["model_type","multi_query","is_encoder_decoder"])};for(const i in e)n[i]=t[e[i]];return n}function fm(t,{prefix:e="past_key_values",encoder_add_pkv:r=true}={}){const n={},i=t.normalized_config,a=1;if(i.is_encoder_decoder&&r){const s=i.encoder_dim_kv??i.encoder_hidden_size/i.num_encoder_heads,o=i.decoder_dim_kv??i.decoder_hidden_size/i.num_decoder_heads,u=[a,i.num_encoder_heads,0,s],l=[a,i.num_decoder_heads,0,o];for(let h=0;h<i.num_decoder_layers;++h)n[`${e}.${h}.encoder.key`]=u,n[`${e}.${h}.encoder.value`]=u,n[`${e}.${h}.decoder.key`]=l,n[`${e}.${h}.decoder.value`]=l;}else {const s=i.num_heads,o=i.num_layers,u=i.dim_kv??i.hidden_size/(i.num_attention_heads??s);if(i.model_type==="falcon"){const l=[a*s,0,u];for(let h=0;h<o;++h)n[`${e}.${h}.key`]=l,n[`${e}.${h}.value`]=l;}else if(i.multi_query){const l=[a*s,0,2*u];for(let h=0;h<o;++h)n[`${e}.${h}.key_value`]=l;}else if(i.model_type==="bloom"){const l=[a*s,u,0],h=[a*s,0,u];for(let f=0;f<o;++f)n[`${e}.${f}.key`]=l,n[`${e}.${f}.value`]=h;}else if(i.model_type==="openelm")for(let l=0;l<o;++l){const h=[a,s[l],0,u];n[`${e}.${l}.key`]=h,n[`${e}.${l}.value`]=h;}else {const l=[a,s,0,u];for(let h=0;h<o;++h)n[`${e}.${h}.key`]=l,n[`${e}.${h}.value`]=l;}}return n}let yi$2 = class yi{max_position_embeddings;constructor(e){this.model_type=null,this.is_encoder_decoder=false,Object.assign(this,e),this.normalized_config=sn$2(this);}static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main"}={}){n&&!(n instanceof yi)&&(n=new yi(n));const o=n??await oy(e,{progress_callback:r,cache_dir:i,local_files_only:a,revision:s});return new this(o)}};class mm{static async from_pretrained(...e){return yi$2.from_pretrained(...e)}}const Za$1=Object.freeze({cpu:"cpu",gpu:"gpu",wasm:"wasm",webgpu:"webgpu"}),uy=function(){let t;return async function(){if(t===void 0)if(Pr$2.IS_NODE_ENV)t=true;else if(!Pr$2.IS_WEBGPU_AVAILABLE)t=false;else try{t=(await navigator.gpu.requestAdapter()).features.has("shader-f16");}catch{t=false;}return t}}(),$t$2=Object.freeze({fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),ly=Object.freeze({[Za$1.cpu]:$t$2.q8,[Za$1.gpu]:$t$2.fp32,[Za$1.wasm]:$t$2.q8,[Za$1.webgpu]:$t$2.fp32}),Sc$1=Object.freeze({[$t$2.fp32]:"",[$t$2.fp16]:"_fp16",[$t$2.int8]:"_int8",[$t$2.uint8]:"_uint8",[$t$2.q8]:"_quantized",[$t$2.q4]:"_q4",[$t$2.q4f16]:"_q4f16",[$t$2.bnb4]:"_bnb4"});let Zt$2 = class Zt extends or$2{_call(e,r){throw Error("`_call` should be implemented in a subclass")}};let Co$2 = class Co extends or$2{_call(e,r){throw Error("`_call` should be implemented in a subclass")}};let Ys$2 = class Ys extends or$2{constructor(){super(),this.processors=[];}push(e){this.processors.push(e);}extend(e){this.processors.push(...e);}_call(e,r){let n=r;for(const i of this.processors)n=i(e,n);return n}[Symbol.iterator](){return this.processors.values()}};class dy extends Zt$2{constructor(e){super(),this.bos_token_id=e;}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length===1){const i=r[n];i.data.fill(-1/0),i.data[this.bos_token_id]=0;}return r}}class cy extends Zt$2{constructor(e,r){super(),this.max_length=e,this.eos_token_id=Array.isArray(r)?r:[r];}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length===this.max_length-1){const i=r[n];i.data.fill(-1/0);for(const a of this.eos_token_id)i.data[a]=0;}return r}}class py extends Zt$2{constructor(e,r){super(),this.begin_suppress_tokens=e,this.begin_index=r;}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length===this.begin_index){const i=r[n];for(const a of this.begin_suppress_tokens)i.data[a]=-1/0;}return r}}class hy extends Zt$2{constructor(e,r){super(),this.eos_token_id=Array.isArray(e.eos_token_id)?e.eos_token_id[0]:e.eos_token_id,this.no_timestamps_token_id=e.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=r.length,r.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=e.max_initial_timestamp_index;}_call(e,r){for(let n=0;n<e.length;++n){const a=r[n].data;if(a[this.no_timestamps_token_id]=-1/0,e[n].length===this.begin_index-1){a.fill(-1/0),a[this.timestamp_begin]=0;continue}const s=e[n].slice(this.begin_index),o=s.length>=1&&s[s.length-1]>=this.timestamp_begin,u=s.length<2||s[s.length-2]>=this.timestamp_begin;if(o&&(u?a.subarray(this.timestamp_begin).fill(-1/0):a.subarray(0,this.eos_token_id).fill(-1/0)),e[n].length===this.begin_index&&this.max_initial_timestamp_index!==null){const m=this.timestamp_begin+this.max_initial_timestamp_index;a.subarray(m+1).fill(-1/0);}const l=o0(a),h=Math.log(l.subarray(this.timestamp_begin).map(Math.exp).reduce((m,c)=>m+c)),f=_r$2(l.subarray(0,this.timestamp_begin))[0];h>f&&a.subarray(0,this.timestamp_begin).fill(-1/0);}return r}}class fy extends Zt$2{constructor(e){super(),this.no_repeat_ngram_size=e;}getNgrams(e){const r=e.length,n=[];for(let a=0;a<r+1-this.no_repeat_ngram_size;++a){const s=[];for(let o=0;o<this.no_repeat_ngram_size;++o)s.push(e[a+o]);n.push(s);}const i=new Map;for(const a of n){const s=a.slice(0,a.length-1),o=JSON.stringify(s),u=i.get(o)??[];u.push(a[a.length-1]),i.set(o,u);}return i}getGeneratedNgrams(e,r){const n=r.slice(r.length+1-this.no_repeat_ngram_size,r.length);return e.get(JSON.stringify(n))??[]}calcBannedNgramTokens(e){const r=[];if(e.length+1<this.no_repeat_ngram_size)return r;{const n=this.getNgrams(e);return this.getGeneratedNgrams(n,e)}}_call(e,r){for(let n=0;n<e.length;++n){const i=r[n],a=this.calcBannedNgramTokens(e[n]);for(const s of a)i.data[s]=-1/0;}return r}}class my extends Zt$2{constructor(e){super(),this.penalty=e;}_call(e,r){for(let n=0;n<e.length;++n){const i=r[n];for(const a of e[n])i.data[a]<0?i.data[a]*=this.penalty:i.data[a]/=this.penalty;}return r}}class gy extends Zt$2{constructor(e,r){super(),this.min_length=e,this.eos_token_id=Array.isArray(r)?r:[r];}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length<this.min_length){const i=r[n];for(const a of this.eos_token_id)i.data[a]=-1/0;}return r}}let _y$1 = class _y extends Zt$2{constructor(e,r,n){super(),this.prompt_length_to_skip=e,this.min_new_tokens=r,this.eos_token_id=Array.isArray(n)?n:[n];}_call(e,r){for(let n=0;n<e.length;++n)if(e[n].length-this.prompt_length_to_skip<this.min_new_tokens){const a=r[n];for(const s of this.eos_token_id)a[s]=-1/0;}return r}};class yy extends Zt$2{constructor(e,r){super(),this.bad_words_ids=e,this.eos_token_id=Array.isArray(r)?r:[r];}_call(e,r){for(let n=0;n<e.length;++n){const i=r[n];for(const a of this.bad_words_ids){let s=true;for(let o=1;o<=a.length-1&&a.length<e[o].length;++o)if(a.at(-o-1)!==e[o].at(-o)){s=false;break}s&&(i[a.at(-1)]=-1/0);}}return r}}class wy extends Zt$2{constructor(e){if(super(),e<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${e}.`);this.guidance_scale=e;}_call(e,r){if(r.dims[0]!==2*e.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${r.dims[0]} for the logits and ${e.length} for the input ids.`);const n=e.length,i=r.slice([0,n],null),a=r.slice([n,r.dims[0]],null);for(let s=0;s<a.data.length;++s)a.data[s]+=(i.data[s]-a.data[s])*this.guidance_scale;return a}}class by extends Co$2{constructor(e){super(),this.temperature=e;}_call(e,r){const n=r.data;for(let i=0;i<n.length;++i)n[i]/=this.temperature;return r}}class vy extends Co$2{constructor(e,{filter_value:r=-1/0,min_tokens_to_keep:n=1}={}){if(super(),e<0||e>1)throw new Error(`\`top_p\` must be a float > 0 and < 1, but is ${e}`);if(!Number.isInteger(n)||n<1)throw new Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${n}`);this.top_p=e,this.filter_value=r,this.min_tokens_to_keep=n;}}class $y extends Co$2{constructor(e,{filter_value:r=-1/0,min_tokens_to_keep:n=1}={}){if(super(),!Number.isInteger(e)||e<0)throw new Error(`\`top_k\` must be a positive integer, but is ${e}`);this.top_k=Math.max(e,n),this.filter_value=r;}}class gm{max_length=20;max_new_tokens=null;min_length=0;min_new_tokens=null;early_stopping=false;max_time=null;do_sample=false;num_beams=1;num_beam_groups=1;penalty_alpha=null;use_cache=true;temperature=1;top_k=50;top_p=1;typical_p=1;epsilon_cutoff=0;eta_cutoff=0;diversity_penalty=0;repetition_penalty=1;encoder_repetition_penalty=1;length_penalty=1;no_repeat_ngram_size=0;bad_words_ids=null;force_words_ids=null;renormalize_logits=false;constraints=null;forced_bos_token_id=null;forced_eos_token_id=null;remove_invalid_values=false;exponential_decay_length_penalty=null;suppress_tokens=null;begin_suppress_tokens=null;forced_decoder_ids=null;guidance_scale=null;num_return_sequences=1;output_attentions=false;output_hidden_states=false;output_scores=false;return_dict_in_generate=false;pad_token_id=null;bos_token_id=null;eos_token_id=null;encoder_no_repeat_ngram_size=0;decoder_start_token_id=null;generation_kwargs={};constructor(e){Object.assign(this,zr$2(e,Object.getOwnPropertyNames(this)));}}let Eo$2 = class Eo extends or$2{_call(e,r){throw Error("StoppingCriteria needs to be subclassed")}};let To$2 = class To extends or$2{constructor(){super(),this.criteria=[];}push(e){this.criteria.push(e);}extend(e){e instanceof To?e=e.criteria:e instanceof Eo$2&&(e=[e]),this.criteria.push(...e);}_call(e,r){const n=new Array(e.length).fill(false);for(const i of this.criteria){const a=i(e,r);for(let s=0;s<n.length;++s)n[s]||=a[s];}return n}[Symbol.iterator](){return this.criteria.values()}};class xy extends Eo$2{constructor(e,r=null){super(),this.max_length=e,this.max_position_embeddings=r;}_call(e){return e.map(r=>r.length>=this.max_length)}}class Sy extends Eo$2{constructor(e){super(),Array.isArray(e)||(e=[e]),this.eos_token_id=e;}_call(e,r){return e.map(n=>{const i=n.at(-1);return this.eos_token_id.some(a=>i==a)})}}let Si$1 = class Si extends or$2{constructor(e){super(),this.generation_config=e;}async _call(e){return this.sample(e)}async sample(e){throw Error("sample should be implemented in subclasses.")}getLogits(e,r){let n=e.dims.at(-1),i=e.data;if(r===-1)i=i.slice(-n);else {let a=r*n;i=i.slice(a,a+n);}return i}randomSelect(e){let r=0;for(let i=0;i<e.length;++i)r+=e[i];let n=Math.random()*r;for(let i=0;i<e.length;++i)if(n-=e[i],n<=0)return i;return 0}static getSampler(e){if(e.do_sample)return new Ey(e);if(e.num_beams>1)return new Ty(e);if(e.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${e.num_return_sequences}.`);return new Cy(e)}};class Cy extends Si$1{async sample(e){const r=_r$2(e.data)[1];return [[BigInt(r),0]]}}class Ey extends Si$1{async sample(e){let r=e.dims.at(-1);this.generation_config.top_k>0&&(r=Math.min(this.generation_config.top_k,r));const[n,i]=await pm(e,r),a=ta$2(n.data);return Array.from({length:this.generation_config.num_beams},()=>{const s=this.randomSelect(a);return [i.data[s],Math.log(a[s])]})}}class Ty extends Si$1{async sample(e){let r=e.dims.at(-1);this.generation_config.top_k>0&&(r=Math.min(this.generation_config.top_k,r));const[n,i]=await pm(e,r),a=ta$2(n.data);return Array.from({length:this.generation_config.num_beams},(s,o)=>[i.data[o],Math.log(a[o])])}}class ky extends gm{return_timestamps=null;return_token_timestamps=null;num_frames=null;alignment_heads=null;task=null;language=null;no_timestamps_token_id=null;prompt_ids=null;is_multilingual=null;lang_to_id=null;task_to_id=null;max_initial_timestamp_index=1}const be$2={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7},wi$1=new Map,_m=new Map,qn$2=new Map;async function Iy(t,e,r){let n=r.device;n&&typeof n!="string"&&(n.hasOwnProperty(e)?n=n[e]:(console.warn(`Device not specified for ${e}. Using the default device.`),n=null));const i=H_(n);let a=r.dtype;if(typeof a!="string"&&(a&&a.hasOwnProperty(e)?a=a[e]:(a=ly[i[0]],console.warn(`Dtype not specified for ${e}. Using the default dtype: ${a}.`))),Sc$1.hasOwnProperty(a)){if(a===$t$2.fp16&&!await uy())throw new Error("The device does not support fp16.")}else throw new Error(`Invalid dtype: ${a}. Should be one of: ${Object.keys($t$2).join(", ")}`);const s=Sc$1[a],o=`${r.subfolder??""}/${e}${s}.onnx`,u={...r.session_options};u.executionProviders??=i;const l=ei$2(t,o,true,r);let h=[];if(r.use_external_data_format){if(Pr$2.IS_NODE_ENV)throw new Error("External data format is not yet supported in Node.js");const m=`${e}${s}.onnx_data`,c=`${r.subfolder??""}/${m}`;h.push(new Promise(async(y,b)=>{const v=await ei$2(t,c,true,r);y({path:m,data:v});}));}else u.externalData!==void 0&&(h=u.externalData.map(async m=>{if(typeof m.data=="string"){const c=await ei$2(t,m.data,true,r);return {...m,data:c}}return m}));if(h.length>0&&(u.externalData=await Promise.all(h)),n==="webgpu"){const m=fm(r.config,{prefix:"present"});if(Object.keys(m).length>0){const c={};for(const y in m)c[y]="gpu-buffer";u.preferredOutputLocation=c;}}return {buffer:await l,session_options:u}}async function Tr$2(t,e,r){const n=Object.keys(e),i=await Promise.all(n.map(async s=>Iy(t,e[s],r))),a={};for(let s=0;s<n.length;++s){const{buffer:o,session_options:u}=i[s],l=await lm(o,u);a[n[s]]=l;}return a}function Ay(t,e){const r=Object.create(null),n=[];for(const s of t.inputNames){const o=e[s];if(!(o instanceof ce$2)){n.push(s);continue}r[s]=q_()?o.clone():o;}if(n.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${n.join(", ")}.`);const i=Object.keys(e).length,a=t.inputNames.length;if(i>a){let s=Object.keys(e).filter(o=>!t.inputNames.includes(o));console.warn(`WARNING: Too many inputs were provided (${i} > ${a}). The following inputs will be ignored: "${s.join(", ")}".`);}return r}async function gr$2(t,e){const r=Ay(t,e);try{const n=Object.fromEntries(Object.entries(r).map(([a,s])=>[a,s.ort_tensor]));let i=await t.run(n);return i=ym(i),i}catch(n){throw console.error(`An error occurred during model execution: "${n}".`),console.error("Inputs given to model:",r),n}}function ym(t){for(let e in t)dm(t[e])?t[e]=new ce$2(t[e]):typeof t[e]=="object"&&ym(t[e]);return t}function wm(t){if(t instanceof ce$2)return t;if(t.length===0)throw Error("items must be non-empty");if(Array.isArray(t[0])){if(t.some(e=>e.length!==t[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new ce$2("int64",BigInt64Array.from(t.flat().map(e=>BigInt(e))),[t.length,t[0].length])}else return new ce$2("int64",BigInt64Array.from(t.map(e=>BigInt(e))),[1,t.length])}function bm(t){return new ce$2("bool",[t],[1])}async function Cc$1(t,e){let{encoder_outputs:r,past_key_values:n}=e;if(!r){const u=zr$2(e,t.sessions.model.inputNames);r=(await Jn$2(t,u)).last_hidden_state;}const{input_ids:i,decoder_input_ids:a,...s}=e;return s.input_ids=a,s.encoder_hidden_states=r,t.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(s.encoder_attention_mask=e.attention_mask),await ko$2(t,s,true)}async function Jn$2(t,e){const r=t.sessions.model,n=Object.create(null);for(const i of r.inputNames)n[i]=e[i];return r.inputNames.includes("token_type_ids")&&!n.token_type_ids&&(n.token_type_ids=new ce$2("int64",new BigInt64Array(n.input_ids.data.length),n.input_ids.dims)),await gr$2(r,n)}async function ko$2(t,e,r=false){const n=t.sessions[r?"decoder_model_merged":"model"],{past_key_values:i,...a}=e;n.inputNames.includes("use_cache_branch")&&(a.use_cache_branch=bm(!!i)),n.inputNames.includes("position_ids")&&a.attention_mask&&!a.position_ids&&(a.position_ids=Oy(a,i)),t.addPastKeyValues(a,i);const s=zr$2(a,n.inputNames);return await gr$2(n,s)}async function My(t,{input_ids:e=null,attention_mask:r=null,pixel_values:n=null,position_ids:i=null,inputs_embeds:a=null,past_key_values:s=null,generation_config:o=null,logits_processor:u=null,...l}){if(!a){if(a=await t.encode_text({input_ids:e}),n&&e.dims[1]!==1){const f=await t.encode_image({pixel_values:n});({inputs_embeds:a,attention_mask:r}=t._merge_input_ids_with_image_features({image_features:f,inputs_embeds:a,input_ids:e,attention_mask:r}));}else if(s&&n&&e.dims[1]===1){const f=e.dims[1],m=Object.values(s)[0].dims.at(-2);r=Jt$2([aa$2([e.dims[0],m]),r.slice(null,[r.dims[1]-f,r.dims[1]])],1);}}return await ko$2(t,{inputs_embeds:a,past_key_values:s,attention_mask:r,position_ids:i,generation_config:o,logits_processor:u},true)}function Oy(t,e=null){const{input_ids:r,inputs_embeds:n,attention_mask:i}=t,[a,s]=i.dims,o=new BigInt64Array(i.data.length);for(let l=0;l<a;++l){const h=l*s;let f=BigInt(0);for(let m=0;m<s;++m){const c=h+m;i.data[c]===0n?o[c]=BigInt(1):(o[c]=f,f+=i.data[c]);}}let u=new ce$2("int64",o,i.dims);if(e){const l=-(r??n).dims.at(1);u=u.slice(null,[l,null]);}return u}function Ec$1(t,e,r,n){if(r.past_key_values){const i=Object.values(r.past_key_values)[0].dims.at(-2),{input_ids:a,attention_mask:s}=r;if(!(s&&s.dims[1]>a.dims[1])){if(i<a.dims[1])r.input_ids=a.slice(null,[i,null]);else if(t.config.image_token_index!=null&&a.data.some(o=>o==t.config.image_token_index)){const o=t.config.num_image_tokens;if(!o)throw new Error("`num_image_tokens` is missing in the model configuration.");const u=a.dims[1]-(i-o);r.input_ids=a.slice(null,[-u,null]),r.attention_mask=aa$2([1,i+u]);}}}return r}function zy(t,e,r,n){const{...i}=r;return r.past_key_values&&(e=e.map(s=>[s.at(-1)])),i.decoder_input_ids=wm(e),i}let X$2 = class X extends or$2{main_input_name="input_ids";forward_params=["input_ids","attention_mask"];constructor(e,r){super(),this.config=e,this.sessions=r;const n=qn$2.get(this.constructor),i=wi$1.get(n);this.can_generate=false,this._forward=null,this._prepare_inputs_for_generation=null,i===be$2.DecoderOnly?(this.can_generate=true,this._forward=ko$2,this._prepare_inputs_for_generation=Ec$1):i===be$2.Seq2Seq||i===be$2.Vision2Seq||i===be$2.Musicgen?(this.can_generate=true,this._forward=Cc$1,this._prepare_inputs_for_generation=zy):i===be$2.EncoderDecoder?this._forward=Cc$1:i===be$2.ImageTextToText?(this.can_generate=true,this._forward=My,this._prepare_inputs_for_generation=Ec$1):this._forward=Jn$2,this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=this.config["transformers.js_config"]??{};}async dispose(){const e=[];for(const r of Object.values(this.sessions))r?.handler?.dispose&&e.push(r.handler.dispose());return await Promise.all(e)}static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main",model_file_name:o=null,subfolder:u="onnx",device:l=null,dtype:h=null,use_external_data_format:f=null,session_options:m={}}={}){let c={progress_callback:r,config:n,cache_dir:i,local_files_only:a,revision:s,model_file_name:o,subfolder:u,device:l,dtype:h,use_external_data_format:f,session_options:m};const y=qn$2.get(this),b=wi$1.get(y);c.config=await mm.from_pretrained(e,c);let v;return b===be$2.DecoderOnly?v=await Promise.all([Tr$2(e,{model:c.model_file_name??"model"},c),on$2(e,"generation_config.json",false,c)]):b===be$2.Seq2Seq||b===be$2.Vision2Seq?v=await Promise.all([Tr$2(e,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},c),on$2(e,"generation_config.json",false,c)]):b===be$2.MaskGeneration?v=await Promise.all([Tr$2(e,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},c)]):b===be$2.EncoderDecoder?v=await Promise.all([Tr$2(e,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},c)]):b===be$2.ImageTextToText?v=await Promise.all([Tr$2(e,{embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"},c),on$2(e,"generation_config.json",false,c)]):b===be$2.Musicgen?v=await Promise.all([Tr$2(e,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},c),on$2(e,"generation_config.json",false,c)]):(b!==be$2.EncoderOnly&&console.warn(`Model type for '${y??n?.model_type}' not found, assuming encoder-only architecture. Please report this at https://github.com/xenova/transformers.js/issues/new/choose.`),v=await Promise.all([Tr$2(e,{model:c.model_file_name??"model"},c)])),new this(c.config,...v)}async _call(e){return await this.forward(e)}async forward(e){return await this._forward(this,e)}_get_logits_warper(e){const r=new Ys$2;return e.temperature!==null&&e.temperature!==1&&r.push(new by(e.temperature)),e.top_k!==null&&e.top_k!==0&&r.push(new $y(e.top_k)),e.top_p!==null&&e.top_p<1&&r.push(new vy(e.top_p)),r}_get_logits_processor(e,r,n=null){const i=new Ys$2;if(e.repetition_penalty!==null&&e.repetition_penalty!==1&&i.push(new my(e.repetition_penalty)),e.no_repeat_ngram_size!==null&&e.no_repeat_ngram_size>0&&i.push(new fy(e.no_repeat_ngram_size)),e.bad_words_ids!==null&&i.push(new yy(e.bad_words_ids,e.eos_token_id)),e.min_length!==null&&e.eos_token_id!==null&&e.min_length>0&&i.push(new gy(e.min_length,e.eos_token_id)),e.min_new_tokens!==null&&e.eos_token_id!==null&&e.min_new_tokens>0&&i.push(new _y$1(r,e.min_new_tokens,e.eos_token_id)),e.forced_bos_token_id!==null&&i.push(new dy(e.forced_bos_token_id)),e.forced_eos_token_id!==null&&i.push(new cy(e.max_length,e.forced_eos_token_id)),e.begin_suppress_tokens!==null){const a=r>1||e.forced_bos_token_id===null?r:r+1;i.push(new py(e.begin_suppress_tokens,a));}return e.guidance_scale!==null&&e.guidance_scale>1&&i.push(new wy(e.guidance_scale)),n!==null&&i.extend(n),i}_prepare_generation_config(e,r,n=gm){const i={...this.config};for(const s of ["decoder","generator","text_config"])s in i&&Object.assign(i,i[s]);const a=new n(i);return "generation_config"in this&&Object.assign(a,this.generation_config),e&&Object.assign(a,e),r&&Object.assign(a,zr$2(r,Object.getOwnPropertyNames(a))),a}_get_stopping_criteria(e,r=null){const n=new To$2;return e.max_length!==null&&n.push(new xy(e.max_length,this.config.max_position_embeddings??null)),e.eos_token_id!==null&&n.push(new Sy(e.eos_token_id)),r&&n.extend(r),n}_validate_model_class(){if(!this.can_generate){const e=[Cg,Eg,Sg,xg],r=qn$2.get(this.constructor),n=new Set,i=this.config.model_type;for(const s of e){const o=s.get(i);o&&n.add(o[0]);}let a=`The current model class (${r}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;throw n.size>0&&(a+=` Please use the following class instead: ${[...n].join(", ")}`),Error(a)}}prepare_inputs_for_generation(...e){return this._prepare_inputs_for_generation(this,...e)}_update_model_kwargs_for_generation({generated_input_ids:e,outputs:r,model_inputs:n,is_encoder_decoder:i}){return n.past_key_values=this.getPastKeyValues(r,n.past_key_values),n.input_ids=new ce$2("int64",e.flat(),[e.length,1]),i||(n.attention_mask=Jt$2([n.attention_mask,aa$2([n.attention_mask.dims[0],1])],1)),n.position_ids=null,n}_prepare_model_inputs({inputs:e,bos_token_id:r,model_kwargs:n}){const i=zr$2(n,this.forward_params),a=this.main_input_name;if(a in i){if(e)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else i[a]=e;return {inputs_tensor:i[a],model_inputs:i,model_input_name:a}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:e,model_inputs:r,model_input_name:n,generation_config:i}){const a=zr$2(r,this.sessions.model.inputNames);let{last_hidden_state:s}=await Jn$2(this,a);return i.guidance_scale!==null&&i.guidance_scale>1&&(s=Jt$2([s,ey(s,0)],0),"attention_mask"in r&&(r.attention_mask=Jt$2([r.attention_mask,ny(r.attention_mask)],0))),r.encoder_outputs=s,r}_prepare_decoder_input_ids_for_generation({batch_size:e,model_input_name:r,model_kwargs:n,decoder_start_token_id:i,bos_token_id:a,generation_config:s}){let{decoder_input_ids:o,...u}=n;if(!o)if(i??=a,this.config.model_type==="musicgen")o=Array.from({length:e*this.config.decoder.num_codebooks},()=>[i]);else if(Array.isArray(i)){if(i.length!==e)throw new Error(`\`decoder_start_token_id\` expcted to have length ${e} but got ${i.length}`);o=i;}else o=Array.from({length:e},()=>[i]);return o=wm(o),n.decoder_attention_mask=ty(o),{input_ids:o,model_inputs:u}}async generate({inputs:e=null,generation_config:r=null,logits_processor:n=null,stopping_criteria:i=null,streamer:a=null,...s}){this._validate_model_class(),r=this._prepare_generation_config(r,s);let{inputs_tensor:o,model_inputs:u,model_input_name:l}=this._prepare_model_inputs({inputs:e,model_kwargs:s});const h=this.config.is_encoder_decoder;h&&("encoder_outputs"in u||(u=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:o,model_inputs:u,model_input_name:l,generation_config:r})));let f;h?{input_ids:f,model_inputs:u}=this._prepare_decoder_input_ids_for_generation({batch_size:u[l].dims.at(0),model_input_name:l,model_kwargs:u,decoder_start_token_id:r.decoder_start_token_id,bos_token_id:r.bos_token_id,generation_config:r}):f=u[l];let m=f.dims.at(-1);r.max_new_tokens!==null&&(r.max_length=m+r.max_new_tokens);const c=this._get_logits_processor(r,m,n),y=this._get_stopping_criteria(r,i),b=u[l].dims.at(0),v=Si$1.getSampler(r),C=new Array(b).fill(0),x=f.tolist();a&&a.put(x);let T=null;for(;;){u=this.prepare_inputs_for_generation(x,u,r);const A=await this.forward(u),R=A.logits.slice(null,-1,null),z=c(x,R),P=[];for(let K=0;K<z.dims.at(0);++K){const ue=z[K],ie=await v(ue);for(const[ge,he]of ie){const D=BigInt(ge);C[K]+=he,x[K].push(D),P.push([D]);break}}if(a&&a.put(P),y(x).every(K=>K)){r.return_dict_in_generate&&(T=this.getPastKeyValues(A,u.past_key_values,false));break}u=this._update_model_kwargs_for_generation({generated_input_ids:P,outputs:A,model_inputs:u,is_encoder_decoder:h});}a&&a.end();const I=new ce$2("int64",x.flat(),[x.length,x[0].length]);return r.return_dict_in_generate?{sequences:I,past_key_values:T}:I}addAttentionsToBeam(e,r){if(this.config.is_encoder_decoder){if(!r.cross_attentions||r.cross_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce cross-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.cross_attentions||(e.cross_attentions=[]),e.cross_attentions.push(r.cross_attentions);}if(!r.decoder_attentions||r.decoder_attentions.length===0)throw Error("`output_attentions` is true, but the model did not produce decoder-attentions. This is most likely because the model was not exported with `output_attentions=True`.");e.decoder_attentions||(e.decoder_attentions=[]),e.decoder_attentions.push(r.decoder_attentions);}groupBeams(e){const r=Object.create(null);for(const n of e)r[n.id]===void 0?r[n.id]=[n]:r[n.id].push(n);return Object.values(r)}getPastKeyValues(e,r,n=true){const i=Object.create(null);for(const a in e)if(a.startsWith("present")){let s=a.replace("present","past_key_values");if(r&&a.includes("encoder"))i[s]=r[s];else {if(n&&r){const o=r[s];o.location==="gpu-buffer"&&o.dispose();}i[s]=e[a];}}return i}getAttentions(e){const r=Object.create(null);for(const n of ["cross_attentions","decoder_attentions"]){const i=[];for(const a in e)if(a.startsWith(n)){const s=a.split(".").pop();i[s]=e[a];}r[n]=i;}return r}addPastKeyValues(e,r){if(r)Object.assign(e,r);else {const n=this.custom_config.kv_cache_dtype??"float32",i=n==="float16"?new Uint16Array:[],a=fm(this.config);for(const s in a)e[s]=new ce$2(n,i,a[s]);}}};let Ot$2 = class Ot{};let ia$2 = class ia extends X$2{};class Ry extends ia$2{}class Py extends ia$2{async _call(e){return new dt$2(await super._call(e))}}class By extends ia$2{async _call(e){return new Ae$2(await super._call(e))}}class Dy extends ia$2{async _call(e){return new lt$2(await super._call(e))}}class Ny extends ia$2{async _call(e){return new mt$2(await super._call(e))}}class Fy extends X$2{}class Ly extends Fy{}let sa$2 = class sa extends X$2{};class Wy extends sa$2{}class Uy extends sa$2{async _call(e){return new dt$2(await super._call(e))}}class Vy extends sa$2{async _call(e){return new Ae$2(await super._call(e))}}class Gy extends sa$2{async _call(e){return new lt$2(await super._call(e))}}class Hy extends sa$2{async _call(e){return new mt$2(await super._call(e))}}let oa$2 = class oa extends X$2{};class qy extends oa$2{}class jy extends oa$2{async _call(e){return new dt$2(await super._call(e))}}class Ky extends oa$2{async _call(e){return new Ae$2(await super._call(e))}}class Yy extends oa$2{async _call(e){return new lt$2(await super._call(e))}}class Xy extends oa$2{async _call(e){return new mt$2(await super._call(e))}}let ua$2 = class ua extends X$2{};class Qy extends ua$2{}class Jy extends ua$2{async _call(e){return new dt$2(await super._call(e))}}class Zy extends ua$2{async _call(e){return new Ae$2(await super._call(e))}}class ew extends ua$2{async _call(e){return new lt$2(await super._call(e))}}class tw extends ua$2{async _call(e){return new mt$2(await super._call(e))}}let la$2 = class la extends X$2{};class rw extends la$2{}class nw extends la$2{async _call(e){return new dt$2(await super._call(e))}}class aw extends la$2{async _call(e){return new Ae$2(await super._call(e))}}class iw extends la$2{async _call(e){return new lt$2(await super._call(e))}}class sw extends la$2{async _call(e){return new mt$2(await super._call(e))}}let da$2 = class da extends X$2{};class ow extends da$2{}class uw extends da$2{async _call(e){return new dt$2(await super._call(e))}}class lw extends da$2{async _call(e){return new Ae$2(await super._call(e))}}class dw extends da$2{async _call(e){return new lt$2(await super._call(e))}}class cw extends da$2{async _call(e){return new mt$2(await super._call(e))}}let ca$2 = class ca extends X$2{};class pw extends ca$2{}class hw extends ca$2{async _call(e){return new dt$2(await super._call(e))}}class fw extends ca$2{async _call(e){return new Ae$2(await super._call(e))}}class mw extends ca$2{async _call(e){return new lt$2(await super._call(e))}}class gw extends ca$2{async _call(e){return new mt$2(await super._call(e))}}let pa$2 = class pa extends X$2{};class _w extends pa$2{}class yw extends pa$2{async _call(e){return new Ae$2(await super._call(e))}}class ww extends pa$2{async _call(e){return new lt$2(await super._call(e))}}class bw extends pa$2{async _call(e){return new mt$2(await super._call(e))}}class vw extends pa$2{async _call(e){return new dt$2(await super._call(e))}}let Ci$2 = class Ci extends X$2{};class $w extends Ci$2{}class xw extends Ci$2{async _call(e){return new dt$2(await super._call(e))}}class Sw extends Ci$2{async _call(e){return new Ae$2(await super._call(e))}}class Cw extends Ci$2{async _call(e){return new lt$2(await super._call(e))}}let Ei$1 = class Ei extends X$2{};class Ew extends Ei$1{}class Tw extends Ei$1{async _call(e){return new dt$2(await super._call(e))}}class kw extends Ei$1{async _call(e){return new Ae$2(await super._call(e))}}class Iw extends Ei$1{async _call(e){return new mt$2(await super._call(e))}}let ha$2 = class ha extends X$2{};class Aw extends ha$2{}class Mw extends ha$2{async _call(e){return new dt$2(await super._call(e))}}class Ow extends ha$2{async _call(e){return new Ae$2(await super._call(e))}}class zw extends ha$2{async _call(e){return new lt$2(await super._call(e))}}class Rw extends ha$2{async _call(e){return new mt$2(await super._call(e))}}let Ti$2 = class Ti extends X$2{};class Pw extends Ti$2{}class Bw extends Ti$2{async _call(e){return new dt$2(await super._call(e))}}class Dw extends Ti$2{async _call(e){return new Ae$2(await super._call(e))}}class Nw extends Ti$2{async _call(e){return new mt$2(await super._call(e))}}let ki$1 = class ki extends X$2{};class Fw extends ki$1{}class Lw extends ki$1{async _call(e){return new Ae$2(await super._call(e))}}class Ww extends ki$1{async _call(e){return new mt$2(await super._call(e))}}class Uw extends ki$1{async _call(e){return new dt$2(await super._call(e))}}class vm extends X$2{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class Vw extends vm{}class Gw extends vm{}class $m extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Hw extends $m{}class qw extends $m{}class xm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class jw extends xm{}class Kw extends xm{}let Io$2 = class Io extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}};class Yw extends Io$2{}class Xw extends Io$2{}class Qw extends Io$2{async _call(e){return new Ae$2(await super._call(e))}}let Ii$1 = class Ii extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}};class Jw extends Ii$1{}class Zw extends Ii$1{}class eb extends Ii$1{async _call(e){return new Ae$2(await super._call(e))}}class tb extends Ii$1{}class Sm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class rb extends Sm{}class nb extends Sm{}class Cm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class ab extends Cm{}class ib extends Cm{}let fa$2 = class fa extends X$2{};class sb extends fa$2{}class ob extends fa$2{async _call(e){return new dt$2(await super._call(e))}}class ub extends fa$2{async _call(e){return new Ae$2(await super._call(e))}}class lb extends fa$2{async _call(e){return new lt$2(await super._call(e))}}class db extends fa$2{async _call(e){return new mt$2(await super._call(e))}}let ma$2 = class ma extends X$2{};class cb extends ma$2{}class pb extends ma$2{async _call(e){return new dt$2(await super._call(e))}}class hb extends ma$2{async _call(e){return new Ae$2(await super._call(e))}}class fb extends ma$2{async _call(e){return new lt$2(await super._call(e))}}class mb extends ma$2{async _call(e){return new mt$2(await super._call(e))}}let ga$2 = class ga extends X$2{};class gb extends ga$2{}let _b$1 = class _b extends ga$2{async _call(e){return new dt$2(await super._call(e))}};class yb extends ga$2{async _call(e){return new Ae$2(await super._call(e))}}class wb extends ga$2{async _call(e){return new lt$2(await super._call(e))}}class bb extends ga$2{async _call(e){return new mt$2(await super._call(e))}}class Em extends X$2{}class vb extends Em{}class $b extends Em{}class Tm extends X$2{requires_attention_mask=false;main_input_name="input_features";forward_params=["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class xb extends Tm{}class Sb extends Tm{_prepare_generation_config(e,r){return super._prepare_generation_config(e,r,ky)}_retrieve_init_tokens(e){const r=[e.decoder_start_token_id];let n=e.language;const i=e.task;if(e.is_multilingual){n||(console.warn("No language specified - defaulting to English (en)."),n="en");const s=`<|${iy(n)}|>`;r.push(e.lang_to_id[s]),r.push(e.task_to_id[i??"transcribe"]);}else if(n||i)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return !e.return_timestamps&&e.no_timestamps_token_id&&r.at(-1)!==e.no_timestamps_token_id?r.push(e.no_timestamps_token_id):e.return_timestamps&&r.at(-1)===e.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),r.pop()),r.filter(a=>a!=null)}async generate({inputs:e=null,generation_config:r=null,logits_processor:n=null,stopping_criteria:i=null,...a}){r=this._prepare_generation_config(r,a);const s=this._retrieve_init_tokens(r);return r.return_timestamps&&(n??=new Ys$2,n.push(new hy(r,s))),await super.generate({inputs:e,generation_config:r,logits_processor:n,decoder_input_ids:s,...a})}_extract_token_timestamps(e,r,n=null,i=.02){if(!e.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");let a=this.config.median_filter_width;a===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),a=7);const s=e.cross_attentions.map(l=>{let h=Array.from({length:this.config.decoder_layers},(v,C)=>Jt$2(l.map(x=>x[C]),2)),f=Qn$2(r.map(([v,C])=>n?h[v].slice(null,C,null,[0,n]):h[v].slice(null,C)));f=f.transpose(1,0,2,3);let[m,c]=X_(f,-2,0,true),y=f.clone();for(let v=0;v<y.dims[0];++v){let C=y[v];for(let x=0;x<C.dims[0];++x){let T=C[x];const I=m[v][x][0],A=c[v][x][0];for(let R=0;R<T.dims[0];++R){let z=T[R];for(let P=0;P<z.data.length;++P)z.data[P]=(z.data[P]-A.data[P])/I.data[P];z.data.set(c0(z.data,a));}}}return xo$2(y,1)}),o=[e.sequences.length,e.sequences[0].length],u=new ce$2("float32",new Float32Array(o[0]*o[1]),o);for(let l=0;l<o[0];++l){const h=s[l].neg().squeeze_(0);let[f,m]=Q_(h),c=Array.from({length:f.length-1},(v,C)=>f[C+1]-f[C]),y=e0([1],c).map(v=>!!v),b=[];for(let v=0;v<y.length;++v)y[v]&&b.push(m[v]*i);u[l].data.set(b,1);}return u}}class Cb extends X$2{main_input_name="pixel_values";forward_params=["pixel_values","input_ids","encoder_hidden_states","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class Eb extends X$2{forward_params=["input_ids","pixel_values","attention_mask","position_ids","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}}class km extends Eb{async encode_image({pixel_values:e}){const r=(await gr$2(this.sessions.vision_encoder,{pixel_values:e})).image_features;return this.config.num_image_tokens||(console.warn(`The number of image tokens was not set in the model configuration. Setting it to the number of features detected by the vision encoder (${r.dims[1]}).`),this.config.num_image_tokens=r.dims[1]),r}async encode_text({input_ids:e}){return (await gr$2(this.sessions.embed_tokens,{input_ids:e})).inputs_embeds}_merge_input_ids_with_image_features({inputs_embeds:e,image_features:r,input_ids:n,attention_mask:i}){const a=this.config.image_token_index,o=n.tolist().map(m=>m.findIndex(c=>c==a)),u=o.every(m=>m===-1),l=o.every(m=>m!==-1);if(!u&&!l)throw new Error("Every input should contain either 0 or 1 image token.");if(u)return {inputs_embeds:e,attention_mask:i};const h=[],f=[];for(let m=0;m<o.length;++m){const c=o[m],y=e[m],b=r[m],v=i[m];h.push(Jt$2([y.slice([0,c]),b,y.slice([c+1,y.dims[0]])],0)),f.push(Jt$2([v.slice([0,c]),aa$2([b.dims[0]]),v.slice([c+1,v.dims[0]])],0));}return {inputs_embeds:Qn$2(h,0),attention_mask:Qn$2(f,0)}}}class Tb extends km{}let Ai$1 = class Ai extends X$2{};class kb extends Ai$1{}class Ib extends Ai$1{static async from_pretrained(e,r={}){return r.model_file_name??="text_model",super.from_pretrained(e,r)}}class Ab extends Ai$1{static async from_pretrained(e,r={}){return r.model_file_name??="vision_model",super.from_pretrained(e,r)}}class Im extends X$2{}class Mb extends Im{}class Ob extends Im{static async from_pretrained(e,r={}){return r.model_file_name??="text_model",super.from_pretrained(e,r)}}class zb extends Ai$1{static async from_pretrained(e,r={}){return r.model_file_name??="vision_model",super.from_pretrained(e,r)}}class Rb extends X$2{}class Pb extends Rb{}class Am extends X$2{}class Bb extends Am{}class Db extends Am{}class Mm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Nb extends Mm{}class Fb extends Mm{}class Om extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Lb extends Om{}class Wb extends Om{}class zm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Ub extends zm{}class Vb extends zm{}class Rm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Gb extends Rm{}class Hb extends Rm{}class Pm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class qb extends Pm{}class jb extends Pm{}class Bm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Kb extends Bm{}class Yb extends Bm{}class Dm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Xb extends Dm{}class Qb extends Dm{}class Nm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class Jb extends Nm{}class Zb extends Nm{}class Fm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class e2 extends Fm{}class t2 extends Fm{}class Lm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class r2 extends Lm{}class n2 extends Lm{}class Wm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class a2 extends Wm{}class i2 extends Wm{}class Um extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class s2 extends Um{}class o2 extends Um{}class Vm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class u2 extends Vm{}class l2 extends Vm{}class Gm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class d2 extends Gm{}class c2 extends Gm{}class Hm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class p2 extends Hm{}class h2 extends Hm{}class qm extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class f2 extends qm{}class m2 extends qm{}class jm extends X$2{}class g2 extends jm{}class _2 extends jm{async _call(e){return new Ae$2(await super._call(e))}}class Km extends X$2{}class y2 extends Km{}class w2 extends Km{async _call(e){return new Ae$2(await super._call(e))}}let b2$1 = class b2 extends X$2{};class v2 extends b2$1{async _call(e){return new Rv(await super._call(e))}}class Ym extends X$2{}class $2 extends Ym{}class x2 extends Ym{async _call(e){return new Ae$2(await super._call(e))}}class Xm extends X$2{}class S2 extends Xm{}class C2 extends Xm{async _call(e){return new Ae$2(await super._call(e))}}class Qm extends X$2{}class E2 extends Qm{}class T2 extends Qm{}class Jm extends X$2{}class k2 extends Jm{}class I2 extends Jm{}class Zm extends X$2{}class A2 extends Zm{}class M2 extends Zm{async _call(e){return new Ae$2(await super._call(e))}}let Ao$2 = class Ao extends X$2{};class O2 extends Ao$2{}class z2 extends Ao$2{async _call(e){return new eg(await super._call(e))}}class R2 extends Ao$2{async _call(e){return new P2(await super._call(e))}}class eg extends Ot$2{constructor({logits:e,pred_boxes:r}){super(),this.logits=e,this.pred_boxes=r;}}class P2 extends Ot$2{constructor({logits:e,pred_boxes:r,pred_masks:n}){super(),this.logits=e,this.pred_boxes=r,this.pred_masks=n;}}class tg extends X$2{}class B2 extends tg{}class D2 extends tg{async _call(e){return new N2(await super._call(e))}}class N2 extends eg{}class rg extends X$2{}class F2 extends rg{}class L2 extends rg{async _call(e){return new Ae$2(await super._call(e))}}class ng extends X$2{}class W2 extends ng{}class U2 extends ng{async _call(e){return new Ae$2(await super._call(e))}}class ag extends X$2{}class V2 extends ag{}class G2 extends ag{async _call(e){return new Ae$2(await super._call(e))}}class ig extends X$2{}class H2 extends ig{}class q2 extends ig{}class sg extends X$2{}class j2 extends sg{}class K2 extends sg{}class Y2 extends X$2{}class X2 extends Y2{}class og extends X$2{}class Q2 extends og{}class J2 extends og{}class Z2 extends X$2{}class e1 extends Z2{}class ug extends X$2{}class t1 extends ug{}class r1 extends ug{async _call(e){return new Ae$2(await super._call(e))}}class lg extends X$2{}class n1 extends lg{}class a1 extends lg{async _call(e){return new Ae$2(await super._call(e))}}class dg extends X$2{}class i1 extends dg{}class s1 extends dg{async _call(e){return new Ae$2(await super._call(e))}}class cg extends X$2{}class o1 extends cg{}class u1 extends cg{async _call(e){return new l1(await super._call(e))}}class l1 extends Ot$2{constructor({logits:e,pred_boxes:r}){super(),this.logits=e,this.pred_boxes=r;}}class d1 extends X$2{}class c1 extends d1{async get_image_embeddings({pixel_values:e}){return await Jn$2(this,{pixel_values:e})}async forward(e){if((!e.image_embeddings||!e.image_positional_embeddings)&&(e={...e,...await this.get_image_embeddings(e)}),!e.input_labels&&e.input_points){const n=e.input_points.dims.slice(0,-1),i=n.reduce((a,s)=>a*s,1);e.input_labels=new ce$2("int64",new BigInt64Array(i).fill(1n),n);}const r={image_embeddings:e.image_embeddings,image_positional_embeddings:e.image_positional_embeddings};return e.input_points&&(r.input_points=e.input_points),e.input_labels&&(r.input_labels=e.input_labels),e.input_boxes&&(r.input_boxes=e.input_boxes),await gr$2(this.sessions.prompt_encoder_mask_decoder,r)}async _call(e){return new p1(await super._call(e))}}class p1 extends Ot$2{constructor({iou_scores:e,pred_masks:r}){super(),this.iou_scores=e,this.pred_masks=r;}}class pg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class h1 extends pg{}class f1 extends pg{}class hg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class m1 extends hg{}class g1 extends hg{}let Ur$2 = class Ur extends X$2{};class _1 extends Ur$2{}class y1 extends Ur$2{async _call(e){return new gn$2(await super._call(e))}}class w1 extends Ur$2{async _call(e){return new Ae$2(await super._call(e))}}class b1 extends Ur$2{async _call(e){return new lt$2(await super._call(e))}}let Mo$2 = class Mo extends X$2{};class v1 extends Mo$2{}class $1 extends Mo$2{async _call(e){return new gn$2(await super._call(e))}}class x1 extends Mo$2{async _call(e){return new Ae$2(await super._call(e))}}let Mi$1 = class Mi extends X$2{};class S1 extends Mi$1{}class C1 extends Mi$1{async _call(e){return new gn$2(await super._call(e))}}class E1 extends Mi$1{async _call(e){return new Ae$2(await super._call(e))}}class T1 extends Mi$1{async _call(e){return new lt$2(await super._call(e))}}let Oo$2 = class Oo extends X$2{};class k1 extends Oo$2{}class I1 extends Oo$2{async _call(e){return new gn$2(await super._call(e))}}class A1 extends Oo$2{async _call(e){return new Ae$2(await super._call(e))}}class M1 extends Ur$2{}class O1 extends Ur$2{async _call(e){return new gn$2(await super._call(e))}}class z1 extends Ur$2{async _call(e){return new Ae$2(await super._call(e))}}let _a$3 = class _a extends X$2{};class R1 extends _a$3{}class P1 extends _a$3{async _call(e){return new gn$2(await super._call(e))}}class B1 extends _a$3{async _call(e){return new Ae$2(await super._call(e))}}class D1 extends _a$3{async _call(e){return new zv(await super._call(e))}}class N1 extends _a$3{async _call(e){return new lt$2(await super._call(e))}}class fg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class F1 extends fg{}class L1 extends fg{async generate_speech(e,r,{threshold:n=.5,minlenratio:i=0,maxlenratio:a=20,vocoder:s=null}={}){const o={input_ids:e},{encoder_outputs:u,encoder_attention_mask:l}=await Jn$2(this,o),h=u.dims[1]/this.config.reduction_factor,f=Math.floor(h*a),m=Math.floor(h*i),c=this.config.num_mel_bins;let y=[],b=null,v=null,C=0;for(;;){++C;const I=bm(!!v);let A;v?A=v.output_sequence_out:A=new ce$2("float32",new Float32Array(c),[1,1,c]);let R={use_cache_branch:I,output_sequence:A,encoder_attention_mask:l,speaker_embeddings:r,encoder_hidden_states:u};this.addPastKeyValues(R,b),v=await gr$2(this.sessions.decoder_model_merged,R),b=this.getPastKeyValues(v,b);const{prob:z,spectrum:P}=v;if(y.push(P),C>=m&&(Array.from(z.data).filter(J=>J>=n).length>0||C>=f))break}const x=Jt$2(y),{waveform:T}=await gr$2(s.sessions.model,{spectrogram:x});return {spectrogram:x,waveform:T}}}class W1 extends X$2{main_input_name="spectrogram"}class U1 extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class V1 extends U1{}class mg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class G1 extends mg{}class H1 extends mg{}class gg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class q1 extends gg{}class j1 extends gg{}class _g extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class K1 extends _g{}class Y1 extends _g{}let zo$2 = class zo extends X$2{};class X1 extends zo$2{}class Q1 extends zo$2{static async from_pretrained(e,r={}){return r.model_file_name??="text_model",super.from_pretrained(e,r)}}class J1 extends zo$2{static async from_pretrained(e,r={}){return r.model_file_name??="audio_model",super.from_pretrained(e,r)}}class Z1 extends X$2{}class yg extends Z1{async _call(e){return new Pv(await super._call(e))}}class wg extends X$2{}class ev extends wg{}class tv extends wg{}class bg extends X$2{constructor(e,r,n){super(e,r),this.generation_config=n;}}class rv extends bg{}class nv extends bg{}class vg extends X$2{}class av extends vg{}class iv extends vg{async _call(e){return new Ae$2(await super._call(e))}}class $g extends X$2{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"];constructor(e,r,n){super(e,r),this.generation_config=n;}_apply_and_filter_by_delay_pattern_mask(e){const[r,n]=e.dims,i=this.config.decoder.num_codebooks,a=n-i;let s=0;for(let l=0;l<e.size;++l){if(e.data[l]===this.config.decoder.pad_token_id)continue;const h=l%n,f=Math.floor(l/n)%i,m=h-f;m>0&&m<=a&&(e.data[s++]=e.data[l]);}const o=Math.floor(r/i),u=s/(o*i);return new ce$2(e.type,e.data.slice(0,s),[o,i,u])}prepare_inputs_for_generation(e,r,n){let i=structuredClone(e);for(let s=0;s<i.length;++s)for(let o=0;o<i[s].length;++o)s%this.config.decoder.num_codebooks>=o&&(i[s][o]=BigInt(this.config.decoder.pad_token_id));return n.guidance_scale!==null&&n.guidance_scale>1&&(i=i.concat(i)),super.prepare_inputs_for_generation(i,r,n)}async generate(e){const r=await super.generate(e),n=this._apply_and_filter_by_delay_pattern_mask(r).unsqueeze_(0),{audio_values:i}=await gr$2(this.sessions.encodec_decode,{audio_codes:n});return i}}class sv{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=false;static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main",model_file_name:o=null,subfolder:u="onnx",device:l=null,dtype:h=null,use_external_data_format:f=null,session_options:m={}}={}){let c={progress_callback:r,config:n,cache_dir:i,local_files_only:a,revision:s,model_file_name:o,subfolder:u,device:l,dtype:h,use_external_data_format:f,session_options:m};if(c.config=await mm.from_pretrained(e,c),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);for(let y of this.MODEL_CLASS_MAPPINGS){const b=y.get(c.config.model_type);if(b)return await b[1].from_pretrained(e,c)}if(this.BASE_IF_FAIL)return console.warn(`Unknown model class "${c.config.model_type}", attempting to construct from base class.`),await X$2.from_pretrained(e,c);throw Error(`Unsupported model type: ${c.config.model_type}`)}}const ov=new Map([["bert",["BertModel",Ry]],["nomic_bert",["NomicBertModel",Ly]],["roformer",["RoFormerModel",Wy]],["electra",["ElectraModel",Qy]],["esm",["EsmModel",$w]],["convbert",["ConvBertModel",qy]],["camembert",["CamembertModel",rw]],["deberta",["DebertaModel",ow]],["deberta-v2",["DebertaV2Model",pw]],["mpnet",["MPNetModel",Aw]],["albert",["AlbertModel",Fw]],["distilbert",["DistilBertModel",_w]],["roberta",["RobertaModel",sb]],["xlm",["XLMModel",cb]],["xlm-roberta",["XLMRobertaModel",gb]],["clap",["ClapModel",X1]],["clip",["CLIPModel",kb]],["clipseg",["CLIPSegModel",Bb]],["chinese_clip",["ChineseCLIPModel",Pb]],["siglip",["SiglipModel",Mb]],["mobilebert",["MobileBertModel",Ew]],["squeezebert",["SqueezeBertModel",Pw]],["wav2vec2",["Wav2Vec2Model",_1]],["wav2vec2-bert",["Wav2Vec2BertModel",k1]],["unispeech",["UniSpeechModel",v1]],["unispeech-sat",["UniSpeechSatModel",S1]],["hubert",["HubertModel",M1]],["wavlm",["WavLMModel",R1]],["audio-spectrogram-transformer",["ASTModel",vb]],["vits",["VitsModel",yg]],["detr",["DetrModel",O2]],["table-transformer",["TableTransformerModel",B2]],["vit",["ViTModel",g2]],["fastvit",["FastViTModel",y2]],["mobilevit",["MobileViTModel",$2]],["mobilevitv2",["MobileViTV2Model",S2]],["owlvit",["OwlViTModel",E2]],["owlv2",["Owlv2Model",k2]],["beit",["BeitModel",A2]],["deit",["DeiTModel",F2]],["convnext",["ConvNextModel",t1]],["convnextv2",["ConvNextV2Model",n1]],["dinov2",["Dinov2Model",i1]],["resnet",["ResNetModel",W2]],["swin",["SwinModel",V2]],["swin2sr",["Swin2SRModel",H2]],["donut-swin",["DonutSwinModel",e1]],["yolos",["YolosModel",o1]],["dpt",["DPTModel",j2]],["glpn",["GLPNModel",Q2]],["hifigan",["SpeechT5HifiGan",W1]],["efficientnet",["EfficientNetModel",av]]]),uv=new Map([["t5",["T5Model",Vw]],["longt5",["LongT5Model",Hw]],["mt5",["MT5Model",jw]],["bart",["BartModel",Yw]],["mbart",["MBartModel",Jw]],["marian",["MarianModel",h1]],["whisper",["WhisperModel",xb]],["m2m_100",["M2M100Model",m1]],["blenderbot",["BlenderbotModel",rb]],["blenderbot-small",["BlenderbotSmallModel",ab]]]),lv=new Map([["bloom",["BloomModel",d2]],["gpt2",["GPT2Model",Nb]],["gptj",["GPTJModel",Gb]],["gpt_bigcode",["GPTBigCodeModel",qb]],["gpt_neo",["GPTNeoModel",Lb]],["gpt_neox",["GPTNeoXModel",Ub]],["codegen",["CodeGenModel",Kb]],["llama",["LlamaModel",Xb]],["cohere",["CohereModel",Jb]],["gemma",["GemmaModel",e2]],["openelm",["OpenELMModel",r2]],["qwen2",["Qwen2Model",a2]],["phi",["PhiModel",s2]],["phi3",["Phi3Model",u2]],["mpt",["MptModel",p2]],["opt",["OPTModel",f2]],["mistral",["MistralModel",G1]],["starcoder2",["Starcoder2Model",q1]],["falcon",["FalconModel",K1]],["stablelm",["StableLmModel",rv]]]),xg=new Map([["speecht5",["SpeechT5ForSpeechToText",F1]],["whisper",["WhisperForConditionalGeneration",Sb]]]),dv=new Map([["speecht5",["SpeechT5ForTextToSpeech",L1]]]),cv=new Map([["vits",["VitsModel",yg]],["musicgen",["MusicgenForConditionalGeneration",$g]]]),pv=new Map([["bert",["BertForSequenceClassification",By]],["roformer",["RoFormerForSequenceClassification",Vy]],["electra",["ElectraForSequenceClassification",Zy]],["esm",["EsmForSequenceClassification",Sw]],["convbert",["ConvBertForSequenceClassification",Ky]],["camembert",["CamembertForSequenceClassification",aw]],["deberta",["DebertaForSequenceClassification",lw]],["deberta-v2",["DebertaV2ForSequenceClassification",fw]],["mpnet",["MPNetForSequenceClassification",Ow]],["albert",["AlbertForSequenceClassification",Lw]],["distilbert",["DistilBertForSequenceClassification",yw]],["roberta",["RobertaForSequenceClassification",ub]],["xlm",["XLMForSequenceClassification",hb]],["xlm-roberta",["XLMRobertaForSequenceClassification",yb]],["bart",["BartForSequenceClassification",Qw]],["mbart",["MBartForSequenceClassification",eb]],["mobilebert",["MobileBertForSequenceClassification",kw]],["squeezebert",["SqueezeBertForSequenceClassification",Dw]]]),hv=new Map([["bert",["BertForTokenClassification",Dy]],["roformer",["RoFormerForTokenClassification",Gy]],["electra",["ElectraForTokenClassification",ew]],["esm",["EsmForTokenClassification",Cw]],["convbert",["ConvBertForTokenClassification",Yy]],["camembert",["CamembertForTokenClassification",iw]],["deberta",["DebertaForTokenClassification",dw]],["deberta-v2",["DebertaV2ForTokenClassification",mw]],["mpnet",["MPNetForTokenClassification",zw]],["distilbert",["DistilBertForTokenClassification",ww]],["roberta",["RobertaForTokenClassification",lb]],["xlm",["XLMForTokenClassification",fb]],["xlm-roberta",["XLMRobertaForTokenClassification",wb]]]),Sg=new Map([["t5",["T5ForConditionalGeneration",Gw]],["longt5",["LongT5ForConditionalGeneration",qw]],["mt5",["MT5ForConditionalGeneration",Kw]],["bart",["BartForConditionalGeneration",Xw]],["mbart",["MBartForConditionalGeneration",Zw]],["marian",["MarianMTModel",f1]],["m2m_100",["M2M100ForConditionalGeneration",g1]],["blenderbot",["BlenderbotForConditionalGeneration",nb]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",ib]]]),Cg=new Map([["bloom",["BloomForCausalLM",c2]],["gpt2",["GPT2LMHeadModel",Fb]],["gptj",["GPTJForCausalLM",Hb]],["gpt_bigcode",["GPTBigCodeForCausalLM",jb]],["gpt_neo",["GPTNeoForCausalLM",Wb]],["gpt_neox",["GPTNeoXForCausalLM",Vb]],["codegen",["CodeGenForCausalLM",Yb]],["llama",["LlamaForCausalLM",Qb]],["cohere",["CohereForCausalLM",Zb]],["gemma",["GemmaForCausalLM",t2]],["openelm",["OpenELMForCausalLM",n2]],["qwen2",["Qwen2ForCausalLM",i2]],["phi",["PhiForCausalLM",o2]],["phi3",["Phi3ForCausalLM",l2]],["mpt",["MptForCausalLM",h2]],["opt",["OPTForCausalLM",m2]],["mbart",["MBartForCausalLM",tb]],["mistral",["MistralForCausalLM",H1]],["starcoder2",["Starcoder2ForCausalLM",j1]],["falcon",["FalconForCausalLM",Y1]],["trocr",["TrOCRForCausalLM",V1]],["stablelm",["StableLmForCausalLM",nv]]]),fv=new Map([["bert",["BertForMaskedLM",Py]],["roformer",["RoFormerForMaskedLM",Uy]],["electra",["ElectraForMaskedLM",Jy]],["esm",["EsmForMaskedLM",xw]],["convbert",["ConvBertForMaskedLM",jy]],["camembert",["CamembertForMaskedLM",nw]],["deberta",["DebertaForMaskedLM",uw]],["deberta-v2",["DebertaV2ForMaskedLM",hw]],["mpnet",["MPNetForMaskedLM",Mw]],["albert",["AlbertForMaskedLM",Uw]],["distilbert",["DistilBertForMaskedLM",vw]],["roberta",["RobertaForMaskedLM",ob]],["xlm",["XLMWithLMHeadModel",pb]],["xlm-roberta",["XLMRobertaForMaskedLM",_b$1]],["mobilebert",["MobileBertForMaskedLM",Tw]],["squeezebert",["SqueezeBertForMaskedLM",Bw]]]),mv=new Map([["bert",["BertForQuestionAnswering",Ny]],["roformer",["RoFormerForQuestionAnswering",Hy]],["electra",["ElectraForQuestionAnswering",tw]],["convbert",["ConvBertForQuestionAnswering",Xy]],["camembert",["CamembertForQuestionAnswering",sw]],["deberta",["DebertaForQuestionAnswering",cw]],["deberta-v2",["DebertaV2ForQuestionAnswering",gw]],["mpnet",["MPNetForQuestionAnswering",Rw]],["albert",["AlbertForQuestionAnswering",Ww]],["distilbert",["DistilBertForQuestionAnswering",bw]],["roberta",["RobertaForQuestionAnswering",db]],["xlm",["XLMForQuestionAnswering",mb]],["xlm-roberta",["XLMRobertaForQuestionAnswering",bb]],["mobilebert",["MobileBertForQuestionAnswering",Iw]],["squeezebert",["SqueezeBertForQuestionAnswering",Nw]]]),Eg=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",Cb]]]),gv=new Map([["llava",["LlavaForConditionalGeneration",km]],["moondream1",["Moondream1ForConditionalGeneration",Tb]]]),_v=new Map([["vit",["ViTForImageClassification",_2]],["fastvit",["FastViTForImageClassification",w2]],["mobilevit",["MobileViTForImageClassification",x2]],["mobilevitv2",["MobileViTV2ForImageClassification",C2]],["beit",["BeitForImageClassification",M2]],["deit",["DeiTForImageClassification",L2]],["convnext",["ConvNextForImageClassification",r1]],["convnextv2",["ConvNextV2ForImageClassification",a1]],["dinov2",["Dinov2ForImageClassification",s1]],["resnet",["ResNetForImageClassification",U2]],["swin",["SwinForImageClassification",G2]],["segformer",["SegformerForImageClassification",ev]],["efficientnet",["EfficientNetForImageClassification",iv]]]),yv=new Map([["detr",["DetrForObjectDetection",z2]],["table-transformer",["TableTransformerForObjectDetection",D2]],["yolos",["YolosForObjectDetection",u1]]]),wv=new Map([["owlvit",["OwlViTForObjectDetection",T2]],["owlv2",["Owlv2ForObjectDetection",I2]]]),bv=new Map([["detr",["DetrForSegmentation",R2]],["clipseg",["CLIPSegForImageSegmentation",Db]]]),vv=new Map([["segformer",["SegformerForSemanticSegmentation",tv]]]),$v=new Map([["sam",["SamModel",c1]]]),xv=new Map([["wav2vec2",["Wav2Vec2ForCTC",y1]],["wav2vec2-bert",["Wav2Vec2BertForCTC",I1]],["unispeech",["UniSpeechForCTC",$1]],["unispeech-sat",["UniSpeechSatForCTC",C1]],["wavlm",["WavLMForCTC",P1]],["hubert",["HubertForCTC",O1]]]),Sv=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",w1]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",A1]],["unispeech",["UniSpeechForSequenceClassification",x1]],["unispeech-sat",["UniSpeechSatForSequenceClassification",E1]],["wavlm",["WavLMForSequenceClassification",B1]],["hubert",["HubertForSequenceClassification",z1]],["audio-spectrogram-transformer",["ASTForAudioClassification",$b]]]),Cv=new Map([["wavlm",["WavLMForXVector",D1]]]),Ev=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",T1]],["wavlm",["WavLMForAudioFrameClassification",N1]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",b1]]]),Tv=new Map([["vitmatte",["VitMatteForImageMatting",v2]]]),kv=new Map([["swin2sr",["Swin2SRForImageSuperResolution",q2]]]),Iv=new Map([["dpt",["DPTForDepthEstimation",K2]],["depth_anything",["DepthAnythingForDepthEstimation",X2]],["glpn",["GLPNForDepthEstimation",J2]]]),Av=new Map([["clip",["CLIPVisionModelWithProjection",Ab]],["siglip",["SiglipVisionModel",zb]]]),Tg=[[ov,be$2.EncoderOnly],[uv,be$2.EncoderDecoder],[lv,be$2.DecoderOnly],[pv,be$2.EncoderOnly],[hv,be$2.EncoderOnly],[Sg,be$2.Seq2Seq],[xg,be$2.Seq2Seq],[Cg,be$2.DecoderOnly],[fv,be$2.EncoderOnly],[mv,be$2.EncoderOnly],[Eg,be$2.Vision2Seq],[gv,be$2.ImageTextToText],[_v,be$2.EncoderOnly],[bv,be$2.EncoderOnly],[vv,be$2.EncoderOnly],[Tv,be$2.EncoderOnly],[kv,be$2.EncoderOnly],[Iv,be$2.EncoderOnly],[yv,be$2.EncoderOnly],[wv,be$2.EncoderOnly],[$v,be$2.MaskGeneration],[xv,be$2.EncoderOnly],[Sv,be$2.EncoderOnly],[dv,be$2.Seq2Seq],[cv,be$2.EncoderOnly],[Cv,be$2.EncoderOnly],[Ev,be$2.EncoderOnly],[Av,be$2.EncoderOnly]];for(const[t,e]of Tg)for(const[r,n]of t.values())wi$1.set(r,e),qn$2.set(n,r),_m.set(r,n);const Mv=[["MusicgenForConditionalGeneration",$g,be$2.Musicgen],["CLIPTextModelWithProjection",Ib,be$2.EncoderOnly],["SiglipTextModel",Ob,be$2.EncoderOnly],["ClapTextModelWithProjection",Q1,be$2.EncoderOnly],["ClapAudioModelWithProjection",J1,be$2.EncoderOnly]];for(const[t,e,r]of Mv)wi$1.set(t,r),qn$2.set(e,t),_m.set(t,e);class Ov extends sv{static MODEL_CLASS_MAPPINGS=Tg.map(e=>e[0]);static BASE_IF_FAIL=true}let Ae$2 = class Ae extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};class zv extends Ot$2{constructor({logits:e,embeddings:r}){super(),this.logits=e,this.embeddings=r;}}let lt$2 = class lt extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};let dt$2 = class dt extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};let mt$2 = class mt extends Ot$2{constructor({start_logits:e,end_logits:r}){super(),this.start_logits=e,this.end_logits=r;}};let gn$2 = class gn extends Ot$2{constructor({logits:e}){super(),this.logits=e;}};class Rv extends Ot$2{constructor({alphas:e}){super(),this.alphas=e;}}class Pv extends Ot$2{constructor({waveform:e,spectrogram:r}){super(),this.waveform=e,this.spectrogram=r;}}const It$2=typeof self<"u",Bv=It$2&&self.constructor.name==="DedicatedWorkerGlobalScope";let kr$2,kg,fr$2;if(It$2)kr$2=(t,e)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(t,e)},fr$2=self.createImageBitmap,kg=self.ImageData;else if(Ye$2)fr$2=async t=>{const r=(await t.metadata()).channels,{data:n,info:i}=await t.rotate().raw().toBuffer({resolveWithObject:true}),a=new Vt$2(new Uint8ClampedArray(n),i.width,i.height,i.channels);return r!==void 0&&r!==i.channels&&a.convert(r),a};else throw new Error("Unable to load image processing library.");const Dv={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},Nv=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);let Vt$2 = class Vt{constructor(e,r,n,i){this.data=e,this.width=r,this.height=n,this.channels=i;}get size(){return [this.width,this.height]}static async read(e){if(e instanceof Vt)return e;if(typeof e=="string"||e instanceof URL)return await this.fromURL(e);throw new Error(`Unsupported input type: ${typeof e}`)}static fromCanvas(e){if(!It$2)throw new Error("fromCanvas() is only supported in browser environments.");const n=e.getContext("2d").getImageData(0,0,e.width,e.height).data;return new Vt(n,e.width,e.height,4)}static async fromURL(e){const r=await Rs$2(e);if(r.status!==200)throw new Error(`Unable to read image from "${e}" (${r.status} ${r.statusText})`);const n=await r.blob();return this.fromBlob(n)}static async fromBlob(e){if(It$2){const r=await fr$2(e),n=kr$2(r.width,r.height).getContext("2d");return n.drawImage(r,0,0),new this(n.getImageData(0,0,r.width,r.height).data,r.width,r.height,4)}else {const r=Ye$2(await e.arrayBuffer());return await fr$2(r)}}static fromTensor(e,r="CHW"){if(e.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${e.dims.length} dimensions.`);if(r==="CHW")e=e.transpose(1,2,0);else if(r!=="HWC")throw new Error(`Unsupported channel format: ${r}`);if(!(e.data instanceof Uint8ClampedArray||e.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${e.type}`);switch(e.dims[2]){case 1:case 2:case 3:case 4:return new Vt(e.data,e.dims[1],e.dims[0],e.dims[2]);default:throw new Error(`Unsupported number of channels: ${e.dims[2]}`)}}grayscale(){if(this.channels===1)return this;const e=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let r=0,n=0;r<this.data.length;r+=this.channels){const i=this.data[r],a=this.data[r+1],s=this.data[r+2];e[n++]=Math.round(.2989*i+.587*a+.114*s);}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,1)}rgb(){if(this.channels===3)return this;const e=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let r=0,n=0;r<this.data.length;++r)e[n++]=this.data[r],e[n++]=this.data[r],e[n++]=this.data[r];break;case 4:for(let r=0,n=0;r<this.data.length;r+=4)e[n++]=this.data[r],e[n++]=this.data[r+1],e[n++]=this.data[r+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,3)}rgba(){if(this.channels===4)return this;const e=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let r=0,n=0;r<this.data.length;++r)e[n++]=this.data[r],e[n++]=this.data[r],e[n++]=this.data[r],e[n++]=255;break;case 3:for(let r=0,n=0;r<this.data.length;r+=3)e[n++]=this.data[r],e[n++]=this.data[r+1],e[n++]=this.data[r+2],e[n++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(e,this.width,this.height,4)}async resize(e,r,{resample:n=2}={}){let i=Dv[n]??n;if(It$2){const a=this.channels,s=this.toCanvas(),o=kr$2(e,r).getContext("2d");return o.drawImage(s,0,0,e,r),new Vt(o.getImageData(0,0,e,r).data,e,r,4).convert(a)}else {let a=this.toSharp();switch(i){case "box":case "hamming":(i==="box"||i==="hamming")&&(console.warn(`Resampling method ${i} is not yet supported. Using bilinear instead.`),i="bilinear");case "nearest":case "bilinear":case "bicubic":a=a.affine([e/this.width,0,0,r/this.height],{interpolator:i});break;case "lanczos":a=a.resize({width:e,height:r,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${i} is not supported.`)}return await fr$2(a)}}async pad([e,r,n,i]){if(e=Math.max(e,0),r=Math.max(r,0),n=Math.max(n,0),i=Math.max(i,0),e===0&&r===0&&n===0&&i===0)return this;if(It$2){const a=this.channels,s=this.toCanvas(),o=this.width+e+r,u=this.height+n+i,l=kr$2(o,u).getContext("2d");return l.drawImage(s,0,0,this.width,this.height,e,n,o,u),new Vt(l.getImageData(0,0,o,u).data,o,u,4).convert(a)}else {const a=this.toSharp().extend({left:e,right:r,top:n,bottom:i});return await fr$2(a)}}async crop([e,r,n,i]){if(e=Math.max(e,0),r=Math.max(r,0),n=Math.min(n,this.width-1),i=Math.min(i,this.height-1),e===0&&r===0&&n===this.width-1&&i===this.height-1)return this;const a=n-e+1,s=i-r+1;if(It$2){const o=this.channels,u=this.toCanvas(),l=kr$2(a,s).getContext("2d");return l.drawImage(u,e,r,a,s,0,0,a,s),new Vt(l.getImageData(0,0,a,s).data,a,s,4).convert(o)}else {const o=this.toSharp().extract({left:e,top:r,width:a,height:s});return await fr$2(o)}}async center_crop(e,r){if(this.width===e&&this.height===r)return this;const n=(this.width-e)/2,i=(this.height-r)/2;if(It$2){const a=this.channels,s=this.toCanvas(),o=kr$2(e,r).getContext("2d");let u=0,l=0,h=0,f=0;return n>=0?u=n:h=-n,i>=0?l=i:f=-i,o.drawImage(s,u,l,e,r,h,f,e,r),new Vt(o.getImageData(0,0,e,r).data,e,r,4).convert(a)}else {let a=this.toSharp();if(n>=0&&i>=0)a=a.extract({left:Math.floor(n),top:Math.floor(i),width:e,height:r});else if(n<=0&&i<=0){const s=Math.floor(-i),o=Math.floor(-n);a=a.extend({top:s,left:o,right:e-this.width-o,bottom:r-this.height-s});}else {let s=[0,0],o=0;i<0?(s[0]=Math.floor(-i),s[1]=r-this.height-s[0]):o=Math.floor(i);let u=[0,0],l=0;n<0?(u[0]=Math.floor(-n),u[1]=e-this.width-u[0]):l=Math.floor(n),a=a.extend({top:s[0],bottom:s[1],left:u[0],right:u[1]}).extract({left:l,top:o,width:e,height:r});}return await fr$2(a)}}async toBlob(e="image/png",r=1){if(!It$2)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:e,quality:r})}toTensor(e="CHW"){let r=new ce$2("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(e!=="HWC")if(e==="CHW")r=r.permute(2,0,1);else throw new Error(`Unsupported channel format: ${e}`);return r}toCanvas(){if(!It$2)throw new Error("toCanvas() is only supported in browser environments.");const e=this.clone().rgba(),r=kr$2(e.width,e.height),n=new kg(e.data,e.width,e.height);return r.getContext("2d").putImageData(n,0,0),r}_update(e,r,n,i=null){return this.data=e,this.width=r,this.height=n,i!==null&&(this.channels=i),this}clone(){return new Vt(this.data.slice(),this.width,this.height,this.channels)}convert(e){if(this.channels===e)return this;switch(e){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(e){if(It$2){if(Bv)throw new Error("Unable to save an image from a Web Worker.");const r=e.split(".").pop().toLowerCase(),n=Nv.get(r)??"image/png",i=await this.toBlob(n),a=URL.createObjectURL(i),s=document.createElement("a");s.href=a,s.download=e,s.click(),s.remove();}else {if(bt$2.useFS)return await this.toSharp().toFile(e);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(It$2)throw new Error("toSharp() is only supported in server-side environments.");return Ye$2(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}};function Tc$1(t){if(t<1)return new Float64Array;if(t===1)return new Float64Array([1]);const e=t-1,r=Math.PI/e,n=new Float64Array(t);for(let i=0;i<t;++i){const a=2*i-e;n[i]=.5+.5*Math.cos(r*a);}return n}const Fv={htk:t=>2595*Math.log10(1+t/700),kaldi:t=>1127*Math.log(1+t/700),slaney:(t,e=1e3,r=15,n=27/Math.log(6.4))=>t>=e?r+Math.log(t/e)*n:3*t/200};function Is$2(t,e="htk"){const r=Fv[e];if(!r)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof t=="number"?r(t):t.map(n=>r(n))}const Lv={htk:t=>700*(10**(t/2595)-1),kaldi:t=>700*(Math.exp(t/1127)-1),slaney:(t,e=1e3,r=15,n=Math.log(6.4)/27)=>t>=r?e*Math.exp(n*(t-r)):200*t/3};function Wv(t,e="htk"){const r=Lv[e];if(!r)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof t=="number"?r(t):t.map(n=>r(n))}function Uv(t,e){const r=Float64Array.from({length:e.length-1},(s,o)=>e[o+1]-e[o]),n=Array.from({length:t.length},()=>new Array(e.length));for(let s=0;s<t.length;++s){const o=n[s];for(let u=0;u<e.length;++u)o[u]=e[u]-t[s];}const i=e.length-2,a=Array.from({length:i},()=>new Array(t.length));for(let s=0;s<t.length;++s){const o=n[s];for(let u=0;u<i;++u){const l=-o[u]/r[u],h=o[u+2]/r[u+1];a[u][s]=Math.max(0,Math.min(l,h));}}return a}function kc$1(t,e,r){const n=(e-t)/(r-1);return Float64Array.from({length:r},(i,a)=>t+n*a)}function Zn$2(t,e,r,n,i,a=null,s="htk",o=false){if(a!==null&&a!=="slaney")throw new Error('norm must be one of null or "slaney"');const u=Is$2(r,s),l=Is$2(n,s),h=kc$1(u,l,e+2);let f=Wv(h,s),m;if(o){const y=i/(t*2);m=Is$2(Float64Array.from({length:t},(b,v)=>v*y),s),f=h;}else m=kc$1(0,Math.floor(i/2),t);const c=Uv(m,f);if(a!==null&&a==="slaney")for(let y=0;y<e;++y){const b=c[y],v=2/(f[y+2]-f[y]);for(let C=0;C<t;++C)b[C]*=v;}return c}function Vv(t,e,r){const n=new t.constructor(t.length+e+r),i=t.length-1;for(let a=0;a<t.length;++a)n[e+a]=t[a];for(let a=1;a<=e;++a)n[e-a]=t[oi$2(a,i)];for(let a=1;a<=r;++a)n[i+e+a]=t[oi$2(i-a,i)];return n}function Ig(t,e,r,n,i){if(r<=0)throw new Error("reference must be greater than zero");if(n<=0)throw new Error("min_value must be greater than zero");r=Math.max(n,r);const a=Math.log10(r);for(let s=0;s<t.length;++s)t[s]=e*Math.log10(Math.max(n,t[s])-a);if(i!==null){if(i<=0)throw new Error("db_range must be greater than zero");const s=_r$2(t)[0]-i;for(let o=0;o<t.length;++o)t[o]=Math.max(t[o],s);}return t}function Gv(t,e=1,r=1e-5,n=null){return Ig(t,20,e,r,n)}function Hv(t,e=1,r=1e-10,n=null){return Ig(t,10,e,r,n)}async function Oi$1(t,e,r,n,{fft_length:i=null,power:a=1,center:s=true,pad_mode:o="reflect",onesided:u=true,preemphasis:l=null,mel_filters:h=null,mel_floor:f=1e-10,log_mel:m=null,reference:c=1,min_value:y=1e-10,db_range:b=null,remove_dc_offset:v=null,max_num_frames:C=null,do_pad:x=true,transpose:T=false}={}){const I=e.length;if(i===null&&(i=r),r>i)throw Error(`frame_length (${r}) may not be larger than fft_length (${i})`);if(I!==r)throw new Error(`Length of the window (${I}) must equal frame_length (${r})`);if(n<=0)throw new Error("hop_length must be greater than zero");if(a===null&&h!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(s){if(o!=="reflect")throw new Error(`pad_mode="${o}" not implemented yet.`);const U=Math.floor((i-1)/2)+1;t=Vv(t,U,U);}const A=Math.floor(1+Math.floor((t.length-r)/n)),R=u?Math.floor(i/2)+1:i;let z=A,P=A;C!==null&&(C>A?x&&(P=C):P=z=C);const J=new d0(i),K=new Float64Array(i),ue=new Float64Array(J.outputBufferSize),ie=new Float32Array(R*P);for(let U=0;U<z;++U){const de=U*n;for(let re=0;re<r;++re)K[re]=t[de+re];if(v){let re=0;for(let Z=0;Z<r;++Z)re+=K[Z];const Q=re/r;for(let Z=0;Z<r;++Z)K[Z]-=Q;}if(l!==null){for(let re=r-1;re>=1;--re)K[re]-=l*K[re-1];K[0]*=1-l;}for(let re=0;re<e.length;++re)K[re]*=e[re];J.realTransform(ue,K);for(let re=0;re<R;++re){const Q=re<<1;ie[re*P+U]=ue[Q]**2+ue[Q+1]**2;}}if(a!==null&&a!==2){const U=2/a;for(let de=0;de<ie.length;++de)ie[de]**=U;}const ge=h.length;let he=await Y_(new ce$2("float32",h.flat(),[ge,R]),new ce$2("float32",ie,[R,P]));T&&(he=he.transpose(1,0));const D=he.data;for(let U=0;U<D.length;++U)D[U]=Math.max(f,D[U]);if(a!==null&&m!==null){const U=Math.min(D.length,z*ge);switch(m){case "log":for(let de=0;de<U;++de)D[de]=Math.log(D[de]);break;case "log10":for(let de=0;de<U;++de)D[de]=Math.log10(D[de]);break;case "dB":if(a===1)Gv(D,c,y,b);else if(a===2)Hv(D,c,y,b);else throw new Error(`Cannot use log_mel option '${m}' with power ${a}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${m}'`)}}return he}function zi$2(t,e,{periodic:r=true,frame_length:n=null,center:i=true}={}){const a=r?t+1:t;let s;switch(e){case "boxcar":s=new Float64Array(a).fill(1);break;case "hann":case "hann_window":s=Tc$1(a);break;case "povey":s=Tc$1(a).map(o=>Math.pow(o,.85));break;default:throw new Error(`Unknown window type ${e}.`)}if(r&&(s=s.subarray(0,t)),n===null)return s;if(t>n)throw new Error(`Length of the window (${t}) may not be larger than frame_length (${n})`);return s}function qv([t,e,r,n]){return [t-r/2,e-n/2,t+r/2,e+n/2]}function Ro$2(t,e=.5,r=null,n=false){const i=t.logits,a=t.pred_boxes,[s,o,u]=i.dims;if(r!==null&&r.length!==s)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let l=[];for(let h=0;h<s;++h){let f=r!==null?r[h]:null,m={boxes:[],classes:[],scores:[]},c=i[h],y=a[h];for(let b=0;b<o;++b){let v=c[b],C=[],x;if(n){x=v.sigmoid().data;for(let T=0;T<x.length;++T)x[T]>e&&C.push(T);}else {let T=_r$2(v.data)[1];if(T===u-1||(x=ta$2(v.data),x[T]<e))continue;C.push(T);}for(const T of C){let I=y[b].data;I=qv(I),f!==null&&(I=I.map((A,R)=>A*f[(R+1)%2])),m.boxes.push(I),m.classes.push(T),m.scores.push(x[T]);}}l.push(m);}return l}function ya$2(t,e){if(!(t instanceof Float32Array||t instanceof Float64Array))throw new Error(`${e} expects input to be a Float32Array or a Float64Array, but got ${t?.constructor?.name??typeof t} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}function Ic$1(t,e,r=0,n=null){const i=t/e;let a=p0(i)*e;return n!==null&&a>n&&(a=Math.floor(i)*e),a<r&&(a=Math.ceil(i)*e),a}function As$2([t,e],r){return [Math.max(Math.floor(t/r),1)*r,Math.max(Math.floor(e/r),1)*r]}let Vr$2 = class Vr extends or$2{constructor(e){super(),this.config=e;}};let je$2 = class je extends Vr$2{constructor(e){super(e),this.image_mean=this.config.image_mean??this.config.mean,this.image_std=this.config.image_std??this.config.std,this.resample=this.config.resample??2,this.do_rescale=this.config.do_rescale??true,this.rescale_factor=this.config.rescale_factor??1/255,this.do_normalize=this.config.do_normalize,this.do_resize=this.config.do_resize,this.do_thumbnail=this.config.do_thumbnail,this.size=this.config.size,this.size_divisibility=this.config.size_divisibility??this.config.size_divisor,this.do_center_crop=this.config.do_center_crop,this.crop_size=this.config.crop_size,this.do_convert_rgb=this.config.do_convert_rgb??true,this.do_crop_margin=this.config.do_crop_margin,this.pad_size=this.config.pad_size,this.do_pad=this.config.do_pad,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=this.config.do_flip_channel_order??false;}async thumbnail(e,r,n=2){const i=e.height,a=e.width,s=r.height,o=r.width;let u=Math.min(i,s),l=Math.min(a,o);return u===i&&l===a?e:(i>a?l=Math.floor(a*u/i):a>i&&(u=Math.floor(i*l/a)),await e.resize(l,u,{resample:n}))}async crop_margin(e,r=200){const n=e.clone().grayscale(),i=u0(n.data)[0],s=_r$2(n.data)[0]-i;if(s===0)return e;const o=r/255;let u=n.width,l=n.height,h=0,f=0;const m=n.data;for(let c=0;c<n.height;++c){const y=c*n.width;for(let b=0;b<n.width;++b)(m[y+b]-i)/s<o&&(u=Math.min(u,b),l=Math.min(l,c),h=Math.max(h,b),f=Math.max(f,c));}return e=await e.crop([u,l,h,f]),e}pad_image(e,r,n,{mode:i="constant",center:a=false,constant_values:s=0}={}){const[o,u,l]=r;let h,f;if(typeof n=="number"?(h=n,f=n):(h=n.width,f=n.height),h!==u||f!==o){const m=new Float32Array(h*f*l);if(Array.isArray(s))for(let b=0;b<m.length;++b)m[b]=s[b%l];else s!==0&&m.fill(s);const[c,y]=a?[Math.floor((h-u)/2),Math.floor((f-o)/2)]:[0,0];for(let b=0;b<o;++b){const v=(b+y)*h,C=b*u;for(let x=0;x<u;++x){const T=(v+x+c)*l,I=(C+x)*l;for(let A=0;A<l;++A)m[T+A]=e[I+A];}}if(i==="symmetric"){if(a)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const b=o-1,v=u-1;for(let C=0;C<f;++C){const x=C*h,T=oi$2(C,b)*u;for(let I=0;I<h;++I){if(C<o&&I<u)continue;const A=(x+I)*l,R=(T+oi$2(I,v))*l;for(let z=0;z<l;++z)m[A+z]=e[R+z];}}}e=m,r=[f,h,l];}return [e,r]}rescale(e){for(let r=0;r<e.length;++r)e[r]=this.rescale_factor*e[r];}get_resize_output_image_size(e,r){const[n,i]=e.size;let a,s;if(this.do_thumbnail){const{height:o,width:u}=r;a=Math.min(o,u);}else Number.isInteger(r)?(a=r,s=this.config.max_size??a):r!==void 0&&(a=r.shortest_edge,s=r.longest_edge);if(a!==void 0||s!==void 0){const o=a===void 0?1:Math.max(a/n,a/i),u=n*o,l=i*o,h=s===void 0?1:Math.min(s/u,s/l);let f=Math.floor(Number((u*h).toFixed(2))),m=Math.floor(Number((l*h).toFixed(2)));return this.size_divisibility!==void 0&&([f,m]=As$2([f,m],this.size_divisibility)),[f,m]}else if(r!==void 0&&r.width!==void 0&&r.height!==void 0){let o=r.width,u=r.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let l=u/i,h=o/n;Math.abs(1-h)<Math.abs(1-l)?l=h:h=l,u=Ic$1(l*i,this.config.ensure_multiple_of),o=Ic$1(h*n,this.config.ensure_multiple_of);}return [o,u]}else {if(this.size_divisibility!==void 0)return As$2([n,i],this.size_divisibility);throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(r)}`)}}async resize(e){const[r,n]=this.get_resize_output_image_size(e,this.size);return await e.resize(r,n,{resample:this.resample})}async preprocess(e,{do_normalize:r=null,do_pad:n=null,do_convert_rgb:i=null,do_convert_grayscale:a=null,do_flip_channel_order:s=null}={}){this.do_crop_margin&&(e=await this.crop_margin(e));const[o,u]=e.size;if(i??this.do_convert_rgb?e=e.rgb():a&&(e=e.grayscale()),this.do_resize&&(e=await this.resize(e)),this.do_thumbnail&&(e=await this.thumbnail(e,this.size,this.resample)),this.do_center_crop){let c,y;Number.isInteger(this.crop_size)?(c=this.crop_size,y=this.crop_size):(c=this.crop_size.width,y=this.crop_size.height),e=await e.center_crop(c,y);}const l=[e.height,e.width];let h=Float32Array.from(e.data),f=[e.height,e.width,e.channels];if(this.do_rescale&&this.rescale(h),r??this.do_normalize){let c=this.image_mean;Array.isArray(this.image_mean)||(c=new Array(e.channels).fill(c));let y=this.image_std;if(Array.isArray(this.image_std)||(y=new Array(e.channels).fill(c)),c.length!==e.channels||y.length!==e.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${c.length}) and \`image_std\` (${y.length}) must match the number of channels in the image (${e.channels}).`);for(let b=0;b<h.length;b+=e.channels)for(let v=0;v<e.channels;++v)h[b+v]=(h[b+v]-c[v])/y[v];}if(n??this.do_pad){if(this.pad_size)[h,f]=this.pad_image(h,[e.height,e.width,e.channels],this.pad_size);else if(this.size_divisibility){const[c,y]=As$2([f[1],f[0]],this.size_divisibility);[h,f]=this.pad_image(h,f,{width:c,height:y});}}if(s??this.do_flip_channel_order){if(f[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let c=0;c<h.length;c+=3){const y=h[c];h[c]=h[c+2],h[c+2]=y;}}const m=new ce$2("float32",h,f).permute(2,0,1);return {original_size:[u,o],reshaped_input_size:l,pixel_values:m}}async _call(e,...r){Array.isArray(e)||(e=[e]);const n=await Promise.all(e.map(a=>this.preprocess(a)));return {pixel_values:Qn$2(n.map(a=>a.pixel_values),0),original_sizes:n.map(a=>a.original_size),reshaped_input_sizes:n.map(a=>a.reshaped_input_size)}}};class jv extends je$2{post_process_semantic_segmentation(e,r=null){const n=e.logits,i=n.dims[0];if(r!==null&&r.length!==i)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const a=[];for(let s=0;s<i;++s){const o=r!==null?r[s]:null;let u=n[s];o!==null&&(u=cm(u,o,"bilinear",false));const[l,h]=o??u.dims.slice(-2),f=new ce$2("int32",new Int32Array(l*h),[l,h]),m=u[0].data,c=f.data;for(let C=1;C<u.dims[0];++C){const x=u[C].data;for(let T=0;T<x.length;++T)x[T]>m[T]&&(m[T]=x[T],c[T]=C);}const y=new Array(u.dims[0]),b=f.data;for(let C=0;C<b.length;++C){const x=b[C];y[x]=x;}const v=y.filter(C=>C!==void 0);a.push({segmentation:f,labels:v});}return a}}class Ag extends je$2{}class Kv extends Ag{}class Yv extends je$2{}class Xv extends je$2{}class Mg extends je$2{}class Qv extends Mg{}class Jv extends je$2{}class Zv extends je$2{}class Og extends je$2{constructor(e){super(e),this.crop_pct=this.config.crop_pct??224/256;}async resize(e){const r=this.size?.shortest_edge;if(r===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(r<384){const n=Math.floor(r/this.crop_pct),[i,a]=this.get_resize_output_image_size(e,{shortest_edge:n});e=await e.resize(i,a,{resample:this.resample}),e=await e.center_crop(r,r);}else e=await e.resize(r,r,{resample:this.resample});return e}}class e$ extends Og{}class t$ extends je$2{}class r$ extends je$2{}class n$ extends je$2{constructor(e){super(e),this.include_top=this.config.include_top??true,this.include_top&&(this.image_std=this.image_std.map(r=>r*r));}}class zg extends je$2{}class a$ extends zg{}class Rg extends je$2{post_process_object_detection(...e){return Ro$2(...e)}}class i$ extends Rg{}class s$ extends je$2{}class o$ extends je$2{}class Pg extends je$2{pad_image(e,r,n,i={}){const[a,s,o]=r;let u=this.image_mean;Array.isArray(this.image_mean)||(u=new Array(o).fill(u));let l=this.image_std;Array.isArray(l)||(l=new Array(o).fill(u));const h=u.map((f,m)=>-f/l[m]);return super.pad_image(e,r,n,{center:true,constant_values:h,...i})}}class u$ extends Pg{}class l$ extends je$2{async _call(e){const r=await super._call(e),n=[r.pixel_values.dims[0],64,64],i=new ce$2("int64",new BigInt64Array(n.reduce((a,s)=>a*s)).fill(1n),n);return {...r,pixel_mask:i}}post_process_object_detection(...e){return Ro$2(...e)}remove_low_and_no_objects(e,r,n,i){let a=[],s=[],o=[];for(let u=0;u<e.dims[0];++u){let l=e[u],h=r[u],f=_r$2(l.data)[1];if(f===i)continue;let c=ta$2(l.data)[f];c>n&&(a.push(h),s.push(c),o.push(f));}return [a,s,o]}check_segment_validity(e,r,n,i=.5,a=.8){let s=[],o=0,u=0;const l=r[n].data;for(let f=0;f<e.length;++f)e[f]===n&&(s.push(f),++o),l[f]>=i&&++u;let h=o>0&&u>0;return h&&(h=o/u>a),[h,s]}compute_segments(e,r,n,i,a,s=null,o=null){let[u,l]=o??e[0].dims,h=new ce$2("int32",new Int32Array(u*l),[u,l]),f=[];if(o!==null)for(let v=0;v<e.length;++v)e[v]=cm(e[v],o,"bilinear",false);let m=new Int32Array(e[0].data.length),c=new Float32Array(e[0].data.length);for(let v=0;v<e.length;++v){let C=r[v];const x=e[v].data;for(let T=0;T<x.length;++T)x[T]*=C,x[T]>c[T]&&(m[T]=v,c[T]=x[T]);}let y=0;const b=h.data;for(let v=0;v<n.length;++v){let C=n[v],[x,T]=this.check_segment_validity(m,e,v,i,a);if(x){++y;for(let I of T)b[I]=y;f.push({id:y,label_id:C,score:r[v]});}}return [h,f]}post_process_panoptic_segmentation(e,r=.5,n=.5,i=.8,a=null,s=null){a===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),a=new Set);const o=e.logits,l=e.pred_masks.sigmoid();let[h,f,m]=o.dims;if(m-=1,s!==null&&s.length!==h)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let c=[];for(let y=0;y<h;++y){let b=s!==null?s[y]:null,v=o[y],C=l[y],[x,T,I]=this.remove_low_and_no_objects(v,C,r,m);if(I.length===0){let[z,P]=b??C.dims.slice(-2),J=new ce$2("int32",new Int32Array(z*P).fill(-1),[z,P]);c.push({segmentation:J,segments_info:[]});continue}let[A,R]=this.compute_segments(x,T,I,n,i,a,b);c.push({segmentation:A,segments_info:R});}return c}post_process_instance_segmentation(){throw Error("Not implemented yet")}}class d$ extends je$2{post_process_object_detection(...e){return Ro$2(...e)}}class c$ extends je$2{reshape_input_points(e,r,n,i=false){e=structuredClone(e);let a=cu(e);if(a.length===3)i||(a=[1,...a]),e=[e];else if(a.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let s=0;s<e.length;++s){let o=r[s],u=n[s],l=[u[0]/o[0],u[1]/o[1]];for(let h=0;h<e[s].length;++h)for(let f=0;f<e[s][h].length;++f)for(let m=0;m<e[s][h][f].length;++m)e[s][h][f][m]*=l[m%2];}return new ce$2("float32",Float32Array.from(e.flat(1/0)),a)}add_input_labels(e,r){let n=cu(e);if(n.length===2)n=[1,...n],e=[e];else if(n.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(n.some((i,a)=>i!==r.dims[a]))throw Error(`The first ${n.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new ce$2("int64",e.flat(1/0).map(BigInt),n)}async _call(e,{input_points:r=null,input_labels:n=null,input_boxes:i=null}={}){const a=await super._call(e);if(r&&(a.input_points=this.reshape_input_points(r,a.original_sizes,a.reshaped_input_sizes)),n){if(!a.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");a.input_labels=this.add_input_labels(n,a.input_points);}return i&&(a.input_boxes=this.reshape_input_points(i,a.original_sizes,a.reshaped_input_sizes,true)),a}async post_process_masks(e,r,n,{mask_threshold:i=0,binarize:a=true,pad_size:s=null}={}){const o=[];s=s??this.pad_size;const u=[s.height,s.width];for(let l=0;l<r.length;++l){const h=r[l],f=n[l];let m=await vc$2(e[l],{mode:"bilinear",size:u});if(m=m.slice(null,null,[0,f[0]],[0,f[1]]),m=await vc$2(m,{mode:"bilinear",size:h}),a){const c=m.data,y=new Uint8Array(c.length);for(let b=0;b<c.length;++b)c[b]>i&&(y[b]=1);m=new ce$2("bool",y,m.dims);}o.push(m);}return o}generate_crop_boxes(e,r,{crop_n_layers:n=0,overlap_ratio:i=512/1500,points_per_crop:a=32,crop_n_points_downscale_factor:s=1}={}){}}class p$ extends je$2{pad_image(e,r,n,i={}){const[a,s,o]=r;return super.pad_image(e,r,{width:s+(n-s%n)%n,height:a+(n-a%n)%n},{mode:"symmetric",center:false,constant_values:-1,...i})}}class h$ extends je$2{async _call(e,r){Array.isArray(e)||(e=[e]),Array.isArray(r)||(r=[r]);const n=await Promise.all(e.map(s=>this.preprocess(s))),i=await Promise.all(r.map(s=>this.preprocess(s,{do_normalize:false,do_convert_rgb:false,do_convert_grayscale:true})));return {pixel_values:Qn$2(n.map((s,o)=>Jt$2([s.pixel_values,i[o].pixel_values],0)),0),original_sizes:n.map(s=>s.original_size),reshaped_input_sizes:n.map(s=>s.reshaped_input_size)}}}class f$ extends Vr$2{constructor(e){super(e),this.config.mel_filters??=Zn$2(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney"),this.window=zi$2(this.config.n_fft,"hann");}async _extract_fbank_features(e){const r=await Oi$1(e,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:this.config.nb_max_frames}),n=r.data,i=_r$2(n)[0];for(let a=0;a<n.length;++a)n[a]=(Math.max(n[a],i-8)+4)/4;return r}async _call(e){ya$2(e,"WhisperFeatureExtractor");let r;return e.length>this.config.n_samples?(console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),r=e.slice(0,this.config.n_samples)):(r=new Float32Array(this.config.n_samples),r.set(e)),{input_features:(await this._extract_fbank_features(r)).unsqueeze_(0)}}}class m$ extends Vr$2{_zero_mean_unit_var_norm(e){const n=e.reduce((a,s)=>a+s,0)/e.length,i=e.reduce((a,s)=>a+(s-n)**2,0)/e.length;return e.map(a=>(a-n)/Math.sqrt(i+1e-7))}async _call(e){ya$2(e,"Wav2Vec2FeatureExtractor"),e instanceof Float64Array&&(e=new Float32Array(e));let r=e;this.config.do_normalize&&(r=this._zero_mean_unit_var_norm(r));const n=[1,r.length];return {input_values:new ce$2("float32",r,n),attention_mask:new ce$2("int64",new BigInt64Array(r.length).fill(1n),n)}}}class g$ extends Vr$2{constructor(e){super(e);const r=this.config.sampling_rate,n=Zn$2(256,this.config.num_mel_bins,20,Math.floor(r/2),r,null,"kaldi",true);for(let i=0;i<n.length;++i)n[i].push(0);this.mel_filters=n,this.window=zi$2(400,"povey",{periodic:false});}async _extract_fbank_features(e,r){return e=e.map(n=>n*32768),Oi$1(e,this.window,400,160,{fft_length:512,power:2,center:false,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:true,max_num_frames:r,transpose:true})}async _call(e,{padding:r=true,pad_to_multiple_of:n=2,do_normalize_per_mel_bins:i=true,return_attention_mask:a=true}={}){ya$2(e,"SeamlessM4TFeatureExtractor");let s=await this._extract_fbank_features(e,this.config.max_length);if(i){const[y,b]=s.dims,v=s.data;for(let C=0;C<b;++C){let x=0;for(let R=0;R<y;++R)x+=v[R*b+C];const T=x/y;let I=0;for(let R=0;R<y;++R)I+=(v[R*b+C]-T)**2;I/=y-1;const A=Math.sqrt(I+1e-7);for(let R=0;R<y;++R){const z=R*b+C;v[z]=(v[z]-T)/A;}}}let o;if(r){const[y,b]=s.dims,v=s.data,C=y%n;if(C>0){const x=new Float32Array(b*(y+C));x.set(v),x.fill(this.config.padding_value,v.length);const T=y+C;s=new ce$2(s.type,x,[T,b]),a&&(o=new ce$2("int64",new BigInt64Array(T),[1,T]),o.data.fill(1n,0,y));}}const[u,l]=s.dims,h=this.config.stride;if(u%h!==0)throw new Error(`The number of frames (${u}) must be a multiple of the stride (${h}).`);const m=s.view(1,Math.floor(u/h),l*h),c={input_features:m};if(a){const y=m.dims[1],b=new BigInt64Array(y);if(o){const v=o.data;for(let C=1,x=0;C<u;C+=h,++x)b[x]=v[C];}else b.fill(1n);c.attention_mask=new ce$2("int64",b,[1,y]);}return c}}class _$ extends Vr$2{constructor(e){super(e);const r=this.config.sampling_rate,n=Zn$2(256,this.config.num_mel_bins,20,Math.floor(r/2),r,null,"kaldi",true);for(let i=0;i<n.length;++i)n[i].push(0);this.mel_filters=n,this.window=zi$2(400,"hann",{periodic:false}),this.mean=this.config.mean,this.std=this.config.std;}async _extract_fbank_features(e,r){return Oi$1(e,this.window,400,160,{fft_length:512,power:2,center:false,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:true,max_num_frames:r,transpose:true})}async _call(e){ya$2(e,"ASTFeatureExtractor");const r=await this._extract_fbank_features(e,this.config.max_length);if(this.config.do_normalize){const n=this.std*2,i=r.data;for(let a=0;a<i.length;++a)i[a]=(i[a]-this.mean)/n;}return {input_values:r.unsqueeze_(0)}}}class y$ extends Vr$2{constructor(e){super(e),this.mel_filters=Zn$2(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=Zn$2(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=zi$2(this.config.fft_window_size,"hann");}async _get_input_mel(e,r,n,i){let a;const s=e.length-r;if(s>0)if(n==="rand_trunc"){const o=Math.floor(Math.random()*(s+1));e=e.subarray(o,o+r),a=await this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples);}else throw new Error(`Truncation strategy "${n}" not implemented`);else {if(s<0){let o=new Float64Array(r);if(o.set(e),i==="repeat")for(let u=e.length;u<r;u+=e.length)o.set(e.subarray(0,Math.min(e.length,r-u)),u);else if(i==="repeatpad")for(let u=e.length;u<-s;u+=e.length)o.set(e,u);e=o;}if(n==="fusion")throw new Error(`Truncation strategy "${n}" not implemented`);a=await this._extract_fbank_features(e,this.mel_filters_slaney,this.config.nb_max_samples);}return a.unsqueeze_(0)}async _extract_fbank_features(e,r,n=null){return Oi$1(e,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:r,log_mel:"dB",max_num_frames:n,do_pad:false,transpose:true})}async _call(e,{max_length:r=null}={}){return ya$2(e,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(e,r??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}class w$ extends Vr$2{}let _n$2 = class _n extends or$2{constructor(e){super(),this.feature_extractor=e;}async _call(e,...r){return await this.feature_extractor(e,...r)}};class b$ extends _n$2{async _call(...e){return await this.feature_extractor(...e)}post_process_masks(...e){return this.feature_extractor.post_process_masks(...e)}reshape_input_points(...e){return this.feature_extractor.reshape_input_points(...e)}}class v$ extends _n$2{async _call(e){return await this.feature_extractor(e)}}class $$ extends _n$2{async _call(e){return await this.feature_extractor(e)}}class x$ extends _n$2{async _call(e){return await this.feature_extractor(e)}}class S$ extends _n$2{}class C${static FEATURE_EXTRACTOR_CLASS_MAPPING={ImageFeatureExtractor:je$2,WhisperFeatureExtractor:f$,ViTFeatureExtractor:t$,MobileViTFeatureExtractor:zg,MobileViTImageProcessor:a$,OwlViTFeatureExtractor:Rg,Owlv2ImageProcessor:i$,CLIPFeatureExtractor:Mg,CLIPImageProcessor:Qv,ChineseCLIPFeatureExtractor:Jv,SiglipImageProcessor:Zv,ConvNextFeatureExtractor:Og,ConvNextImageProcessor:e$,SegformerFeatureExtractor:jv,BitImageProcessor:Yv,DPTImageProcessor:Kv,DPTFeatureExtractor:Ag,GLPNFeatureExtractor:Xv,BeitFeatureExtractor:o$,DeiTFeatureExtractor:s$,DetrFeatureExtractor:l$,YolosFeatureExtractor:d$,DonutFeatureExtractor:Pg,NougatImageProcessor:u$,EfficientNetImageProcessor:n$,ViTImageProcessor:r$,VitMatteImageProcessor:h$,SamImageProcessor:c$,Swin2SRImageProcessor:p$,Wav2Vec2FeatureExtractor:m$,SeamlessM4TFeatureExtractor:g$,SpeechT5FeatureExtractor:w$,ASTFeatureExtractor:_$,ClapFeatureExtractor:y$};static PROCESSOR_CLASS_MAPPING={WhisperProcessor:v$,Wav2Vec2ProcessorWithLM:$$,SamProcessor:b$,SpeechT5Processor:x$,OwlViTProcessor:S$};static async from_pretrained(e,{progress_callback:r=null,config:n=null,cache_dir:i=null,local_files_only:a=false,revision:s="main"}={}){let o=n??await on$2(e,"preprocessor_config.json",true,{progress_callback:r,cache_dir:i,local_files_only:a,revision:s}),u=o.feature_extractor_type??o.image_processor_type,l=this.FEATURE_EXTRACTOR_CLASS_MAPPING[u];if(!l)if(o.size!==void 0)console.warn(`Feature extractor type "${u}" not found, assuming ImageFeatureExtractor due to size parameter in config.`),l=je$2;else throw new Error(`Unknown Feature Extractor type: ${u}`);let h=this.PROCESSOR_CLASS_MAPPING[o.processor_class]??_n$2,f=new l(o);return new h(f)}}Pr$2.IS_PROCESS_AVAILABLE;async function E$(){try{return (await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch{return  false}}const Ri$1=document.getElementById("status"),bi$1=document.createElement("canvas"),ea$2=document.getElementById("output-canvas"),Fr$2=document.getElementById("video"),Xs$2=document.getElementById("size"),T$=document.getElementById("size-value"),Qs$2=document.getElementById("scale"),k$=document.getElementById("scale-value");function Bg(t,e){Fr$2.width=ea$2.width=bi$1.width=Math.round(t),Fr$2.height=ea$2.height=bi$1.height=Math.round(e);}Ri$1.textContent="Loading model...";const Dg="onnx-community/depth-anything-v2-small";let Ng;try{Ng=await Ov.from_pretrained(Dg,{device:"webgpu",dtype:await E$()?"fp16":"fp32"});}catch(t){throw Ri$1.textContent=t.message,alert(t.message),t}const Po$2=await C$.from_pretrained(Dg);let dn$2=504;Po$2.feature_extractor.size={width:dn$2,height:dn$2};Xs$2.addEventListener("input",()=>{dn$2=Number(Xs$2.value),Po$2.feature_extractor.size={width:dn$2,height:dn$2},T$.textContent=dn$2;});Xs$2.disabled=false;let cn$2=.4;Qs$2.addEventListener("input",()=>{cn$2=Number(Qs$2.value),Bg(Fr$2.videoWidth*cn$2,Fr$2.videoHeight*cn$2),k$.textContent=cn$2;});Qs$2.disabled=false;Ri$1.textContent="Ready";let Ms$2=false,Os$2;const Ac$1=bi$1.getContext("2d",{willReadFrequently:true}),I$=ea$2.getContext("2d",{willReadFrequently:true});function Fg(){const{width:t,height:e}=bi$1;Ms$2||(Ms$2=true,async function(){Ac$1.drawImage(Fr$2,0,0,t,e);const r=Ac$1.getImageData(0,0,t,e),n=new Vt$2(r.data,t,e,4),i=await Po$2(n),{predicted_depth:a}=await Ng(i),s=a.data,[o,u,l]=a.dims;let h=1/0,f=-1/0;ea$2.width=l,ea$2.height=u;for(let b=0;b<s.length;++b){const v=s[b];v<h&&(h=v),v>f&&(f=v);}const m=f-h,c=new Uint8ClampedArray(4*s.length);for(let b=0;b<s.length;++b){const v=4*b;c[v]=255,c[v+3]=255*(1-(s[b]-h)/m);}const y=new ImageData(c,l,u);if(I$.putImageData(y,0,0),Os$2!==void 0){const b=1e3/(performance.now()-Os$2);Ri$1.textContent=`FPS: ${b.toFixed(2)}`;}Os$2=performance.now(),Ms$2=false;}()),window.requestAnimationFrame(Fg);}navigator.mediaDevices.getUserMedia({video:{width:720,height:720}}).then(t=>{Fr$2.srcObject=t,Fr$2.play();const e=t.getVideoTracks()[0],{width:r,height:n}=e.getSettings();Bg(r*cn$2,n*cn$2),setTimeout(Fg,50);}).catch(t=>{alert(t);});
   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ^
2392|  
2393|  const scriptRel = 'modulepreload';const assetsURL = function(dep) { return "/chess/"+dep };const seen = {};const __vitePreload = function preload(baseModule, deps, importerUrl) {

    at failureErrorWithLog (/Users/robblack/chess/node_modules/esbuild/lib/main.js:1472:15)
    at /Users/robblack/chess/node_modules/esbuild/lib/main.js:755:50
    at responseCallbacks.<computed> (/Users/robblack/chess/node_modules/esbuild/lib/main.js:622:9)
    at handleIncomingPacket (/Users/robblack/chess/node_modules/esbuild/lib/main.js:677:12)
    at Socket.readFromStdout (/Users/robblack/chess/node_modules/esbuild/lib/main.js:600:7)
    at Socket.emit (node:events:517:28)
    at addChunk (node:internal/streams/readable:368:12)
    at readableAddChunk (node:internal/streams/readable:341:9)
    at Readable.push (node:internal/streams/readable:278:10)
    at Pipe.onStreamRead (node:internal/stream_base_commons:190:23)
